(()=>{var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire94c2;null==parcelRequire&&(parcelRequire=function(e){if(e in $parcel$modules)return $parcel$modules[e].exports;if(e in $parcel$inits){var t=$parcel$inits[e];delete $parcel$inits[e];var i={id:e,exports:{}};return $parcel$modules[e]=i,t.call(i.exports,i,i.exports),i.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a},parcelRequire.register=function(e,t){$parcel$inits[e]=t},$parcel$global.parcelRequire94c2=parcelRequire),parcelRequire.register("hJIwW",(function(e,t){var i=parcelRequire("iLgc0"),a=i.UIKit,r=i.TabBarController,s=i.Kernel,o=i.FileStorage,n=i.Setting,l=parcelRequire("jdqER"),d=parcelRequire("ljwly"),h=parcelRequire("jfaRJ"),c=parcelRequire("aXe3x");const p=new o;class u extends s{constructor(){let e;super(),this.query=$context.query,this.fileStorage=p;try{e=__SETTING__}catch{}this.setting=new n({fileStorage:this.fileStorage,structure:e}),this.setting.loadConfig(),this.storage=new l(this.setting.get("clipboard.autoSync"),this),this.initComponents(),c(this)}initComponents(){this.clipboard=new d(this),this.actionManager=new h(this)}deleteConfirm(e,t){$ui.alert({title:e,actions:[{title:$l10n("DELETE"),style:$alertActionType.destructive,handler:()=>{t()}},{title:$l10n("CANCEL")}]})}}class g{static renderMainUI(){const e=new u,t={clipboard:{icon:"doc.on.clipboard",title:$l10n("CLIPBOARD")},actions:{icon:"command",title:$l10n("ACTIONS")},setting:{icon:"gear",title:$l10n("SETTING")}};if(e.setting.setEvent("onSet",(e=>{"mainUIDisplayMode"===e&&$delay(.3,(()=>$addin.restart()))})),0===e.setting.get("mainUIDisplayMode"))e.useJsboxNav(),e.setting.useJsboxNav(),e.setNavButtons([{symbol:t.setting.icon,title:t.setting.title,handler:()=>{a.push({title:t.setting.title,views:[e.setting.getListView()]})}},{symbol:t.actions.icon,title:t.actions.title,handler:()=>{e.actionManager.present()}}]),e.UIRender(e.clipboard.getNavigationView().getPage());else{e.tabBarController=new r;const i=e.clipboard.getNavigationView();e.tabBarController.setPages({clipboard:i.getPage(),actions:e.actionManager.getPageView(),setting:e.setting.getPageView()}).setCells({clipboard:t.clipboard,actions:t.actions,setting:t.setting}),e.UIRender(e.tabBarController.generateView().definition)}}static renderKeyboardUI(){const e=new u,t=new(parcelRequire("1t2b4"))(e);$ui.render({views:[t.getView()]})}static renderTodayUI(){const e=new u,t=new(parcelRequire("4RtRK"))(e);$ui.render({views:[t.getView()]})}static renderUnsupported(){$intents.finish("不支持在此环境中运行"),$ui.render({views:[{type:"label",props:{text:"不支持在此环境中运行",align:$align.center},layout:$layout.fill}]})}}class ${static widgetInstance(e,...t){if($file.exists(`/scripts/widget/${e}.js`)){const{Widget:i}=require(`./widget/${e}.js`);return new i(...t)}return!1}static renderError(){$widget.setTimeline({render:()=>({type:"text",props:{text:"Invalid argument"}})})}static renderClipboard(){const e=new n;e.loadConfig().setReadonly();$.widgetInstance("Clipboard",e,new l(!1,{fileStorage:p})).render()}static render(e=$widget.inputValue){"Clipboard"===(e=e??"Clipboard")?$.renderClipboard():$.renderError()}}e.exports={Widget:$,run:()=>{$app.env===$env.app||$app.env===$env.action?g.renderMainUI():$app.env===$env.keyboard?g.renderKeyboardUI():$app.env===$env.widget?$.render():$app.env===$env.today?g.renderTodayUI():g.renderUnsupported()}}})),parcelRequire.register("iLgc0",(function(module,exports){var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==$parcel$global?$parcel$global:{},$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire94c2;null==parcelRequire&&(parcelRequire=function(e){if(e in $parcel$modules)return $parcel$modules[e].exports;if(e in $parcel$inits){var t=$parcel$inits[e];delete $parcel$inits[e];var i={id:e,exports:{}};return $parcel$modules[e]=i,t.call(i.exports,i,i.exports),i.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a},parcelRequire.register=function(e,t){$parcel$inits[e]=t},$parcel$global.parcelRequire94c2=parcelRequire),parcelRequire.register("hRZVz",(function(module,exports){var $d0276c71af360aa0$require$Controller=$2af90aa604fd0097$exports.Controller,$d0276c71af360aa0$require$l10n=$62460e67380da48b$exports.l10n,$d0276c71af360aa0$require$UIKit=$64717582e22fe5d9$exports.UIKit,$d0276c71af360aa0$require$FileStorage=$97b9cd7a6713ce56$exports.FileStorage,$ifAas1=parcelRequire("ifAas"),$d0276c71af360aa0$require$NavigationView=$ifAas1.NavigationView,$ieG9D1=parcelRequire("ieG9D"),$d0276c71af360aa0$require$NavigationBar=$ieG9D1.NavigationBar,$4iwee1=parcelRequire("4iwee"),$d0276c71af360aa0$require$ViewController=$4iwee1.ViewController;class SettingLoadConfigError extends Error{constructor(){super("Call loadConfig() first."),this.name="SettingLoadConfigError"}}class SettingReadonlyError extends Error{constructor(){super("Attempted to assign to readonly property."),this.name="SettingReadonlyError"}}class Setting extends $d0276c71af360aa0$require$Controller{name;setting={};userData;fileStorage;imagePath;viewController=new $d0276c71af360aa0$require$ViewController;method={};rowHeight=50;edgeOffset=10;iconSize=30;#e={};#t=!1;#i=!1;#a;constructor(e={}){super(),"function"==typeof e.set&&"function"==typeof e.get?(this.set=e.set,this.get=e.get,this.userData=e.userData):(this.fileStorage=e.fileStorage??new $d0276c71af360aa0$require$FileStorage,this.dataFile=e.dataFile??"setting.json"),e.structure?this.setStructure(e.structure):this.setStructurePath(e.structurePath??"setting.json"),this.isUseJsboxNav=e.isUseJsboxNav??!1,this.imagePath=(e.name??"default")+".image",this.setName(e.name??$text.uuid),this.loadL10n()}useJsboxNav(){return this.isUseJsboxNav=!0,this}#r(){if(!this.#i)throw new SettingLoadConfigError}loadConfig(){const e=["script","info"],t=this.userData??this.fileStorage.readAsJSON("",this.dataFile,{});return this.setting=function i(a){const r={};for(let s of a)for(let a of s.items)if("child"===a.type){const e=i(a.children);Object.assign(r,e)}else-1===e.indexOf(a.type)?r[a.key]=a.key in t?t[a.key]:a.value:r[a.key]=a.value;return r}(this.structure),this.#i=!0,this}hasSectionTitle(e){return this.#r(),!!e[0].title}loadL10n(){$d0276c71af360aa0$require$l10n("zh-Hans",'\n            "OK" = "好";\n            "CANCEL" = "取消";\n            "CLEAR" = "清除";\n            "BACK" = "返回";\n            "ERROR" = "发生错误";\n            "SUCCESS" = "成功";\n            "LOADING" = "加载中";\n            "INVALID_VALUE" = "非法参数";\n            \n            "SETTING" = "设置";\n            "GENERAL" = "一般";\n            "ADVANCED" = "高级";\n            "TIPS" = "小贴士";\n            "COLOR" = "颜色";\n            "COPY" = "复制";\n            "COPIED" = "复制成功";\n            \n            "JSBOX_ICON" = "JSBox 内置图标";\n            "SF_SYMBOLS" = "SF Symbols";\n            "IMAGE_BASE64" = "图片 / base64";\n\n            "PREVIEW" = "预览";\n            "SELECT_IMAGE" = "选择图片";\n            "CLEAR_IMAGE" = "清除图片";\n            "NO_IMAGE" = "无图片";\n            \n            "ABOUT" = "关于";\n            "VERSION" = "Version";\n            "AUTHOR" = "作者";\n            "AT_BOTTOM" = "已经到底啦~";\n            ',!1),$d0276c71af360aa0$require$l10n("en",'\n            "OK" = "OK";\n            "CANCEL" = "Cancel";\n            "CLEAR" = "Clear";\n            "BACK" = "Back";\n            "ERROR" = "Error";\n            "SUCCESS" = "Success";\n            "LOADING" = "Loading";\n            "INVALID_VALUE" = "Invalid value";\n\n            "SETTING" = "Setting";\n            "GENERAL" = "General";\n            "ADVANCED" = "Advanced";\n            "TIPS" = "Tips";\n            "COLOR" = "Color";\n            "COPY" = "Copy";\n            "COPIED" = "Copide";\n\n            "JSBOX_ICON" = "JSBox in app icon";\n            "SF_SYMBOLS" = "SF Symbols";\n            "IMAGE_BASE64" = "Image / base64";\n\n            "PREVIEW" = "Preview";\n            "SELECT_IMAGE" = "Select Image";\n            "CLEAR_IMAGE" = "Clear Image";\n            "NO_IMAGE" = "No Image";\n\n            "ABOUT" = "About";\n            "VERSION" = "Version";\n            "AUTHOR" = "Author";\n            "AT_BOTTOM" = "It\'s the end~";\n            ',!1)}setUserData(e){this.userData=e}setStructure(e){return this.structure=e,this}setStructurePath(e){return this.structure||this.setStructure($d0276c71af360aa0$require$FileStorage.readFromRootAsJSON(e)),this}setName(e){return this.name=e,this}setFooter(e){return this.#a=e,this}set footer(e){this.#a=e}get footer(){if(void 0===this.#a){let e=$d0276c71af360aa0$require$FileStorage.readFromRootAsJSON("config.json",{}).info??{};if(!e.version||!e.author)try{e=__INFO__}catch{}this.#a=e.version&&e.author?{type:"view",props:{height:130},views:[{type:"label",props:{font:$font(14),text:`${$l10n("VERSION")} ${e.version} ♥ ${e.author}`,textColor:$color({light:"#C0C0C0",dark:"#545454"}),align:$align.center},layout:e=>{e.left.right.inset(0),e.top.inset(10)}}]}:{}}return this.#a}setReadonly(){return this.#t=!0,this}set(e,t){if(this.#t)throw new SettingReadonlyError;return this.#r(),this.setting[e]=t,this.fileStorage.write("",this.dataFile,$data({string:JSON.stringify(this.setting)})),this.callEvent("onSet",e,t),!0}get(e,t=null){return this.#r(),Object.prototype.hasOwnProperty.call(this.setting,e)?this.setting[e]:t}getColor(e){return"string"==typeof e?$color(e):$rgba(e.red,e.green,e.blue,e.alpha)}getImageName(e,t=!1){let i=$text.MD5(e)+".jpg";return t&&(i="compress."+i),i}getImage(e,t=!1){try{const i=this.getImageName(e,t);return this.fileStorage.read(this.imagePath,i).image}catch(e){if(e instanceof FileStorageFileNotFoundError)return null;throw e}}getId(e){return`setting-${this.name}-${e}`}#s(e){$(e).bgcolor=$color("systemFill")}#o(e,t=.3){0===t?$(e).bgcolor=$color("clear"):$ui.animate({duration:t,animation:()=>{$(e).bgcolor=$color("clear")}})}#n(e,t,i=!1,a=0){if(t=Object.assign(t,{touchesBegan:()=>{this.#s(e),this.#e[e]=$delay(1,(()=>this.#o(e,0)))},touchesMoved:()=>{this.#e[e]?.cancel(),this.#o(e,0)}}),i){const i=t.tapped;t.tapped=()=>{this.#s(e),setTimeout((()=>this.#o(e)),1e3*a),"function"==typeof i&&i()}}return t}createLineLabel(e,t){return t[1]||(t[1]="#00CC00"),"object"!=typeof t[1]&&(t[1]=[t[1],t[1]]),"object"!=typeof t[0]&&(t[0]=[t[0],t[0]]),{type:"view",views:[{type:"view",props:{bgcolor:$color(t[1][0],t[1][1]),cornerRadius:5,smoothCorners:!0},views:[{type:"image",props:{tintColor:$color("white"),image:$image(t[0][0],t[0][1])},layout:(e,t)=>{e.center.equalTo(t.super),e.size.equalTo(20)}}],layout:(e,t)=>{e.centerY.equalTo(t.super),e.size.equalTo(this.iconSize),e.left.inset(this.edgeOffset)}},{type:"label",props:{text:e,lines:1,textColor:this.textColor,align:$align.left},layout:(e,t)=>{e.centerY.equalTo(t.super),e.height.equalTo(t.super),e.left.equalTo(t.prev.right).offset(this.edgeOffset)}}],layout:(e,t)=>{e.height.centerY.equalTo(t.super),e.left.inset(0)}}}createInfo(e,t,i){const a=Array.isArray(i),r=a?i[0]:i,s=a?i[1]:i;return{type:"view",props:{selectable:!0},views:[this.createLineLabel(t,e),{type:"label",props:{text:r,align:$align.right,textColor:$color("darkGray")},layout:(e,t)=>{e.centerY.equalTo(t.prev),e.right.inset(this.edgeOffset),e.width.equalTo(180)}},{type:"view",events:{tapped:()=>{$ui.alert({title:t,message:s,actions:[{title:$l10n("COPY"),handler:()=>{$clipboard.text=s,$ui.toast($l10n("COPIED"))}},{title:$l10n("OK")}]})}},layout:(e,t)=>{e.right.inset(0),e.size.equalTo(t.super)}}],layout:$layout.fill}}createSwitch(e,t,i){return{type:"view",props:{id:this.getId(e),selectable:!0},views:[this.createLineLabel(i,t),{type:"switch",props:{on:this.get(e),onColor:$color("#00CC00")},events:{changed:t=>{try{this.set(e,t.on)}catch(e){throw t.on=!t.on,e}}},layout:(e,t)=>{e.centerY.equalTo(t.prev),e.right.inset(this.edgeOffset)}}],layout:$layout.fill}}createString(e,t,i){return{type:"view",props:{id:this.getId(e),selectable:!0},views:[this.createLineLabel(i,t),{type:"button",props:{symbol:"square.and.pencil",bgcolor:$color("clear"),tintColor:$color("primaryText")},events:{tapped:t=>{const i=$ui.popover({sourceView:t,sourceRect:t.bounds,directions:$popoverDirection.down,size:$size(320,150),views:[{type:"text",props:{id:`${this.name}-string-${e}`,align:$align.left,text:this.get(e)},layout:e=>{e.left.right.inset(10),e.top.inset(20),e.height.equalTo(90)}},{type:"button",props:{symbol:"checkmark",bgcolor:$color("clear"),titleEdgeInsets:10,contentEdgeInsets:0},layout:e=>{e.right.inset(10),e.bottom.inset(25),e.size.equalTo(30)},events:{tapped:()=>{this.set(e,$(`${this.name}-string-${e}`).text),i.dismiss()}}}]})}},layout:(e,t)=>{e.centerY.equalTo(t.prev),e.right.inset(0),e.size.equalTo(50)}}],layout:$layout.fill}}createNumber(e,t,i){const a=this.getId(e),r=`${a}-label`;return{type:"view",props:{id:a,selectable:!0},views:[this.createLineLabel(i,t),{type:"label",props:{id:r,align:$align.right,text:this.get(e)},events:{tapped:()=>{$input.text({type:$kbType.decimal,text:this.get(e),placeholder:i,handler:t=>{""!==t&&/^[0-9]+.?[0-9]*$/.test(t)?(this.set(e,t),$(r).text=t):$ui.toast($l10n("INVALID_VALUE"))}})}},layout:(e,t)=>{e.centerY.equalTo(t.prev),e.right.inset(this.edgeOffset),e.height.equalTo(this.rowHeight),e.width.equalTo(100)}}],layout:$layout.fill}}createStepper(e,t,i,a,r){const s=this.getId(e),o=`${s}-label`;return{type:"view",props:{id:s,selectable:!0},views:[this.createLineLabel(i,t),{type:"label",props:{id:o,text:this.get(e),textColor:this.textColor,align:$align.left},layout:(e,t)=>{e.height.equalTo(t.super),e.right.inset(120)}},{type:"stepper",props:{min:a,max:r,value:this.get(e)},events:{changed:t=>{$(o).text=t.value;try{this.set(e,t.value)}catch(t){throw $(o).text=this.get(e),t}}},layout:(e,t)=>{e.centerY.equalTo(t.prev),e.right.inset(this.edgeOffset)}}],layout:$layout.fill}}createScript(key,icon,title,script){const id7=this.getId(key),buttonId=`${id7}-button`,actionStart=()=>{$(buttonId).alpha=0,$(`${buttonId}-spinner`).alpha=1,this.#s(id7)},actionCancel=()=>{$(buttonId).alpha=1,$(`${buttonId}-spinner`).alpha=0,this.#o(id7)},actionDone=(e=!0,t=$l10n("ERROR"))=>{$(`${buttonId}-spinner`).alpha=0,this.#o(id7);const i=$(buttonId);if(!e)return $ui.toast(t),void(i.alpha=1);i.symbol="checkmark",$ui.animate({duration:.6,animation:()=>{i.alpha=1},completion:()=>{setTimeout((()=>{$ui.animate({duration:.4,animation:()=>{i.alpha=0},completion:()=>{i.symbol="chevron.right",$ui.animate({duration:.4,animation:()=>{i.alpha=1},completion:()=>{i.alpha=1}})}})}),600)}})};return{type:"view",props:{id:id7},views:[this.createLineLabel(title,icon),{type:"view",views:[{type:"image",props:{id:buttonId,symbol:"chevron.right",tintColor:$color("secondaryText")},layout:(e,t)=>{e.centerY.equalTo(t.super),e.right.inset(0),e.size.equalTo(15)}},{type:"spinner",props:{id:`${buttonId}-spinner`,loading:!0,alpha:0},layout:(e,t)=>{e.size.equalTo(t.prev),e.left.top.equalTo(t.prev)}}],layout:(e,t)=>{e.right.inset(this.edgeOffset),e.height.equalTo(this.rowHeight),e.width.equalTo(t.super)}}],events:this.#n(id7,{tapped:()=>{const animate={actionStart:actionStart,actionCancel:actionCancel,actionDone:actionDone,touchHighlightStart:()=>this.#s(id7),touchHighlightEnd:()=>this.#o(id7)};"function"==typeof script?script(animate):script.startsWith("this")?eval(`(()=>{return ${script}(animate)})()`):eval(script)}}),layout:$layout.fill}}createTab(key,icon,title,items,values){"string"==typeof items?items=eval(`(()=>{return ${items}()})()`):"function"==typeof items&&(items=items()),"string"==typeof values?values=eval(`(()=>{return ${values}()})()`):"function"==typeof values&&(values=values());const id8=this.getId(key),isCustomizeValues=items?.length>0&&values?.length===items?.length;return{type:"view",props:{id:id8,selectable:!0},views:[this.createLineLabel(title,icon),{type:"tab",props:{items:items??[],index:isCustomizeValues?values.indexOf(this.get(key)):this.get(key),dynamicWidth:!0},layout:(e,t)=>{e.right.inset(this.edgeOffset),e.centerY.equalTo(t.prev)},events:{changed:e=>{isCustomizeValues?this.set(key,values[e.index]):this.set(key,e.index)}}}],layout:$layout.fill}}createMenu(key,icon,title1,items,values){const id9=this.getId(key),labelId=`${id9}-label`,getItems=()=>{let res;return res="string"==typeof items?eval(`(()=>{return ${items}()})()`):"function"==typeof items?items():items??[],res},getValues=()=>{let res;return res="string"==typeof values?eval(`(()=>{return ${values}()})()`):"function"==typeof values?values():values,res},tmpItems1=getItems(),tmpValues1=getValues(),isCustomizeValues=tmpItems1?.length>0&&tmpValues1?.length===tmpItems1?.length;return{type:"view",props:{id:id9,selectable:!0},views:[this.createLineLabel(title1,icon),{type:"view",views:[{type:"label",props:{text:isCustomizeValues?tmpItems1[tmpValues1.indexOf(this.get(key))]:tmpItems1[this.get(key)],color:$color("secondaryText"),id:labelId},layout:(e,t)=>{e.right.inset(0),e.height.equalTo(t.super)}}],layout:(e,t)=>{e.right.inset(this.edgeOffset),e.height.equalTo(this.rowHeight),e.width.equalTo(t.super)}}],events:{tapped:()=>{const e=getItems(),t=getValues();$ui.menu({items:e,handler:(e,i)=>{isCustomizeValues?this.set(key,t[i]):this.set(key,i),$(labelId).text=$l10n(e)}})}},layout:$layout.fill}}createColor(e,t,i){const a=this.getId(e),r=`${a}-color`;return{type:"view",props:{id:a,selectable:!0},views:[this.createLineLabel(i,t),{type:"view",views:[{type:"view",props:{id:r,bgcolor:this.getColor(this.get(e)),circular:!0,borderWidth:1,borderColor:$color("#e3e3e3")},layout:(e,t)=>{e.centerY.equalTo(t.super),e.right.inset(this.edgeOffset),e.size.equalTo(20)}},{type:"view",events:{tapped:async()=>{const t=await $picker.color({color:this.getColor(this.get(e))});this.set(e,t.components),$(r).bgcolor=$rgba(t.components.red,t.components.green,t.components.blue,t.components.alpha)}},layout:(e,t)=>{e.right.inset(0),e.height.width.equalTo(t.super.height)}}],layout:(e,t)=>{e.height.equalTo(this.rowHeight),e.width.equalTo(t.super)}}],layout:$layout.fill}}createDate(e,t,i,a=2){const r=this.getId(e),s=e=>{let t="";switch("number"==typeof e&&(e=new Date(e)),a){case 0:t=e.toLocaleTimeString();break;case 1:t=e.toLocaleDateString();break;case 2:t=e.toLocaleString()}return t};return{type:"view",props:{id:r,selectable:!0},views:[this.createLineLabel(i,t),{type:"view",views:[{type:"label",props:{id:`${r}-label`,color:$color("secondaryText"),text:this.get(e)?s(this.get(e)):"None"},layout:(e,t)=>{e.right.inset(0),e.height.equalTo(t.super)}}],events:{tapped:async()=>{const t=this.get(e),i=await $picker.date({props:{mode:a,date:t||Date.now()}});this.set(e,i.getTime()),$(`${r}-label`).text=s(i)}},layout:(e,t)=>{e.right.inset(this.edgeOffset),e.height.equalTo(this.rowHeight),e.width.equalTo(t.super)}}],layout:$layout.fill}}createInput(e,t,i){return{type:"view",props:{id:this.getId(e),selectable:!0},views:[this.createLineLabel(i,t),{type:"view",views:[{type:"input",props:{align:$align.right,bgcolor:$color("clear"),textColor:$color("secondaryText"),text:this.get(e)},layout:function(e,t){e.right.inset(0),e.size.equalTo(t.super)},events:{didBeginEditing:()=>{$app.autoKeyboardEnabled||($app.autoKeyboardEnabled=!0)},returned:e=>{e.blur()},didEndEditing:t=>{this.set(e,t.text),t.blur()}}}],layout:(e,t)=>{e.left.equalTo(t.prev.get("label").right).offset(this.edgeOffset),e.right.inset(this.edgeOffset),e.height.equalTo(t.super)}}],layout:$layout.fill}}createIcon(e,t,i,a="#000000"){const r=this.getId(e),s=`${r}-image`;return{type:"view",props:{id:r,selectable:!0},views:[this.createLineLabel(i,t),{type:"view",views:[{type:"image",props:{cornerRadius:8,bgcolor:"string"==typeof a?$color(a):a,smoothCorners:!0},layout:(e,t)=>{e.right.inset(this.edgeOffset),e.centerY.equalTo(t.super),e.size.equalTo($size(30,30))}},{type:"image",props:{id:s,image:$image(this.get(e)),icon:$icon(this.get(e).slice(5,this.get(e).indexOf(".")),$color("#ffffff")),tintColor:$color("#ffffff")},layout:(e,t)=>{e.right.equalTo(t.prev).offset(-5),e.centerY.equalTo(t.super),e.size.equalTo($size(20,20))}}],events:{tapped:()=>{$ui.menu({items:[$l10n("JSBOX_ICON"),$l10n("SF_SYMBOLS"),$l10n("IMAGE_BASE64")],handler:async(t,i)=>{if(0===i){const t=await $ui.selectIcon();this.set(e,t),$(s).icon=$icon(t.slice(5,t.indexOf(".")),$color("#ffffff"))}else 1!==i&&2!==i||$input.text({text:"",placeholder:t,handler:t=>{""!==t?(this.set(e,t),1===i?$(s).symbol=t:$(s).image=$image(t)):$ui.toast($l10n("INVALID_VALUE"))}})}})}},layout:(e,t)=>{e.right.inset(0),e.height.equalTo(this.rowHeight),e.width.equalTo(t.super)}}],layout:$layout.fill}}createChild(e,t,i,a){const r=this.getId(e);return{type:"view",layout:$layout.fill,props:{id:r,selectable:!0},views:[this.createLineLabel(i,t),{type:"image",props:{symbol:"chevron.right",tintColor:$color("secondaryText")},layout:(e,t)=>{e.centerY.equalTo(t.super),e.right.inset(this.edgeOffset),e.size.equalTo(15)}}],events:{tapped:()=>{setTimeout((()=>{if(this.events?.onChildPush)this.callEvent("onChildPush",this.getListView(a,{}),i);else if(this.isUseJsboxNav)$d0276c71af360aa0$require$UIKit.push({title:i,bgcolor:$d0276c71af360aa0$require$UIKit.scrollViewBackgroundColor,views:[this.getListView(a,{})]});else{const e=new $d0276c71af360aa0$require$NavigationView;e.setView(this.getListView(a,{})).navigationBarTitle(i),e.navigationBarItems.addPopButton(),e.navigationBar.setLargeTitleDisplayMode($d0276c71af360aa0$require$NavigationBar.largeTitleDisplayModeNever),this.hasSectionTitle(a)&&e.navigationBar.setContentViewHeightOffset(-10),this.viewController.push(e)}}))}}}}createImage(e,t,i){const a=this.getId(e),r=`${a}-image`;return{type:"view",props:{id:a,selectable:!0},views:[this.createLineLabel(i,t),{type:"view",views:[{type:"image",props:{id:r,image:this.getImage(e,!0)??$image("questionmark.square.dashed")},layout:(e,t)=>{e.right.inset(this.edgeOffset),e.centerY.equalTo(t.super),e.size.equalTo($size(30,30))}}],events:{tapped:()=>{this.#s(a),$ui.menu({items:[$l10n("PREVIEW"),$l10n("SELECT_IMAGE"),$l10n("CLEAR_IMAGE")],handler:(t,i)=>{if(0===i){const t=this.getImage(e);t?$quicklook.open({image:t}):$ui.toast($l10n("NO_IMAGE"))}else 1===i?$photo.pick({format:"data"}).then((t=>{if($ui.toast($l10n("LOADING")),!t.status||!t.data)return void("canceled"!==t?.error?.description&&$ui.toast($l10n("ERROR")));const i=compressImage(t.data.image);this.fileStorage.write(this.imagePath,this.getImageName(e,!0),i.jpg(.8)),this.fileStorage.write(this.imagePath,this.getImageName(e),t.data),$(r).image=i,$ui.success($l10n("SUCCESS"))})):2===i&&(this.fileStorage.delete(this.imagePath,this.getImageName(e,!0)),this.fileStorage.delete(this.imagePath,this.getImageName(e)),$(r).image=$image("questionmark.square.dashed"),$ui.success($l10n("SUCCESS")))},finished:()=>{this.#o(a)}})}},layout:(e,t)=>{e.right.inset(0),e.height.equalTo(this.rowHeight),e.width.equalTo(t.super)}}],layout:$layout.fill}}#l(e){const t=[];for(let i of e){const e=[];for(let t of i.items){const i=this.get(t.key);let a=null;switch(t.icon||(t.icon=["square.grid.2x2.fill","#00CC00"]),"object"==typeof t.items&&(t.items=t.items.map((e=>$l10n(e)))),t.title=$l10n(t.title),t.type){case"switch":a=this.createSwitch(t.key,t.icon,t.title);break;case"stepper":a=this.createStepper(t.key,t.icon,t.title,t.min??1,t.max??12);break;case"string":a=this.createString(t.key,t.icon,t.title);break;case"number":a=this.createNumber(t.key,t.icon,t.title);break;case"info":a=this.createInfo(t.icon,t.title,i);break;case"script":a=this.createScript(t.key,t.icon,t.title,i);break;case"tab":a=this.createTab(t.key,t.icon,t.title,t.items,t.values);break;case"menu":a=this.createMenu(t.key,t.icon,t.title,t.items,t.values);break;case"color":a=this.createColor(t.key,t.icon,t.title);break;case"date":a=this.createDate(t.key,t.icon,t.title,t.mode);break;case"input":a=this.createInput(t.key,t.icon,t.title);break;case"icon":a=this.createIcon(t.key,t.icon,t.title,t.bgcolor);break;case"child":a=this.createChild(t.key,t.icon,t.title,t.children);break;case"image":a=this.createImage(t.key,t.icon,t.title);break;default:continue}e.push(a)}t.push({title:$l10n(i.title??""),rows:e})}return t}getListView(e,t=this.footer){return{type:"list",props:{id:this.name,style:2,separatorInset:$insets(0,this.iconSize+2*this.edgeOffset,0,this.edgeOffset),bgcolor:$d0276c71af360aa0$require$UIKit.scrollViewBackgroundColor,footer:t,data:this.#l(e??this.structure)},layout:$layout.fill,events:{rowHeight:(e,t)=>(e.object(t)?.props?.info??{}).rowHeight??this.rowHeight}}}getPageView(){const e=new $d0276c71af360aa0$require$NavigationView;return e.setView(this.getListView(this.structure)).navigationBarTitle($l10n("SETTING")),this.hasSectionTitle(this.structure)&&e.navigationBar.setContentViewHeightOffset(-10),e.getPage()}}module.exports={Setting:Setting}}));var $2af90aa604fd0097$exports={};class $2af90aa604fd0097$var$Controller{events={};setEvents(e){return Object.keys(e).forEach((t=>this.setEvent(t,e[t]))),this}setEvent(e,t){return this.events[e]=t,this}callEvent(e,...t){"function"==typeof this.events[e]&&this.events[e](...t)}}$2af90aa604fd0097$exports={Controller:$2af90aa604fd0097$var$Controller};var $62460e67380da48b$exports={};const $62460e67380da48b$var$VERSION="1.3.0";function $62460e67380da48b$var$versionCompare(e="",t=""){let i=e.split("."),a=t.split("."),r=Math.max(i.length,a.length),s=0;for(let e=0;e<r;e++){let t=i.length>e?i[e]:0,r=isNaN(Number(t))?t.charCodeAt():Number(t),o=a.length>e?a[e]:0,n=isNaN(Number(o))?o.charCodeAt():Number(o);if(r<n){s=-1;break}if(r>n){s=1;break}}return s}function $62460e67380da48b$var$l10n(e,t,i=!0){if("string"==typeof t){const e={};t.split(";").forEach((t=>{if(""!==(t=t.trim())){const i=t.split("=");e[i[0].trim().slice(1,-1)]=i[1].trim().slice(1,-1)}})),t=e}const a=$app.strings;a[e]=i?Object.assign($app.strings[e],t):Object.assign(t,$app.strings[e]),$app.strings=a}function $62460e67380da48b$var$objectEqual(e,t){let i=Object.getOwnPropertyNames(e),a=Object.getOwnPropertyNames(t);if(i.length!==a.length)return!1;for(let a=0;a<i.length;a++){let r=i[a],s=e[r],o=t[r];if(Array.isArray(s)){for(let e=0;e<s.length;e++)if(!$62460e67380da48b$var$objectEqual(s[e],o[e]))return!1}else{if("object"==typeof s)return $62460e67380da48b$var$objectEqual(s,o);if(s!==o)return!1}}return!0}function $62460e67380da48b$var$compressImage(e,t=921600){const i=$imagekit.info(e);if(i.height*i.width>t){const a=t/(i.height*i.width);e=$imagekit.scaleBy(e,a)}return e}String.prototype.trim=function(e,t){return e?"l"===t?this.replace(new RegExp("^\\"+e+"+","g"),""):"r"===t?this.replace(new RegExp("\\"+e+"+$","g"),""):this.replace(new RegExp("^\\"+e+"+|\\"+e+"+$","g"),""):this.replace(/^\s+|\s+$/g,"")};var $64717582e22fe5d9$exports={};class $64717582e22fe5d9$var$UIKit{static#d=$objc("UIApplication").$sharedApplication();static align={left:0,right:1,top:2,bottom:3};static textColor=$color("primaryText","secondaryText");static linkColor=$color("systemLink");static primaryViewBackgroundColor=$color("primarySurface");static scrollViewBackgroundColor=$color("insetGroupedBackground");static scrollViewList=["list","matrix"];static isLargeScreen=$device.isIpad||$device.isIpadPro;static get windowSize(){return $objc("UIWindow").$keyWindow().jsValue().size}static NavigationBarNormalHeight=$objc("UINavigationController").invoke("alloc.init").$navigationBar().jsValue().frame.height;static NavigationBarLargeTitleHeight=$objc("UITabBarController").invoke("alloc.init").$tabBar().jsValue().frame.height+$64717582e22fe5d9$var$UIKit.NavigationBarNormalHeight;static get isSplitScreenMode(){return $64717582e22fe5d9$var$UIKit.isLargeScreen&&$device.info.screen.width!==$64717582e22fe5d9$var$UIKit.windowSize.width}static get statusBarHeight(){return $app.isDebugging?0:$64717582e22fe5d9$var$UIKit.#d.$statusBarFrame().height}static get statusBarOrientation(){return $64717582e22fe5d9$var$UIKit.#d.$statusBarOrientation()}static get isHorizontal(){return 3===$64717582e22fe5d9$var$UIKit.statusBarOrientation||4===$64717582e22fe5d9$var$UIKit.statusBarOrientation}static loading(){const e=$ui.create($64717582e22fe5d9$var$UIKit.blurBox({cornerRadius:15},[{type:"spinner",props:{loading:!0,style:0},layout:(e,t)=>{e.size.equalTo(t.prev),e.center.equalTo(t.super)}}]));return{start:()=>{$ui.controller.view.insertAtIndex(e,0),e.layout(((e,t)=>{e.center.equalTo(t.super);const i=Math.min(.6*$64717582e22fe5d9$var$UIKit.windowSize.width,300);e.size.equalTo($size(i,i))})),e.moveToFront()},end:()=>{e.remove()}}}static defaultBackgroundColor(e){return $64717582e22fe5d9$var$UIKit.scrollViewList.indexOf(e)>-1?$64717582e22fe5d9$var$UIKit.scrollViewBackgroundColor:$64717582e22fe5d9$var$UIKit.primaryViewBackgroundColor}static separatorLine(e={},t=$64717582e22fe5d9$var$UIKit.align.bottom){return{type:"canvas",props:e,layout:(e,i)=>{void 0===i.prev?e.top.equalTo(i.super):t===$64717582e22fe5d9$var$UIKit.align.bottom?e.top.equalTo(i.prev.bottom):e.top.equalTo(i.prev.top),e.height.equalTo(1/$device.info.screen.scale),e.left.right.inset(0)},events:{draw:(t,i)=>{i.strokeColor=e.bgcolor??$color("separatorColor"),i.setLineWidth(1),i.moveToPoint(0,0),i.addLineToPoint(t.frame.width,0),i.strokePath()}}}}static blurBox(e={},t=[],i=$layout.fill){return{type:"blur",props:Object.assign({style:$blurStyle.thinMaterial},e),views:t,layout:i}}static push({views:e,statusBarStyle:t=0,title:i="",navButtons:a=[{title:""}],bgcolor:r=e[0]?.props?.bgcolor??"primarySurface",disappeared:s}={}){$ui.push({props:{statusBarStyle:t,navButtons:a,title:i,bgcolor:"string"==typeof r?$color(r):r},events:{disappeared:()=>{void 0!==s&&s()}},views:[{type:"view",views:e,layout:(e,t)=>{e.top.equalTo(t.super.safeArea),e.bottom.equalTo(t.super),e.left.right.equalTo(t.super.safeArea)}}]})}}$64717582e22fe5d9$exports={UIKit:$64717582e22fe5d9$var$UIKit};var $62460e67380da48b$require$UIKit=$64717582e22fe5d9$exports.UIKit;class $62460e67380da48b$var$Kernel{startTime=Date.now();version=$62460e67380da48b$var$VERSION;isUseJsboxNav=!1;constructor(){$app.isDebugging&&this.debug()}l10n(e,t,i=!0){$62460e67380da48b$var$l10n(e,t,i)}debug(e,t){this.debugMode=!0,$app.idleTimerDisabled=!0,"function"==typeof e&&(this.debugPrint=e),"function"==typeof t&&(this.debugError=t),this.print("You are running EasyJsBox in debug mode.")}print(e){this.debugMode&&("function"==typeof this.debugPrint?this.debugPrint(e):console.log(e))}error(e){this.debugMode&&("function"==typeof this.debugError?this.debugError(e):console.error(e))}useJsboxNav(){return this.isUseJsboxNav=!0,this}setTitle(e){this.isUseJsboxNav&&($ui.title=e),this.title=e}setNavButtons(e){this.navButtons=e}UIRender(e){try{e.props=Object.assign({title:this.title,navBarHidden:!this.isUseJsboxNav,navButtons:this.navButtons??[],statusBarStyle:0},e.props),e.events||(e.events={});const t=e.events.layoutSubviews;e.events.layoutSubviews=()=>{$app.notify({name:"interfaceOrientationEvent",object:{statusBarOrientation:$62460e67380da48b$require$UIKit.statusBarOrientation,isHorizontal:$62460e67380da48b$require$UIKit.isHorizontal}}),"function"==typeof t&&t()},$ui.render(e)}catch(e){this.print(e)}}async checkUpdate(e){const t=await $http.get("https://raw.githubusercontent.com/ipuppet/EasyJsBox/dev/dist/easy-jsbox.js");if(t.error)throw t.error;const i=new RegExp('.*VERSION.?=.?"([0-9.]*)"'),a=t.data.match(i)[1];this.print(`latestVersion: ${a}`),$62460e67380da48b$var$versionCompare(a,$62460e67380da48b$var$VERSION)>0&&"function"==typeof e&&e(t.data)}}$62460e67380da48b$exports={VERSION:$62460e67380da48b$var$VERSION,versionCompare:$62460e67380da48b$var$versionCompare,l10n:$62460e67380da48b$var$l10n,objectEqual:$62460e67380da48b$var$objectEqual,compressImage:$62460e67380da48b$var$compressImage,Kernel:$62460e67380da48b$var$Kernel};var $97b9cd7a6713ce56$exports={};class $97b9cd7a6713ce56$var$FileStorageParameterError extends Error{constructor(e){super(`Parameter [${e}] is required.`),this.name="FileStorageParameterError"}}class $97b9cd7a6713ce56$var$FileStorageFileNotFoundError extends Error{constructor(e){super(`File not found: ${e}`),this.name="FileStorageFileNotFoundError"}}class $97b9cd7a6713ce56$var$FileStorage{basePath;constructor({basePath:e="storage"}={}){this.basePath=e,this.#h(this.basePath)}#h(e){$file.isDirectory(e)||$file.mkdir(e)}#c(e="",t){return e=`${this.basePath}/${e.trim("/")}`.trim("/"),this.#h(e),`${e}/${t}`}write(e="",t,i){if(!t)throw new $97b9cd7a6713ce56$var$FileStorageParameterError("fileName");if(!i)throw new $97b9cd7a6713ce56$var$FileStorageParameterError("data");return $file.write({data:i,path:this.#c(e,t)})}writeSync(e="",t,i){return new Promise(((a,r)=>{try{const s=this.write(e,t,i);s?a(s):r(s)}catch(e){r(e)}}))}exists(e="",t){if(!t)throw new $97b9cd7a6713ce56$var$FileStorageParameterError("fileName");return e=this.#c(e,t),!!$file.exists(e)&&e}read(e="",t){if(!t)throw new $97b9cd7a6713ce56$var$FileStorageParameterError("fileName");if(e=this.#c(e,t),!$file.exists(e))throw new $97b9cd7a6713ce56$var$FileStorageFileNotFoundError(e);return $file.isDirectory(e)?$file.list(e):$file.read(e)}readSync(e="",t){return new Promise(((i,a)=>{try{const r=this.read(e,t);r?i(r):a()}catch(e){a(e)}}))}readAsJSON(e="",t,i=null){try{const i=this.read(e,t)?.string;return JSON.parse(i)}catch(e){return i}}static readFromRoot(e){if(!e)throw new $97b9cd7a6713ce56$var$FileStorageParameterError("path");if(!$file.exists(e))throw new $97b9cd7a6713ce56$var$FileStorageFileNotFoundError(e);return $file.isDirectory(e)?$file.list(e):$file.read(e)}static readFromRootSync(e=""){return new Promise(((t,i)=>{try{const a=$97b9cd7a6713ce56$var$FileStorage.readFromRoot(e);a?t(a):i()}catch(e){i(e)}}))}static readFromRootAsJSON(e="",t=null){try{const t=$97b9cd7a6713ce56$var$FileStorage.readFromRoot(e)?.string;return JSON.parse(t)}catch(e){return t}}delete(e="",t=""){return $file.delete(this.#c(e,t))}}$97b9cd7a6713ce56$exports={FileStorage:$97b9cd7a6713ce56$var$FileStorage},parcelRequire.register("ifAas",(function(e,t){var i=$c448a874e2cf17a6$exports.View,a=$c448a874e2cf17a6$exports.PageView,r=parcelRequire("1HpaF").ValidationError,s=$64717582e22fe5d9$exports.UIKit,o=parcelRequire("ieG9D"),n=o.NavigationBar,l=o.NavigationBarController,d=parcelRequire("dRsJ3").NavigationBarItems;class h extends r{constructor(e,t){super(e,t),this.name="NavigationViewTypeError"}}e.exports={NavigationView:class{page;navigationController=new l;navigationBar=new n;navigationBarItems=new d;constructor(){this.navigationBar.navigationBarItems=this.navigationBarItems,this.navigationController.navigationBar=this.navigationBar}navigationBarTitle(e){return this.navigationBar.setTitle(e),this}setView(e){if("object"!=typeof e)throw new h("view","object");return this.view=i.create(e),this}#p(){if(!(this.view instanceof i))throw new h("view","View");let e=this.navigationBar.contentViewHeightOffset;if(this.navigationBarItems.titleView&&(e+=this.navigationBarItems.titleView.topOffset,e+=this.navigationBarItems.titleView.height,e+=this.navigationBarItems.titleView.bottomOffset),this.view.props.stickyHeader?e+=this.navigationBar.largeTitleFontHeight:this.navigationBar.largeTitleDisplayMode===n.largeTitleDisplayModeNever?e+=this.navigationBar.navigationBarNormalHeight:e+=this.navigationBar.navigationBarLargeTitleHeight,this.view.props.header?this.view.props.header={type:"view",props:{height:e+(this.view.props.header?.props?.height??0)},views:[{type:"view",props:{clipsToBounds:!0},views:[this.view.props.header],layout:(t,i)=>{t.top.inset(e),t.height.equalTo(this.view.props.header?.props?.height??0),t.width.equalTo(i.super)}}]}:this.view.props.header={props:{height:e}},this.view.props.footer||(this.view.props.footer={}),this.view.props.footer.props=Object.assign(this.view.props.footer.props??{},{height:(this.navigationBarItems.fixedFooterView?.height??0)+(this.view.props.footer.props?.height??0)}),-1===s.scrollViewList.indexOf(this.view.type))this.view.layout=(e,t)=>{e.left.right.equalTo(t.super.safeArea),e.bottom.equalTo(t.super);let i=this.navigationBar.contentViewHeightOffset;this.navigationBar.largeTitleDisplayMode!==n.largeTitleDisplayModeNever&&(i+=this.navigationBar.largeTitleFontHeight),this.navigationBarItems.titleView&&(i+=this.navigationBarItems.titleView.topOffset+this.navigationBarItems.titleView.bottomOffset),s.isHorizontal&&!s.isLargeScreen||!this.navigationBar.addStatusBarHeight||(i+=s.statusBarHeight),e.top.equalTo(this.navigationBar.navigationBarNormalHeight+i)};else{const e=this.navigationBarItems.isPinTitleView?this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset+this.navigationBar.contentViewHeightOffset:0;if(this.view.props.indicatorInsets){const t=this.view.props.indicatorInsets;this.view.props.indicatorInsets=$insets(t.top+this.navigationBar.navigationBarNormalHeight+e,t.left,t.bottom+(this.navigationBarItems.fixedFooterView?.height??0),t.right)}else this.view.props.indicatorInsets=$insets(this.navigationBar.navigationBarNormalHeight+e,0,this.navigationBarItems.fixedFooterView?.height??0,0);this.view.layout=(e,t)=>{this.view.props.stickyHeader?e.top.equalTo(t.super.safeArea).offset(this.navigationBar.navigationBarNormalHeight):e.top.equalTo(t.super),e.left.right.equalTo(t.super.safeArea),e.bottom.equalTo(t.super)},this.view.assignEvent("didScroll",(e=>{let t=e.contentOffset.y;s.isHorizontal&&!s.isLargeScreen||!this.navigationBar.addStatusBarHeight||this.view.props.stickyHeader||(t+=s.statusBarHeight),this.navigationController.didScroll(t)})).assignEvent("didEndDragging",((e,t)=>{let i=e.contentOffset.y,a=0;s.isHorizontal&&!s.isLargeScreen||!this.navigationBar.addStatusBarHeight||this.view.props.stickyHeader||(i+=s.statusBarHeight,a=s.statusBarHeight),this.navigationController.didEndDragging(i,t,((...t)=>e.scrollToOffset(...t)),a)})).assignEvent("didEndDecelerating",((...e)=>{e[0].tracking||this.view.events?.didEndDragging(...e)}))}}#u(){if(this.navigationBar.prefersLargeTitles){this.#p();let e={};if(this.navigationBarItems.titleView){const t=this.navigationBar.prefersLargeTitles;e=i.create({views:[this.navigationBar.backgroundColor?{type:"view",props:{hidden:t,bgcolor:this.navigationBar.backgroundColor,id:this.navigationBar.id+"-title-view-background"},layout:$layout.fill}:s.blurBox({hidden:t,id:this.navigationBar.id+"-title-view-background"}),s.separatorLine({id:this.navigationBar.id+"-title-view-underline",alpha:t?0:1}),this.navigationBarItems.titleView.definition],layout:(e,t)=>{e.top.equalTo(t.prev.bottom),e.width.equalTo(t.super),e.height.equalTo(this.navigationBarItems.titleView.topOffset+this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset)}})}this.page=a.createByViews([this.view,this.navigationBar.getLargeTitleView(),e,this.navigationBar.getNavigationBarView(),this.navigationBarItems.fixedFooterView?.definition??{}])}else this.page=a.createByViews([this.view]);return this.view.props?.bgcolor?this.page.setProp("bgcolor",this.view.props.bgcolor):this.page.setProp("bgcolor",s.defaultBackgroundColor(this.view.type)),this}getPage(){return this.page||this.#u(),this.page}}}}));var $c448a874e2cf17a6$exports={};class $c448a874e2cf17a6$var$View{id=$text.uuid;type;props;views;events;layout;constructor({type:e="view",props:t={},views:i=[],events:a={},layout:r=$layout.fill}={}){this.type=e,this.props=t,this.views=i,this.events=a,this.layout=r,this.props.id?this.id=this.props.id:this.props.id=this.id}static create(e){return new this(e)}static createByViews(e){return new this({views:e})}setProps(e){return Object.keys(e).forEach((t=>this.setProp(t,e[t]))),this}setProp(e,t){return"id"===e&&(this.id=t),this.props[e]=t,this}setViews(e){return this.views=e,this}setEvents(e){return Object.keys(e).forEach((t=>this.setEvent(t,e[t]))),this}setEvent(e,t){return this.events[e]=t,this}eventMiddleware(e,t){const i=this.events[e];return this.events[e]=(...e)=>{"function"==typeof i&&t(i,...e)},this}assignEvent(e,t){const i=this.events[e];return this.events[e]=(...e)=>{"function"==typeof i&&i(...e),t(...e)},this}setLayout(e){return this.layout=e,this}getView(){return this}get definition(){return this.getView()}}class $c448a874e2cf17a6$var$PageView extends $c448a874e2cf17a6$var$View{constructor(e={}){super(e),this.activeStatus=!0}show(){$(this.props.id).hidden=!1,this.activeStatus=!0}hide(){$(this.props.id).hidden=!0,this.activeStatus=!1}setHorizontalSafeArea(e){return this.horizontalSafeArea=e,this}#g(e,t){e.top.bottom.equalTo(t.super),this.horizontalSafeArea?e.left.right.equalTo(t.super.safeArea):e.left.right.equalTo(t.super)}getView(){return this.layout=this.#g,this.props.clipsToBounds=!0,this.props.hidden=!this.activeStatus,super.getView()}}$c448a874e2cf17a6$exports={View:$c448a874e2cf17a6$var$View,PageView:$c448a874e2cf17a6$var$PageView},parcelRequire.register("1HpaF",(function(e,t){class i extends Error{constructor(e,t){super(`The type of the parameter '${e}' must be '${t}'`),this.name="ValidationError"}}e.exports={ValidationError:i}})),parcelRequire.register("ieG9D",(function(e,t){var i=$c448a874e2cf17a6$exports.View,a=$2af90aa604fd0097$exports.Controller,r=$64717582e22fe5d9$exports.UIKit,s=parcelRequire("dRsJ3").BarButtonItem;class o extends i{static largeTitleDisplayModeAutomatic=0;static largeTitleDisplayModeAlways=1;static largeTitleDisplayModeNever=2;static pageSheetNavigationBarHeight=56;navigationBarItems;title="";prefersLargeTitles=!0;largeTitleDisplayMode=o.largeTitleDisplayModeAutomatic;largeTitleFontSize=34;largeTitleFontFamily="bold";largeTitleFontHeight=$text.sizeThatFits({text:"A",width:100,font:$font(this.largeTitleFontFamily,this.largeTitleFontSize)}).height;navigationBarTitleFontSize=17;addStatusBarHeight=!0;contentViewHeightOffset=10;navigationBarNormalHeight=r.NavigationBarNormalHeight;navigationBarLargeTitleHeight=r.NavigationBarLargeTitleHeight;pageSheetMode(){return this.navigationBarLargeTitleHeight-=this.navigationBarNormalHeight,this.navigationBarNormalHeight=o.pageSheetNavigationBarHeight,this.navigationBarLargeTitleHeight+=this.navigationBarNormalHeight,this.addStatusBarHeight=!1,this}withStatusBarHeight(){return this.addStatusBarHeight=!0,this}withoutStatusBarHeight(){return this.addStatusBarHeight=!1,this}setLargeTitleDisplayMode(e){return this.largeTitleDisplayMode=e,this}setBackgroundColor(e){return this.backgroundColor=e,this}setTitle(e){return this.title=e,this}setPrefersLargeTitles(e){return this.prefersLargeTitles=e,this}setContentViewHeightOffset(e){return this.contentViewHeightOffset=e,this}getLargeTitleView(){return this.prefersLargeTitles&&this.largeTitleDisplayMode!==o.largeTitleDisplayModeNever?{type:"label",props:{id:this.id+"-large-title",text:this.title,textColor:r.textColor,align:$align.left,font:$font(this.largeTitleFontFamily,this.largeTitleFontSize),line:1},layout:(e,t)=>{e.left.equalTo(t.super.safeArea).offset(15),e.height.equalTo(this.largeTitleFontHeight),e.top.equalTo(t.super.safeAreaTop).offset(this.navigationBarNormalHeight)}}:{}}getNavigationBarView(){const e=(e,t)=>e.length>0?{type:"view",views:[{type:"view",views:e,layout:$layout.fill}],layout:(i,a)=>{i.top.equalTo(a.super.safeAreaTop),i.bottom.equalTo(a.super.safeAreaTop).offset(this.navigationBarNormalHeight),t===r.align.left?i.left.equalTo(a.super.safeArea):i.right.equalTo(a.super.safeArea),i.width.equalTo(e.length*s.size.width)}}:{},t=e(this.navigationBarItems.rightButtons,r.align.right),i=this.navigationBarItems.popButtonView??e(this.navigationBarItems.leftButtons,r.align.left),a=this.prefersLargeTitles,n=!this.prefersLargeTitles||this.largeTitleDisplayMode===o.largeTitleDisplayModeNever;return{type:"view",props:{id:this.id+"-navigation",bgcolor:$color("clear")},layout:(e,t)=>{e.left.top.right.inset(0),e.bottom.equalTo(t.super.safeAreaTop).offset(this.navigationBarNormalHeight)},views:[this.backgroundColor?{type:"view",props:{hidden:a,bgcolor:this.backgroundColor,id:this.id+"-background"},layout:$layout.fill}:r.blurBox({hidden:a,id:this.id+"-background"}),r.separatorLine({id:this.id+"-underline",alpha:a?0:1}),{type:"view",props:{hidden:!0,bgcolor:$color("clear"),id:this.id+"-large-title-mask"},layout:$layout.fill},{type:"label",props:{id:this.id+"-small-title",alpha:n?1:0,text:this.title,font:$font(this.largeTitleFontFamily,this.navigationBarTitleFontSize),align:$align.center,bgcolor:$color("clear"),textColor:r.textColor},layout:(e,t)=>{e.left.right.inset(0),e.height.equalTo(20),e.centerY.equalTo(t.super.safeArea)}}].concat(t,i)}}}class n extends a{static largeTitleViewSmallMode=0;static largeTitleViewLargeMode=1;navigationBar;updateSelector(){this.selector={navigation:$(this.navigationBar.id+"-navigation"),largeTitleView:$(this.navigationBar.id+"-large-title"),smallTitleView:$(this.navigationBar.id+"-small-title"),underlineView:this.navigationBar.navigationBarItems.isPinTitleView?$(this.navigationBar.id+"-title-view-underline"):$(this.navigationBar.id+"-underline"),largeTitleMaskView:$(this.navigationBar.id+"-large-title-mask"),backgroundView:$(this.navigationBar.id+"-background"),titleViewBackgroundView:$(this.navigationBar.id+"-title-view-background")}}toNormal(e=!0){this.updateSelector(),$ui.animate({duration:.2,animation:()=>{this.selector.underlineView.alpha=1,this.selector.backgroundView.hidden=!1,this.selector.smallTitleView.alpha=1,this.selector.largeTitleView.alpha=0}}),e&&this.navigationBar.navigationBarItems&&(this.navigationBar.largeTitleDisplayMode=o.largeTitleDisplayModeNever)}toLargeTitle(e=!0){this.updateSelector(),this.selector.underlineView.alpha=0,this.selector.backgroundView.hidden=!0,$ui.animate({duration:.2,animation:()=>{this.selector.smallTitleView.alpha=0,this.selector.largeTitleView.alpha=1}}),e&&this.navigationBar.navigationBarItems&&(this.navigationBar.largeTitleDisplayMode=o.largeTitleDisplayModeAlways)}#$(e){const t=e===n.largeTitleViewSmallMode;$ui.animate({duration:.2,animation:()=>{this.selector.smallTitleView.alpha=t?1:0,this.selector.largeTitleView.alpha=t?0:1}})}#f(e){if(this.selector.largeTitleView.updateLayout(((t,i)=>{this.navigationBar.navigationBarNormalHeight-e>0?t.top.equalTo(i.super.safeAreaTop).offset(this.navigationBar.navigationBarNormalHeight-e):t.top.equalTo(i.super.safeAreaTop).offset(0)})),e>0)e>=this.navigationBar.navigationBarNormalHeight?this.#$(n.largeTitleViewSmallMode):this.#$(n.largeTitleViewLargeMode);else{this.#$(n.largeTitleViewLargeMode);let t=this.navigationBar.largeTitleFontSize-.04*e;t>40&&(t=40),this.selector.largeTitleView.font=$font(this.navigationBar.largeTitleFontFamily,t)}}#v(e){if(this.navigationBar.navigationBarItems.isPinTitleView&&(this.navigationBar.navigationBarNormalHeight-e>0?this.selector.titleViewBackgroundView.hidden=!0:this.selector.titleViewBackgroundView.hidden=!1),e>(this.navigationBar.largeTitleDisplayMode===o.largeTitleDisplayModeNever?5:this.navigationBar.navigationBarNormalHeight))this.selector.largeTitleMaskView.hidden=!0,$ui.animate({duration:.2,animation:()=>{this.selector.underlineView.hidden=!1,this.selector.backgroundView.hidden=!1}});else{const e=this.selector.largeTitleView?.prev.bgcolor;this.selector.largeTitleMaskView.bgcolor=e,this.selector.largeTitleMaskView.hidden=!1,this.selector.underlineView.hidden=!0,this.selector.backgroundView.hidden=!0}}didScroll(e){if(!this.navigationBar.prefersLargeTitles)return;const t=this.navigationBar.largeTitleDisplayMode;t!==o.largeTitleDisplayModeAlways&&(this.updateSelector(),t===o.largeTitleDisplayModeAutomatic?(!this.navigationBar.navigationBarItems?.isPinTitleView&&(this.navigationBar.navigationBarItems?.titleView?.controller.didScroll(e),e>0)&&(e-=this.navigationBar.navigationBarItems?.titleView?.height??0)<0&&(e=0),this.#f(e),this.#v(e)):t===o.largeTitleDisplayModeNever&&this.#v(e))}didEndDragging(e,t,i,a){if(!this.navigationBar.prefersLargeTitles)return;const r=this.navigationBar.largeTitleDisplayMode;if(r!==o.largeTitleDisplayModeAlways&&(this.updateSelector(),r===o.largeTitleDisplayModeAutomatic)){let r=0;this.navigationBar.navigationBarItems?.isPinTitleView||(this.navigationBar.navigationBarItems?.titleView?.controller.didEndDragging(e,t,i,a),r=this.navigationBar.navigationBarItems?.titleView?.height??0,e-=r),e>=0&&e<=this.navigationBar.largeTitleFontHeight&&i($point(0,e>=this.navigationBar.largeTitleFontHeight/2?this.navigationBar.navigationBarNormalHeight+r-a:r-a))}}}e.exports={NavigationBar:o,NavigationBarController:n}})),parcelRequire.register("dRsJ3",(function(e,t){var i=$c448a874e2cf17a6$exports.View,a=$64717582e22fe5d9$exports.UIKit;class r extends i{static size=$size(38,38);static iconSize=$size(23,23);static edges=15;title="";align=a.align.right;setTitle(e=""){return this.title=e,this}setSymbol(e){return this.symbol=e,this}setMenu(e){return this.menu=e,this}setAlign(e){return this.align=e,this}#m(){$(this.id).hidden=!0,$("spinner-"+this.id).hidden=!1}#b(){const e=$(`icon-button-${this.id}`),t=$(`icon-checkmark-${this.id}`);e.alpha=0,$(this.id).hidden=!1,$("spinner-"+this.id).hidden=!0,$ui.animate({duration:.6,animation:()=>{t.alpha=1},completion:()=>{$delay(.3,(()=>$ui.animate({duration:.6,animation:()=>{t.alpha=0},completion:()=>{$ui.animate({duration:.4,animation:()=>{e.alpha=1},completion:()=>{e.alpha=1}})}})))}})}#y(){$(this.id).hidden=!1,$("spinner-"+this.id).hidden=!0}getView(){const e=this.events.tapped;return this.events.tapped=t=>{e&&e({start:()=>this.#m(),done:()=>this.#b(),cancel:()=>this.#y()},t)},{type:"view",views:[{type:"button",props:Object.assign({id:this.id,bgcolor:$color("clear"),tintColor:a.textColor,titleColor:a.textColor,contentEdgeInsets:$insets(0,0,0,0),titleEdgeInsets:$insets(0,0,0,0),imageEdgeInsets:$insets(0,0,0,0)},this.menu?{menu:this.menu}:{},this.title?.length>0?{title:this.title}:{},this.props),views:[{type:"image",props:Object.assign({id:`icon-button-${this.id}`,hidden:void 0===this.symbol,tintColor:a.textColor},void 0===this.symbol?{}:"string"==typeof this.symbol?{symbol:this.symbol}:{data:this.symbol.png}),layout:(e,t)=>{e.center.equalTo(t.super),e.size.equalTo(r.iconSize)}},{type:"image",props:{id:`icon-checkmark-${this.id}`,alpha:0,tintColor:a.textColor,symbol:"checkmark"},layout:(e,t)=>{e.center.equalTo(t.super),e.size.equalTo(r.iconSize)}}],events:this.events,layout:$layout.fill},{type:"spinner",props:{id:"spinner-"+this.id,loading:!0,hidden:!0},layout:$layout.fill}],layout:(e,t)=>{if(e.size.equalTo(r.size),e.centerY.equalTo(t.super),t.prev&&"label"!==t.prev.id&&void 0!==t.prev.id)this.align===a.align.right?e.right.equalTo(t.prev.left):e.left.equalTo(t.prev.right);else{const t=this.symbol?r.edges/2:r.edges;this.align===a.align.right?e.right.inset(t):e.left.inset(t)}}}}static creat({symbol:e,title:t,tapped:i,menu:s,events:o,align:n=a.align.right}){const l=new r;return l.setEvents(Object.assign({tapped:i},o)).setAlign(n).setSymbol(e).setTitle(t).setMenu(s),l}}e.exports={BarTitleView:class extends i{height=20;topOffset=15;bottomOffset=10;controller={};setController(e){return this.controller=e,this}},BarButtonItem:r,NavigationBarItems:class{rightButtons=[];leftButtons=[];hasbutton=!1;isPinTitleView=!1;setTitleView(e){return this.titleView=e,this}pinTitleView(){return this.isPinTitleView=!0,this}setFixedFooterView(e){return this.fixedFooterView=e,this}setRightButtons(e){return e.forEach((e=>this.addRightButton(e))),this.hasbutton||(this.hasbutton=!0),this}setLeftButtons(e){return e.forEach((e=>this.addLeftButton(e))),this.hasbutton||(this.hasbutton=!0),this}addRightButton({symbol:e,title:t,tapped:i,menu:s,events:o}){return this.rightButtons.push(r.creat({symbol:e,title:t,tapped:i,menu:s,events:o,align:a.align.right}).definition),this.hasbutton||(this.hasbutton=!0),this}addLeftButton({symbol:e,title:t,tapped:i,menu:s,events:o}){return this.leftButtons.push(r.creat({symbol:e,title:t,tapped:i,menu:s,events:o,align:a.align.left}).definition),this.hasbutton||(this.hasbutton=!0),this}addPopButton(e,t){return e||(e=$l10n("BACK")),this.popButtonView=t??{type:"button",props:{bgcolor:$color("clear"),symbol:"chevron.left",tintColor:a.linkColor,title:` ${e}`,titleColor:a.linkColor,font:$font("bold",16)},layout:(e,t)=>{e.left.equalTo(t.super.safeArea).offset(r.edges),e.centerY.equalTo(t.super.safeArea)},events:{tapped:()=>{$ui.pop()}}},this}removePopButton(){return this.popButtonView=void 0,this}}}})),parcelRequire.register("4iwee",(function(e,t){var i=$2af90aa604fd0097$exports.Controller;e.exports={ViewController:class extends i{#w=[];#T(e){this.callEvent("onPop",e),this.#w.pop()}push(e){const t=this.#w[this.#w.length-1];e.navigationBarItems.addPopButton(t?.navigationBar.title),this.#w.push(e),$ui.push({props:{statusBarStyle:0,navBarHidden:!0},events:{dealloc:()=>{this.#T(e)}},views:[e.getPage().definition],layout:$layout.fill})}}}}));var $f87a6170e58d4c4b$require$Controller=$2af90aa604fd0097$exports.Controller,$f87a6170e58d4c4b$require$FileStorage=$97b9cd7a6713ce56$exports.FileStorage,$01a0ae45ce602f73$exports={},$01a0ae45ce602f73$require$View=$c448a874e2cf17a6$exports.View,$01a0ae45ce602f73$require$UIKit=$64717582e22fe5d9$exports.UIKit;class $01a0ae45ce602f73$var$FixedFooterView extends $01a0ae45ce602f73$require$View{height=60;getView(){return this.type="view",this.setProp("bgcolor",$01a0ae45ce602f73$require$UIKit.primaryViewBackgroundColor),this.layout=(e,t)=>{e.left.right.bottom.equalTo(t.super),e.top.equalTo(t.super.safeAreaBottom).offset(-this.height)},this.views=[$01a0ae45ce602f73$require$View.create({props:this.props,views:this.views,layout:(e,t)=>{e.left.right.top.equalTo(t.super),e.height.equalTo(this.height)}})],this}}$01a0ae45ce602f73$exports={FixedFooterView:$01a0ae45ce602f73$var$FixedFooterView};var $f87a6170e58d4c4b$require$FixedFooterView=$01a0ae45ce602f73$exports.FixedFooterView,$f87a6170e58d4c4b$require$VERSION=$62460e67380da48b$exports.VERSION,$f87a6170e58d4c4b$require$versionCompare=$62460e67380da48b$exports.versionCompare,$f87a6170e58d4c4b$require$l10n=$62460e67380da48b$exports.l10n,$f87a6170e58d4c4b$require$objectEqual=$62460e67380da48b$exports.objectEqual,$f87a6170e58d4c4b$require$compressImage=$62460e67380da48b$exports.compressImage,$f87a6170e58d4c4b$require$Kernel=$62460e67380da48b$exports.Kernel,$a7b35f37bc42ac44$exports={},$a7b35f37bc42ac44$require$View=$c448a874e2cf17a6$exports.View;class $a7b35f37bc42ac44$var$Matrix extends $a7b35f37bc42ac44$require$View{titleStyle={font:$font("bold",21),height:30};#E;#C;templateIdByIndex(e){return void 0===this.props.template.views[e]?.props?.id&&(void 0===this.props.template.views[e].props&&(this.props.template.views[e].props={}),this.props.template.views[e].props.id=$text.uuid),this.props.template.views[e].props.id}get templateHiddenStatus(){if(!this.#C){this.#C={};for(let e=0;e<this.props.template.views.length;e++)void 0===this.props.template.views[e].props.id&&void 0===this.props.template.views[e].props.hidden&&(this.#C[this.templateIdByIndex(e)]=!1),void 0!==this.props.template.views[e].props.hidden&&(this.#C[this.templateIdByIndex(e)]=this.props.template.views[e].props.hidden)}return this.#C}get hiddenViews(){if(!this.#E){this.#E={};for(let e=0;e<this.props.template.views.length;e++)this.#E[this.templateIdByIndex(e)]={hidden:!0}}return this.#E}#x(e){let t={...this.hiddenViews};return Object.assign(t,{__templateProps:{hidden:!0},__title:{hidden:!1,text:e,info:{title:!0}}}),t}rebuildData(e=[]){return e.map((e=>(e.items=e.items.map((e=>(Object.keys(e).forEach((t=>{e[t].hidden=this.templateHiddenStatus[t]??!1})),Object.keys(this.templateHiddenStatus).forEach((t=>{e[t]||(e[t]={}),e[t].hidden=this.templateHiddenStatus[t]})),e.__templateProps={hidden:!1},e.__title={hidden:!0},e))),e.title&&e.items.unshift(this.#x(e.title)),e)))}rebuildTemplate(){let e={};void 0!==this.props.template.props&&(e=Object.assign(this.props.template.props,{id:"__templateProps",hidden:!1})),this.props.template.props={};const t=[{type:"view",props:e,layout:$layout.fill},{type:"label",props:{id:"__title",hidden:!0,font:this.titleStyle.font},layout:(e,t)=>{e.top.inset(-this.titleStyle.height/4*3),e.height.equalTo(this.titleStyle.height),e.width.equalTo(t.super.safeArea)}}].concat(this.props.template.views);this.props.template.views=t}insert(e,t=!0){return e.indexPath=this.indexPath(e.indexPath,t),$(this.id).insert(e)}delete(e,t=!0){return e=this.indexPath(e,t),$(this.id).delete(e)}object(e,t=!0){return e=this.indexPath(e,t),$(this.id).object(e)}cell(e,t=!0){return e=this.indexPath(e,t),$(this.id).cell(e)}indexPath(e,t){let i=t?0:1;return"number"==typeof e&&(e=$indexPath(0,e)),$indexPath(e.section,e.row+i)}update(e){this.props.data=this.rebuildData(e),$(this.id).data=this.props.data}getView(){return this.props.data=this.rebuildData(this.props.data),this.rebuildTemplate(),this.setEvent("itemSize",((e,t)=>{const i=e.object(t)?.__title?.info;if(i?.title)return $size(Math.max($device.info.screen.width,$device.info.screen.height),0);const a=this.props.columns??2,r=this.props.spacing??15,s=this.props.itemWidth??this.props.itemSize?.width??(e.super.frame.width-r*(a+1))/a,o=this.props.itemHeight??this.props.itemSize?.height??100;return $size(s,o)})),this}}$a7b35f37bc42ac44$exports={Matrix:$a7b35f37bc42ac44$var$Matrix};var $f87a6170e58d4c4b$require$Matrix=$a7b35f37bc42ac44$exports.Matrix,$hRZVz=parcelRequire("hRZVz"),$f87a6170e58d4c4b$require$Setting=$hRZVz.Setting,$3ca6d7e1b309f73c$exports={},$1HpaF=parcelRequire("1HpaF"),$3ca6d7e1b309f73c$require$ValidationError=$1HpaF.ValidationError,$3ca6d7e1b309f73c$require$View=$c448a874e2cf17a6$exports.View,$3ca6d7e1b309f73c$require$UIKit=$64717582e22fe5d9$exports.UIKit,$ifAas=parcelRequire("ifAas"),$3ca6d7e1b309f73c$require$NavigationView=$ifAas.NavigationView,$ieG9D=parcelRequire("ieG9D"),$3ca6d7e1b309f73c$require$NavigationBar=$ieG9D.NavigationBar,$dRsJ3=parcelRequire("dRsJ3"),$3ca6d7e1b309f73c$require$BarButtonItem=$dRsJ3.BarButtonItem;class $3ca6d7e1b309f73c$var$SheetAddNavBarError extends Error{constructor(){super("Please call setView(view) first."),this.name="SheetAddNavBarError"}}class $3ca6d7e1b309f73c$var$SheetViewTypeError extends $3ca6d7e1b309f73c$require$ValidationError{constructor(e,t){super(e,t),this.name="SheetViewTypeError"}}class $3ca6d7e1b309f73c$var$Sheet extends $3ca6d7e1b309f73c$require$View{#I=()=>{};#S=()=>{};navigationView;init(){const{width:e,height:t}=$device.info.screen,i=$objc("UIView").invoke("initWithFrame",$rect(0,0,e,t)),a=$objc("UIViewController").invoke("alloc.init"),r=a.$view();return r.$setBackgroundColor($color("primarySurface")),r.$addSubview(i),a.$setModalPresentationStyle(1),this.#I=()=>{r.jsValue().add(this.navigationView?.getPage().definition??this.view),$ui.vc.ocValue().invoke("presentModalViewController:animated",a,!0)},this.#S=()=>a.invoke("dismissModalViewControllerAnimated",!0),this}setView(e={}){if("object"!=typeof e)throw new $3ca6d7e1b309f73c$var$SheetViewTypeError("view","object");return this.view=e,this}addNavBar({title:e,popButton:t={title:"Done"},rightButtons:i=[]}){if(void 0===this.view)throw new $3ca6d7e1b309f73c$var$SheetAddNavBarError;this.navigationView=new $3ca6d7e1b309f73c$require$NavigationView;const a=new $3ca6d7e1b309f73c$require$BarButtonItem;a.setEvents(Object.assign({tapped:()=>{this.dismiss(),"function"==typeof t.tapped&&t.tapped()}},t.events)).setAlign($3ca6d7e1b309f73c$require$UIKit.align.left).setSymbol(t.symbol).setTitle(t.title).setMenu(t.menu);const r=a.definition.views[0];return r.layout=(e,t)=>{e.left.equalTo(t.super.safeArea).offset(15),e.centerY.equalTo(t.super.safeArea)},this.navigationView.navigationBar.setLargeTitleDisplayMode($3ca6d7e1b309f73c$require$NavigationBar.largeTitleDisplayModeNever).pageSheetMode(),this.navigationView.navigationBarItems.addPopButton("",r).setRightButtons(i),this.navigationView.setView(this.view).navigationBarTitle(e),this.view.props?.bgcolor&&this.navigationView?.getPage().setProp("bgcolor",this.view.props?.bgcolor),this}present(){this.#I()}dismiss(){this.#S()}}$3ca6d7e1b309f73c$exports={Sheet:$3ca6d7e1b309f73c$var$Sheet};var $f87a6170e58d4c4b$require$Sheet=$3ca6d7e1b309f73c$exports.Sheet,$7898d7906c8a0e5f$exports={},$7898d7906c8a0e5f$require$View=$c448a874e2cf17a6$exports.View,$7898d7906c8a0e5f$require$PageView=$c448a874e2cf17a6$exports.PageView,$7898d7906c8a0e5f$require$Controller=$2af90aa604fd0097$exports.Controller,$7898d7906c8a0e5f$require$UIKit=$64717582e22fe5d9$exports.UIKit;class $7898d7906c8a0e5f$var$TabBarCellView extends $7898d7906c8a0e5f$require$View{constructor(e={}){super(e),this.setIcon(e.icon),this.setTitle(e.title),void 0!==e.activeStatus&&(this.activeStatus=e.activeStatus)}setIcon(e){return this.icon=e instanceof Array?e:[e,e],this}setTitle(e){return this.title=e,this}active(){$(`${this.props.id}-icon`).image=$image(this.icon[1]),$(`${this.props.id}-icon`).tintColor=$color("systemLink"),$(`${this.props.id}-title`).textColor=$color("systemLink"),this.activeStatus=!0}inactive(){$(`${this.props.id}-icon`).image=$image(this.icon[0]),$(`${this.props.id}-icon`).tintColor=$color("lightGray"),$(`${this.props.id}-title`).textColor=$color("lightGray"),this.activeStatus=!1}getView(){return this.views=[{type:"image",props:{id:`${this.props.id}-icon`,image:$image(this.activeStatus?this.icon[1]:this.icon[0]),bgcolor:$color("clear"),tintColor:$color(this.activeStatus?"systemLink":"lightGray")},layout:(e,t)=>{e.centerX.equalTo(t.super);const i=$7898d7906c8a0e5f$var$TabBarController.tabBarHeight/2;e.size.equalTo(i),e.top.inset(($7898d7906c8a0e5f$var$TabBarController.tabBarHeight-i-13)/2)}},{type:"label",props:{id:`${this.props.id}-title`,text:this.title,font:$font(10),textColor:$color(this.activeStatus?"systemLink":"lightGray")},layout:(e,t)=>{e.centerX.equalTo(t.prev),e.top.equalTo(t.prev.bottom).offset(3)}}],this}}class $7898d7906c8a0e5f$var$TabBarHeaderView extends $7898d7906c8a0e5f$require$View{height=60;getView(){return this.type="view",this.setProp("bgcolor",this.props.bgcolor??$7898d7906c8a0e5f$require$UIKit.primaryViewBackgroundColor),this.layout=(e,t)=>{e.left.right.bottom.equalTo(t.super),e.top.equalTo(t.super.safeAreaBottom).offset(-this.height-$7898d7906c8a0e5f$var$TabBarController.tabBarHeight)},this.views=[$7898d7906c8a0e5f$require$View.create({props:this.props,views:this.views,layout:(e,t)=>{e.left.right.top.equalTo(t.super),e.height.equalTo(this.height)}})],this}}class $7898d7906c8a0e5f$var$TabBarController extends $7898d7906c8a0e5f$require$Controller{static tabBarHeight=50;#A={};#B={};#R;#q;get selected(){return this.#q}set selected(e){this.switchPageTo(e)}get contentOffset(){return $7898d7906c8a0e5f$var$TabBarController.tabBarHeight+(this.#R?.height??0)}setPages(e={}){return Object.keys(e).forEach((t=>this.setPage(t,e[t]))),this}setPage(e,t){return void 0===this.#q&&(this.#q=e),this.#A[e]=t instanceof $7898d7906c8a0e5f$require$PageView?t:$7898d7906c8a0e5f$require$PageView.createByViews(t),this.#q!==e&&(this.#A[e].activeStatus=!1),this}switchPageTo(e){if(this.#A[e]){if(this.#q===e)return;$ui.animate({duration:.4,animation:()=>{this.#B[e].active()}}),this.#B[this.#q].inactive(),this.#A[this.#q].hide(),this.#A[e].show(),this.callEvent("onChange",this.#q,e),this.#q=e}}setCells(e={}){return Object.keys(e).forEach((t=>this.setCell(t,e[t]))),this}setCell(e,t){return void 0===this.#q&&(this.#q=e),t instanceof $7898d7906c8a0e5f$var$TabBarCellView||(t=new $7898d7906c8a0e5f$var$TabBarCellView({props:{info:{key:e}},icon:t.icon,title:t.title,activeStatus:this.#q===e})),this.#B[e]=t,this}setHeader(e){return this.#R=e,this}#k(){const e=[];return Object.values(this.#B).forEach((t=>{t.setEvent("tapped",(e=>{const t=e.info.key;this.switchPageTo(t)})),e.push(t.getView())})),e}#D(){return Object.values(this.#A).map((e=>{const t=e.definition;if($7898d7906c8a0e5f$require$UIKit.scrollViewList.indexOf(t.views[0].type)>-1){if(void 0===t.views[0].props&&(t.views[0].props={}),t.views[0].props.indicatorInsets){const e=t.views[0].props.indicatorInsets;t.views[0].props.indicatorInsets=$insets(e.top,e.left,e.bottom+this.contentOffset,e.right)}else t.views[0].props.indicatorInsets=$insets(0,0,0,this.contentOffset);void 0===t.views[0].footer?t.views[0].footer={props:{}}:void 0===t.views[0].footer.props&&(t.views[0].footer.props={}),t.views[0].props.footer.props.height?t.views[0].props.footer.props.height+=this.contentOffset:t.views[0].props.footer.props.height=this.contentOffset}return t}))}generateView(){const e={type:"view",layout:(e,t)=>{e.centerX.equalTo(t.super),e.width.equalTo(t.super),e.top.equalTo(t.super.safeAreaBottom).offset(-$7898d7906c8a0e5f$var$TabBarController.tabBarHeight),e.bottom.equalTo(t.super)},views:[$7898d7906c8a0e5f$require$UIKit.blurBox({},[{type:"stack",layout:$layout.fillSafeArea,props:{axis:$stackViewAxis.horizontal,distribution:$stackViewDistribution.fillEqually,spacing:0,stack:{views:this.#k()}}}]),$7898d7906c8a0e5f$require$UIKit.separatorLine({},$7898d7906c8a0e5f$require$UIKit.align.top)]};return $7898d7906c8a0e5f$require$View.createByViews(this.#D().concat(this.#R?.definition??[],e))}}$7898d7906c8a0e5f$exports={TabBarCellView:$7898d7906c8a0e5f$var$TabBarCellView,TabBarHeaderView:$7898d7906c8a0e5f$var$TabBarHeaderView,TabBarController:$7898d7906c8a0e5f$var$TabBarController};var $f87a6170e58d4c4b$require$TabBarCellView=$7898d7906c8a0e5f$exports.TabBarCellView,$f87a6170e58d4c4b$require$TabBarHeaderView=$7898d7906c8a0e5f$exports.TabBarHeaderView,$f87a6170e58d4c4b$require$TabBarController=$7898d7906c8a0e5f$exports.TabBarController,$f87a6170e58d4c4b$require$UIKit=$64717582e22fe5d9$exports.UIKit,$23cb1940af8dd3e1$exports={};class $23cb1940af8dd3e1$var$UILoading{#N;text="";interval;fullScreen=!1;#O=()=>{};constructor(){this.#N=$text.uuid}updateText(e){$(this.#N).text=e}setLoop(e){if("function"!=typeof e)throw"loop must be a function";this.#O=e}done(){clearInterval(this.interval)}load(){$ui.render({props:{navBarHidden:this.fullScreen},views:[{type:"spinner",props:{loading:!0},layout:(e,t)=>{e.centerY.equalTo(t.super).offset(-15),e.width.equalTo(t.super)}},{type:"label",props:{id:this.#N,align:$align.center,text:""},layout:(e,t)=>{e.top.equalTo(t.prev.bottom).offset(10),e.left.right.equalTo(t.super)}}],layout:$layout.fill,events:{appeared:()=>{this.interval=setInterval((()=>{this.#O()}),100)}}})}}$23cb1940af8dd3e1$exports={UILoading:$23cb1940af8dd3e1$var$UILoading};var $f87a6170e58d4c4b$require$UILoading=$23cb1940af8dd3e1$exports.UILoading,$1HpaF=parcelRequire("1HpaF"),$f87a6170e58d4c4b$require$ValidationError=$1HpaF.ValidationError,$f87a6170e58d4c4b$require$View=$c448a874e2cf17a6$exports.View,$f87a6170e58d4c4b$require$PageView=$c448a874e2cf17a6$exports.PageView,$4iwee=parcelRequire("4iwee"),$f87a6170e58d4c4b$require$ViewController=$4iwee.ViewController,$ifAas=parcelRequire("ifAas"),$f87a6170e58d4c4b$require$NavigationView=$ifAas.NavigationView,$ieG9D=parcelRequire("ieG9D"),$f87a6170e58d4c4b$require$NavigationBar=$ieG9D.NavigationBar,$f87a6170e58d4c4b$require$NavigationBarController=$ieG9D.NavigationBarController,$dRsJ3=parcelRequire("dRsJ3"),$f87a6170e58d4c4b$require$NavigationBarItems=$dRsJ3.NavigationBarItems,$f87a6170e58d4c4b$require$BarButtonItem=$dRsJ3.BarButtonItem,$a31b76cb1e2f0185$exports={},$a31b76cb1e2f0185$require$Controller=$2af90aa604fd0097$exports.Controller,$dRsJ3=parcelRequire("dRsJ3"),$a31b76cb1e2f0185$require$BarTitleView=$dRsJ3.BarTitleView;class $a31b76cb1e2f0185$var$SearchBar extends $a31b76cb1e2f0185$require$BarTitleView{height=35;topOffset=15;bottomOffset=10;kbType=$kbType.search;placeholder=$l10n("SEARCH");constructor(e){super(e),this.setController(new $a31b76cb1e2f0185$var$SearchBarController),this.controller.setSearchBar(this),this.init()}init(){this.props={id:this.id,smoothCorners:!0,cornerRadius:6,bgcolor:$color("#EEF1F1","#212121")},this.views=[{type:"input",props:{id:this.id+"-input",type:this.kbType,bgcolor:$color("clear"),placeholder:this.placeholder},layout:$layout.fill,events:{changed:e=>this.controller.callEvent("onChange",e.text)}}],this.layout=(e,t)=>{e.height.equalTo(this.height),e.top.equalTo(t.super.safeArea).offset(this.topOffset),e.left.equalTo(t.super.safeArea).offset(15),e.right.equalTo(t.super.safeArea).offset(-15)}}setPlaceholder(e){return this.placeholder=e,this}setKbType(e){return this.kbType=e,this}}class $a31b76cb1e2f0185$var$SearchBarController extends $a31b76cb1e2f0185$require$Controller{setSearchBar(e){return this.searchBar=e,this}updateSelector(){this.selector={inputBox:$(this.searchBar.id),input:$(this.searchBar.id+"-input")}}hide(){this.updateSelector(),this.selector.inputBox.updateLayout((e=>{e.height.equalTo(0)}))}show(){this.updateSelector(),this.selector.inputBox.updateLayout((e=>{e.height.equalTo(this.searchBar.height)}))}didScroll(e){this.updateSelector();let t=this.searchBar.height-e;if(t=t>0?t>this.searchBar.height?this.searchBar.height:t:0,this.selector.inputBox.updateLayout((e=>{e.height.equalTo(t)})),e>0){const t=(this.searchBar.height/2-5-e)/10;this.selector.input.alpha=t}else this.selector.input.alpha=1}didEndDragging(e,t,i){this.updateSelector(),e>=0&&e<=this.searchBar.height&&i($point(0,e>=this.searchBar.height/2?this.searchBar.height:0))}}$a31b76cb1e2f0185$exports={SearchBar:$a31b76cb1e2f0185$var$SearchBar,SearchBarController:$a31b76cb1e2f0185$var$SearchBarController};var $f87a6170e58d4c4b$require$SearchBar=$a31b76cb1e2f0185$exports.SearchBar,$f87a6170e58d4c4b$require$SearchBarController=$a31b76cb1e2f0185$exports.SearchBarController;module.exports={Controller:$f87a6170e58d4c4b$require$Controller,FileStorage:$f87a6170e58d4c4b$require$FileStorage,FixedFooterView:$f87a6170e58d4c4b$require$FixedFooterView,VERSION:$f87a6170e58d4c4b$require$VERSION,versionCompare:$f87a6170e58d4c4b$require$versionCompare,l10n:$f87a6170e58d4c4b$require$l10n,objectEqual:$f87a6170e58d4c4b$require$objectEqual,compressImage:$f87a6170e58d4c4b$require$compressImage,Kernel:$f87a6170e58d4c4b$require$Kernel,Matrix:$f87a6170e58d4c4b$require$Matrix,Setting:$f87a6170e58d4c4b$require$Setting,Sheet:$f87a6170e58d4c4b$require$Sheet,TabBarCellView:$f87a6170e58d4c4b$require$TabBarCellView,TabBarHeaderView:$f87a6170e58d4c4b$require$TabBarHeaderView,TabBarController:$f87a6170e58d4c4b$require$TabBarController,UIKit:$f87a6170e58d4c4b$require$UIKit,UILoading:$f87a6170e58d4c4b$require$UILoading,ValidationError:$f87a6170e58d4c4b$require$ValidationError,View:$f87a6170e58d4c4b$require$View,PageView:$f87a6170e58d4c4b$require$PageView,ViewController:$f87a6170e58d4c4b$require$ViewController,NavigationView:$f87a6170e58d4c4b$require$NavigationView,NavigationBar:$f87a6170e58d4c4b$require$NavigationBar,NavigationBarController:$f87a6170e58d4c4b$require$NavigationBarController,NavigationBarItems:$f87a6170e58d4c4b$require$NavigationBarItems,BarButtonItem:$f87a6170e58d4c4b$require$BarButtonItem,SearchBar:$f87a6170e58d4c4b$require$SearchBar,SearchBarController:$f87a6170e58d4c4b$require$SearchBarController}})),parcelRequire.register("jdqER",(function(e,t){var i=parcelRequire("iLgc0").compressImage;class a{constructor(e=!1,t){this.sync=e,this.kernel=t,this.dbName="CAIO.db",this.localDb=`${this.kernel.fileStorage.basePath}/${this.dbName}`,this.syncInfoFile=`${this.kernel.fileStorage.basePath}/sync.json`,this.imagePath=`${this.kernel.fileStorage.basePath}/image`,this.imageOriginalPath=`${this.imagePath}/original`,this.imagePreviewPath=`${this.imagePath}/preview`,this.iCloudPath="drive://CAIO",this.iCloudSyncInfoFile=`${this.iCloudPath}/sync.json`,this.iCloudDbFile=`${this.iCloudPath}/${this.dbName}`,this.iCloudImagePath=`${this.iCloudPath}/image`,this.tempPath=`${this.kernel.fileStorage.basePath}/temp`,this.tempSyncInfoFile=`${this.tempPath}/sync.json`,this.tempDbFile=`${this.tempPath}/${this.dbName}`,this.tempImagePath=`${this.tempPath}/image`,this.init(),this.sync&&this.syncByiCloud()}init(){this.sqlite=$sqlite.open(this.localDb),this.sqlite.update("CREATE TABLE IF NOT EXISTS clipboard(uuid TEXT PRIMARY KEY NOT NULL, text TEXT, md5 TEXT, prev TEXT, next TEXT)"),this.sqlite.update("CREATE TABLE IF NOT EXISTS pin(uuid TEXT PRIMARY KEY NOT NULL, text TEXT, md5 TEXT, prev TEXT, next TEXT)");[this.tempPath,this.iCloudPath,this.imagePath,this.imagePreviewPath,this.imageOriginalPath].forEach((e=>{$file.isDirectory(e)||$file.mkdir(e)}))}rebuild(){const e=this.tempPath+"/rebuild.db";$file.delete(e);const t=new a(!1,this.kernel);t.localDb=e,t.init();const i=(e,i=!0)=>{const a=[];e.forEach((e=>{const r={uuid:e.uuid,text:e.text,md5:e.md5,image:e.image,prev:null,next:a[0]?.uuid??null};t.beginTransaction();try{i?t.insert(r):t.insertPin(r),r.next&&(a[0].prev=r.uuid,i?t.update(a[0]):t.updatePin(a[0])),t.commit(),a.unshift(r)}catch(e){throw t.rollback(),this.kernel.error(e),e}}))};let r;try{r=this.all();const e=this.sort(JSON.parse(JSON.stringify(r)));if(e.length>r.length)throw new Error;i(e.reverse())}catch{i(this.all())}try{r=this.allPin();const e=this.sort(JSON.parse(JSON.stringify(r)));if(e.length>r.length)throw new Error;i(e.reverse(),!1)}catch{i(this.allPin(),!1)}$file.copy({src:e,dst:this.localDb})}clearTemp(){$file.delete(this.tempPath),$file.mkdir(this.tempPath)}async export(e){$file.copy({src:this.syncInfoFile,dst:this.tempSyncInfoFile}),$file.copy({src:this.localDb,dst:this.tempDbFile}),$file.copy({src:this.imagePath,dst:this.tempImagePath});const t=this.tempPath+"/"+this.iCloudZipFileName;await $archiver.zip({directory:this.tempPath,dest:t}),$share.sheet({items:[{name:this.iCloudZipFileName,data:$data({path:t})}],handler:i=>{$file.delete(t),e(i)}})}async import(e){if("db"===e.fileName.slice(-2)){if(!$file.write({data:e,path:this.localDb}))throw new Error("WRITE_DB_FILE_FAILED")}else if("zip"===e.fileName.slice(-3)){if(!await $archiver.unzip({file:e,dest:this.tempPath}))throw new Error("UNZIP_FAILED");$file.write({data:$data({path:this.tempDbFile}),path:this.localDb}),$file.move({src:this.tempImagePath,dst:this.imagePath})}$sqlite.close(this.sqlite),this.sqlite=$sqlite.open(this.localDb),await this.upload()}async upload(e){if(!this.sync&&!e)return;if(0===this.all().length)return;const t=async e=>{const i=e.path+".lock";if(await $file.download(i),await $file.exists(i))return await new Promise((e=>{setTimeout((()=>e()),500)})),void await t(e);await $file.write({data:$data({string:""}),path:i}),this.kernel.print("file locked: "+e.path);try{const t=e.path.substring(0,e.path.lastIndexOf("/")),a=e.path.substring(e.path.lastIndexOf("/")+1,e.path.lastIndexOf("."));for(let i of $file.list(t)??[]){let t=i.substring(0,i.lastIndexOf("."));(t===a||t.startsWith(a+" "))&&$file.delete(e.path)}if(!await $file.write(e))throw new Error("FILE_WRITE_ERROR: "+e.path)}catch(e){throw this.kernel.error(e),e}finally{await $file.delete(i),this.kernel.print("file unlocked: "+e.path)}},i=Date.now();await t({data:$data({string:JSON.stringify({timestamp:i})}),path:this.iCloudSyncInfoFile}),await t({data:$data({path:this.localDb}),path:this.iCloudDbFile}),$file.exists(this.iCloudImagePath)||$file.mkdir(this.iCloudImagePath),await $file.copy({src:this.imagePath,dst:this.iCloudImagePath}),await $file.write({data:$data({string:JSON.stringify({timestamp:i})}),path:this.syncInfoFile})}async syncByiCloud(e=!1){if(!$file.exists(this.iCloudSyncInfoFile))return void this.upload(e);const t=$file.exists(this.syncInfoFile)?JSON.parse($file.read(this.syncInfoFile).string):{},i=await $file.download(this.iCloudSyncInfoFile),a=JSON.parse(i.string);(!t.timestamp||t.timestamp<a.timestamp)&&(await $file.write({data:await $file.download(this.iCloudSyncInfoFile),path:this.syncInfoFile}),await $file.write({data:await $file.download(this.iCloudDbFile),path:this.localDb}),await $file.copy({src:this.iCloudImagePath,dst:this.imagePath}),$sqlite.close(this.sqlite),this.sqlite=$sqlite.open(this.localDb),$app.notify({name:"syncByiCloud",object:{status:!0}}))}deleteICloudData(){return $file.delete(this.iCloudSyncInfoFile)&&$file.delete(this.iCloudDbFile)&&$file.delete(this.iCloudImagePath)}sort(e,t=9e3){const i={};let a=0,r=null;e.forEach((e=>{i[e.uuid]=e,null===e.prev&&(r=e.uuid),a++}));const s=[];if(a>0)try{let e=i[r];for(;null!==e.next&&t>0;)t--,s.push(e),e=i[e.next];s.push(e)}catch(e){throw"Unable to sort: "+e}return s}parse(e){if(null!==e.error)throw e.error;const t=[];for(;e.result.next();)t.push({uuid:e.result.get("uuid"),section:e.result.get("section"),text:e.result.get("text"),md5:e.result.get("md5"),prev:e.result.get("prev")??null,next:e.result.get("next")??null});return e.result.close(),t}beginTransaction(){this.sqlite.beginTransaction()}commit(){this.sqlite.commit(),this.upload()}rollback(){this.sqlite.rollback()}getByText(e){const t=this.sqlite.query({sql:"SELECT *, 'clipboard' AS section FROM clipboard WHERE text = ? UNION SELECT *, 'pin' AS section FROM pin WHERE text = ?",args:[e,e]});return this.parse(t)[0]}getByUUID(e){const t=this.sqlite.query({sql:"SELECT *, 'clipboard' AS section FROM clipboard a WHERE uuid = ? UNION SELECT *, 'pin' AS section FROM pin a WHERE uuid = ?",args:[e,e]});return this.parse(t)[0]}getByMD5(e){const t=this.sqlite.query({sql:"SELECT *, 'clipboard' AS section FROM clipboard WHERE md5 = ? UNION SELECT *, 'pin' AS section FROM pin WHERE md5 = ?",args:[e,e]});return this.parse(t)[0]}search(e){const t=this.sqlite.query({sql:"SELECT *, 'clipboard' AS section FROM clipboard WHERE text like ? UNION SELECT *, 'pin' AS section FROM pin WHERE text like ?",args:[`%${e}%`,`%${e}%`]});return this.parse(t)}pathToKey(e){return`@image=${e=JSON.stringify(e)}`}keyToPath(e){return!!e.startsWith("@image=")&&JSON.parse(e.slice(7))}_all(e){const t=this.sqlite.query(`SELECT *, '${e}' AS section FROM ${e}`);return this.parse(t)}_page(e,t,i){const a=this.sqlite.query(`SELECT *, '${e}' AS section FROM ${e} LIMIT ${t*i},${i}`);return this.parse(a)}_insert(e,t){if(t.image){const e=t.image,a=$text.uuid,r={original:`${this.imageOriginalPath}/${a}.png`,preview:`${this.imagePreviewPath}/${a}.jpg`};$file.write({data:e.png,path:r.original}),$file.write({data:i(e).jpg(.8),path:r.preview}),t.text=this.pathToKey(r)}const a=this.sqlite.update({sql:`INSERT INTO ${e} (uuid, text, md5, prev, next) values (?, ?, ?, ?, ?)`,args:[t.uuid,t.text,$text.MD5(t.text),t.prev,t.next]});if(!a.result)throw a.error;this.upload()}_update(e,t){if(Object.keys(t).length<4||"string"!=typeof t.uuid)return;const i=this.sqlite.update({sql:`UPDATE ${e} SET text = ?, md5 = ?, prev = ?, next = ? WHERE uuid = ?`,args:[t.text,$text.MD5(t.text),t.prev,t.next,t.uuid]});if(!i.result)throw i.error;this.upload()}_updateText(e,t,i){if("string"!=typeof t)return;const a=this.sqlite.update({sql:`UPDATE ${e} SET text = ?, md5 = ? WHERE uuid = ?`,args:[i,$text.MD5(i),t]});if(!a.result)throw a.error;this.upload()}_delete(e,t){const i=this.getByUUID(t),a=this.sqlite.update({sql:`DELETE FROM ${e} WHERE uuid = ?`,args:[t]}),r=this.keyToPath(i.text);if(r&&($file.delete(r.original),$file.delete(r.preview)),!a.result)throw a.error;this.upload()}all(){return this._all("clipboard")}page(e,t){return this._page("clipboard",e,t)}insert(e){return this._insert("clipboard",e)}update(e){return this._update("clipboard",e)}updateText(e,t){return this._updateText("clipboard",e,t)}delete(e){return this._delete("clipboard",e)}allPin(){return this._all("pin")}pagePin(e,t){return this._page("pin",e,t)}insertPin(e){return this._insert("pin",e)}updatePin(e){return this._update("pin",e)}updateTextPin(e,t){return this._updateText("pin",e,t)}deletePin(e){return this._delete("pin",e)}getPinByMD5(e){const t=this.sqlite.query({sql:"SELECT * FROM pin WHERE md5 = ?",args:[e]});return this.parse(t)[0]}}e.exports=a})),parcelRequire.register("ljwly",(function(e,t){var i=parcelRequire("iLgc0"),a=i.UIKit,r=i.ViewController,s=i.NavigationView,o=i.SearchBar,n=parcelRequire("cCz0w");e.exports=class{copied=$cache.get("clipboard.copied")??{};#P=!1;reorder={};#V=[];savedClipboardIndex={};constructor(e){this.kernel=e,this.listId="clipboard-list",this.edges=20,this.fontSize=16,this.copiedIndicatorSize=7,this.imageContentHeight=50,this.viewController=new r}get savedClipboard(){return 0===this.#V.length&&this.loadSavedClipboard(),this.#V}set savedClipboard(e){this.#V=e}getSingleLineHeight(){return $text.sizeThatFits({text:"A",width:this.fontSize,font:$font(this.fontSize)}).height}setSingleLine(){this.imageContentHeight=this.getSingleLineHeight(),this.#P=!0}loadDataWithSingleLine(){this.setSingleLine(),this.loadSavedClipboard()}static updateMenu(e){}setClipboardText(e){this.kernel.setting.get("clipboard.universal")?$clipboard.text=e:$clipboard.setTextLocalOnly(e)}listReady(){$delay(.5,(()=>{if($context.query.copy){const e=$context.query.copy,t=this.kernel.storage.getByUUID(e);this.setClipboardText(t.text),this.setCopied(e,this.getIndexPathByUUID(e)),$ui.success($l10n("COPIED"))}else $context.query.add?this.getAddTextView():$context.query.actions&&(this.kernel.isUseJsboxNav?this.kernel.actionManager.present():this.kernel.tabBarController.switchPageTo("actions"))})),$delay(.5,(()=>{this.readClipboard()})),$app.listen({syncByiCloud:e=>{if(e.status){this.loadSavedClipboard();const e=$(this.listId);e&&(e.data=this.savedClipboard)}},resume:()=>{$delay(.5,(()=>{this.loadSavedClipboard(),this.updateList(),this.readClipboard()}))}})}updateList(){$(this.listId).data=this.savedClipboard}setCopied(e,t,i=!0){e===this.copied.uuid&&t?.section===this.copied.indexPath?.section&&t?.row===this.copied.indexPath?.row||(e?(i&&(this.copied.indexPath&&(this.savedClipboard[this.copied.indexPath.section].rows[this.copied.indexPath.row].copied.hidden=!0),this.savedClipboard[t.section].rows[t.row].copied.hidden=!1,$delay(.3,(()=>this.updateList()))),this.copied.uuid!==e&&(this.copied=Object.assign(this.copied,this.kernel.storage.getByUUID(e)??{})),this.copied.indexPath=t):(i&&(this.copied.indexPath&&(this.savedClipboard[this.copied.indexPath.section].rows[this.copied.indexPath.row].copied.hidden=!0),$delay(.3,(()=>this.updateList()))),this.copied={},$clipboard.clear()),$cache.set("clipboard.copied",this.copied))}getIndexPathByUUID(e){const t=$(this.listId).data;let i=t[0].rows.length;for(let a=0;a<i;a++)if(t[0].rows[a].content.info.uuid===e)return $indexPath(0,a);i=t[1].rows.length;for(let a=0;a<i;a++)if(t[1].rows[a].content.info.uuid===e)return $indexPath(1,a);return!1}readClipboard(e=!1){if(e||this.kernel.setting.get("clipboard.autoSave")){if(this.kernel.print("read clipboard"),e&&$clipboard.images?.length>0)return $clipboard.images.forEach((e=>{this.add(e)})),!0;const t=$clipboard.text;if(!t||""===t)return this.setCopied(),!1;if($clipboard.text=t,this.copied.text===t)return!1;const i=$text.MD5(t),a=this.kernel.storage.getByMD5(i);if(this.copied.uuid&&this.copied.uuid===a?.uuid)this.setCopied(a.uuid,this.getIndexPathByUUID(a.uuid));else if(!this.savedClipboardIndex[i]){const e=this.add(t);this.copy(t,e.uuid,e.indexPath)}return!0}return!1}add(e,t){const i={uuid:this.kernel.uuid(),text:e,md5:null,image:null,prev:null,next:this.savedClipboard[1].rows[0]?this.savedClipboard[1].rows[0].content.info.uuid:null};if("string"==typeof e){if(""===e.trim())return;i.md5=$text.MD5(e)}else{if("object"!=typeof e)return;i.text="",i.image=e}this.kernel.storage.beginTransaction();try{this.kernel.storage.insert(i),i.next&&(this.savedClipboard[1].rows[0].content.info.prev=i.uuid,this.kernel.storage.update(this.savedClipboard[1].rows[0].content.info)),this.kernel.storage.commit();const e=this.lineData(i);if(this.savedClipboard[1].rows.unshift(e),this.savedClipboardIndex[$text.MD5(i.text)]=1,"function"!=typeof t)return i.indexPath=$indexPath(1,0),$(this.listId).insert({indexPath:i.indexPath,value:e}),1===this.copied?.indexPath?.section&&this.setCopied(this.copied.uuid,$indexPath(this.copied?.indexPath?.section,this.copied?.indexPath?.row+1),!1),i;t(i)}catch(e){this.kernel.storage.rollback(),this.kernel.error(e),$ui.alert(e)}}delete(e,t){const i=t.section,a=t.row;this.kernel.storage.beginTransaction();try{if(0===i?this.kernel.storage.deletePin(e):this.kernel.storage.delete(e),this.savedClipboard[i].rows[a-1]){const e={uuid:this.savedClipboard[i].rows[a-1].content.info.uuid,text:this.savedClipboard[i].rows[a-1].content.info.text,prev:this.savedClipboard[i].rows[a-1].content.info.prev,next:this.savedClipboard[i].rows[a].content.info.next};0===i?this.kernel.storage.updatePin(e):this.kernel.storage.update(e),this.savedClipboard[i].rows[a-1]=this.lineData(e)}if(this.savedClipboard[i].rows[a+1]){const e={uuid:this.savedClipboard[i].rows[a+1].content.info.uuid,text:this.savedClipboard[i].rows[a+1].content.info.text,prev:this.savedClipboard[i].rows[a].content.info.prev,next:this.savedClipboard[i].rows[a+1].content.info.next};0===i?this.kernel.storage.updatePin(e):this.kernel.storage.update(e),this.savedClipboard[i].rows[a+1]=this.lineData(e)}this.kernel.storage.commit(),delete this.savedClipboardIndex[this.savedClipboard[i].rows[a].content.info.md5],this.savedClipboard[i].rows.splice(a,1),this.copied.uuid===e&&this.setCopied(null)}catch(e){this.kernel.storage.rollback(),this.kernel.error(e),$ui.alert(e)}}update(e,t,i){const a=$(this.listId).cell(i).get("content").info,r=$text.MD5(t);delete this.savedClipboardIndex[a.md5],this.savedClipboardIndex[r]=1;const s=this.lineData(Object.assign(a,{text:t,md5:r}),a.uuid===this.copied.uuid);this.savedClipboard[i.section].rows[i.row]=s,this.updateList(),e===this.copied.uuid&&this.setClipboardText(t);try{return 0===i.section?this.kernel.storage.updateTextPin(e,t):this.kernel.storage.updateText(e,t),!0}catch(e){return this.kernel.error(e),!1}}move(e,t,i,a=!0){if(e!==t){e<t&&t++,this.savedClipboard[i].rows[t]||(this.savedClipboard[i].rows[t]=this.lineData({uuid:null,text:"",next:null,prev:this.savedClipboard[i].rows[t-1].content.info.uuid})),this.kernel.storage.beginTransaction();try{const r={uuid:this.savedClipboard[i].rows[e].content.info.uuid,text:this.savedClipboard[i].rows[e].content.info.text},s={uuid:this.savedClipboard[i].rows[t].content.info.uuid,text:this.savedClipboard[i].rows[t].content.info.text};if(this.savedClipboard[i].rows[e-1]){const t={uuid:this.savedClipboard[i].rows[e-1].content.info.uuid,text:this.savedClipboard[i].rows[e-1].content.info.text,prev:this.savedClipboard[i].rows[e-1].content.info.prev,next:this.savedClipboard[i].rows[e].content.info.next};0===i?this.kernel.storage.updatePin(t):this.kernel.storage.update(t),this.savedClipboard[i].rows[e-1]=this.lineData(t)}if(this.savedClipboard[i].rows[e+1]){const t={uuid:this.savedClipboard[i].rows[e+1].content.info.uuid,text:this.savedClipboard[i].rows[e+1].content.info.text,prev:this.savedClipboard[i].rows[e].content.info.prev,next:this.savedClipboard[i].rows[e+1].content.info.next};0===i?this.kernel.storage.updatePin(t):this.kernel.storage.update(t),this.savedClipboard[i].rows[e+1]=this.lineData(t)}{if(this.savedClipboard[i].rows[t-1]){const e={uuid:this.savedClipboard[i].rows[t-1].content.info.uuid,text:this.savedClipboard[i].rows[t-1].content.info.text,prev:this.savedClipboard[i].rows[t-1].content.info.prev,next:r.uuid};0===i?this.kernel.storage.updatePin(e):this.kernel.storage.update(e),this.savedClipboard[i].rows[t-1]=this.lineData(e)}const a={uuid:s.uuid,text:s.text,prev:r.uuid,next:this.savedClipboard[i].rows[t].content.info.next};0===i?this.kernel.storage.updatePin(a):this.kernel.storage.update(a);const o={uuid:r.uuid,text:r.text,prev:this.savedClipboard[i].rows[t].content.info.prev,next:s.uuid};0===i?this.kernel.storage.updatePin(o):this.kernel.storage.update(o),this.savedClipboard[i].rows[t]=this.lineData(a),this.savedClipboard[i].rows[e]=this.lineData(o)}this.savedClipboard[i].rows.splice(t,0,this.savedClipboard[i].rows[e]),this.savedClipboard[i].rows.splice(e>t?e+1:e,1),this.kernel.storage.commit(),null===this.savedClipboard[i].rows[t].content.info.uuid&&this.savedClipboard[i].rows.splice(t,1);{const r=e<t?t-1:t,s=$(this.listId);if(e<r?(s.insert({indexPath:$indexPath(i,t),value:this.savedClipboard[i].rows[r]}),s.delete($indexPath(i,e))):(s.delete($indexPath(i,e)),s.insert({indexPath:$indexPath(i,t),value:this.savedClipboard[i].rows[t]})),a&&this.copied.indexPath){const t=this.copied.indexPath;if(t.section===i){const a=this.copied.uuid;t.row===e?this.setCopied(a,$indexPath(i,r)):(t.row>e&&t.row<r||t.row<e&&t.row>r||t.row===r)&&this.setCopied(a,$indexPath(i,e<r?t.row-1:t.row+1))}}}}catch(e){this.kernel.storage.rollback(),this.kernel.error(e),$ui.alert(e)}}}pin(e,t){if("pin"===e?.section)return;if(this.kernel.storage.getPinByMD5(e.md5))$ui.warning("Already exists");else{e.next=this.savedClipboard[0].rows[0]?.content?.info?.uuid??null,e.prev=null,this.kernel.storage.beginTransaction();try{this.kernel.storage.insertPin(e),e.next&&(this.savedClipboard[0].rows[0].content.info.prev=e.uuid,this.kernel.storage.updatePin(this.savedClipboard[0].rows[0].content.info)),this.kernel.storage.commit(),this.delete(e.uuid,t);const i=$(this.listId),a=this.lineData(e);this.savedClipboard[0].rows.unshift(a),this.savedClipboardIndex[e.md5]=1,i.insert({indexPath:$indexPath(0,0),value:a}),i.delete(t)}catch(e){this.kernel.storage.rollback(),this.kernel.error(e),$ui.alert(e)}}}copy(e,t,i){const a=this.kernel.storage.keyToPath(e);a&&$file.exists(a.original)?$clipboard.image=$file.read(a.original).image:this.setClipboardText(e);const r=1===i.section;r&&this.move(i.row,0,i.section),this.setCopied(t,r?$indexPath(i.section,0):i)}edit(e,t){const i=new n(this.kernel),a=[{symbol:"square.and.arrow.up",tapped:()=>{i.text?$share.sheet(i.text):$ui.warning($l10n("NONE"))}}];if(this.kernel.isUseJsboxNav)i.uikitPush(e,(()=>t(i.text)),a);else{const r=i.getNavigationView(e,a);this.viewController.setEvent("onPop",(()=>t(i.text))),this.viewController.push(r)}}getAddTextView(){this.edit("",(e=>{""!==e&&this.add(e)}))}loadSavedClipboard(){this.kernel.print("load clipboard");const e=e=>{try{return this.kernel.storage.sort(e,this.kernel.setting.get("clipboard.maxItemLength")).map((e=>(this.savedClipboardIndex[e.md5]=1,this.lineData(e,this.copied.uuid===e.uuid))))}catch(e){$ui.alert({title:$l10n("REBUILD_DATABASE"),message:$l10n("CLIPBOARD_STRUCTURE_ERROR"),actions:[{title:$l10n("OK"),handler:()=>{const e=a.loading();e.start(),this.kernel.storage.rebuild(),e.end(),$delay(.8,(()=>$addin.restart()))}},{title:$l10n("CANCEL")}]}),this.kernel.error(e)}};this.savedClipboard=[{rows:e(this.kernel.storage.allPin())??[]},{rows:e(this.kernel.storage.all())??[]}]}searchAction(e){try{if(""===e)this.updateList();else{const t=this.kernel.storage.search(e);t&&t.length>0&&($(this.listId).data=t.map((e=>this.lineData(e))))}}catch(e){throw this.updateList(),e}}menuItems(e=!0){const t=this.kernel.actionManager.getActions("clipboard").map((e=>{const t=this.kernel.actionManager.getActionHandler(e.type,e.dir);var i;return e.handler=(i=t,(e,t)=>{const a=e.object(t),r={text:a.content.info.text,uuid:a.content.info.uuid};i(r)}),e.title=e.name,e.symbol=e.icon,e})),i=[{inline:!0,items:[{title:$l10n("SHARE"),symbol:"square.and.arrow.up",handler:(e,t)=>{const i=e.object(t).content.info.text;let a=i;const r=this.kernel.storage.keyToPath(i);if(r&&$file.exists(r.original)){const e=$file.read(r.original)?.image?.png;a={name:e.fileName,data:e}}$share.sheet([a])}},{title:$l10n("COPY"),symbol:"square.on.square",handler:(e,t)=>{const i=e.object(t);this.copy(i.content.info.text,i.content.info.uuid,t)}},{title:$l10n("DELETE"),symbol:"trash",destructive:!0,handler:(e,t)=>{this.kernel.deleteConfirm($l10n("CONFIRM_DELETE_MSG"),(()=>{const i=e.object(t);this.delete(i.content.info.uuid,t),e.delete(t)}))}}]}];return t.concat(e?i:[])}lineData(e,t=!1){const i=this.kernel.storage.keyToPath(e.text);if(i)return{copied:{hidden:!t},image:{src:i.preview,hidden:!1},content:{info:{text:e.text,section:e.section,uuid:e.uuid,md5:e.md5,height:this.imageContentHeight,prev:e.prev,next:e.next}}};{const i=(e=>{const t=this.kernel.setting.get("clipboard.textMaxLength");return e.length>t?e.slice(0,t)+"...":e})(e.text),r=$text.sizeThatFits({text:i,width:a.windowSize.width-2*this.edges,font:$font(this.fontSize)}).height;return{copied:{hidden:!t},image:{hidden:!0},content:{text:i,info:{text:e.text,section:e.section,uuid:e.uuid,md5:e.md5,height:r,prev:e.prev,next:e.next}}}}}listTemplate(e=0){return{props:{bgcolor:$color("clear")},views:[{type:"view",props:{id:"copied",circular:this.copiedIndicatorSize,hidden:!0,bgcolor:$color("green")},layout:(e,t)=>{e.centerY.equalTo(t.super),e.size.equalTo(this.copiedIndicatorSize),e.left.inset(this.edges/2-this.copiedIndicatorSize/2)}},{type:"label",props:{id:"content",lines:e,font:$font(this.fontSize)},layout:(e,t)=>{e.centerY.equalTo(t.super),e.left.right.inset(this.edges)}},{type:"image",props:{id:"image",hidden:!0},layout:$layout.fill}]}}getListView(){return this.loadSavedClipboard(),{type:"list",props:{id:this.listId,menu:{items:this.menuItems(this.kernel)},bgcolor:a.primaryViewBackgroundColor,separatorInset:$insets(0,this.edges,0,0),data:this.savedClipboard,template:this.listTemplate(),actions:[{title:$l10n("COPY"),color:$color("systemLink"),handler:(e,t)=>{const i=e.object(t);this.copy(i.content.info.text,i.content.info.uuid,t)}},{title:$l10n("PIN"),color:$color("orange"),handler:(e,t)=>{const i=e.object(t).content.info;delete i.height,this.pin(i,t)}},{title:" "+$l10n("DELETE")+" ",color:$color("red"),handler:(e,t)=>{this.kernel.deleteConfirm($l10n("CONFIRM_DELETE_MSG"),(()=>{const i=e.object(t);this.delete(i.content.info.uuid,t),e.delete(t)}))}}]},layout:$layout.fill,events:{ready:()=>this.listReady(),rowHeight:(e,t)=>e.object(t).content.info.height+2*this.edges,didSelect:(e,t,i)=>{const a=i.content,r=a.info.text,s=this.kernel.storage.keyToPath(r);s&&$file.exists(s.original)?$quicklook.open({image:$file.read(s.original)?.image}):this.edit(a.info.text,(e=>{a.info.md5!==$text.MD5(e)&&this.update(a.info.uuid,e,t)}))}}}}getNavigationView(){const e=new o;e.controller.setEvent("onChange",(e=>this.searchAction(e)));const t=new s;return t.navigationBarTitle($l10n("CLIPBOARD")),t.navigationBarItems.setTitleView(e).pinTitleView().setRightButtons([{symbol:"plus.circle",tapped:()=>this.getAddTextView()}]).setLeftButtons([{symbol:"arrow.up.arrow.down.circle",tapped:(e,t)=>{$ui.popover({sourceView:t,directions:$popoverDirection.up,size:$size(200,300),views:[{type:"label",props:{text:$l10n("SORT"),color:$color("secondaryText"),font:$font(14)},layout:(e,t)=>{e.top.equalTo(t.super.safeArea).offset(0),e.height.equalTo(40),e.left.inset(20)}},a.separatorLine(),{type:"list",props:{id:"clipboard-list-sort",reorder:!0,crossSections:!1,bgcolor:$color("clear"),data:this.savedClipboard,template:this.listTemplate(1),actions:[{title:"delete",handler:(e,t)=>{const i=$(this.listId),a=i.object(t);this.delete(a.content.info.uuid,t),i.delete(t)}}]},events:{rowHeight:(e,t)=>{const i=e.object(t);return void 0===i.image||i.image.hidden?this.fontSize+this.edges:i.content?.info?.height},reorderBegan:e=>{this.reorder.content=this.savedClipboard[e.section].rows[e.row].content,this.reorder.image=this.savedClipboard[e.section].rows[e.row].image,this.reorder.section=e.section,this.reorder.from=e.row,this.reorder.to=void 0},reorderMoved:(e,t)=>{this.reorder.section=t.section,this.reorder.to=t.row},reorderFinished:()=>{void 0!==this.reorder.to&&this.move(this.reorder.from,this.reorder.to,this.reorder.section)}},layout:(e,t)=>{e.width.equalTo(t.super),e.top.equalTo(t.prev.bottom),e.bottom.inset(0)}}]})}},{symbol:"square.and.arrow.down.on.square",tapped:e=>{e.start(),this.readClipboard(!0),e.done()}}]),t.navigationBar.setBackgroundColor(a.primaryViewBackgroundColor),this.kernel.isUseJsboxNav&&t.navigationBar.withoutStatusBarHeight(),t.setView(this.getListView()),t}}})),parcelRequire.register("cCz0w",(function(e,t){var i=parcelRequire("iLgc0"),a=i.UIKit,r=i.NavigationBar,s=i.NavigationView,o=i.Sheet;e.exports=class{constructor(e){this.kernel=e,this.id="editor",this.originalContent=void 0}set text(e=""){void 0===this.originalContent&&(this.originalContent=e),this._text=e}get text(){return this._text}getActionButton(){return{symbol:"bolt.circle",tapped:(e,t)=>{t&&(e=t);const i=$(this.id).selectedRange,a={text:this.text,selectedRange:i,selectedText:this.text.slice(i.location,i.location+i.length)},r=$ui.popover({sourceView:e,directions:$popoverDirection.up,size:$size(200,300),views:[this.kernel.actionManager.getActionListView({},{didSelect:(e,t,i)=>{r.dismiss();const s=this.kernel.actionManager.getActionHandler(i.info.info.type,i.info.info.dir);setTimeout((()=>s(a)),500)}})]})}}}setContent(e){this.text=e,$(this.id).text=e}getView(e="text"){return{type:e,layout:$layout.fill,props:{id:this.id,lineNumbers:this.kernel.setting.get("editor.code.lineNumbers"),theme:this.kernel.setting.get($device.isDarkMode?"editor.code.darkTheme":"editor.code.lightTheme"),text:this.text,insets:$insets(15,15,"text"===e?this.kernel.setting.get("editor.text.insets"):15,15)},events:{ready:e=>{""===this.text&&setTimeout((()=>e.focus()),500)},didChange:e=>{this.text=e.text}}}}pageSheet(e="",t,i,a=[],r="text"){this.text=e,a.unshift(this.getActionButton());const s=new o;s.setView(this.getView(r)).addNavBar({title:i,popButton:{title:$l10n("DONE"),tapped:()=>t(this.text)},rightButtons:a}),s.NavigationView.navigationBar.contentViewHeightOffset=0,s.init().present()}uikitPush(e="",t,i=[],r="text"){this.text=e,i.unshift(this.getActionButton()),a.push({title:"",navButtons:i.map((e=>(e.handler=e.tapped,e.tapped=void 0,e))),views:[this.getView(r)],disappeared:()=>t(this.text)})}getNavigationView(e="",t=[],i="text"){this.text=e,t.unshift(this.getActionButton());const a=new s;return a.navigationBar.contentViewHeightOffset=0,a.navigationBar.setLargeTitleDisplayMode(r.largeTitleDisplayModeNever),a.navigationBarItems.setRightButtons(t),a.setView(this.getView(i)).navigationBarTitle(""),a}}})),parcelRequire.register("jfaRJ",(function(e,t){var i=parcelRequire("iLgc0"),a=i.Matrix,r=i.Setting,s=i.NavigationView,o=i.BarButtonItem,n=i.Sheet,l=i.UIKit,d=parcelRequire("cCz0w"),h=parcelRequire("19zow");e.exports=class{matrixId="actions";matrix;reorder={};constructor(e){this.kernel=e,this.actionPath="scripts/action",this.actionOrderFile="order.json",this.userActionPath=`${this.kernel.fileStorage.basePath}/user_action`,this.typeNameMap={},this.checkUserAction()}importExampleAction(){try{Object.keys(__ACTIONS__).forEach((e=>{const t=`${this.userActionPath}/${e}`;Object.keys(__ACTIONS__[e]).forEach((i=>{$file.exists(`${t}/${i}/main.js`)||($file.mkdir(t),$file.mkdir(`${t}/${i}`),$file.write({data:$data({string:__ACTIONS__[e][i]["main.js"]}),path:`${t}/${i}/main.js`}),$file.write({data:$data({string:__ACTIONS__[e][i]["config.json"]}),path:`${t}/${i}/config.json`}),$file.write({data:$data({string:__ACTIONS__[e][i]["README.md"]}),path:`${t}/${i}/README.md`}))}))}))}catch{$file.list(this.actionPath).forEach((e=>{const t=`${this.actionPath}/${e}`;if($file.isDirectory(t)){const i=`${this.userActionPath}/${e}`;$file.list(t).forEach((e=>{$file.exists(`${i}/${e}/main.js`)||($file.mkdir(i),$file.copy({src:`${t}/${e}`,dst:`${i}/${e}`}))}))}}))}}checkUserAction(){$file.exists(this.userActionPath)&&0!==$file.list(this.userActionPath).length||($file.mkdir(this.userActionPath),this.importExampleAction())}getActionTypes(){const e=["clipboard","editor"];return e.concat($file.list(this.userActionPath).filter((t=>{if($file.isDirectory(`${this.userActionPath}/${t}`)&&e.indexOf(t)<0)return t})))}getActionOrder(e){const t=`${this.userActionPath}/${e}/${this.actionOrderFile}`;return $file.exists(t)?JSON.parse($file.read(t).string):[]}getActionHandler(e,t,i){i||(i=`${this.userActionPath}/${e}/${t}`);const a=JSON.parse($file.read(`${i}/config.json`).string);return async e=>{try{const t=$file.read(`${i}/main.js`).string,r=new(new Function("Action",`${t}\n return MyAction`)(h))(this.kernel,a,e);return await r.do()}catch(e){$ui.error(e),this.kernel.error(e)}}}getActions(e){const t=[],i=`${this.userActionPath}/${e}`;if(!$file.exists(i))return[];const a=a=>{const r=`${i}/${a}/`;if($file.isDirectory(r)){const i=JSON.parse($file.read(r+"config.json").string);t.push(Object.assign(i,{dir:a,type:e,name:i.name??a,icon:i.icon}))}},r=this.getActionOrder(e);return r.forEach((e=>a(e))),$file.list(i).forEach((e=>{-1===r.indexOf(e)&&a(e)})),t}getTypeName(e){const t=e.toUpperCase(),i=$l10n(t),a=i===t?e:i;return this.typeNameMap[a]=e,a}getTypeDir(e){return this.typeNameMap[e]??e}actionToData(e){return{name:{text:e.name},icon:"icon_"===e.icon.slice(0,5)?{icon:$icon(e.icon.slice(5,e.icon.indexOf(".")),$color("#ffffff"))}:{image:$image(e.icon)},color:{bgcolor:this.kernel.setting.getColor(e.color)},info:{info:e}}}titleView(e){return{name:{hidden:!0},icon:{hidden:!0},color:{hidden:!0},button:{hidden:!0},bgcolor:{hidden:!0},info:{hidden:!1,info:{title:e}}}}getActionListView(e={},t={}){const i=[];return this.getActionTypes().forEach((e=>{const t={title:this.getTypeName(e),rows:[]};this.getActions(e).forEach((e=>{t.rows.push(this.actionToData(e))})),i.push(t)})),{type:"list",layout:(e,t)=>{e.top.width.equalTo(t.super.safeArea),e.bottom.inset(0)},events:t,props:Object.assign({reorder:!1,bgcolor:$color("clear"),rowHeight:60,sectionTitleHeight:30,stickyHeader:!0,data:i,template:{props:{bgcolor:$color("clear")},views:[{type:"image",props:{id:"color",cornerRadius:8,smoothCorners:!0},layout:(e,t)=>{e.centerY.equalTo(t.super),e.left.inset(15),e.size.equalTo($size(30,30))}},{type:"image",props:{id:"icon",tintColor:$color("#ffffff")},layout:(e,t)=>{e.centerY.equalTo(t.super),e.left.inset(20),e.size.equalTo($size(20,20))}},{type:"label",props:{id:"name",lines:1,font:$font(16)},layout:(e,t)=>{e.height.equalTo(30),e.centerY.equalTo(t.super),e.left.equalTo(t.prev.right).offset(15)}},{type:"label",props:{id:"info"}}]}},e)}}editActionInfoPageSheet(e,t){const i=this.getActionTypes(),a={};i.forEach(((e,t)=>{a[e]=t})),this.editingActionInfo=e??{dir:this.kernel.uuid(),type:"clipboard",name:"MyAction",color:"#CC00CC",icon:"icon_062.png",description:""};const s=new r({structure:{},set:(e,t)=>(this.editingActionInfo[e]="type"===e?t[1]:t,!0),get:(e,t=null)=>"type"===e?a[this.editingActionInfo.type]:Object.prototype.hasOwnProperty.call(this.editingActionInfo,e)?this.editingActionInfo[e]:t}),o=s.createInput("name",["pencil.circle","#FF3366"],$l10n("NAME")),l=s.createColor("color",["pencil.tip.crop.circle","#0066CC"],$l10n("COLOR")),d=s.createIcon("icon",["star.circle","#FF9933"],$l10n("ICON"),this.kernel.setting.getColor(this.editingActionInfo.color)),h=s.createMenu("type",["tag.circle","#33CC33"],$l10n("TYPE"),i,!0),c={type:"view",views:[{type:"text",props:{id:"action-text",textColor:$color("#000000","secondaryText"),bgcolor:$color("systemBackground"),text:this.editingActionInfo.description,insets:$insets(10,10,10,10)},layout:$layout.fill,events:{tapped:t=>{$("actionInfoPageSheetList").scrollToOffset($point(0,e?230:280)),setTimeout((()=>t.focus()),200)},didChange:e=>{this.editingActionInfo.description=e.text}}}],layout:$layout.fill},p=[{title:$l10n("INFORMATION"),rows:[o,l,d]},{title:$l10n("DESCRIPTION"),rows:[c]}];e||(p[0].rows=p[0].rows.concat(h));(new n).setView({type:"list",props:{id:"actionInfoPageSheetList",bgcolor:$color("insetGroupedBackground"),style:2,separatorInset:$insets(0,50,0,10),data:p},layout:$layout.fill,events:{rowHeight:(e,t)=>1===t.section?120:50}}).addNavBar({title:"",popButton:{title:"Done",tapped:()=>{this.saveActionInfo(this.editingActionInfo);parcelRequire("ljwly").updateMenu(this.kernel),t&&t(this.editingActionInfo)}}}).init().present()}editActionMainJs(e="",t){new d(this.kernel).pageSheet(e,(e=>{this.saveMainJs(t,e)}),t.name,[{symbol:"book.circle",tapped:()=>{const e=$file.read("scripts/action/README.md").string;(new n).setView({type:"markdown",props:{content:e},layout:(e,t)=>{e.size.equalTo(t.super)}}).init().present()}}],"code")}saveActionInfo(e){const t=`${this.userActionPath}/${e.type}/${e.dir}`;$file.exists(t)||$file.mkdir(t),$file.write({data:$data({string:JSON.stringify({icon:e.icon,color:e.color,name:e.name,description:e.description})}),path:`${t}/config.json`})}saveMainJs(e,t){const i=`${this.userActionPath}/${e.type}/${e.dir}`,a=`${i}/main.js`;$file.exists(i)||$file.mkdir(i),$text.MD5(t)!==$text.MD5($file.read(a)?.string??"")&&$file.write({data:$data({string:t}),path:a})}saveOrder(e,t){$file.write({data:$data({string:JSON.stringify(t)}),path:`${this.userActionPath}/${e}/${this.actionOrderFile}`})}move(e,t,i){if(e.section===t.section&&e.row===t.row)return;const a=(i=i.map((e=>(e.rows=e.rows.map((e=>e.info.info)),e))))[e.section],r=i[t.section],s=e=>{const t=[];return i[e].rows.forEach((e=>t.push(e.dir))),t},o=this.getTypeDir(a.title),n=this.getTypeDir(r.title);e.section===t.section?this.saveOrder(o,s(e.section)):(this.saveOrder(o,s(e.section)),this.saveOrder(n,s(t.section)),$file.move({src:`${this.userActionPath}/${o}/${r.rows[t.row].dir}`,dst:`${this.userActionPath}/${n}/${r.rows[t.row].dir}`})),((i=!0,a)=>{const s=this.matrix,o=this.actionToData(Object.assign(r.rows[t.row],{type:a}));i?(s.insert({indexPath:$indexPath(t.section,t.row+1),value:o},!1),s.delete(e,!1)):(s.delete(e,!1),s.insert({indexPath:t,value:o},!1))})(e.row<t.row,n)}delete(e){$file.delete(`${this.userActionPath}/${e.type}/${e.dir}`)}menuItems(){return[{title:$l10n("EDIT_DETAILS"),symbol:"slider.horizontal.3",handler:(e,t)=>{const i=e.cell(t),a=i.get("info").info;this.editActionInfoPageSheet(a,(e=>{i.get("info").info=e,i.get("color").bgcolor=this.kernel.setting.getColor(e.color),i.get("name").text=e.name,"icon_"===e.icon.slice(0,5)?i.get("icon").icon=$icon(e.icon.slice(5,e.icon.indexOf(".")),$color("#ffffff")):i.get("icon").image=$image(e.icon)}))}},{title:$l10n("EDIT_SCRIPT"),symbol:"square.and.pencil",handler:(e,t,i)=>{const a=i.info.info;if(!a)return;const r=`${this.userActionPath}/${a.type}/${a.dir}/main.js`,s=$file.read(r).string;this.editActionMainJs(s,a)}},{title:$l10n("DELETE"),symbol:"trash",destructive:!0,handler:(e,t,i)=>{this.kernel.deleteConfirm($l10n("CONFIRM_DELETE_MSG"),(()=>{this.delete(i.info.info),e.delete(t)}))}}]}getNavButtons(){return[{symbol:"plus.circle",menu:{pullDown:!0,asPrimary:!0,items:[{title:$l10n("CREATE_NEW_ACTION"),handler:()=>{this.editActionInfoPageSheet(null,(e=>{this.matrix.insert({indexPath:$indexPath(this.getActionTypes().indexOf(e.type),0),value:this.actionToData(e)});const t=$file.read(`${this.actionPath}/template.js`).string;this.saveMainJs(e,t),this.editActionMainJs(t,e)}))}},{title:$l10n("CREATE_NEW_TYPE"),handler:()=>{$input.text({text:"",placeholder:$l10n("CREATE_NEW_TYPE"),handler:e=>{if(""===(e=e.trim()))return void $ui.toast($l10n("INVALID_VALUE"));const t=`${this.userActionPath}/${e}`;$file.isDirectory(t)?$ui.warning($l10n("TYPE_ALREADY_EXISTS")):($file.mkdir(t),$ui.success($l10n("SUCCESS")))}})}}]}},{symbol:"arrow.up.arrow.down.circle",tapped:(e,t)=>{$ui.popover({sourceView:t,directions:$popoverDirection.up,size:$size(200,300),views:[this.getActionListView({reorder:!0,actions:[{title:"delete",handler:(e,t)=>{const i=this.matrix,a=i.object(t,!1).info.info;this.delete(a),i.delete(t,!1)}}]},{reorderBegan:e=>{this.reorder.from=e,this.reorder.to=void 0},reorderMoved:(e,t)=>{this.reorder.to=t},reorderFinished:e=>{void 0!==this.reorder.to&&this.move(this.reorder.from,this.reorder.to,e)}})]})}}]}actionsToData(){const e=[];return this.getActionTypes().forEach((t=>{const i={title:this.getTypeName(t),items:[]};this.getActions(t).forEach((e=>{i.items.push(this.actionToData(e))})),e.push(i)})),e}getMatrixView({columns:e=2,spacing:t=15,itemHeight:i=100}={}){return this.matrix=a.create({type:"matrix",props:{id:this.matrixId,columns:e,itemHeight:i,spacing:t,bgcolor:l.scrollViewBackgroundColor,menu:{items:this.menuItems()},data:this.actionsToData(),template:{props:{smoothCorners:!0,cornerRadius:10,bgcolor:$color("#ffffff","#242424")},views:[{type:"image",props:{id:"color",cornerRadius:8,smoothCorners:!0},layout:e=>{e.top.left.inset(10),e.size.equalTo($size(30,30))}},{type:"image",props:{id:"icon",tintColor:$color("#ffffff")},layout:e=>{e.top.left.inset(15),e.size.equalTo($size(20,20))}},{type:"button",props:{bgcolor:$color("clear"),tintColor:l.textColor,titleColor:l.textColor,contentEdgeInsets:$insets(0,0,0,0),titleEdgeInsets:$insets(0,0,0,0),imageEdgeInsets:$insets(0,0,0,0)},views:[{type:"image",props:{symbol:"ellipsis.circle"},layout:(e,t)=>{e.center.equalTo(t.super),e.size.equalTo(o.iconSize)}}],events:{tapped:e=>{const t=e.next.info;if(!t)return;const i=`${this.userActionPath}/${t.type}/${t.dir}/main.js`,a=$file.read(i).string;this.editActionMainJs(a,t)}},layout:e=>{e.top.right.inset(0),e.size.equalTo(o.size)}},{type:"view",props:{id:"info",hidden:!0}},{type:"label",props:{id:"name",font:$font(16)},layout:(e,t)=>{e.bottom.left.inset(10),e.width.equalTo(t.super)}}]}},layout:$layout.fill,events:{didSelect:(e,t,i)=>{const a=i.info.info;this.getActionHandler(a.type,a.dir)({text:"clipboard"===a.type||"uncategorized"===a.type?$clipboard.text:null,uuid:null})},pulled:e=>{$delay(.5,(()=>{e.endRefreshing(),this.matrix.update(this.actionsToData())}))}}}),this.matrix.definition}getPageView(){const e=new s;return e.navigationBarItems.setRightButtons(this.getNavButtons()),e.setView(this.getMatrixView()).navigationBarTitle($l10n("ACTIONS")),e.getPage()}present(){(new n).setView(this.getMatrixView()).addNavBar({title:$l10n("ACTIONS"),popButton:{symbol:"xmark.circle"},rightButtons:this.getNavButtons()}).init().present()}}})),parcelRequire.register("19zow",(function(e,t){var i=parcelRequire("iLgc0").Sheet;e.exports=class{constructor(e,t,i){this.kernel=e,this.config=t,Object.assign(this,i);const a=this.l10n();Object.keys(a).forEach((e=>{this.kernel.l10n(e,a[e])}))}l10n(){return{}}push(e){this.pageSheet(e)}pageSheet({view:e,title:t="",done:a,doneText:r=$l10n("DONE")}){(new i).setView(e).addNavBar({title:t,popButton:{title:r,tapped:()=>{a&&a()}}}).init().present()}getAllClipboard(){return this.kernel.storage.all().map((e=>e.text))}getAllContent(){return this.getAllClipboard()}setContent(e){this.text=e,this.kernel.editor.setContent(e)}get originalContent(){return this.kernel.editor.originalContent}async runAction(e,t){const i=this.kernel.actionManager.getActionHandler(e,t);return new Promise((async(a,r)=>{if("function"==typeof i){a(await i())}else r(`No such Action: ${e}/${t}`)}))}}})),parcelRequire.register("aXe3x",(function(e,t){var i=parcelRequire("iLgc0"),a=i.versionCompare,r=i.UIKit,s=i.Sheet,o=parcelRequire("jzyxm"),n=parcelRequire("huVPz");let l;function d(){l.setting.method.exportClipboard=e=>{e.actionStart(),l.storage.export((t=>{t?e.actionDone():e.actionCancel()}))},l.setting.method.importClipboard=e=>{e.actionStart(),$ui.alert({title:$l10n("ALERT_INFO"),message:$l10n("OVERWRITE_ALERT"),actions:[{title:$l10n("OK"),handler:()=>{$drive.open({handler:t=>{void 0!==t?"db"===t.fileName.slice(-2)||"zip"===t.fileName.slice(-3)?l.storage.import(t).then((()=>{e.actionDone(),$delay(.3,(()=>{$addin.restart()}))})).catch((t=>{$ui.error(t),l.print(t),e.actionCancel()})):($ui.warning($l10n("FILE_TYPE_ERROR")),e.actionCancel()):e.actionCancel()}})}},{title:$l10n("CANCEL"),handler:()=>e.actionCancel()}]})},l.setting.method.sync=e=>{$ui.alert({title:$l10n("SYNC_NOW"),message:$l10n("SYNC_ALERT_INFO"),actions:[{title:$l10n("CANCEL")},{title:$l10n("OK"),handler:()=>{e.actionStart(),setTimeout((()=>{l.storage.syncByiCloud(!0).then((()=>{e.actionDone()})).catch((t=>{$ui.error(t),l.print(t),e.actionCancel()}))}),200)}}]})},l.setting.method.deleteICloudData=e=>{l.deleteConfirm($l10n("CONFIRM_DELETE_MSG"),(()=>{l.storage.deleteICloudData()?e.actionDone():$ui.toast($l10n("DELETE_ERROR"))}))},l.setting.method.rebuildDatabase=e=>{e.actionStart();$ui.alert({title:$l10n("REBUILD_DATABASE_ALERT"),actions:[{title:$l10n("REBUILD"),style:$alertActionType.destructive,handler:()=>{(()=>{try{l.storage.rebuild(),e.actionDone(),$delay(.8,(()=>$addin.restart()))}catch(t){e.actionCancel(),$ui.alert(t)}})()}},{title:$l10n("CANCEL")}]})}}e.exports=function(e){l=e,l.setting.method.readme=e=>{const t=(()=>{const e=$device.info?.language?.startsWith("zh")?"README_CN.md":"README.md";try{return __README__[e]}catch{return $file.read(e).string}})();(new s).setView({type:"markdown",props:{content:t},layout:(e,t)=>{e.size.equalTo(t.super)}}).init().present()},l.setting.method.checkUpdate=e=>{e.actionStart(),l.checkUpdate((e=>{$file.write({data:$data({string:e}),path:"scripts/libs/easy-jsbox.js"}),$ui.toast("The framework has been updated.")})),$http.get({url:"https://raw.githubusercontent.com/ipuppet/CAIO/master/config.json",handler:t=>{const i=t.data?.info.version;let r;try{r=__INFO__}catch{r=JSON.parse($file.read("config.json").string).info}a(i,r.version)>0?$ui.alert({title:"New Version",message:`New version found: ${i}\nUpdate via Github or click the button to open Erots.`,actions:[{title:$l10n("CANCEL")},{title:"Erots",handler:()=>{$addin.run({name:"Erots",query:{q:"show",objectId:"603e6eaaca0dd64fcef93e2d"}})}}]}):$ui.toast("No need to update"),e.actionDone()}})},l.setting.method.previewWidget=e=>{const{Widget:t}=parcelRequire("hJIwW"),i={};try{JSON.parse($file.read("widget-options.json").string).forEach((e=>{i[e.name]=e.value}))}catch(e){return void $ui.error(e)}$ui.menu({items:Object.keys(i),handler:e=>{t.render(i[e])}})},d(),l.setting.method.exportAction=e=>{e.actionStart();const t="actions.zip",i=`${l.fileStorage.basePath}/actions.zip`;$archiver.zip({directory:l.actionManager.userActionPath,dest:i,handler:()=>{$share.sheet({items:[{name:t,data:$data({path:i})}],handler:t=>{t?e.actionDone():e.actionCancel(),$file.delete(i)}})}})},l.setting.method.importAction=e=>{e.actionStart(),$drive.open({handler:t=>{if(void 0!==t)if("zip"===t.fileName.slice(-3)){const i=`${l.fileStorage.basePath}/action_import`;$archiver.unzip({file:t,dest:i,handler:()=>{$file.list(i).forEach((e=>{$file.isDirectory(`${i}/${e}`)&&$file.copy({src:`${i}/${e}`,dst:`${l.actionManager.userActionPath}${e}`})})),$file.delete(i),e.actionDone()}})}else $ui.warning($l10n("FILE_TYPE_ERROR")),e.actionCancel();else e.actionCancel()}})},l.setting.method.importExampleAction=e=>{e.actionStart(),l.actionManager.importExampleAction(),e.actionDone()},l.setting.method.rebuildAction=e=>{e.actionStart(),$ui.alert({title:$l10n("REBUILD_ACTION_DATABASE_ALERT"),actions:[{title:$l10n("REBUILD"),style:$alertActionType.destructive,handler:()=>{$file.delete(l.actionManager.userActionPath),e.actionDone(),$delay(.8,(()=>$addin.restart()))}},{title:$l10n("CANCEL")}]})},l.setting.method.previewKeyboard=e=>{e.touchHighlightStart();const t=new(parcelRequire("1t2b4"))(l).getView();r.push({views:[t],disappeared:()=>e.touchHighlightEnd()})},l.setting.method.setKeyboardQuickStart=e=>{o.sheet()},l.setting.method.previewTodayWidget=e=>{e.touchHighlightStart();const t=new(parcelRequire("4RtRK"))(l).getView();r.push({views:[t],disappeared:()=>e.touchHighlightEnd()})},l.setting.method.setTodayWidgetActions=e=>{n.sheet(l)}}})),parcelRequire.register("jzyxm",(function(e,t){var i=parcelRequire("iLgc0").Sheet;class a{constructor(){this.listId="keyboard-script-list"}static getAddins(){const e=$cache.get("keyboard.addins");return void 0===e?(this.setAddins(),[]):JSON.parse(e)}static setAddins(e=[]){e.map(((t,i)=>{null===t&&e.splice(i,1)})),$cache.set("keyboard.addins",JSON.stringify(e))}getUnsetAddins(){const e=$addin.current.name,t=a.getAddins(),i=[];return $addin.list?.forEach((a=>{const r=a.displayName;-1===t.indexOf(r)&&e!==r&&i.push(r)})),i}add(){const e={type:"list",props:{data:this.getUnsetAddins()},events:{didSelect:(e,t,i)=>{const r=a.getAddins();r.unshift(i),a.setAddins(r),$(this.listId).insert({indexPath:$indexPath(0,0),value:i}),e.delete(t)}},layout:$layout.fill};(new i).setView(e).addNavBar({title:$l10n("ADD")}).init().present()}getNavButtons(){return[{symbol:"plus",tapped:()=>this.add()}]}getListView(){return{type:"list",props:{id:this.listId,reorder:!0,data:a.getAddins(),actions:[{title:"delete",handler:(e,t)=>{a.setAddins(e.data)}}]},events:{reorderFinished:e=>{a.setAddins(e)}},layout:$layout.fill}}static sheet(){const e=new i,t=new a;e.setView(t.getListView()).addNavBar({title:$l10n("QUICK_START_SCRIPTS"),popButton:{title:$l10n("CANCEL")},rightButtons:t.getNavButtons()}),e.init().present()}}e.exports=a})),parcelRequire.register("huVPz",(function(e,t){var i=parcelRequire("iLgc0").Sheet;class a{constructor(e){this.listId="today-action-list",this.kernel=e}getActions(){let e=$cache.get("today.actions")??[];"string"==typeof e&&(e=JSON.parse(e),this.setActions(e));const t={};this.kernel.actionManager.getActionTypes().forEach((e=>{this.kernel.actionManager.getActions(e).forEach((e=>{t[e.type+e.dir]=e}))}));const i=[];return e.forEach((e=>{i.push(t[e.type+e.dir])})),i}setActions(e=[]){e.map(((t,i)=>{null===t&&e.splice(i,1)})),$cache.set("today.actions",e)}getAllActions(){let e=[];return this.kernel.actionManager.getActionTypes().forEach((t=>{e=e.concat(this.kernel.actionManager.getActions(t))})),e}getUnsetActions(){const e=this.getActions().map((e=>e.name)),t=[];return this.getAllActions().forEach((i=>{const a=i.name;-1===e.indexOf(a)&&t.push(i)})),t}getListData(e){return e.map((e=>({action:{text:e.name,info:e},icon:"icon_"===e.icon.slice(0,5)?{icon:$icon(e.icon.slice(5,e.icon.indexOf(".")),$color("#ffffff"))}:{image:$image(e.icon)},color:{bgcolor:this.kernel.setting.getColor(e.color)}})))}getListTemplate(){return{views:[{type:"image",props:{id:"color",cornerRadius:8,smoothCorners:!0},layout:e=>{e.top.left.inset(10),e.size.equalTo($size(30,30))}},{type:"image",props:{id:"icon",tintColor:$color("#ffffff")},layout:e=>{e.top.left.inset(15),e.size.equalTo($size(20,20))}},{type:"label",props:{id:"action"},layout:(e,t)=>{e.bottom.top.inset(10),e.left.equalTo(t.prev.prev.right).offset(10),e.right.inset(10)}}]}}add(){const e={type:"list",props:{data:this.getListData(this.getUnsetActions()),template:this.getListTemplate(),rowHeight:50},events:{didSelect:(e,t,i)=>{const a=i.action.info,r=this.getActions();r.unshift(a),this.setActions(r),$(this.listId).insert({indexPath:$indexPath(0,0),value:this.getListData([a])[0]}),e.delete(t)}},layout:$layout.fill};(new i).setView(e).addNavBar({title:$l10n("ADD")}).init().present()}getNavButtons(){return[{symbol:"plus",tapped:()=>this.add()}]}getListView(){return{type:"list",props:{id:this.listId,data:this.getListData(this.getActions()),template:this.getListTemplate(),rowHeight:50,reorder:!0,actions:[{title:"delete",handler:(e,t)=>{this.setActions(e.data.map((e=>e.action.info)))}}]},events:{reorderFinished:e=>{const t=[];e.forEach((e=>{t.push(e.action.info)})),this.setActions(t)}},layout:$layout.fill}}static sheet(e){const t=new i,r=new a(e);t.setView(r.getListView()).addNavBar({title:$l10n("ACTIONS"),popButton:{title:$l10n("CANCEL")},rightButtons:r.getNavButtons()}),t.init().present()}}e.exports=a})),parcelRequire.register("1t2b4",(function(e,t){var i=parcelRequire("iLgc0"),a=i.UIKit,r=i.BarButtonItem,s=i.NavigationItem,o=i.NavigationBar,n=parcelRequire("ljwly"),l=parcelRequire("jzyxm");e.exports=class extends n{#L;constructor(e){super(e),this.listId="keyboard-clipboard-list",this.left_right=20,this.top_bottom=10,this.fontSize=14,this.navHeight=50,this.navBarSeparatorId="navBarSeparator",this.keyboardSetting(),this.taptic=1,this.deleteTimer=void 0,this.continuousDeleteTimer=void 0,this.deleteDelay=this.kernel.setting.get("keyboard.deleteDelay"),this.continuousDeleteDelay=.5,this.loadDataWithSingleLine()}listReady(){this.kernel.setting.get("clipboard.autoSave")&&$app.env===$env.keyboard&&(this.#L=$timer.schedule({interval:1,handler:()=>{this.readClipboard()}}))}keyboardSetting(){this.kernel.setting.get("keyboard.showJSBoxToolbar")||($keyboard.barHidden=!0)}keyboardTapped(e,t=!0){return(...i)=>{t&&this.kernel.setting.get("keyboard.tapticEngine")&&$device.taptic(this.taptic),e(...i)}}navButtons(){return[{symbol:"keyboard.chevron.compact.down",tapped:this.keyboardTapped((()=>$keyboard.dismiss()))},{symbol:"square.and.arrow.down.on.square",tapped:this.keyboardTapped((e=>{e.start(),this.readClipboard(!0),e.done()}))},{symbol:"bolt.circle",tapped:this.keyboardTapped(((e,t)=>{const i=$ui.popover({sourceView:t,directions:$popoverDirection.up,size:$size(200,300),views:[this.kernel.actionManager.getActionListView({},{didSelect:(e,t,a)=>{i.dismiss();const r=this.kernel.actionManager.getActionHandler(a.info.info.type,a.info.info.dir);setTimeout((()=>r({text:$clipboard.text})),500)}})]})}))}].map((e=>(new r).setAlign(a.align.right).setSymbol(e.symbol).setEvent("tapped",e.tapped).definition))}getNavBarView(){return{type:"view",props:{bgcolor:$color("backgroundColor")},views:[{type:"view",layout:$layout.fill,views:[{type:"label",props:{text:$l10n("CLIPBOARD"),font:$font("bold",20)},layout:(e,t)=>{e.centerY.equalTo(t.super),e.left.equalTo(t.super).offset(this.left_right)}}].concat(this.navButtons())}],layout:(e,t)=>{e.top.width.equalTo(t.super),e.height.equalTo(this.navHeight)}}}getBottomBarView(){const e=new o,t=new s;t.setLeftButtons([{symbol:"paperplane",menu:{pullDown:!0,asPrimary:!0,items:l.getAddins().reverse().map((e=>({title:e,handler:this.keyboardTapped((()=>$addin.run(e)))})))}}]),$device.isIphoneX||t.addLeftButton({symbol:"globe",tapped:this.keyboardTapped((()=>$keyboard.next())),menu:{pullDown:!0,items:[{title:"Next Keyboard",handler:this.keyboardTapped((()=>$keyboard.next()))}]}}),t.setRightButtons([{title:"Send",tapped:this.keyboardTapped((()=>$keyboard.send()))},{symbol:"delete.left",events:{touchesBegan:this.keyboardTapped((()=>{$keyboard.delete(),this.continuousDeleteTimer=$delay(this.continuousDeleteDelay,(()=>{this.deleteTimer=$timer.schedule({interval:this.deleteDelay,handler:this.keyboardTapped((()=>$keyboard.delete()),this.kernel.setting.get("keyboard.tapticEngineForDelete"))})}))})),touchesEnded:()=>{this.deleteTimer?.invalidate(),this.continuousDeleteTimer?.cancel()}}}]),e.setNavigationItem(t);const i=e.getNavigationBarView();return i.layout=(e,t)=>{e.bottom.left.right.equalTo(t.super.safeArea),e.top.equalTo(t.prev.bottom).offset(3)},i}getListView(){return{type:"list",props:{id:this.listId,bgcolor:$color("clear"),menu:{items:this.menuItems()},separatorInset:$insets(0,this.left_right,0,this.left_right),separatorColor:$color("lightGray"),data:this.savedClipboard,template:this.listTemplate(1)},events:{ready:()=>this.listReady(),rowHeight:(e,t)=>e.object(t).content.info.height+2*this.top_bottom+1,didSelect:this.keyboardTapped(((e,t,i)=>{const a=i.content.info.text,r=this.kernel.storage.keyToPath(a);r&&$file.exists(r.original)?($clipboard.image=$file.read(r.original).image,$ui.toast($l10n("COPIED"))):$keyboard.insert(i.content.info.text)})),didScroll:e=>{e.contentOffset.y>0?$(this.navBarSeparatorId).hidden=!1:$(this.navBarSeparatorId).hidden=!0}},layout:(e,t)=>{e.top.equalTo(this.navHeight),e.width.equalTo(t.super),e.bottom.equalTo(t.super).offset(-this.navHeight)}}}getView(){let e=this.kernel.setting.getImage("keyboard.background.image");const t=this.kernel.setting.getColor(this.kernel.setting.get("keyboard.background.color")),i=this.kernel.setting.getColor(this.kernel.setting.get("keyboard.background.color.dark"));return{type:"view",props:{id:"keyboard.main",bgcolor:$color(t,i)},views:[null!==e?{type:"image",props:{image:e},layout:$layout.fill}:{},this.getNavBarView(),a.separatorLine({id:this.navBarSeparatorId,hidden:!0,bgcolor:$color("lightGray")}),this.getListView(),a.separatorLine({bgcolor:$color("lightGray")}),this.getBottomBarView()],layout:$layout.fill}}}})),parcelRequire.register("4RtRK",(function(e,t){var i=parcelRequire("iLgc0"),a=i.UIKit,r=i.BarButtonItem,s=i.NavigationItem,o=i.NavigationBar,n=parcelRequire("ljwly"),l=parcelRequire("huVPz");e.exports=class extends n{constructor(e){super(e),this.actionsId="today-list-actions",this.listContainerId="today-list-container",this.readClipboardButtonId="today-nav-readClipboard",this.listId="today-list",this.bottomBar=new o,this.left_right=20,this.top_bottom=10,this.fontSize=14,this.navHeight=38,this.taptic=1,this.setSingleLine(),this.setClipboarPageSize($widget.mode),this.listPageNow=[0,0],this.listSection=Math.min(this.tabIndex,1),this.todayActions=new l(this.kernel),$widget.modeChanged=e=>{this.setClipboarPageSize(e),this.updateList()}}get isActionPage(){return 2===this.tabIndex}set tabIndex(e){$cache.set("caio.today.tab.index",e)}get tabIndex(){return $cache.get("caio.today.tab.index")??0}get tabItems(){return[$l10n("PIN"),$l10n("CLIPBOARD"),$l10n("ACTIONS")]}listReady(){this.updateList(),$delay(.5,(()=>this.readClipboard()))}readClipboard(e=!1){return!this.isActionPage&&(super.readClipboard(e)&&(this.listSection=1,this.listPageNow[this.listSection]=0,this.updateList()),!0)}setClipboarPageSize(e){if(0===e)this.listPageSize=1;else{const e=(($app.env===$env.app?a.windowSize.height:$widget.height)-2*this.navHeight)/(this.getSingleLineHeight()+2*this.top_bottom),t=Math.floor(e);this.listPageSize=t,e-t>=.6&&this.listPageSize++}}buttonTapped(e,t=!0){return(...i)=>{t&&this.kernel.setting.get("keyboard.tapticEngine")&&$device.taptic(this.taptic),e(...i)}}navButtons(){return[{symbol:"square.and.arrow.down.on.square",props:{id:this.readClipboardButtonId,hidden:this.isActionPage},tapped:this.buttonTapped((e=>{e.start(),this.readClipboard(!0)?e.done():e.cancel()}))}].map((e=>{const t=new r;return t.setAlign(a.align.right).setSymbol(e.symbol).setEvent("tapped",e.tapped).setProps(e.props??{}),t.definition}))}tabView(){const e=e=>{this.tabIndex=e,2===e?($(this.listContainerId).hidden=!0,$(this.actionsId).hidden=!1,$(this.readClipboardButtonId).hidden=!0):(this.listSection=e,$(this.actionsId).hidden=!0,$(this.listContainerId).hidden=!1,$(this.readClipboardButtonId).hidden=!1,this.updateList())};return{type:"tab",props:{items:this.tabItems,index:this.tabIndex,dynamicWidth:!0},events:{changed:t=>{e(t.index)}},layout:(e,t)=>{e.centerY.equalTo(t.super),e.left.equalTo(t.super.saveArea).offset(10)}}}getNavBarView(){return{type:"view",views:[{type:"view",layout:$layout.fill,views:[this.tabView(),{type:"label"},...this.navButtons()]}],layout:(e,t)=>{e.top.width.equalTo(t.super),e.height.equalTo(this.navHeight)}}}getBottomBarView(){const e=new s;e.setLeftButtons([{title:$l10n("PREV_PAGE"),tapped:this.buttonTapped((()=>{this.clipboardPrevPage()}))}]).setRightButtons([{title:$l10n("NEXT_PAGE"),tapped:this.buttonTapped((()=>{this.clipboardNextPage()}))}]).setTitle(this.listPageNow[this.listSection]+1).setLargeTitleDisplayMode(s.largeTitleDisplayModeNever),this.bottomBar.setNavigationItem(e);const t=this.bottomBar.getNavigationBarView();return t.layout=(e,t)=>{e.bottom.left.right.equalTo(t.super.safeArea),e.top.equalTo(t.prev.bottom)},t}updateList(){$(this.listId).data=this.getClipboardPage(),$(this.bottomBar.id+"-small-title").text=this.listPageNow[this.listSection]+1}clipboardPrevPage(){this.listPageNow[this.listSection]>0&&(this.listPageNow[this.listSection]--,this.updateList())}clipboardNextPage(){const e=Math.ceil(this.savedClipboard[this.listSection].rows.length/this.listPageSize);this.listPageNow[this.listSection]<e-1&&(this.listPageNow[this.listSection]++,this.updateList())}getClipboardPage(){const e=this.listPageNow[this.listSection]*this.listPageSize,t=e+this.listPageSize;return this.savedClipboard[this.listSection].rows.slice(e,t)}getListView(){return{type:"view",props:{id:this.listContainerId,hidden:this.isActionPage},views:[{type:"list",props:{id:this.listId,scrollEnabled:!1,bgcolor:$color("clear"),menu:{items:this.menuItems(!1)},separatorInset:$insets(0,this.left_right,0,this.left_right),rowHeight:this.getSingleLineHeight()+2*this.top_bottom,data:[],template:this.listTemplate(1)},events:{ready:()=>this.listReady(),didSelect:this.buttonTapped(((e,t,i)=>{const a=i.content.info.text,r=this.kernel.storage.keyToPath(a);r&&$file.exists(r.original)?$clipboard.image=$file.read(r.original).image:(this.setCopied(i.content.info.uuid,$indexPath(this.listSection,t.row)),this.setClipboardText(i.content.info.text)),$ui.toast($l10n("COPIED"))}))},layout:(e,t)=>{e.top.width.equalTo(t.super),e.bottom.equalTo(t.super).offset(-this.navHeight)}},this.getBottomBarView()],layout:(e,t)=>{e.top.equalTo(this.navHeight),e.bottom.left.right.equalTo(t.super.safeArea)}}}getMatrixView(){let e=this.todayActions.getActions();return 0===e.length&&(e=this.todayActions.getAllActions()),{type:"matrix",props:{id:this.matrixId,columns:2,itemHeight:50,spacing:8,data:e.map((e=>this.kernel.actionManager.actionToData(e))),template:{props:{smoothCorners:!0,cornerRadius:10,bgcolor:$color($rgba(255,255,255,.3),$rgba(0,0,0,.3))},views:[{type:"image",props:{id:"color",cornerRadius:8,smoothCorners:!0},layout:e=>{e.top.left.inset(10),e.size.equalTo($size(30,30))}},{type:"image",props:{id:"icon",tintColor:$color("#ffffff")},layout:e=>{e.top.left.inset(15),e.size.equalTo($size(20,20))}},{type:"label",props:{id:"name",font:$font(14)},layout:(e,t)=>{e.bottom.top.inset(10),e.left.equalTo(t.prev.prev.right).offset(10),e.right.inset(10)}},{type:"view",props:{id:"info",hidden:!0}}]}},layout:$layout.fill,events:{didSelect:(e,t,i)=>{const a=i.info.info;this.kernel.actionManager.getActionHandler(a.type,a.dir)({text:"clipboard"===a.type||"uncategorized"===a.type?$clipboard.text:null,uuid:null})}}}}getActionView(){return{type:"view",props:{id:this.actionsId,hidden:2!==this.tabIndex},views:[this.getMatrixView()],layout:(e,t)=>{e.top.equalTo(this.navHeight),e.bottom.left.right.equalTo(t.super.safeArea)}}}getView(){return{type:"view",views:[this.getNavBarView(),this.getListView(),this.getActionView()],layout:$layout.fill}}}})),$app.strings={en:{ALERT_INFO:"Alert",NONE:"None",FAILED_TO_LOAD_VIEW:"Faild to load view",VIEW_NOT_PROVIDED:"The view is not provided",UNCATEGORIZED:"Uncategorized",SHARE:"Share",CLIPBOARD:"Clipboard",UNIVERSAL_CLIPBOARD:"Universal Clipboard",UNIVERSAL_CLIPBOARD_TIPS:"Universal Clipboard allows you to copy something on your iPhone, and paste it on your Mac–or vice-versa–using iCloud.",CLIPBOARD_STRUCTURE_ERROR:"Clipboard data structure is abnormal",ADD:"Add",EDIT:"Edit",SEARCH:"Search",PIN:"Pin",COPY:"Copy",COPIED:"Copied",SORT:"Sort",ACTIONS:"Actions",PREVIEW:"Preview",MAX_ITEM_LENGTH:"Line Limit",TEXT_MAX_LENGTH:"Display Character Length",AUTO_SAVE:"Auto Save",AUTO_SYNC:"Auto Sync",SYNC_NOW:"Sync Now",UNZIP_FAILED:"Unzip file failed",SYNC_ALERT_INFO:"If it has not been synced locally, the iCloud data will be pulled directly. \\nDo you want to continue?",DELETE_ICLOUD_DATA:"Delete iCloud Data",REBUILD:"Rebuild",REBUILD_DATABASE:"Rebuild Database",REBUILD_DATABASE_ALERT:"Rebuilding the database will lose the order information, do you want to confirm the rebuild?",EDITOR:"Editor",CREATE_NEW:"Create New",CREATE_NEW_ACTION:"New Action",CREATE_NEW_TYPE:"New Category",TYPE_ALREADY_EXISTS:"This category already exists",EDIT_DETAILS:"Edit Details",EDIT_SCRIPT:"Edit Script",INFORMATION:"Information",NAME:"Name",ICON:"Icon",TYPE:"Category",DESCRIPTION:"Description",CODE:"Code",TEXT_INSETS:"Text bottom margin",SHOW_LINE_NUMBER:"Show line number",LIGHT_MODE_THEME:"Light Mode Theme",DARK_MODE_THEME:"Dark Mode Theme",SAVE:"Save",SAVE_SUCCESS:"Save success",SAVE_ERROR:"Save failed",DELETE:"Delete",CONFIRM_DELETE_MSG:"Are you sure you want to delete?",DELETE_SUCCESS:"Delete success",DELETE_ERROR:"Delete failed",IMPORT_EXAMPLE_ACTIONS:"Import example actions",REBUILD_ACTION_DATABASE:"Rebuild Action Database",REBUILD_ACTION_DATABASE_ALERT:"Are you sure you want to rebuild?",EXPORT:"Export",IMPORT:"Import",FILE_TYPE_ERROR:"File type does not match",OVERWRITE_ALERT:"This operation will overwrite the current data. Do you want to continue?",KEYBOARD:"Keyboard",BACKGROUND_COLOR:"Background Color",BACKGROUND_COLOR_DARK:"Dark Background Color",BACKGROUND_IMAGE:"Background Image",DELETE_DELAY:"Delete Delay",JSBOX_TOOLBAR:"JSBox Toolbar",QUICK_START_SCRIPTS:"Quick Start Scripts",CHECK_UPDATE:"Check Update",UPDATE:"Update",WIDGET:"Widget",RECENT:"Recent",CLICK_ACTION:"Click Action",TODAY_WIDGET:"Today Widget",PREV_PAGE:"Prev",NEXT_PAGE:"Next",DISPLAY_MODE:"Display Mode",CLASSIC:"Classic",MODERN:"Modern"},"zh-Hans":{ALERT_INFO:"提示",NONE:"什么都没有",FAILED_TO_LOAD_VIEW:"加载视图失败",VIEW_NOT_PROVIDED:"未提供该视图",UNCATEGORIZED:"未分类",SHARE:"分享",CLIPBOARD:"剪切板",UNIVERSAL_CLIPBOARD:"通用剪贴板",UNIVERSAL_CLIPBOARD_TIPS:"用剪贴板允许您在iPhone上复制某些内容，然后使用iCloud将其粘贴到Mac上(反之亦然)。",CLIPBOARD_STRUCTURE_ERROR:"剪切板数据结构异常",ADD:"添加",EDIT:"编辑",SEARCH:"搜索",PIN:"置顶",COPY:"复制",COPIED:"已复制",SORT:"排序",ACTIONS:"动作",PREVIEW:"预览",MAX_ITEM_LENGTH:"行数限制",TEXT_MAX_LENGTH:"显示字符长度",AUTO_SAVE:"自动保存",AUTO_SYNC:"自动同步",SYNC_NOW:"立即同步",UNZIP_FAILED:"解压文件失败",SYNC_ALERT_INFO:"若未在本机进行过同步则会直接拉取 iCloud 数据。\\n是否继续？",DELETE_ICLOUD_DATA:"删除 iCloud 数据",REBUILD:"重建",REBUILD_DATABASE:"重建数据库",REBUILD_DATABASE_ALERT:"重建数据库将会丢失顺序信息，是否确认重建？",EDITOR:"编辑器",CREATE_NEW:"新建",CREATE_NEW_ACTION:"新建动作",CREATE_NEW_TYPE:"新建分类",TYPE_ALREADY_EXISTS:"该类别已经存在",EDIT_DETAILS:"编辑信息",EDIT_SCRIPT:"编辑脚本",INFORMATION:"信息",NAME:"名称",ICON:"图标",TYPE:"分类",DESCRIPTION:"描述",CODE:"代码",TEXT_INSETS:"文本下边距",SHOW_LINE_NUMBER:"显示行号",LIGHT_MODE_THEME:"浅色模式主题",DARK_MODE_THEME:"深色模式主题",SAVE:"保存",SAVE_SUCCESS:"保存成功",SAVE_ERROR:"保存失败",DELETE:"删除",CONFIRM_DELETE_MSG:"确认要删除吗？",DELETE_SUCCESS:"删除成功",DELETE_ERROR:"删除失败",IMPORT_EXAMPLE_ACTIONS:"导入示例动作",REBUILD_ACTION_DATABASE:"重建动作库",REBUILD_ACTION_DATABASE_ALERT:"您确认要重建？",EXPORT:"导出",IMPORT:"导入",FILE_TYPE_ERROR:"文件类型不符",OVERWRITE_ALERT:"该操作将会覆盖当前数据，是否继续？",KEYBOARD:"键盘",BACKGROUND_COLOR:"背景色",BACKGROUND_COLOR_DARK:"深色模式背景色",BACKGROUND_IMAGE:"背景图片",DELETE_DELAY:"删除延时",JSBOX_TOOLBAR:"JSBox 工具栏",QUICK_START_SCRIPTS:"快速启动脚本",CHECK_UPDATE:"检查更新",UPDATE:"更新",WIDGET:"小组件",RECENT:"最近内容",CLICK_ACTION:"点击事件",TODAY_WIDGET:"通知中心小组件",PREV_PAGE:"上一页",NEXT_PAGE:"下一页",DISPLAY_MODE:"显示模式",CLASSIC:"经典",MODERN:"现代"}},$app.theme="auto",$app.minSDKVer="2.19.0",$app.minOSVer="14.0.0",$app.idleTimerDisabled=!1,$app.keyboardToolbarEnabled=!0,$app.rotateDisabled=!1,__INFO__={name:"CAIO",version:"1.6.0",author:"ipuppet",module:!1},__README__={"README.md":"# CAIO\n\n> Clipboard all in one.\n> \n> A Clipboard tool based on JSBox.\n\n支持桌面小组件和通知中心小组件\n\n## Actions\n\n> 编写方式详见 `scripts/action/README.md` 或应用内 `Action` 编辑页面右上角图书按钮。\n\n### 不同环境中 `Action` 数据区别\n\n- 首页顶部 `Action` 按钮处理的数据为当前复制的内容\n- 长按列表弹出的 `Action` 菜单处理的数据为被选中的内容\n- 编辑器中顶部 `Action` 按钮（闪电图形按钮）处理的数据为正在编辑的所有内容\n\n\n## Today Widget\n\n> 点击复制，长按触发动作。\n\n请尽量避免在 JSBox 运行 CAIO 时使用 Today Widget","README_CN.md":"# CAIO\n\n> Clipboard all in one.\n> \n> A Clipboard tool based on JSBox.\n\n支持桌面小组件和通知中心小组件\n\n## Actions\n\n> 编写方式详见 `scripts/action/README.md` 或应用内 `Action` 编辑页面右上角图书按钮。\n\n### 不同环境中 `Action` 数据区别\n\n- 首页顶部 `Action` 按钮处理的数据为当前复制的内容\n- 长按列表弹出的 `Action` 菜单处理的数据为被选中的内容\n- 编辑器中顶部 `Action` 按钮（闪电图形按钮）处理的数据为正在编辑的所有内容\n\n\n## Today Widget\n\n> 点击复制，长按触发动作。\n\n请尽量避免在 JSBox 运行 CAIO 时使用 Today Widget"},__SETTING__=[{items:[{icon:["doc.on.clipboard","#FFCC66"],type:"child",title:"CLIPBOARD",key:"clipboard",children:[{items:[{icon:["link","#FF6633"],title:"UNIVERSAL_CLIPBOARD",type:"switch",key:"clipboard.universal",value:!0},{icon:["cursorarrow.rays","#FF6633"],title:"Tips",type:"script",key:"clipboard.tips.universal",value:"$ui.alert({title:$l10n('UNIVERSAL_CLIPBOARD'),message:$l10n('UNIVERSAL_CLIPBOARD_TIPS')})"}]},{items:[{icon:["text.alignleft","#FFCC66"],title:"MAX_ITEM_LENGTH",type:"number",key:"clipboard.maxItemLength",value:100},{icon:["pencil.and.ellipsis.rectangle","#CC0099"],title:"TEXT_MAX_LENGTH",type:"number",key:"clipboard.textMaxLength",value:35},{icon:["square.and.arrow.down.on.square","#FF6633"],title:"AUTO_SAVE",type:"switch",key:"clipboard.autoSave",value:!0}]},{items:[{icon:["arrow.2.circlepath"],title:"AUTO_SYNC",type:"switch",key:"clipboard.autoSync",value:!1},{icon:["arrow.2.circlepath","#FFCC66"],title:"SYNC_NOW",type:"script",key:"clipboard.sync",value:"this.method.sync"},{icon:["trash","red"],title:"DELETE_ICLOUD_DATA",type:"script",key:"clipboard.deleteICloudData",value:"this.method.deleteICloudData"}]},{items:[{icon:["arrow.2.circlepath","red"],title:"REBUILD_DATABASE",type:"script",key:"clipboard.rebuildDatabase",value:"this.method.rebuildDatabase"}]},{items:[{icon:["square.and.arrow.up"],title:"EXPORT",type:"script",key:"clipboard.export",value:"this.method.exportClipboard"},{icon:["square.and.arrow.down","#FFCC33"],title:"IMPORT",type:"script",key:"clipboard.import",value:"this.method.importClipboard"}]}]},{icon:["bolt.circle","#FF6633"],type:"child",title:"ACTIONS",key:"action",children:[{items:[{icon:["bolt.circle","#FF6633"],title:"IMPORT_EXAMPLE_ACTIONS",type:"script",key:"action.importExampleAction",value:"this.method.importExampleAction"}]},{items:[{icon:["arrow.2.circlepath","red"],title:"REBUILD_ACTION_DATABASE",type:"script",key:"action.rebuildAction",value:"this.method.rebuildAction"}]},{items:[{icon:["square.and.arrow.up"],title:"EXPORT",type:"script",key:"action.export",value:"this.method.exportAction"},{icon:["square.and.arrow.down","#FFCC33"],title:"IMPORT",type:"script",key:"action.import",value:"this.method.importAction"}]}]},{icon:["pencil.circle","#CC0099"],type:"child",title:"EDITOR",key:"editor",children:[{title:"CLIPBOARD",items:[{icon:["wand.and.stars","#FF6633"],title:"TEXT_INSETS",type:"number",key:"editor.text.insets",value:300}]},{title:"CODE",items:[{icon:["list.number","#6699CC"],title:"SHOW_LINE_NUMBER",type:"switch",key:"editor.code.lineNumbers",value:!1},{icon:["wand.and.stars","#FF6633"],title:"LIGHT_MODE_THEME",type:"input",key:"editor.code.lightTheme",value:"atom-one-light"},{icon:["wand.and.stars","#FF6633"],title:"DARK_MODE_THEME",type:"input",key:"editor.code.darkTheme",value:"atom-one-dark"}]}]},{icon:["keyboard","#a2a5a6"],type:"child",title:"KEYBOARD",key:"keyboard",children:[{items:[{icon:["rectangle.3.offgrid.fill"],title:"PREVIEW",type:"script",key:"keyboard.preview",value:"this.method.previewKeyboard"}]},{items:[{icon:["sun.min","#A569BD"],title:"BACKGROUND_COLOR",type:"color",key:"keyboard.background.color",value:"#D1D3D9"},{icon:["sun.min","#A569BD"],title:"BACKGROUND_COLOR_DARK",type:"color",key:"keyboard.background.color.dark",value:"#313131"},{icon:["photo","#FFCC66"],title:"BACKGROUND_IMAGE",type:"image",key:"keyboard.background.image"}]},{items:[{icon:["cursor.rays","#FF8C00"],title:"Taptic Engine",type:"switch",key:"keyboard.tapticEngine",value:!0},{icon:["option","#157EFB"],title:"JSBOX_TOOLBAR",type:"switch",key:"keyboard.showJSBoxToolbar",value:!1},{icon:["paperplane"],title:"QUICK_START_SCRIPTS",type:"script",key:"keyboard.setKeyboardQuickStart",value:"this.method.setKeyboardQuickStart"}]},{items:[{icon:["cursor.rays","#FF8C00"],title:"Taptic Engine For Delete",type:"switch",key:"keyboard.tapticEngineForDelete",value:!0},{icon:["rays","#FFCC33"],title:"DELETE_DELAY",type:"number",key:"keyboard.deleteDelay",value:.05}]}]},{icon:["rectangle.3.offgrid.fill","#1899c4"],type:"child",title:"WIDGET",key:"widget",children:[{items:[{icon:["rectangle.3.offgrid.fill"],title:"PREVIEW",type:"script",key:"previewWidget",value:"this.method.previewWidget"}]},{title:"2x2",items:[{icon:["link"],title:"CLICK_ACTION",type:"menu",key:"widget.2x2.widgetURL",items:["ADD","ACTIONS","CLIPBOARD"],value:2}]}]},{icon:["filemenu.and.selection","#ebcc34"],type:"child",title:"TODAY_WIDGET",key:"todayWidget",children:[{items:[{icon:["rectangle.3.offgrid.fill"],title:"PREVIEW",type:"script",key:"todayWidget.preview",value:"this.method.previewTodayWidget"}]},{items:[{icon:["bolt.circle"],title:"ACTIONS",type:"script",key:"todayWidget.setTodayWidgetActions",value:"this.method.setTodayWidgetActions"}]}]}]},{items:[{icon:["rectangle.topthird.inset.filled","#A569BD"],title:"DISPLAY_MODE",type:"tab",key:"mainUIDisplayMode",items:["CLASSIC","MODERN"],value:0}]},{items:[{icon:["/assets/icon/github.com.jpeg","white"],title:"Github",type:"info",key:"github",value:["ipuppet/CAIO","https://github.com/ipuppet/CAIO"]},{icon:["/assets/icon/telegram.png","white"],title:"Telegram",type:"info",key:"telegram",value:["JSBoxTG","https://t.me/JSBoxTG"]},{icon:["person.fill","#FF9900"],title:"AUTHOR",type:"info",key:"author",value:["ipuppet","https://blog.ultagic.com"]},{icon:["arrow.2.circlepath"],title:"CHECK_UPDATE",type:"script",key:"checkUpdate",value:"this.method.checkUpdate"},{icon:["book.fill","#A569BD"],title:"README",type:"script",key:"readme",value:"this.method.readme"}]}],__ACTIONS__={clipboard:{ClearClipboard:{"config.json":'{\n    "icon": "trash",\n    "color": "#FF0000",\n    "name": "清除剪切板",\n    "description": "清除剪切板内容"\n}',"main.js":'/**\n * @typedef {import("../../action").Action} Action\n */\nclass MyAction extends Action {\n    l10n() {\n        return {\n            "zh-Hans": {\n                "clipboard.clear.success": "剪切板已清空"\n            },\n            en: {\n                "clipboard.clear.success": "Clipboard is cleared"\n            }\n        }\n    }\n\n    /**\n     * 系统会调用 do() 方法\n     */\n    do() {\n        $clipboard.clear()\n        $ui.success($l10n("clipboard.clear.success"))\n    }\n}\n',"README.md":"## ClearClipboard"},DownloadFromUrl:{"config.json":'{\n    "icon": "square.and.arrow.down",\n    "color": "#FF0099",\n    "name": "从链接下载",\n    "description": "从链接下载内容，如 js 文件内容等"\n}',"main.js":'class MyAction extends Action {\n    async downloadContent(url) {\n        const response = await $http.get({\n            url,\n            showsProgress: true\n        })\n        if (response.error) {\n            $ui.alert(response.error.localizedDescription)\n        } else {\n            return response\n        }\n    }\n\n    async do() {\n        const regex = /(https?:\\/\\/)([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([:0-9])*([\\/\\w\\#\\.\\-\\?\\=\\&])*\\s?/ig\n        const text = this.text ?? ""\n        const url = text.match(regex, text) ?? []\n        let response = undefined\n        if (url.length > 1) {\n            $ui.menu({\n                items: url,\n                handler: async (title, index) => {\n                    response = await this.downloadContent(url[index])\n                }\n            })\n        } else if (url.length === 1) {\n            response = await this.downloadContent(url[0])\n        } else {\n            $ui.warning("未检测到链接")\n            return\n        }\n        $share.sheet([{\n            name: response.response.suggestedFilename,\n            data: response.data\n        }])\n        return response\n    }\n}\n',"README.md":"## DownloadFromUrl\n\n从链接下载内容，如 js 文件内容等"},OpenUrl:{"config.json":'{\n    "icon": "link",\n    "color": "#FF0099",\n    "name": "打开链接",\n    "description": "提取文本中的链接并打开"\n}',"main.js":'class MyAction extends Action {\n    openUrl(url) {\n        $app.openURL(url.trim())\n    }\n\n    do() {\n        const regex = /(https?:\\/\\/)([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([:0-9])*([\\/\\w\\#\\.\\-\\?\\=\\&])*\\s?/ig\n        const text = this.text ?? ""\n        const url = text.match(regex, text) ?? []\n        if (url.length > 1) {\n            $ui.menu({\n                items: url,\n                handler: (title, index) => {\n                    this.openUrl(url[index])\n                }\n            })\n        } else if (url.length === 1) {\n            this.openUrl(url[0])\n        } else {\n            $ui.warning("未检测到链接")\n        }\n    }\n}\n',"README.md":"## OpenUrl\n\n提取文本中的URL并打开"},Tokenize:{"config.json":'{\n    "icon": "pencil.and.ellipsis.rectangle",\n    "color": "#0099FF",\n    "name": "分词复制",\n    "description": "将文本分词处理后复制"\n}',"main.js":'class MyAction extends Action {\n    getView() {\n        const color = {\n            background: {\n                normal: $color("#E7F2FF", "#E7F2FF"),\n                highlight: $color("##074FF", "#BBDAFF")\n            },\n            text: {\n                normal: $color("##074FF", "##074FF"),\n                highlight: $color("#FFFFFF", "#ADADAD")\n            }\n        }\n        const fontSize = 16\n        const edges = 10\n        return {\n            type: "matrix",\n            layout: $layout.fill,\n            props: {\n                spacing: edges,\n                data: this.results.map(item => ({ label: { text: item } })),\n                template: {\n                    views: [{\n                        type: "label",\n                        props: {\n                            id: "label",\n                            align: $align.center,\n                            cornerRadius: edges,\n                            bgcolor: color.background.normal,\n                            font: $font(fontSize),\n                            textColor: color.text.normal\n                        },\n                        layout: $layout.fill\n                    }]\n                }\n            },\n            events: {\n                highlighted: () => { },\n                itemSize: (sender, indexPath) => {\n                    const width = fontSize * this.results[indexPath.item].length + 1\n                    if (this.maxtrixItemHeight === undefined)\n                        this.maxtrixItemHeight = fontSize + edges * 2\n                    return $size(width + edges * 2, this.maxtrixItemHeight)\n                },\n                didSelect: (sender, indexPath) => {\n                    const index = this.selected.indexOf(indexPath.item)\n                    const label = sender.cell(indexPath).get("label")\n                    if (index === -1) {\n                        this.selected.push(indexPath.item)\n                        label.bgcolor = color.background.highlight\n                        label.textColor = color.text.highlight\n                    } else {\n                        this.selected.splice(index, 1)\n                        label.bgcolor = color.background.normal\n                        label.textColor = color.text.normal\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * 系统会调用 do() 方法\n     */\n    do() {\n        this.selected = []\n        this.results = []\n        $text.tokenize({\n            text: this.text,\n            handler: results => {\n                this.results = results\n                this.pageSheet({\n                    view: this.getView(),\n                    done: () => {\n                        const result = []\n                        this.selected.sort().forEach(i => {\n                            result.push(this.results[i])\n                        })\n                        if (result.length > 0) {\n                            const text = result.join("")\n                            $clipboard.text = text\n                            $ui.alert({\n                                title: "完成",\n                                message: `已复制内容：${text}`\n                            })\n                        }\n                    }\n                })\n            }\n        })\n    }\n}\n',"README.md":"## Tokenize\n\n> 将文本分词处理后复制"}},editor:{PreviewMarkdown:{"config.json":'{\n    "icon": "book",\n    "color": "#9900CC",\n    "name": "预览Markdown",\n    "description": "预览Markdown"\n}',"main.js":'class MyAction extends Action {\n    do() {\n        this.pageSheet({\n            view: {\n                type: "markdown",\n                props: { content: this.text },\n                layout: $layout.fill\n            }\n        })\n    }\n}\n',"README.md":"## PreviewMarkdown\n\n> 预览Markdown"},SelectedText:{"config.json":'{\n    "icon": "crop",\n    "color": "#6699CC",\n    "name": "选中的文本",\n    "description": "这是个测试 Action, 将在控制台输出当前选中的文本"\n}',"main.js":"class MyAction extends Action {\n    do() {\n        const selectedText = this.selectedText\n        $ui.alert(selectedText)\n    }\n}\n","README.md":"## SelectedText\n\n> 显示选中的文本"}},uncategorized:{DisplayClipboard:{"config.json":'{\n    "icon": "option",\n    "color": "#FF6633",\n    "name": "显示剪切板",\n    "description": "显示剪切板内容"\n}',"main.js":'class MyAction extends Action {\n    /**\n     * 系统会调用 do() 方法\n     */\n    do() {\n        this.pageSheet({\n            view: {\n                type: "label",\n                props: {\n                    text: this.text,\n                    align: $align.center\n                },\n                layout: $layout.fill\n            }\n        })\n    }\n}\n',"README.md":"## DisplayClipboard"},ExportAllContent:{"config.json":'{\n    "icon": "square.and.arrow.up",\n    "color": "#FF3300",\n    "name": "导出数据",\n    "description": "导出所有保存的数据"\n}',"main.js":'class MyAction extends Action {\n    do() {\n        const data = this.getAllContent().join("\\n")\n        if (data) $share.sheet(data)\n        else $ui.alert("无数据")\n    }\n}\n',"README.md":"## ExportAllContent\n\n导出所有保存的数据"},Replace:{"config.json":'{\n    "icon": "square.and.arrow.up",\n    "color": "#FF3300",\n    "name": "查找替换",\n    "description": "查找替换"\n}',"main.js":'function HtmlTemplate(html) {\n    return `\n<html>\n<head>\n    <meta name="viewport" content="width=device-width,initial-scale=1">\n</head>\n<body>\n${html}\n</body>\n</html>\n`\n}\n\nclass MyAction extends Action {\n    do() {\n        $ui.menu({\n            items: ["忽略大小写", "大小写敏感", "正则表达式"],\n            handler: async (title, idx) => {\n                const patternText = await $input.text({\n                    placeholder: "查找内容"\n                })\n                const replaceString = await $input.text({\n                    placeholder: "替换内容"\n                })\n                let pattern = undefined\n                if (idx === 0) {\n                    pattern = new RegExp(`(${patternText})+`, "gi")\n                } else if (idx === 1) {\n                    pattern = new RegExp(`(${patternText})+`, "g")\n                } else if (idx === 2) {\n                    pattern = new RegExp(patternText, "g")\n                }\n\n                const matchResultPreview = this.text.replace(pattern, `<font color=red>${replaceString}</font>`)\n                const matchResult = this.text.replace(pattern, replaceString)\n                this.pageSheet({\n                    title: "替换预览",\n                    doneText: "替换",\n                    view: {\n                        type: "web",\n                        props: {\n                            html: HtmlTemplate(matchResultPreview)\n                        },\n                        layout: $layout.fill\n                    },\n                    done: () => {\n                        this.setContent(matchResult)\n                    }\n                })\n            }\n        })\n        // this.setContent("Hello world!")\n    }\n}\n',"README.md":"## Replace\n\n查找替换"}}};var $hJIwW=parcelRequire("hJIwW");$hJIwW.run()})();