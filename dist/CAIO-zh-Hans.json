{
    "actions": [
        {
            "type": "@comment",
            "parameters": {
                "text": {
                    "value": "GitHub: https://github.com/ipuppet/CAIO"
                }
            }
        },
        {
            "type": "@flow.javascript",
            "parameters": {
                "script": {
                    "value": "(()=>{var t=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:{},e={},i={},s=t.parcelRequire94c2;let n;switch(null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in i){var s=i[t];delete i[t];var n={id:t,exports:{}};return e[t]=n,s.call(n.exports,n,n.exports),n.exports}var r=new Error(\"Cannot find module '\"+t+\"'\");throw r.code=\"MODULE_NOT_FOUND\",r}).register=function(t,e){i[t]=e},t.parcelRequire94c2=s),s.register(\"ljE8b\",(function(t,e){var i=s(\"8Makm\").AppKernelBase;class n extends i{constructor(){super(),this.setting.setReadonly()}addOpenInJsboxButton(){this.useJsboxNav(),this.setNavButtons([{image:$image(\"assets/icon.png\"),handler:()=>this.openInJsbox()}])}}class r{static kernel=$app.env!==$env.widget?new n:void 0;static renderKeyboardUI(){this.kernel.addOpenInJsboxButton();const t=new(s(\"7eNYp\"))(this.kernel);this.kernel.KeyboardRender(t.getView())}static renderTodayUI(){this.kernel.addOpenInJsboxButton();const t=new(s(\"49je6\"))(this.kernel);this.kernel.UIRender(t.getView())}static shortcuts(){const t=$context.query.table?.trim()??\"\";if(\"\"!==t){const e=this.kernel.clips.tabItemsMap;this.kernel.clips.rememberTabIndex=!1,this.kernel.clips.tabIndex=e[t]??e.clips}try{if(void 0!==$context.query.set){let t=$context.query.set;if(\"\"===t.trim())throw new Error(\"cannot set empty content\");this.kernel.clips.addItem(t),$intents.finish()}else if(void 0!==$context.query.get){let t=$context.query.get??0;if(\"number\"!=typeof t)throw new Error(\"`get` must be a number index\");const e=this.kernel.clips.getByIndex(t);$intents.finish(e.text)}else $intents.finish(\"`get` or `set` is required\")}catch(t){$intents.finish(t.message)}finally{$intents.finish()}}}t.exports={run:()=>{$app.env===$env.today?r.renderTodayUI():$app.env===$env.keyboard?r.renderKeyboardUI():$app.env===$env.siri&&r.shortcuts()}}})),s.register(\"8Makm\",(function(t,e){var i=s(\"gxpqj\"),n=i.Kernel,r=i.Logger,a=i.FileStorage,o=i.Setting,l=i.FileManager,h=s(\"2EAPF\"),c=s(\"jEwwi\").Storage,d=s(\"4c0o0\"),u=s(\"gVMQa\");class p extends n{static fileStorage=new a;logPath=\"logs\";logFile=\"caio.log\";logFilePath=a.join(this.logPath,this.logFile);#t;constructor(){super(),$app.listen({exit:()=>$objc_clean()}),this.fileStorage=p.fileStorage,this.logger=new r,this.logger.setWriter(this.fileStorage,this.logFilePath),this.setting=new o({logger:this.logger,fileStorage:this.fileStorage,structure:h}),this.initComponents()}get storage(){return this.#t||(this.logger.info(\"init storage\"),this.#t=new c(this)),this.#t}initComponents(){this.clips=new d(this),this.actions=new u(this),this.fileManager=new l}}t.exports={AppKernelBase:p}})),s.register(\"gxpqj\",(function(t,e){var i=class{title;handler;constructor({title:t=$l10n(\"OK\"),disabled:e=!1,style:i=$alertActionType.default,handler:s=(()=>{})}={}){this.title=t,this.disabled=e,this.style=i,this.handler=s}},s=class{events={};setEvents(t){return Object.keys(t).forEach((e=>this.setEvent(e,t[e]))),this}setEvent(t,e){return this.events[t]=e,this}appendEvent(t,e){let i=this.events[t];return\"function\"==typeof i?this.events[t]=(...t)=>{i(...t),e(...t)}:this.setEvent(t,e),this}callEvent(t,...e){\"function\"==typeof this.events[t]&&this.events[t](...e)}},n=class t{basePath;constructor({basePath:t=\"storage\"}={}){this.basePath=t,this.#e(this.basePath)}static join(...t){let e=t.length,i=t[0];if(e<2)return i;for(let s=0;s<e-1;++s){let e=t[s+1];e.startsWith(\"/\")&&(e=e.substring(1)),i=i.endsWith(\"/\")?i+e:i+\"/\"+e}return i}#e(t){$file.isDirectory(t)||$file.mkdir(t)}filePath(e=\"\",i=!0){let s=\"\";if(!(e=t.join(this.basePath,e)).endsWith(\"/\")){let t=e.lastIndexOf(\"/\");e.lastIndexOf(\".\")>t&&(s=e.substring(t+1),e=e.substring(0,t+1))}return i&&this.#e(e),e+s}exists(t=\"\"){return t=this.filePath(t,!1),!!$file.exists(t)}write(t=\"\",e){return new Promise(((i,s)=>{try{let n=this.writeSync(t,e);n?i(n):s(n)}catch(t){s(t)}}))}writeSync(t=\"\",e){if(!e)throw new g(\"data\");return $file.write({data:e,path:this.filePath(t)})}read(t=\"\"){return new Promise(((e,i)=>{try{let s=this.readSync(t);s?e(s):i()}catch(t){i(t)}}))}readSync(t=\"\"){if(t=this.filePath(t),!$file.exists(t))throw new f(t);return $file.isDirectory(t)?$file.list(t):$file.read(t)}readAsJSON(t=\"\",e=null){try{let e=this.readSync(t)?.string;return JSON.parse(e)}catch{return e}}static readFromRoot(e=\"\"){return new Promise(((i,s)=>{try{let n=t.readFromRootSync(e);n?i(n):s()}catch(t){s(t)}}))}static readFromRootSync(t=\"\"){if(!t)throw new g(\"path\");if(!$file.exists(t))throw new f(t);return $file.isDirectory(t)?$file.list(t):$file.read(t)}static readFromRootAsJSON(e=\"\",i=null){try{let i=t.readFromRootSync(e)?.string;return JSON.parse(i)}catch{return i}}delete(t=\"\"){return $file.delete(this.filePath(t,!1))}copy(t,e){t=this.filePath(t),e=this.filePath(e),$file.copy({src:t,dst:e})}move(t,e){t=this.filePath(t),e=this.filePath(e),$file.move({src:t,dst:e})}},r=class{static l10n(t,e,i){if(\"string\"==typeof e){let t={};e.split(\";\").forEach((e=>{if(\"\"!==(e=e.trim())){let i=e.split(\"=\");t[i[0].trim().slice(1,-1)]=i[1].trim().slice(1,-1)}})),e=t}let s=$app.strings;if(i)Object.assign(s[t],e);else for(let i in e)s[t][i]||(s[t][i]=e[i]);$app.strings=s}static set(t,e){this.l10n(t,e,!0)}static add(t,e){this.l10n(t,e,!1)}static init(){this.add(\"zh-Hans\",{OK:\"好\",DONE:\"完成\",CANCEL:\"取消\",CLEAR:\"清除\",BACK:\"返回\",ERROR:\"发生错误\",SUCCESS:\"成功\",INVALID_VALUE:\"非法参数\",CONFIRM_CHANGES:\"数据已变化，确认修改？\",SETTING:\"设置\",GENERAL:\"一般\",ADVANCED:\"高级\",TIPS:\"小贴士\",COLOR:\"颜色\",COPY:\"复制\",COPIED:\"复制成功\",JSBOX_ICON:\"JSBox 内置图标\",SF_SYMBOLS:\"SF Symbols\",IMAGE_BASE64:\"图片 / base64\",PREVIEW:\"预览\",SELECT_IMAGE_PHOTO:\"从相册选择图片\",SELECT_IMAGE_ICLOUD:\"从 iCloud 选择图片\",CLEAR_IMAGE:\"清除图片\",NO_IMAGE:\"无图片\",ABOUT:\"关于\",VERSION:\"Version\",AUTHOR:\"作者\",AT_BOTTOM:\"已经到底啦~\"}),this.add(\"en\",{OK:\"OK\",DONE:\"Done\",CANCEL:\"Cancel\",CLEAR:\"Clear\",BACK:\"Back\",ERROR:\"Error\",SUCCESS:\"Success\",INVALID_VALUE:\"Invalid value\",CONFIRM_CHANGES:\"The data has changed, confirm the modification?\",SETTING:\"Setting\",GENERAL:\"General\",ADVANCED:\"Advanced\",TIPS:\"Tips\",COLOR:\"Color\",COPY:\"Copy\",COPIED:\"Copide\",JSBOX_ICON:\"JSBox in app icon\",SF_SYMBOLS:\"SF Symbols\",IMAGE_BASE64:\"Image / base64\",PREVIEW:\"Preview\",SELECT_IMAGE_PHOTO:\"Select From Photo\",SELECT_IMAGE_ICLOUD:\"Select From iCloud\",CLEAR_IMAGE:\"Clear Image\",NO_IMAGE:\"No Image\",ABOUT:\"About\",VERSION:\"Version\",AUTHOR:\"Author\",AT_BOTTOM:\"It's the end~\"}),this.add(\"zh-Hans\",{DELETE_CONFIRM_TITLE:\"删除前确认\"}),this.add(\"en\",{DELETE_CONFIRM_TITLE:\"Delete Confirmation\"}),this.add(\"zh-Hans\",{FILE_MANAGER_DELETE_CONFIRM_MSG:\"确认要删除吗\",DELETE:\"删除\",CANCEL:\"取消\",CLOSE:\"关闭\",SHARE:\"分享\",SAVE:\"保存\",SAVE_SUCCESS:\"保存成功\"}),this.add(\"en\",{FILE_MANAGER_DELETE_CONFIRM_MSG:\"Are you sure you want to delete\",DELETE:\"Delete\",CANCEL:\"Cancel\",CLOSE:\"Close\",SHARE:\"Share\",SAVE:\"Save\",SAVE_SUCCESS:\"Save Success\"})}},a=class t{static level={info:\"info\",warn:\"warn\",error:\"error\"};writer;fsLevels=[t.level.error];printToFile(t){this.fsLevels=t}setWriter(t,e){this.writer=i=>{t.exists(e)&&(i=(t.readSync(e)?.string??\"\")+i),t.writeSync(e,$data({string:i}))}}format(t,e){return`${(new Date).toUTCString()} [${e.toUpperCase()}] ${t}\\n`}log(t,e){this.writer&&this.fsLevels.includes(e)&&this.writer(this.format(t,e)),$app.isDebugging&&console[e](t)}info(e){this.log(e,t.level.info)}warn(e){this.log(e,t.level.warn)}error(e){this.log(e,t.level.error)}},o=class{rightButtons=[];leftButtons=[];#e={};hasbutton=!1;isPinTitleView=!1;setTitleView(t){return this.titleView=t,this}pinTitleView(){return this.isPinTitleView=!0,this}setFixedFooterView(t){return this.fixedFooterView=t,this}setRightButtons(t){return t.forEach((t=>this.addRightButton(t))),this.hasbutton||(this.hasbutton=!0),this}setLeftButtons(t){return t.forEach((t=>this.addLeftButton(t))),this.hasbutton||(this.hasbutton=!0),this}addRightButton({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a}={}){let o=E.creat({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a,align:u.align.right});return this.rightButtons.push(o),this.#e[t??o.id]=o,this.hasbutton||(this.hasbutton=!0),this}addLeftButton({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a}={}){let o=E.creat({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a,align:u.align.left});return this.leftButtons.push(o),this.#e[t??o.id]=o,this.hasbutton||(this.hasbutton=!0),this}getButton(t){return this.#e[t]}getButtons(){return Object.values(this.#e)}addPopButton(t,e,i){return t||(t=$l10n(\"BACK\")),this.popButtonView=e??{type:\"button\",props:{bgcolor:$color(\"clear\"),symbol:\"chevron.left\",tintColor:u.linkColor,title:` ${t}`,titleColor:u.linkColor,font:$font(\"bold\",16)},layout:(t,e)=>{t.left.equalTo(e.super.safeArea).offset(E.style.edges),t.centerY.equalTo(e.super.safeArea)},events:{tapped:()=>{$ui.pop(),\"function\"==typeof i&&i()}}},this}removePopButton(){return this.popButtonView=void 0,this}},l=class t{static method={get:\"GET\",post:\"POST\",put:\"PUT\",delete:\"DELETE\",patch:\"PATCH\",head:\"HEAD\",options:\"OPTIONS\"};static errorType={http:0,network:1};cacheContainerKey=$addin?.current?.name+\".request.cache\";#e;#i=!1;#s=!1;cacheLife=2592e6;#n=!1;timeout=5;logger;constructor(t){t instanceof a&&(this.logger=t)}get cache(){return $cache.get(this.cacheContainerKey)??{}}#r(t){this.#n&&this.logger instanceof a&&this.logger.info(t)}logRequest(){return this.#n=!0,this}disableLogRequest(){this.#n=!1}getCacheKey(t){return $text.MD5(t)}getCache(t,e=null){return this.cache[t]??e}setCache(t,e){if(!e)return;let i=this.cache;i[t]=e,$cache.set(this.cacheContainerKey,i)}removeCache(t){let e=this.cache;delete e[t],$cache.set(this.cacheContainerKey,e)}clearCache(){$cache.remove(this.cacheContainerKey)}clearNSURLCache(){this.#e||(this.#e=$objc(\"NSURLCache\").$sharedURLCache()),this.#e.$removeAllCachedResponses()}enableCache(){return this.#i=!0,this}disableCache(){return this.#i=!1,this}ignoreCacheExp(){this.#s=!0}async request(e,i,s={},n={},r=this.cacheLife,a){let o,l=this.#i&&i===t.method.get;if(l){o=this.getCacheKey(e);let t=this.getCache(o);if(t&&(this.#s||t.exp>Date.now()))return this.#r(\"get data from cache: \"+e),t.data}this.#r(`sending request [${i}]: ${e}`);let h=await $http.request(Object.assign({header:n,url:e,method:i,body:i===t.method.get?null:s,timeout:this.timeout},a));if(h.error)throw new w({type:t.errorType.network,message:h.error.localizedDescription,code:h.error.code});if(h?.response?.statusCode>=400){let e=h.data;throw\"object\"==typeof e&&(e=JSON.stringify(e)),new w({type:t.errorType.http,message:e,code:h.response.statusCode})}return l&&this.setCache(o,{exp:Date.now()+r,data:h}),h}},h=class t{static rowHeight=50;static edgeOffset=10;static iconSize=30;static iconDefaultColor=\"#00CC00\";setting;#e;#i;#s;title;#n={};constructor({setting:t,key:e,title:i,icon:s,value:n=null}={}){this.setting=t,this.key=e,this.title=$l10n(i),this.icon=s,this.default=n}get method(){return this.setting.method}set key(t){return this.#i=t??$text.uuid,this.#e=void 0,this}get key(){return this.#i}get id(){return this.#e||(this.#e=`setting-${$text.uuid}-${this.key}`),this.#e}set icon(e){return e?Array.isArray(e)||(e=[e,t.iconDefaultColor]):e=[\"square.grid.2x2.fill\",t.iconDefaultColor],Array.isArray(e[0])||(e[0]=[e[0],e[0]]),e[1]?Array.isArray(e[1])||(e[1]=[e[1],e[1]]):e[1]=[t.iconDefaultColor,t.iconDefaultColor],this.#s=e,this}get icon(){return this.#s}get options(){return this.#n}set options(t){return this.#n=t??{},this}set(t){return this.setting.set(this.key,t)}get(t=this.default){return this.setting.getOriginal(this.key,t)}evalValues(t,e=[]){let i;return i=\"string\"==typeof t?t.startsWith(\"this.method\")?new Function(\"method\",`return ${t.replace(\"this.\",\"\")}()`)(this.method):new Function(`return {${t}}`)():\"function\"==typeof t?t():t??e,i}createLineLabel(){return{type:\"view\",views:[{type:\"view\",props:{bgcolor:$color(this.icon[1][0],this.icon[1][1]),cornerRadius:5,smoothCorners:!0},views:[{type:\"image\",props:{tintColor:$color(\"white\"),image:$image(this.icon[0][0],this.icon[0][1])},layout:(t,e)=>{t.center.equalTo(e.super),t.size.equalTo(20)}}],layout:(e,i)=>{e.centerY.equalTo(i.super),e.size.equalTo(t.iconSize),e.left.inset(t.edgeOffset)}},{type:\"label\",props:{text:this.title,lines:1,align:$align.left},layout:(e,i)=>{e.centerY.equalTo(i.super),e.height.equalTo(i.super),e.left.equalTo(i.prev.right).offset(t.edgeOffset),e.width.greaterThanOrEqualTo(10)}}],layout:(t,e)=>{t.height.centerY.equalTo(e.super),t.left.inset(0)}}}getView(){}create(){return this.getView(this.options)}},c=class t{#e=()=>{};#i=()=>{};style=t.UIModalPresentationStyle.PageSheet;#s=!1;#n;static UIModalPresentationStyle={Automatic:-2,FullScreen:0,PageSheet:1,FormSheet:2,CurrentContext:3,Custom:4,OverFullScreen:5,OverCurrentContext:6,Popover:7,BlurOverFullScreen:8};navigationView;init(){this.initNavBar();let t=$objc(\"UIViewController\").invoke(\"alloc.init\"),e=t.$view();return e.$addSubview($ui.create({type:\"view\"})),t.$setModalPresentationStyle(this.style),t.$setModalInPresentation(this.#s),this.#e=()=>{e.jsValue().add(this.navigationView?.getPage().definition??this.view),$ui.vc.ocValue().invoke(\"presentViewController:animated:completion:\",t,!0,null)},this.#i=()=>t.invoke(\"dismissViewControllerAnimated:completion:\",!0,null),this}initNavBar(){if(!this.#n)return;let{title:e=\"\",popButton:i={title:$l10n(\"CLOSE\")},rightButtons:s=[]}=this.#n;if(void 0===this.view)throw new v;this.navigationView=new x;let n=this.navigationView.navigationBar;n.setLargeTitleDisplayMode(A.largeTitleDisplayModeNever),n.navigationBarLargeTitleHeight-=n.navigationBarNormalHeight,n.navigationBarNormalHeight=u.PageSheetNavigationBarNormalHeight,n.navigationBarLargeTitleHeight+=n.navigationBarNormalHeight,this.style===t.UIModalPresentationStyle.FullScreen||this.style===t.UIModalPresentationStyle.OverFullScreen||this.style===t.UIModalPresentationStyle.BlurOverFullScreen?n.setTopSafeArea():n.removeTopSafeArea(),i.events=Object.assign({tapped:async()=>{\"function\"==typeof i.tapped&&await i.tapped(),this.dismiss()}},i.events??{}),this.navigationView.navigationBarItems.addLeftButton(i).setRightButtons(s),this.navigationView.setView(this.view).navigationBarTitle(e),this.view.props?.bgcolor&&this.navigationView?.getPage().setProp(\"bgcolor\",this.view.props?.bgcolor)}preventDismiss(){return this.#s=!0,this}setStyle(t){return this.style=t,this}setView(t={}){if(\"object\"!=typeof t)throw new z(\"view\",\"object\");return this.view=t,this}addNavBar(t){return this.#n=t,this}present(){this.#e()}dismiss(){this.#i()}static quickLookImage(e,i=$l10n(\"PREVIEW\")){(new t).setView({type:\"view\",views:[{type:\"scroll\",props:{zoomEnabled:!0,maxZoomScale:3},layout:$layout.fill,views:[{type:\"image\",props:{data:e},layout:$layout.fill}]}],layout:$layout.fill}).addNavBar({title:i,rightButtons:[{symbol:\"square.and.arrow.up\",tapped:()=>$share.sheet(e)}]}).init().present()}},d=class t{static type={info:void 0,success:\"checkmark\",warning:\"exclamationmark.triangle\",error:\"xmark.circle\"};static edges=40;static iconSize=100;static labelTopMargin=10;static defaultFont=$font(\"default\",26);width=Math.min(.6*u.windowSize.width,260);labelWidth=this.width-2*t.edges;id=$text.uuid;#e=\"\";font=t.defaultFont;type=t.type.info;labelLines=2;constructor(e,i=t.type.info,s=2,n=t.defaultFont){this.type=i,this.message=e,this.labelLines=s,this.font=n}get message(){return this.#e}set message(e){this.#e=e,this.fontHeight=u.getContentSize(this.font,this.message,this.labelWidth,this.labelLines).height,this.height=(this.hasIcon?t.labelTopMargin+t.iconSize:0)+this.fontHeight+2*t.edges}get hasIcon(){return void 0!==this.type}get blurBox(){let e=u.blurBox({id:this.id,cornerRadius:15,alpha:0},[{type:\"image\",props:{symbol:this.type,hidden:!this.hasIcon,tintColor:$color(\"lightGray\")},layout:(e,i)=>{e.top.inset(t.edges),e.size.equalTo(t.iconSize),e.centerX.equalTo(i.super)}},{type:\"label\",props:{font:this.font,text:this.message,align:$align.center,lines:this.labelLines,color:$color(\"lightGray\")},layout:(e,i)=>{e.bottom.equalTo(i.supper).offset(-t.edges),e.width.equalTo(this.labelWidth),e.height.equalTo(this.fontHeight),e.centerX.equalTo(i.super)}}]);return e.events={tapped:()=>{this.remove()}},e}show(){let t=$ui.create(this.blurBox);$ui.controller.view.hidden?$ui.controller.view.super.insertAtIndex(t,0):$ui.controller.view.insertAtIndex(t,0);let e=$(this.id);e.layout(((t,e)=>{t.center.equalTo(e.super),t.size.equalTo($size(this.width,this.height))})),e.moveToFront(),$ui.animate({duration:.2,animation:()=>{e.alpha=1}})}remove(){let t=$(this.id);t&&$ui.animate({duration:.2,animation:()=>{t.alpha=0},completion:()=>{t.remove()}})}static toast({message:e,type:i=t.type.info,show:s=!0,displayTime:n=2,labelLines:r=2,font:a=t.defaultFont}){let o=new t(e,i,r,a);return s&&(o.show(),$delay(n,(()=>{o.remove()}))),o}static info(e,i={}){return t.toast(Object.assign({message:e,type:t.type.info},i))}static success(e,i={}){return t.toast(Object.assign({message:e,type:t.type.success},i))}static warning(e,i={}){return t.toast(Object.assign({message:e,type:t.type.warning},i))}static error(e,i={}){return t.toast(Object.assign({message:e,type:t.type.error},i))}},u=class t{static#e=$objc(\"UIApplication\").$sharedApplication();static#i=$objc(\"UINotificationFeedbackGenerator\").$new();static feedbackSuccess(){t.#i.$notificationOccurred(0)}static feedbackError(){t.#i.$notificationOccurred(2)}static isTaio=$app.info.bundleID.includes(\"taio\");static align={left:0,right:1,top:2,bottom:3};static textColor=$color(\"primaryText\");static linkColor=$color(\"systemLink\");static primaryViewBackgroundColor=$color(\"primarySurface\");static scrollViewBackgroundColor=$color(\"insetGroupedBackground\");static scrollViewList=[\"list\",\"matrix\"];static isLargeScreen=$device.isIpad||$device.isIpadPro;static get windowSize(){return $objc(\"UIWindow\").$keyWindow().jsValue().size}static NavigationBarNormalHeight=$objc(\"UINavigationController\").invoke(\"alloc.init\").$navigationBar().jsValue().frame.height;static NavigationBarLargeTitleHeight=$objc(\"UITabBarController\").invoke(\"alloc.init\").$tabBar().jsValue().frame.height+t.NavigationBarNormalHeight;static PageSheetNavigationBarNormalHeight=56;static get isSplitScreenMode(){return t.isLargeScreen&&$device.info.screen.width!==t.windowSize.width}static get topSafeAreaInsets(){return t.isTaio?0:t.#e?.$keyWindow()?.$safeAreaInsets()?.top??0}static get bottomSafeAreaInsets(){return t.#e?.$keyWindow()?.$safeAreaInsets()?.bottom??0}static get statusBarOrientation(){return t.#e.$statusBarOrientation()}static get consoleBarHeight(){if($app.isDebugging){let e=t.#e.$statusBarFrame().height+26;return $device.isIphoneX&&(e+=30),e}return 0}static get isHorizontal(){return 3===t.statusBarOrientation||4===t.statusBarOrientation}static loading(){let e=$ui.create(t.blurBox({cornerRadius:15},[{type:\"spinner\",props:{loading:!0,style:0},layout:(t,e)=>{t.size.equalTo(e.prev),t.center.equalTo(e.super)}}]));return{start:()=>{$ui.controller.view.insertAtIndex(e,0),e.layout(((e,i)=>{e.center.equalTo(i.super);let s=Math.min(.6*Math.min(t.windowSize.width,t.windowSize.height),260);e.size.equalTo($size(s,s))})),e.moveToFront()},end:()=>{e.remove()}}}static defaultBackgroundColor(e){return t.scrollViewList.indexOf(e)>-1?t.scrollViewBackgroundColor:t.primaryViewBackgroundColor}static separatorLine(e={},i=t.align.bottom){return{type:\"canvas\",props:e,layout:(e,s)=>{void 0===s.prev?e.top.equalTo(s.super):i===t.align.bottom?e.top.equalTo(s.prev.bottom):e.top.equalTo(s.prev.top),e.height.equalTo(1/$device.info.screen.scale),e.left.right.inset(0)},events:{draw:(t,i)=>{i.strokeColor=e.bgcolor??$color(\"separatorColor\"),i.setLineWidth(1),i.moveToPoint(0,0),i.addLineToPoint(t.frame.width,0),i.strokePath()}}}}static blurBox(t={},e=[],i=$layout.fill){return{type:\"blur\",props:Object.assign({style:$blurStyle.thinMaterial},t),views:e,layout:i}}static getContentSize(e,i=\"A\",s=t.windowSize.width,n){let r={text:i,width:s,font:e};return void 0!==n&&(r.lineSpacing=n),$text.sizeThatFits(r)}static getSymbolSize(t,e){let i=(t=\"string\"==typeof t?$image(t):t).size.width/t.size.height;return t.size.width>t.size.height?$size(e,e/i):$size(e*i,e)}static push({views:t,statusBarStyle:e=0,title:i=\"\",navButtons:s=[{title:\"\"}],bgcolor:n=t[0]?.props?.bgcolor??\"primarySurface\",titleView:r,disappeared:a}={}){let o={statusBarStyle:e,navButtons:s,title:i,bgcolor:\"string\"==typeof n?$color(n):n};r&&(o.titleView=r),$ui.push({props:o,events:{disappeared:()=>{void 0!==a&&a()}},views:[{type:\"view\",views:t,layout:(t,e)=>{t.top.equalTo(e.super.safeArea),t.bottom.equalTo(e.super),t.left.right.equalTo(e.super.safeArea)}}]})}static compressImage(t,e=921600){let i=$imagekit.info(t);if(i.height*i.width>e){let s=e/(i.height*i.width);t=$imagekit.scaleBy(t,s)}return t}static deleteConfirm(t,e){$ui.alert({title:$l10n(\"DELETE_CONFIRM_TITLE\"),message:t,actions:[{title:$l10n(\"DELETE\"),style:$alertActionType.destructive,handler:()=>{e()}},{title:$l10n(\"CANCEL\")}]})}static bytesToSize(t){if(0===t)return\"0 B\";let e=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,e)).toPrecision(3)+\" \"+[\"B\",\"KB\",\"MB\",\"GB\",\"TB\",\"PB\",\"EB\",\"ZB\",\"YB\"][e]}},p=class t{id=$text.uuid;type;props;views;events;layout;#e=void 0;#i=null;constructor({type:t=\"view\",props:e={},views:i=[],events:s={},layout:n=$layout.fill}={}){this.type=t,this.props=e,this.views=i,this.events=s,this.layout=n,this.props.id?this.id=this.props.id:this.props.id=this.id}static create(t){return new this(t)}static createFromViews(t){return new this({views:t})}get scrollableView(){return this.scrollable?this.#i:null}set scrollableView(t){this.#i=t}get scrollable(){if(void 0===this.#e)if(this.#e=!1,u.scrollViewList.indexOf(this.type)>-1)this.scrollableView=this,this.#e=!0;else if(this.views.length>0){let e=i=>{if(!this.#e&&i?.length>0)for(let s=0;s<i.length;s++){if(u.scrollViewList.indexOf(i[s].type)>-1)return typeof i[s]!==t&&(i[s]=t.create(i[s])),this.scrollableView=i[s],void(this.#e=!0);e(i[s].views)}};e(this.views)}return this.#e}set scrollable(t){throw new Error(\"[scrollable] is readonly prop.\")}setProps(t){return Object.keys(t).forEach((e=>this.setProp(e,t[e]))),this}setProp(t,e){return\"id\"===t&&(this.id=e),this.props[t]=e,this}setViews(t){return this.views=t,this.#e=void 0,this}setEvents(t){return Object.keys(t).forEach((e=>this.setEvent(e,t[e]))),this}setEvent(t,e){return this.events[t]=e,this}eventMiddleware(t,e){let i=this.events[t];return this.events[t]=(...t)=>{\"function\"==typeof i&&e(i,...t)},this}assignEvent(t,e){let i=this.events[t];return this.events[t]=(...t)=>{\"function\"==typeof i&&i(...t),e(...t)},this}setLayout(t){return this.layout=t,this}getView(){return this}get definition(){return this.getView()}},g=class extends Error{constructor(t){super(`Parameter [${t}] is required.`),this.name=\"FileStorageParameterError\"}},f=class extends Error{constructor(t){super(`File not found: ${t}`),this.name=\"FileStorageFileNotFoundError\"}},w=class extends Error{constructor({message:t,code:e,type:i}={}){super(t),this.name=\"RequestError\",this.code=e,this.type=i}},m=class extends Error{constructor(){super(\"Call loadConfig() first.\"),this.name=\"SettingLoadConfigError\"}},y=class extends Error{constructor(){super(\"Attempted to assign to readonly property.\"),this.name=\"SettingReadonlyError\"}},v=class extends Error{constructor(){super(\"Please call setView(view) first.\"),this.name=\"SheetViewUndefinedError\"}},b=class extends Error{constructor(t,e){super(`The type of the parameter '${t}' must be '${e}'`),this.name=\"ValidationError\"}},T=class extends p{controller={};setController(t){return this.controller=t,this}},E=class t extends p{static#e;edges=15;buttonEdges=this.edges/2;iconSize=24;fontSize=17;color=u.textColor;title;#i;align=u.align.right;get symbol(){return this.#i}set symbol(t){this.#i=\"string\"==typeof t?$image(t):t}get width(){if(this.title){let t=$text.sizeThatFits({text:this.title,width:u.windowSize.width,font:$font(this.fontSize)});return Math.ceil(t.width)+this.edges}return this.iconSize+this.edges}static get style(){return void 0===this.#e&&(this.#e=new t),this.#e}setEdges(t){return this.edges=t,this}setFontSize(t){return this.fontSize=t,$(this.id)&&($(this.id).font=$font(this.fontSize)),this}setColor(t=u.textColor){return this.color=t,$(this.id)&&($(this.id).titleColor=this.color,$(`icon-button-${this.id}`).titleColor=this.color,$(`icon-checkmark-${this.id}`).titleColor=this.color),this}setTitle(t){return this.title=t,$(this.id)&&($(this.id).title=this.title),this}setSymbol(t){return this.symbol=t,$(this.id)&&($(this.id).symbol=this.symbol),this}setMenu(t){return this.menu=t,this}setAlign(t){return this.align=t,this}setLoading(t){t?($(this.id).hidden=!0,$(\"spinner-\"+this.id).hidden=!1):($(this.id).hidden=!1,$(\"spinner-\"+this.id).hidden=!0)}#s(){let t=$(`icon-button-${this.id}`),e=$(`icon-checkmark-${this.id}`);t.alpha=0,$(this.id).hidden=!1,$(\"spinner-\"+this.id).hidden=!0,$ui.animate({duration:.6,animation:()=>{e.alpha=1},completion:()=>{$delay(.3,(()=>$ui.animate({duration:.6,animation:()=>{e.alpha=0},completion:()=>{$ui.animate({duration:.4,animation:()=>{t.alpha=1},completion:()=>{t.alpha=1}})}})))}})}hide(){$(this.id+\"-container\").hidden=!0}show(){$(this.id+\"-container\").hidden=!1}getView(){let t=this.events.tapped;return this.events.tapped=e=>{t&&t({start:()=>this.setLoading(!0),done:()=>this.#s(),cancel:()=>this.setLoading(!1)},e)},{type:\"view\",props:{id:this.id+\"-container\",info:{align:this.align}},views:[{type:\"button\",props:Object.assign({id:this.id,bgcolor:$color(\"clear\"),font:$font(this.fontSize),titleColor:this.color,contentEdgeInsets:$insets(0,0,0,0),titleEdgeInsets:$insets(0,0,0,0),imageEdgeInsets:$insets(0,0,0,0)},this.menu?{menu:this.menu}:{},this.title?{title:this.title}:{},this.props),views:[{type:\"image\",props:Object.assign({id:`icon-button-${this.id}`,hidden:void 0===this.symbol,tintColor:this.color},this.symbol?{image:this.symbol}:{}),layout:(t,e)=>{this.symbol&&t.size.equalTo(u.getSymbolSize(this.symbol,this.iconSize)),t.center.equalTo(e.super)}},{type:\"image\",props:{id:`icon-checkmark-${this.id}`,alpha:0,tintColor:this.color,symbol:\"checkmark\"},layout:(t,e)=>{t.center.equalTo(e.super),t.size.equalTo(u.getSymbolSize(\"checkmark\",this.iconSize))}}],events:this.events,layout:$layout.fill},{type:\"spinner\",props:{id:\"spinner-\"+this.id,loading:!0,hidden:!0},layout:$layout.fill}],layout:(t,e)=>{if(t.size.equalTo($size(this.width,u.NavigationBarNormalHeight)),t.centerY.equalTo(e.super),e.prev&&e.prev?.info?.align===this.align)this.align===u.align.right?t.right.equalTo(e.prev.left).offset(-this.buttonEdges):t.left.equalTo(e.prev.right).offset(this.buttonEdges);else{let e=this.edges/2;this.align===u.align.right?t.right.inset(e):t.left.inset(e)}}}}static creat({id:e,symbol:i,title:s,tapped:n,menu:r,events:a,color:o,align:l=u.align.right}={}){let h=new t;return h.setEvents(Object.assign({tapped:n},a)).setAlign(l).setSymbol(i).setTitle(s).setColor(o).setMenu(r),e&&h.setProp(\"id\",e),h}},A=class t extends p{static largeTitleDisplayModeAutomatic=0;static largeTitleDisplayModeAlways=1;static largeTitleDisplayModeNever=2;navigationBarItems;title=\"\";prefersLargeTitles=!0;largeTitleDisplayMode=t.largeTitleDisplayModeAutomatic;fontFamily=\"bold\";largeTitleFontSize=34;largeTitleFontHeight=$text.sizeThatFits({text:\"A\",width:100,font:$font(this.fontFamily,this.largeTitleFontSize)}).height;navigationBarTitleFontSize=17;topSafeArea=!0;contentViewHeightOffset=0;navigationBarNormalHeight=u.NavigationBarNormalHeight;navigationBarLargeTitleHeight=u.NavigationBarLargeTitleHeight;setTopSafeArea(){return this.topSafeArea=!0,this}removeTopSafeArea(){return this.topSafeArea=!1,this}setLargeTitleDisplayMode(t){return this.largeTitleDisplayMode=t,this}setBackgroundColor(t){return this.backgroundColor=t,this}setTitle(t){return this.title=t,this}setPrefersLargeTitles(t){return this.prefersLargeTitles=t,this}setContentViewHeightOffset(t){return this.contentViewHeightOffset=t,this}getLargeTitleView(){return this.prefersLargeTitles&&this.largeTitleDisplayMode!==t.largeTitleDisplayModeNever?{type:\"label\",props:{id:this.id+\"-large-title\",text:this.title,textColor:u.textColor,align:$align.left,font:$font(this.fontFamily,this.largeTitleFontSize),line:1},layout:(t,e)=>{t.left.equalTo(e.super.safeArea).offset(15),t.height.equalTo(this.largeTitleFontHeight),t.top.equalTo(e.super.safeAreaTop).offset(this.navigationBarNormalHeight)}}:{props:{id:this.id+\"-large-title\"},layout:(t,e)=>{t.left.top.right.inset(0),t.bottom.equalTo(e.super.safeAreaTop).offset(this.navigationBarNormalHeight)}}}getNavigationBarView(){let e=(t,e)=>{let i=(t,i)=>{t.top.equalTo(i.super.safeAreaTop),t.bottom.equalTo(i.super.safeAreaTop).offset(this.navigationBarNormalHeight),e===u.align.left?t.left.equalTo(i.super.safeArea):t.right.equalTo(i.super.safeArea)};if(t&&!Array.isArray(t))return{type:\"view\",views:[t],layout:i};let s=0,n=[];t.forEach((t=>{s+=t.width,n.push(t.definition)}));let r=t[0]?.edges??0;return s+=t.length>=2?2*r:r,t.length>0?{type:\"view\",views:n,info:{width:s},layout:(t,e)=>{i(t,e),t.width.equalTo(s)}}:{type:\"view\",layout:t=>t.size.equalTo(0)}},i=e(this.navigationBarItems.popButtonView??this.navigationBarItems.leftButtons,u.align.left),s=e(this.navigationBarItems.rightButtons,u.align.right),n=this.prefersLargeTitles,r=!this.prefersLargeTitles||this.largeTitleDisplayMode===t.largeTitleDisplayModeNever;return{type:\"view\",props:{id:this.id+\"-navigation\",bgcolor:$color(\"clear\")},layout:(t,e)=>{t.left.top.right.inset(0),t.bottom.equalTo(e.super.safeAreaTop).offset(this.navigationBarNormalHeight)},views:[this.backgroundColor?{type:\"view\",props:{hidden:n,bgcolor:this.backgroundColor,id:this.id+\"-background\"},layout:$layout.fill}:u.blurBox({hidden:n,id:this.id+\"-background\"}),u.separatorLine({id:this.id+\"-underline\",alpha:n?0:1}),{type:\"view\",props:{alpha:0,bgcolor:$color(\"clear\"),id:this.id+\"-large-title-mask\"},events:{ready:t=>{t.bgcolor=$(this.id+\"-large-title\")?.prev.bgcolor}},layout:$layout.fill},i,s,{type:\"view\",views:[{type:\"label\",props:{id:this.id+\"-small-title\",alpha:r?1:0,text:this.title,font:$font(this.fontFamily,this.navigationBarTitleFontSize),align:$align.center,bgcolor:$color(\"clear\"),textColor:u.textColor},layout:(t,e)=>{t.edges.equalTo(e.super.safeArea);let n=u.getContentSize($font(this.fontFamily,this.navigationBarTitleFontSize),e.text).width,r=Math.max(i.info?.width??0,s.info?.width??0);u.windowSize.width-2*r>n&&t.centerX.equalTo(e.super.super)}}],layout:(t,e)=>{t.top.bottom.equalTo(e.super.safeArea),t.left.equalTo(e.prev.prev.right),t.right.equalTo(e.prev.left)}}]}}},S=class t extends s{static largeTitleViewSmallMode=0;static largeTitleViewLargeMode=1;navigationBar;updateSelector(){this.selector={navigation:$(this.navigationBar.id+\"-navigation\"),largeTitleView:$(this.navigationBar.id+\"-large-title\"),smallTitleView:$(this.navigationBar.id+\"-small-title\"),underlineView:this.navigationBar.navigationBarItems.isPinTitleView?$(this.navigationBar.id+\"-title-view-underline\"):$(this.navigationBar.id+\"-underline\"),largeTitleMaskView:$(this.navigationBar.id+\"-large-title-mask\"),backgroundView:$(this.navigationBar.id+\"-background\"),titleViewBackgroundView:$(this.navigationBar.id+\"-title-view-background\")}}toNormal(t=!0){this.updateSelector(),this.selector.backgroundView.hidden=!1,$ui.animate({duration:.2,animation:()=>{this.selector.underlineView.alpha=1,this.selector.smallTitleView.alpha=1,this.selector.largeTitleView.alpha=0}}),t&&this.navigationBar.navigationBarItems&&(this.navigationBar.largeTitleDisplayMode=A.largeTitleDisplayModeNever)}toLargeTitle(t=!0){this.updateSelector(),this.selector.backgroundView.hidden=!0,$ui.animate({duration:.2,animation:()=>{this.selector.underlineView.alpha=0,this.selector.smallTitleView.alpha=0,this.selector.largeTitleView.alpha=1}}),t&&this.navigationBar.navigationBarItems&&(this.navigationBar.largeTitleDisplayMode=A.largeTitleDisplayModeAlways)}#e(e){let i=e===t.largeTitleViewSmallMode;this.selector.largeTitleView.alpha=i?0:1,$ui.animate({duration:.2,animation:()=>{this.selector.smallTitleView.alpha=i?1:0}})}#i(e){if(this.selector.largeTitleView.updateLayout(((t,i)=>{this.navigationBar.navigationBarNormalHeight-e>0?t.top.equalTo(i.super.safeAreaTop).offset(this.navigationBar.navigationBarNormalHeight-e):t.top.equalTo(i.super.safeAreaTop).offset(0)})),e>0)e>=this.navigationBar.navigationBarNormalHeight?this.#e(t.largeTitleViewSmallMode):this.#e(t.largeTitleViewLargeMode);else{this.#e(t.largeTitleViewLargeMode);let i=this.navigationBar.largeTitleFontSize-.04*e;i>40&&(i=40),this.selector.largeTitleView.font=$font(this.navigationBar.fontFamily,i)}}#s(t){let e=this.navigationBar.largeTitleDisplayMode===A.largeTitleDisplayModeNever?5:this.navigationBar.navigationBarNormalHeight,i=void 0!==this.selector.titleViewBackgroundView;if(t>e){this.selector.backgroundView.hidden=!1;let s=()=>{i&&this.navigationBar.navigationBarItems.isPinTitleView&&(this.selector.titleViewBackgroundView.alpha=1),this.selector.largeTitleMaskView.alpha=0,this.selector.underlineView.alpha=1};(t-e)/3>=1?s():$ui.animate({duration:.2,animation:()=>{s()}})}else this.selector.largeTitleMaskView.alpha=t>0?1:0,this.selector.underlineView.alpha=0,i&&(this.selector.titleViewBackgroundView.alpha=0),this.selector.backgroundView.hidden=!0}didScroll(t){if(!this.navigationBar.prefersLargeTitles)return;let e=this.navigationBar.largeTitleDisplayMode;if(e!==A.largeTitleDisplayModeAlways)if(this.updateSelector(),e===A.largeTitleDisplayModeAutomatic){if(!this.navigationBar.navigationBarItems?.isPinTitleView&&(this.navigationBar.navigationBarItems?.titleView?.controller.didScroll(t),t>0)){(t-=this.navigationBar.navigationBarItems?.titleView?.height??0)<0&&(t=0)}this.#i(t),this.#s(t)}else e===A.largeTitleDisplayModeNever&&this.#s(t)}didEndDragging(t,e,i,s){if(!this.navigationBar.prefersLargeTitles)return;let n=this.navigationBar.largeTitleDisplayMode;if(n!==A.largeTitleDisplayModeAlways&&(this.updateSelector(),n===A.largeTitleDisplayModeAutomatic)){let n=0;this.navigationBar.navigationBarItems?.isPinTitleView||(this.navigationBar.navigationBarItems?.titleView?.controller.didEndDragging(t,e,i,s),n=this.navigationBar.navigationBarItems?.titleView?.height??0,t-=n),t>=0&&t<=this.navigationBar.largeTitleFontHeight&&i($point(0,t>=this.navigationBar.largeTitleFontHeight/2?this.navigationBar.navigationBarNormalHeight+n-s:n-s))}}},I=class extends b{constructor(t,e){super(t,e),this.name=\"NavigationViewTypeError\"}},x=class extends s{page;navigationController=new S;navigationBar=new A;navigationBarItems=new o;constructor(){super(),this.navigationBar.navigationBarItems=this.navigationBarItems,this.navigationController.navigationBar=this.navigationBar}navigationBarTitle(t){return this.navigationBar.setTitle(t),this}setView(t){if(\"object\"!=typeof t)throw new I(\"view\",\"object\");return this.view=p.create(t),this}getTopOffset(){if(!(this.view instanceof p))throw new I(\"view\",\"View\");let t=this.view.scrollableView,e=$app.isDebugging?0:u.topSafeAreaInsets,i=this.navigationBar.largeTitleDisplayMode===A.largeTitleDisplayModeNever?this.navigationBar.navigationBarNormalHeight:this.navigationBar.navigationBarLargeTitleHeight,s=this.navigationBar.contentViewHeightOffset+i;if(this.navigationBarItems.titleView&&(s+=this.navigationBarItems.titleView.topOffset,s+=this.navigationBarItems.titleView.height,s+=this.navigationBarItems.titleView.bottomOffset),!this.view.scrollable||!1===t.props.associateWithNavigationBar){let t=s-this.navigationBar.contentViewHeightOffset;return(!u.isHorizontal||u.isLargeScreen)&&this.navigationBar.topSafeArea&&(t+=e),t}return t.props.stickyHeader&&(s-=i,s+=this.navigationBar.largeTitleFontHeight),s}getBottomOffset(){return this.navigationBarItems.fixedFooterView?.height??0}#e(){if(!(this.view instanceof p))throw new I(\"view\",\"View\");let t=this.view.scrollableView,e=$app.isDebugging?0:u.topSafeAreaInsets,i=this.getTopOffset();if(!this.view.scrollable||!1===t.props.associateWithNavigationBar)return void(this.view.layout=(t,e)=>{t.left.right.equalTo(e.super.safeArea),t.bottom.equalTo(e.super),t.top.equalTo(i)});let s=this.navigationBarItems.isPinTitleView?this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset+this.navigationBar.contentViewHeightOffset:0;if(t.props.indicatorInsets){let e=t.props.indicatorInsets;t.props.indicatorInsets=$insets(e.top+this.navigationBar.navigationBarNormalHeight+s,e.left,e.bottom+this.getBottomOffset(),e.right)}else t.props.indicatorInsets=$insets(this.navigationBar.navigationBarNormalHeight+s,0,this.navigationBarItems.fixedFooterView?.height??0,0);if(t.props.contentInset){let e=t.props.contentInset;t.props.contentInset=$insets(e.top+i+s,e.left,e.bottom+this.getBottomOffset(),e.right)}else t.props.contentInset=$insets(i+s,0,this.navigationBarItems.fixedFooterView?.height??0,0);t.props.contentOffset=$point(0,-i),t.layout=(e,i)=>{t.props.stickyHeader?e.top.equalTo(i.super.safeArea).offset(this.navigationBar.navigationBarNormalHeight):e.top.equalTo(i.super),e.left.right.equalTo(i.super.safeArea),e.bottom.equalTo(i.super)},t.assignEvent(\"didScroll\",(s=>{let n=s.contentOffset.y;(!u.isHorizontal||u.isLargeScreen)&&this.navigationBar.topSafeArea&&!t.props.stickyHeader&&(n+=e),n+=i,this.navigationController.didScroll(n)})).assignEvent(\"didEndDragging\",((s,n)=>{let r=s.contentOffset.y,a=0;(!u.isHorizontal||u.isLargeScreen)&&this.navigationBar.topSafeArea&&!t.props.stickyHeader&&(r+=e,a=e),r+=i,a+=i,this.navigationController.didEndDragging(r,n,((...t)=>s.scrollToOffset(...t)),a)})).assignEvent(\"didEndDecelerating\",((...e)=>{e[0].tracking||t.events?.didEndDragging(...e)}))}#i(){if(this.navigationBar.prefersLargeTitles){this.#e();let t={};if(this.navigationBarItems.titleView){let e=this.navigationBar.largeTitleDisplayMode===A.largeTitleDisplayModeNever?1:0;t=p.create({views:[this.navigationBar.backgroundColor?{type:\"view\",props:{alpha:e,bgcolor:this.navigationBar.backgroundColor,id:this.navigationBar.id+\"-title-view-background\"},layout:$layout.fill}:u.blurBox({alpha:e,id:this.navigationBar.id+\"-title-view-background\"}),u.separatorLine({id:this.navigationBar.id+\"-title-view-underline\",alpha:e}),this.navigationBarItems.titleView.definition],layout:(t,e)=>{t.top.equalTo(e.prev.bottom),t.width.equalTo(e.super),t.height.equalTo(this.navigationBarItems.titleView.topOffset+this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset)}})}this.page=G.createFromViews([this.view,this.navigationBar.getLargeTitleView(),t,this.navigationBar.getNavigationBarView(),this.navigationBarItems.fixedFooterView?.definition??{}])}else this.page=G.createFromViews([this.view]);this.view.props?.bgcolor?this.page.setProp(\"bgcolor\",this.view.props.bgcolor):this.page.setProp(\"bgcolor\",u.defaultBackgroundColor(this.view.type))}getPage(){return this.page||this.#i(),this.page}},C=class extends s{setSearchBar(t){return this.searchBar=t,this}updateSelector(){this.selector={inputBox:$(this.searchBar.id),input:$(this.searchBar.id+\"-input\")}}hide(){this.updateSelector(),this.selector.inputBox.updateLayout((t=>{t.height.equalTo(0)}))}show(){this.updateSelector(),this.selector.inputBox.updateLayout((t=>{t.height.equalTo(this.searchBar.height)}))}didScroll(t){this.updateSelector();let e=this.searchBar.height-t;if(e=e>0?e>this.searchBar.height?this.searchBar.height:e:0,this.selector.inputBox.updateLayout((t=>{t.height.equalTo(e)})),t>0){let e=(this.searchBar.height/2-5-t)/10;this.selector.input.alpha=e}else this.selector.input.alpha=1}didEndDragging(t,e,i){this.updateSelector(),t>=0&&t<=this.searchBar.height&&i($point(0,t>=this.searchBar.height/2?this.searchBar.height:0))}},D=class extends s{#e=[];#i(t){t.callEvent(\"onPop\"),this.callEvent(\"onPop\",t),this.#e.pop()}push(t){let e=this.#e[this.#e.length-1];t.navigationBarItems.addPopButton(e?.navigationBar.title),this.#e.push(t),$ui.push({props:{statusBarStyle:0,navBarHidden:!0},events:{disappeared:()=>{this.#i(t)}},views:[t.getPage().definition],layout:$layout.fill})}},k=class extends h{get isArray(){return Array.isArray(this.default)}async tapped(){let t=this.isArray?this.default[1]:this.default;0===(await $ui.alert({title:this.title,message:t,actions:[{title:$l10n(\"COPY\")},{title:$l10n(\"OK\")}]})).index&&($clipboard.text=t,$ui.toast($l10n(\"COPIED\")))}getView(){return{type:\"view\",props:{selectable:!0,info:{key:this.key}},views:[this.createLineLabel(),{type:\"label\",props:{text:this.isArray?this.default[0]:this.default,align:$align.right,textColor:$color(\"darkGray\")},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(h.edgeOffset),t.width.equalTo(180)}}],layout:$layout.fill}}},B=class extends h{getView(){return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"switch\",props:{on:this.get(),onColor:$color(\"#00CC00\")},events:{changed:t=>{try{this.set(t.on)}catch(e){throw t.on=!t.on,e}}},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(h.edgeOffset)}}],layout:$layout.fill}}},L=class extends h{getView(){return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"button\",props:{symbol:\"square.and.pencil\",bgcolor:$color(\"clear\"),tintColor:$color(\"primaryText\")},events:{tapped:t=>{let e=$ui.popover({sourceView:t,sourceRect:t.bounds,directions:$popoverDirection.down,size:$size(320,150),views:[{type:\"text\",props:{id:`${this.id}-string`,align:$align.left,text:this.get()},layout:t=>{t.left.right.inset(10),t.top.inset(20),t.height.equalTo(90)}},{type:\"button\",props:{symbol:\"checkmark\",bgcolor:$color(\"clear\"),titleEdgeInsets:10,contentEdgeInsets:0},layout:t=>{t.right.inset(10),t.bottom.inset(25),t.size.equalTo(30)},events:{tapped:()=>{this.set($(`${this.id}-string`).text),e.dismiss()}}}]})}},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(0),t.size.equalTo(50)}}],layout:$layout.fill}}},O=class extends h{with({min:t,max:e}={}){return this.options={min:t,max:e},this}getView({min:t,max:e}={}){let i=`${this.id}-label`;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"label\",props:{id:i,text:this.get(),align:$align.left},layout:(t,e)=>{t.height.equalTo(e.super),t.right.inset(120)}},{type:\"stepper\",props:{min:t,max:e,value:this.get()},events:{changed:t=>{$(i).text=t.value;try{this.set(t.value)}catch(t){throw $(i).text=this.get(),t}}},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(h.edgeOffset)}}],layout:$layout.fill}}},N=class extends h{rightSymbol=\"chevron.right\";buttonId=`${this.id}-button`;start(){$(this.buttonId).alpha=0,$(`${this.buttonId}-spinner`).alpha=1}cancel(){$(this.buttonId).alpha=1,$(`${this.buttonId}-spinner`).alpha=0}done(){$(`${this.buttonId}-spinner`).alpha=0;let t=$(this.buttonId);t.symbol=\"checkmark\",$ui.animate({duration:.6,animation:()=>t.alpha=1,completion:()=>{$ui.animate({duration:.4,animation:()=>t.alpha=0,completion:()=>{t.symbol=this.rightSymbol,$ui.animate({duration:.4,animation:()=>t.alpha=1})}})}})}with({script:t}={}){return this.options={script:t},this}async tapped(){let t={start:()=>this.start(),cancel:()=>this.cancel(),done:()=>this.done()},{script:e}=this.options;\"function\"==typeof e?await e(t):e.startsWith(\"this.method\")?await new Function(\"method\",\"animate\",`return async()=>{await ${e.replace(\"this.\",\"\")}(animate)}`)(this.method,t)():await new Function(\"animate\",`return async()=>{${e}}`)(t)()}getView(){return{type:\"view\",props:{id:this.id,selectable:!0,info:{key:this.key}},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"button\",props:{id:this.buttonId,symbol:\"chevron.right\",bgcolor:$color(\"clear\"),tintColor:$color(\"secondaryText\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.right.inset(0),t.height.equalTo(e.super)}},{type:\"spinner\",props:{id:`${this.buttonId}-spinner`,loading:!0,alpha:0},layout:(t,e)=>{t.size.equalTo(15),t.centerY.equalTo(e.super),t.right.equalTo(e.prev)}}],layout:(t,e)=>{t.right.inset(h.edgeOffset),t.height.equalTo(h.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},P=class extends h{with({items:t,values:e}={}){return Array.isArray(t)&&(t=t.map((t=>$l10n(t)))),this.options={items:t,values:e},this}getView({items:t,values:e}={}){t=this.evalValues(t),e=this.evalValues(e);let i=t?.length>0&&e?.length===t?.length;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"tab\",props:{items:t??[],index:i?e.indexOf(this.get()):this.get(),dynamicWidth:!0},layout:(t,e)=>{t.right.inset(h.edgeOffset),t.centerY.equalTo(e.prev)},events:{changed:t=>{i?this.set(e[t.index]):this.set(t.index)}}}],layout:$layout.fill}}},V=class extends h{with({items:t,values:e,pullDown:i}={}){return Array.isArray(t)&&(t=t.map((t=>$l10n(t)))),this.options={items:t,values:e,pullDown:i},this}getView({items:t,values:e,pullDown:i}={}){let s=`${this.id}-label`,n=this.evalValues(t),r=this.evalValues(e),a=n?.length>0&&r?.length===n?.length,o=(t,i)=>{if(a){let t=this.evalValues(e);this.set(t[i])}else this.set(i);$(s).title=t},l=()=>{i||$ui.menu({items:this.evalValues(t),handler:o})};return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"button\",props:{menu:i?{pullDown:!0,asPrimary:!0,items:n.map(((t,e)=>({title:t,handler:()=>o(t,e)})))}:void 0,title:a?n[r.indexOf(this.get())]:n[this.get()],titleColor:$color(\"secondaryText\"),bgcolor:$color(\"clear\"),id:s},events:{tapped:l},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(e.super)}}],layout:(t,e)=>{t.right.inset(h.edgeOffset),t.height.equalTo(h.rowHeight),t.width.equalTo(e.super)}}],events:{tapped:l},layout:$layout.fill}}},R=class extends h{get(t=null){let e=super.get(t);return e?\"string\"==typeof e?$color(e):$rgba(e.red,e.green,e.blue,e.alpha):t}getView(){let t=`${this.id}-color`;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"view\",props:{id:t,bgcolor:this.get(),circular:!0,borderWidth:1,borderColor:$color(\"#e3e3e3\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.right.inset(h.edgeOffset),t.size.equalTo(20)}},{type:\"view\",events:{tapped:async()=>{let e=await $picker.color({color:this.get()});this.set(e.components),$(t).bgcolor=$rgba(e.components.red,e.components.green,e.components.blue,e.components.alpha)}},layout:(t,e)=>{t.right.inset(0),t.height.width.equalTo(e.super.height)}}],layout:(t,e)=>{t.height.equalTo(h.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},_=class extends h{with({mode:t=2}={}){return this.options={mode:t},this}getView({mode:t=2}={}){let e=e=>{let i=\"\";switch(\"number\"==typeof e&&(e=new Date(e)),t){case 0:i=e.toLocaleTimeString();break;case 1:i=e.toLocaleDateString();break;case 2:i=e.toLocaleString()}return i};return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"label\",props:{id:`${this.id}-label`,color:$color(\"secondaryText\"),text:this.get()?e(this.get()):\"None\"},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(e.super)}}],events:{tapped:async()=>{let i=this.get(),s=await $picker.date({props:{mode:t,date:i||Date.now()}});this.set(s.getTime()),$(`${this.id}-label`).text=e(s)}},layout:(t,e)=>{t.right.inset(h.edgeOffset),t.height.equalTo(h.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},M=class extends h{with({secure:t=!1,kbType:e=$kbType.default,saveFunc:i}={}){return this.options={secure:t,kbType:e,saveFunc:i},this}getView({secure:t=!1,kbType:e=$kbType.default,saveFunc:i}={}){void 0===i&&(i=t=>this.set(t));let s=this.id+\"-input\";return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"input\",props:{id:s,type:e,align:$align.right,bgcolor:$color(\"clear\"),textColor:$color(\"secondaryText\"),text:this.get(),font:$font(16),secure:t,accessoryView:u.blurBox({height:44},[u.separatorLine({},u.align.top),{type:\"button\",props:{title:$l10n(\"DONE\"),bgcolor:$color(\"clear\"),titleColor:$color(\"primaryText\")},layout:(t,e)=>{t.right.inset(h.edgeOffset),t.centerY.equalTo(e.super)},events:{tapped:()=>{$(s).blur()}}},{type:\"button\",props:{title:$l10n(\"CANCEL\"),bgcolor:$color(\"clear\"),titleColor:$color(\"primaryText\")},layout:(t,e)=>{t.left.inset(h.edgeOffset),t.centerY.equalTo(e.super)},events:{tapped:()=>{let t=$(s),e=this.get(\"\");t.text!==e&&(t.text=e),t.blur()}}}])},layout:(t,e)=>{t.left.equalTo(e.prev.get(\"label\").right).offset(h.edgeOffset),t.right.inset(h.edgeOffset);let i=u.getContentSize($font(16),this.get(\"\")).width;t.width.greaterThanOrEqualTo(i+30),t.height.equalTo(e.super)},events:{didBeginEditing:t=>{t.secure=!1,$app.autoKeyboardEnabled||($app.autoKeyboardEnabled=!0)},returned:t=>{t.blur()},didEndEditing:async e=>{let s=this.get(\"\");i(e.text)||(e.text=s),t&&(e.secure=t)}}}],layout:$layout.fill}}},q=class extends h{getView(){return new M(this).getView({secure:!1,kbType:$kbType.decimal,saveFunc:t=>\"\"!==t&&/^[0-9]+.?[0-9]*$/.test(t)?this.set(Number(t)):($ui.toast($l10n(\"INVALID_VALUE\")),!1)})}},F=class extends h{with({bgcolor:t=\"#000000\"}={}){return this.options={bgcolor:t},this}getView({bgcolor:t=\"#000000\"}={}){let e=`${this.id}-image`;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"image\",props:{cornerRadius:8,bgcolor:\"string\"==typeof t?$color(t):t,smoothCorners:!0},layout:(t,e)=>{t.right.inset(h.edgeOffset),t.centerY.equalTo(e.super),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:e,image:$image(this.get()),icon:$icon(this.get()?.slice(5,this.get().indexOf(\".\")),$color(\"#ffffff\")),tintColor:$color(\"#ffffff\")},layout:(t,e)=>{t.right.equalTo(e.prev).offset(-5),t.centerY.equalTo(e.super),t.size.equalTo($size(20,20))}}],events:{tapped:()=>{$ui.menu({items:[$l10n(\"JSBOX_ICON\"),$l10n(\"SF_SYMBOLS\"),$l10n(\"IMAGE_BASE64\")],handler:async(t,i)=>{if(0===i){let t=await $ui.selectIcon();this.set(t),$(e).icon=$icon(t.slice(5,t.indexOf(\".\")),$color(\"#ffffff\"))}else(1===i||2===i)&&$input.text({text:\"\",placeholder:t,handler:t=>{\"\"!==t?(this.set(t),1===i?$(e).symbol=t:$(e).image=$image(t)):$ui.toast($l10n(\"INVALID_VALUE\"))}})}})}},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(h.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},U=class extends h{with({view:t,navButtons:e=[]}={}){return this.options={view:t,navButtons:e},this}tapped(){let{view:t,navButtons:e}=this.options;return t=this.evalValues(t,{}),e=this.evalValues(e),e.length>0&&e.map((t=>{if(\"string\"==typeof t.tapped){let e=t.tapped;t.tapped=()=>{this.evalValues(e)}}return t.handler=t.tapped,t})),new Promise(((i,s)=>{if(this.setting.isUseJsboxNav){let s={title:this.title,props:t.props??{},views:[t],disappeared:()=>i()};e.length>0&&(s.navButtons=e),u.push(s)}else{let s=new x;s.setView(t).navigationBarTitle(this.title),s.navigationBarItems.addPopButton(),s.navigationBar.setLargeTitleDisplayMode(A.largeTitleDisplayModeNever),this.setting.hasSectionTitle(t)&&s.navigationBar.setContentViewHeightOffset(-10),e.length>0&&s.navigationBarItems.setRightButtons(e),this.setting.viewController.setEvent(\"onPop\",(()=>i())),this.setting.viewController.push(s)}}))}getView(){return{type:\"view\",props:{id:this.id,selectable:!0,info:{key:this.key}},views:[this.createLineLabel(),{type:\"button\",props:{symbol:\"chevron.right\",bgcolor:$color(\"clear\"),tintColor:$color(\"secondaryText\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.right.inset(h.edgeOffset),t.height.equalTo(e.super)}}],layout:$layout.fill}}},H=class extends U{with({children:t}={}){return super.with({view:()=>this.setting.getListView(t,{},this.id)}),this.options.children=t,this}},j=class extends h{getImagePath(t=!1){let e=$text.MD5(this.key)+\".jpg\";return t&&(e=\"compress.\"+e),this.setting.imagePath+e}getImage(t=!1){try{return this.setting.fileStorage.readSync(this.getImagePath(t))}catch(t){if(t instanceof f)return null;throw t}}get(t=null){return this.getImage(!1)??null}getView(){let t=`${this.id}-image`,e=$image(\"questionmark.square.dashed\"),i=e=>async()=>{$(t).hidden=!0,$(`${t}-spinner`).hidden=!1,await $wait(.1);try{await e()}catch(t){$ui.alert({title:$l10n(\"ERROR\"),message:String(t)})}await $wait(.1),$(`${t}-spinner`).hidden=!0,$(t).hidden=!1},s=[{title:$l10n(\"PREVIEW\"),handler:i((()=>{let t=this.getImage(!1);t?c.quickLookImage(t):$ui.toast($l10n(\"NO_IMAGE\"))}))},{inline:!0,items:[{title:$l10n(\"SELECT_IMAGE_PHOTO\"),handler:i((async()=>{let e=await $photo.pick({format:\"data\"});if(!e.status||!e.data){if(\"canceled\"!==e?.error?.description)throw new Error(e?.error?.description);return}let i=u.compressImage(e.data.image);this.setting.fileStorage.write(this.getImagePath(!0),i.jpg(.8)),this.setting.fileStorage.write(this.getImagePath(),e.data),$(t).image=i,$ui.success($l10n(\"SUCCESS\"))}))},{title:$l10n(\"SELECT_IMAGE_ICLOUD\"),handler:i((async()=>{let e=await $drive.open();if(!e)return;let i=u.compressImage(e.image);this.setting.fileStorage.write(this.getImagePath(!0),i.jpg(.8)),this.setting.fileStorage.write(this.getImagePath(),e),$(t).image=i,$ui.success($l10n(\"SUCCESS\"))}))}]},{title:$l10n(\"CLEAR_IMAGE\"),destructive:!0,handler:i((()=>{this.setting.fileStorage.delete(this.getImagePath(!0)),this.setting.fileStorage.delete(this.getImagePath()),$(t).image=e,$ui.success($l10n(\"SUCCESS\"))}))}];return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"image\",props:{id:t,image:this.getImage(!0)?.image??e},layout:(t,e)=>{t.right.inset(h.edgeOffset),t.centerY.equalTo(e.super),t.size.equalTo($size(30,30))}},{type:\"spinner\",props:{id:`${t}-spinner`,loading:!0,hidden:!0},layout:(t,e)=>{t.size.equalTo(e.prev),t.left.top.equalTo(e.prev)}},{type:\"button\",props:{menu:{pullDown:!0,asPrimary:!0,items:s},bgcolor:$color(\"clear\")},layout:(t,e)=>{t.right.inset(h.edgeOffset),t.centerY.equalTo(e.super),t.size.equalTo($size(30,30))}}],layout:(t,e)=>{t.right.inset(0),t.height.equalTo(h.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},z=class extends b{constructor(t,e){super(t,e),this.name=\"SheetViewTypeError\"}},W=class extends p{constructor(t={}){super(t),this.setIcon(t.icon),this.setTitle(t.title),void 0!==t.activeStatus&&(this.activeStatus=t.activeStatus)}setIcon(t){return this.icon=t instanceof Array?t:[t,t],this}setTitle(t){return this.title=t,this}active(){$(`${this.props.id}-icon`).image=$image(this.icon[1]),$(`${this.props.id}-icon`).tintColor=$color(\"systemLink\"),$(`${this.props.id}-title`).textColor=$color(\"systemLink\"),this.activeStatus=!0}inactive(){$(`${this.props.id}-icon`).image=$image(this.icon[0]),$(`${this.props.id}-icon`).tintColor=$color(\"lightGray\"),$(`${this.props.id}-title`).textColor=$color(\"lightGray\"),this.activeStatus=!1}getView(){return this.views=[{type:\"image\",props:{id:`${this.props.id}-icon`,image:$image(this.activeStatus?this.icon[1]:this.icon[0]),bgcolor:$color(\"clear\"),tintColor:$color(this.activeStatus?\"systemLink\":\"lightGray\")},layout:(t,e)=>{t.centerX.equalTo(e.super);let i=K.tabBarHeight/2;t.size.equalTo(i),t.top.inset((K.tabBarHeight-i-13)/2)}},{type:\"label\",props:{id:`${this.props.id}-title`,text:this.title,font:$font(10),textColor:$color(this.activeStatus?\"systemLink\":\"lightGray\")},layout:(t,e)=>{t.centerX.equalTo(e.prev),t.top.equalTo(e.prev.bottom).offset(3)}}],this}},K=class t extends s{static tabBarHeight=50;#e={};#i={};#s;#n;#r=$text.uuid;#a=$text.uuid;bottomSafeAreaInsets=$app.isDebugging?0:u.bottomSafeAreaInsets;get selected(){return this.#n}set selected(t){this.switchPageTo(t)}get contentOffset(){return t.tabBarHeight+(this.#s?.height??0)}setPages(t={}){return Object.keys(t).forEach((e=>this.setPage(e,t[e]))),this}setPage(t,e){return void 0===this.#n&&(this.#n=t),this.#e[t]=e instanceof G?e:G.create(e),this.#n!==t&&(this.#e[t].activeStatus=!1),this}switchPageTo(t){if(this.#e[t]){if(this.#n===t)return;$ui.animate({duration:.4,animation:()=>{this.#i[t].active()}}),this.#i[this.#n].inactive(),this.#e[this.#n].hide(),this.#e[t].show(),this.callEvent(\"onChange\",this.#n,t),this.#n=t,this.initBackground()}}hideBackground(t=!0){$(this.#a).hidden=!0,$ui.animate({duration:t?.2:1e-4,animation:()=>{$(this.#r).alpha=0}})}showBackground(t=!0){$(this.#a).hidden=!1,$ui.animate({duration:t?.2:1e-4,animation:()=>{$(this.#r).alpha=1}})}initBackground(){let t=this.#e[this.selected];t.scrollable&&$delay(0,(()=>{let e=$(t.id).get(t.scrollableView.id),i=e.contentOffset.y;e.contentSize.height+this.bottomSafeAreaInsets-e.frame.height-i<=0?this.hideBackground(!1):this.showBackground(!1)}))}setCells(t={}){return Object.keys(t).forEach((e=>this.setCell(e,t[e]))),this}setCell(t,e){return void 0===this.#n&&(this.#n=t),e instanceof W||(e=new W({props:{info:{key:t}},icon:e.icon,title:e.title,activeStatus:this.#n===t})),this.#i[t]=e,this}setHeader(t){return this.#s=t,this}#o(){let t=[];return Object.values(this.#i).forEach((e=>{e.setEvent(\"tapped\",(t=>{let e=t.info.key;this.switchPageTo(e)})),t.push(e.getView())})),t}#l(){return Object.values(this.#e).map((t=>{if(t.scrollable){let e=t.scrollableView;if(e.props.indicatorInsets){let t=e.props.indicatorInsets;e.props.indicatorInsets=$insets(t.top,t.left,t.bottom+this.contentOffset,t.right)}else e.props.indicatorInsets=$insets(0,0,this.contentOffset,0);if(e.props.contentInset){let t=e.props.contentInset;e.props.contentInset=$insets(t.top,t.left,t.bottom+this.contentOffset,t.right)}else e.props.contentInset=$insets(0,0,this.contentOffset,0);\"function\"==typeof e.assignEvent&&e.assignEvent(\"didScroll\",(t=>{let e=t.contentOffset.y-this.contentOffset;t.contentSize.height+this.bottomSafeAreaInsets-t.frame.height-e<=1?this.hideBackground():this.showBackground()}))}return t.definition}))}generateView(){let e={type:\"view\",layout:(e,i)=>{e.centerX.equalTo(i.super),e.width.equalTo(i.super),e.top.equalTo(i.super.safeAreaBottom).offset(-t.tabBarHeight),e.bottom.equalTo(i.super)},views:[u.blurBox({id:this.#r}),{type:\"stack\",layout:$layout.fillSafeArea,props:{axis:$stackViewAxis.horizontal,distribution:$stackViewDistribution.fillEqually,spacing:0,stack:{views:this.#o()}}},u.separatorLine({id:this.#a},u.align.top)],events:{ready:()=>this.initBackground()}};return p.createFromViews(this.#l().concat(this.#s?.definition??[],e))}},G=class extends p{constructor(t={}){super(t),this.activeStatus=!0}show(){$(this.props.id).hidden=!1,this.activeStatus=!0}hide(){$(this.props.id).hidden=!0,this.activeStatus=!1}setHorizontalSafeArea(t){return this.horizontalSafeArea=t,this}#e(t,e){t.top.bottom.equalTo(e.super),this.horizontalSafeArea?t.left.right.equalTo(e.super.safeArea):t.left.right.equalTo(e.super)}getView(){return this.layout=this.#e,this.props.clipsToBounds=!0,this.props.hidden=!this.activeStatus,super.getView()}};t.exports={AlertAction:i,Alert:class t{id=$text.uuid;title;message;actions;titleFont=$font(\"bold\",20);messageFont=$font(14);actionButtonFontSize=16;actionButtonHighlight=$color($rgba(0,0,0,.2),$rgba(255,255,255,.2));actionButtonHeight=35;actionButtonBoderWidth=.5;actionButtonBorderColor=$color(\"#C9C9C9\",\"#383838\");boxWidth=250;textVerticalMargin=20;textHorizontalMargin=50;constructor({title:t=\"\",message:e=\"\",actions:s=[]}={}){this.title=t,this.message=e,this.actions=s,0===this.actions.length&&this.actions.push(new i),this.titleSize=u.getContentSize(this.titleFont,this.title,this.boxWidth-2*this.textHorizontalMargin),this.messageSize=u.getContentSize(this.messageFont,this.message,this.boxWidth-2*this.textHorizontalMargin)}textView(){return{type:\"view\",views:[{type:\"label\",props:{lines:0,font:this.titleFont,text:this.title,color:$color(\"tint\"),align:$align.center},layout:(t,e)=>{t.centerX.equalTo(e.super),t.width.equalTo(this.boxWidth-2*this.textHorizontalMargin),t.height.equalTo(this.titleSize.height),t.top.equalTo(this.textVerticalMargin)}},{type:\"label\",props:{lines:0,font:this.messageFont,text:this.message,align:$align.center},layout:(t,e)=>{t.centerX.equalTo(e.super),t.width.equalTo(this.boxWidth-2*this.textHorizontalMargin),t.height.equalTo(this.messageSize.height),t.top.equalTo(e.prev.bottom)}}],layout:(t,e)=>{t.top.width.equalTo(e.super),t.height.equalTo(this.titleSize.height+this.messageSize.height+2*this.textVerticalMargin)}}}actionView(){let t=(t,e)=>{let i=t=>2===this.actions.length?t.y>=0&&t.x>=0&&t.y<=this.actionButtonHeight&&t.x<=this.boxWidth/2:t.y>=0&&t.x>=0&&t.y<=this.actionButtonHeight&&t.x<=this.boxWidth,s=async(s,n,r)=>{t.disabled||(s.bgcolor=$color(\"clear\"),i(n)&&(\"function\"==typeof t.handler&&await t.handler({index:e,title:t.title}),this.dismiss()))},n=$color(\"tint\"),r=$font(this.actionButtonFontSize);return t.disabled?n=$color(\"gray\"):t.style===$alertActionType.destructive?n=$color(\"red\"):t.style===$alertActionType.cancel&&(r=$font(\"bold\",this.actionButtonFontSize)),{type:\"label\",props:{lines:1,text:t.title,align:$align.center,font:r,color:n,borderWidth:this.actionButtonBoderWidth,borderColor:this.actionButtonBorderColor,bgcolor:$color(\"clear\")},events:{tapped:()=>{},touchesBegan:e=>{t.disabled||(e.bgcolor=this.actionButtonHighlight)},touchesEnded:s,touchesCancelled:s,touchesMoved:(e,s,n)=>{t.disabled||(i(s)?e.bgcolor=this.actionButtonHighlight:e.bgcolor=$color(\"clear\"))}},layout:(t,e)=>{2===this.actions.length?e.prev?(t.left.equalTo(e.prev.right).offset(-this.actionButtonBoderWidth),t.width.equalTo(e.super).dividedBy(2).offset(this.actionButtonBoderWidth)):t.width.equalTo(e.super).dividedBy(2):(t.width.equalTo(e.super),e.prev&&t.top.equalTo(e.prev.bottom).offset(-this.actionButtonBoderWidth)),t.height.equalTo(this.actionButtonHeight)}}};return{type:\"view\",views:this.actions.map(((e,i)=>t(e,i))),layout:(t,e)=>{t.left.equalTo(e.super).offset(-this.actionButtonBoderWidth),t.width.equalTo(e.super).offset(2*this.actionButtonBoderWidth),t.bottom.equalTo(e.super),t.top.equalTo(e.prev.bottom)}}}getView(){let t={type:\"view\",props:{id:this.id+\"-box\",smoothCorners:!0,cornerRadius:20,bgcolor:$color(\"#FFFFFF\",\"#000000\")},views:[this.textView(),this.actionView()],layout:(t,e)=>{t.center.equalTo(e.super.safeArea);let i=this.titleSize.height+this.messageSize.height+2*this.textVerticalMargin,s=this.actions.length>2?this.actions.length:1;i+=this.actionButtonHeight*s,i-=this.actionButtonBoderWidth*s;let n=this.boxWidth-2*this.actionButtonBoderWidth;t.size.equalTo($size(n,i))}};return{type:\"view\",props:{id:this.id,alpha:0,bgcolor:$rgba(0,0,0,.6)},views:[t],layout:$layout.fill}}present(){let t=$ui.create(this.getView());$ui.controller.view.hidden?$ui.controller.view.super.insertAtIndex(t,0):$ui.controller.view.insertAtIndex(t,0);let e=$(this.id);e.layout($layout.fill),e.moveToFront(),$ui.animate({duration:.3,animation:()=>{e.alpha=1}})}dismiss(){let t=$(this.id);$ui.animate({duration:.3,animation:()=>{t.alpha=0},completion:()=>{t.remove()}})}static fromJsbox(e){return new Promise(((s,n)=>{new t({title:e.title,message:e.message,actions:e?.actions?.map((t=>(t.handler||(t.handler=t=>{s(t)}),new i(t))))}).present()}))}},Controller:s,FileManager:class{viewController;constructor(){this.listId=\"file-manager-list\",this.edges=10,this.iconSize=25}setViewController(t){this.viewController=t}get menu(){return{items:[{title:$l10n(\"SHARE\"),symbol:\"square.and.arrow.up\",handler:async(t,e)=>{let i=t.object(e).info.info;$share.sheet([$file.absolutePath(i.path)])}}]}}delete(t){$file.delete(t.path)}edit(t){let e=$file.read(t.path);if(e.info?.mimeType?.startsWith(\"image\"))c.quickLookImage(e,t.path.substring(t.path.lastIndexOf(\"/\")+1));else{let i=new c,s=$text.uuid;i.setView({type:\"code\",layout:$layout.fill,props:{id:s,lineNumbers:!0,theme:$device.isDarkMode?\"atom-one-dark\":\"atom-one-light\",text:e.string,insets:$insets(15,15,15,15)}}).addNavBar({title:t.file,popButton:{title:$l10n(\"CLOSE\")},rightButtons:[{title:$l10n(\"SAVE\"),tapped:()=>{$file.write({data:$data({string:$(s).text}),path:t.path}),$ui.success($l10n(\"SAVE_SUCCESS\"))}}]}),i.init().present()}}getFiles(t=\"\"){return $file.list(t).map((e=>{let i=t+\"/\"+e,s=$file.isDirectory(i);return{info:{info:{path:i,file:e,isDirectory:s}},icon:{symbol:s?\"folder.fill\":\"doc\"},name:{text:e},size:{text:s?\"\":\"--\"}}})).sort(((t,e)=>t.info.info.isDirectory!==e.info.info.isDirectory?t.info.info.isDirectory?-1:1:t.info.info.isDirectory===e.info.info.isDirectory?t.info.info.file.localeCompare(e.info.info.file):void 0))}async loadFileSize(t){return t.map(((e,i)=>{let s=e.info.info;if(!s.isDirectory)try{t[i].size.text=u.bytesToSize($file.read(s.path).info.size)}catch(e){t[i].size.text=e}})),t}get listTemplate(){return{props:{bgcolor:$color(\"clear\")},views:[{props:{id:\"info\"}},{type:\"image\",props:{id:\"icon\"},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(this.edges),t.size.equalTo(this.iconSize)}},{type:\"view\",views:[{type:\"label\",props:{id:\"size\",color:$color(\"secondaryText\"),lines:1},layout:(t,e)=>{t.height.equalTo(e.super),t.right.inset(this.edges)}},{type:\"label\",props:{id:\"name\",lines:1},layout:(t,e)=>{t.height.left.equalTo(e.super),t.right.equalTo(e.prev.left).offset(-this.edges)}}],layout:(t,e)=>{t.height.right.equalTo(e.super),t.left.equalTo(e.prev.right).offset(this.edges)}}]}}#e(t,e){let i=()=>{let t=$file.absolutePath($(this.listId).info.basePath);$ui.alert({title:\"Path\",message:t})};if(this.viewController){let s=new x;s.setView(e).navigationBarTitle(t),s.navigationBar.setLargeTitleDisplayMode(A.largeTitleDisplayModeNever),s.navigationBarItems.addRightButton({symbol:\"info.circle\",tapped:i}),this.viewController.push(s)}else u.push({title:t,views:[e],navButtons:[{symbol:\"info.circle\",handler:i}]})}getListView(t=\"\"){return{type:\"list\",props:{id:this.listId,menu:this.menu,info:{basePath:t},bgcolor:u.primaryViewBackgroundColor,separatorInset:$insets(0,this.edges,0,0),data:[],template:this.listTemplate,actions:[{title:\" \"+$l10n(\"DELETE\")+\" \",color:$color(\"red\"),handler:(t,e)=>{let i=t.object(e).info.info;u.deleteConfirm($l10n(\"FILE_MANAGER_DELETE_CONFIRM_MSG\")+' \"'+i.file+'\" ?',(()=>{this.delete(i),t.delete(e)}))}}]},layout:$layout.fill,events:{ready:()=>{let e=this.getFiles(t);$(this.listId).data=e,this.loadFileSize(e).then((t=>{$(this.listId).data=t}))},pulled:async t=>{let e=this.getFiles($(this.listId).info.basePath);$(this.listId).data=e,$(this.listId).data=await this.loadFileSize(e),$delay(.5,(()=>{t.endRefreshing()}))},didSelect:(t,e,i)=>{let s=i.info.info;s.isDirectory?this.#e(s.file,this.getListView(s.path)):this.edit(s)}}}}push(t=\"\"){let e=t.substring(t.lastIndexOf(\"/\"));this.#e(e,this.getListView(t))}},FileStorageParameterError:g,FileStorageFileNotFoundError:f,FileStorage:n,FixedFooterView:class extends p{height=60;getView(){return this.type=\"view\",this.setProp(\"bgcolor\",u.primaryViewBackgroundColor),this.layout=(t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.height)},this.views=[p.create({props:this.props,views:this.views,layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.height.equalTo(this.height)}})],this}},Kernel:class t{startTime=Date.now();isUseJsboxNav=!1;title=$addin?.current?.name;constructor(){$app.isDebugging&&(console.log(\"You are running EasyJsBox in debug mode.\"),$app.idleTimerDisabled=!0),r.init()}static objectEqual(e,i){let s=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(i);if(s.length!==n.length)return!1;for(let n=0;n<s.length;n++){let r=s[n],a=e[r],o=i[r];if(Array.isArray(a)){for(let e=0;e<a.length;e++)if(!t.objectEqual(a[e],o[e]))return!1}else{if(\"object\"==typeof a)return t.objectEqual(a,o);if(a!==o)return!1}}return!0}static versionCompare(t=\"\",e=\"\"){let i=t.split(\".\"),s=e.split(\".\"),n=Math.max(i.length,s.length),r=0;for(let t=0;t<n;++t){let e=i.length>t?i[t]:0,n=isNaN(Number(e))?e.charCodeAt():Number(e),a=s.length>t?s[t]:0,o=isNaN(Number(a))?a.charCodeAt():Number(a);if(n<o){r=-1;break}if(n>o){r=1;break}}return r}useJsboxNav(){return this.isUseJsboxNav=!0,this}setTitle(t){this.isUseJsboxNav&&($ui.title=t),this.title=t}setNavButtons(t){this.navButtons=t}openInJsbox(){$app.openURL(`jsbox://run?name=${this.title}`)}UIRender(t={}){let e=$context.query;if(\"alertFromKeyboard\"===e.type){let t=JSON.parse($text.URLDecode(e.value));return t.actions=[{title:$l10n(\"CANCEL\")}],void $ui.alert(t)}try{t.props=Object.assign({title:this.title,navBarHidden:!this.isUseJsboxNav,navButtons:this.navButtons??[],statusBarStyle:0},t.props),t.events||(t.events={});let e=t.events.layoutSubviews;t.events.layoutSubviews=()=>{$app.notify({name:\"interfaceOrientationEvent\",object:{statusBarOrientation:u.statusBarOrientation,isHorizontal:u.isHorizontal}}),\"function\"==typeof e&&e()},$ui.render(t)}catch(t){this.print(t)}}KeyboardRender(t={}){t.id||(t.id=$text.uuid),$ui.render({events:t.events??{}}),$delay(0,(()=>{$ui.controller.view=$ui.create(t),$ui.controller.view.layout(t.layout)}))}async checkUpdate(){let e=await $http.get(\"https://raw.githubusercontent.com/ipuppet/EasyJsBox/dev/src/version.js\");if(e.error)throw e.error;let i=e.data.match(/.*VERSION.+\\\"([0-9\\.]+)\\\"/)[1];if(this.print(`easy-jsbox latest version: ${i}`),t.versionCompare(i,\"1.4.4\")>0){let t=await $http.get(\"https://raw.githubusercontent.com/ipuppet/EasyJsBox/dev/dist/easy-jsbox.js\");if(t.error)throw t.error;return t.data}return!1}},L10n:r,Logger:a,Matrix:class extends p{titleStyle={font:$font(\"bold\",21),height:30};#e;#i;templateIdByIndex(t){return void 0===this.props.template.views[t]?.props?.id&&(void 0===this.props.template.views[t].props&&(this.props.template.views[t].props={}),this.props.template.views[t].props.id=$text.uuid),this.props.template.views[t].props.id}get templateHiddenStatus(){if(!this.#i){this.#i={};for(let t=0;t<this.props.template.views.length;t++)void 0===this.props.template.views[t].props.id&&void 0===this.props.template.views[t].props.hidden&&(this.#i[this.templateIdByIndex(t)]=!1),void 0!==this.props.template.views[t].props.hidden&&(this.#i[this.templateIdByIndex(t)]=this.props.template.views[t].props.hidden)}return this.#i}get hiddenViews(){if(!this.#e){this.#e={};for(let t=0;t<this.props.template.views.length;t++)this.#e[this.templateIdByIndex(t)]={hidden:!0}}return this.#e}get data(){let t=$(this.id).data,e=[];return t.map((t=>{t.items=t.items.filter((t=>!0===t?.__title?.hidden)),e.push(t)})),e}set data(t){this.props.data=this.rebuildData(t),$(this.id).data=this.props.data}#s(t){let e={...this.hiddenViews};return Object.assign(e,{__templateProps:{hidden:!0},__title:{hidden:!1,text:t,info:{title:!0}}}),e}rebuildData(t=[]){return t.map((t=>(t.items=t.items.map((t=>(Object.keys(t).forEach((e=>{t[e].hidden=this.templateHiddenStatus[e]??!1})),Object.keys(this.templateHiddenStatus).forEach((e=>{t[e]||(t[e]={}),t[e].hidden=this.templateHiddenStatus[e]})),t.__templateProps={hidden:!1},t.__title={hidden:!0},t))),t.title&&t.items.unshift(this.#s(t.title)),t)))}rebuildTemplate(){let t={};void 0!==this.props.template.props&&(void 0!==this.props.template.props.cornerRadius&&(this.props.template.props.clipsToBounds=!1),t=Object.assign(this.props.template.props,{id:\"__templateProps\",hidden:!1}));let e=[{type:\"view\",props:t,layout:$layout.fill},{type:\"label\",props:{id:\"__title\",hidden:!0,font:this.titleStyle.font},layout:(t,e)=>{t.top.inset(-this.titleStyle.height/4*3),t.height.equalTo(this.titleStyle.height),t.width.equalTo(e.super.safeArea)}}].concat(this.props.template.views);this.props.template.views=e}insert(t,e=!0){return t.indexPath=this.indexPath(t.indexPath,e),$(this.id).insert(t)}delete(t,e=!0){return t=this.indexPath(t,e),$(this.id).delete(t)}object(t,e=!0){return t=this.indexPath(t,e),$(this.id).object(t)}cell(t,e=!0){return t=this.indexPath(t,e),$(this.id).cell(t)}indexPath(t,e){let i=e?1:0;return t=\"number\"==typeof t?$indexPath(0,t+i):$indexPath(t.section,t.row+i)}getView(){return this.props.data=this.rebuildData(this.props.data),this.rebuildTemplate(),this.setEvent(\"itemSize\",((t,e)=>{if(t.object(e)?.__title?.info?.title)return $size(Math.max($device.info.screen.width,$device.info.screen.height),0);let i=this.props.columns??2,s=this.props.spacing??15,n=this.props.itemWidth??this.props.itemSize?.width??(t.super.frame.width-s*(i+1))/i,r=this.props.itemHeight??this.props.itemSize?.height??100;return $size(n,r)})),this}},BarTitleView:T,BarButtonItem:E,NavigationBarItems:o,NavigationBar:A,NavigationBarController:S,NavigationViewTypeError:I,NavigationView:x,SearchBar:class extends T{height=35;topOffset=15;bottomOffset=10;horizontalOffset=15;kbType=$kbType.search;placeholder=$l10n(\"SEARCH\");inputEvents={};keyboardView;accessoryView;cancelButtonFont=$font(16);constructor(t){super(t),this.setController(new C),this.controller.setSearchBar(this)}get cancelButtonWidth(){return u.getContentSize(this.cancelButtonFont,$l10n(\"CANCEL\")).width}setEvent(t,e){return this.inputEvents[t]=e,this}setPlaceholder(t){return this.placeholder=t,this}setKbType(t){return this.kbType=t,this}setKeyboardView(t){return this.keyboardView=t,this}setAccessoryView(t){return this.accessoryView=t,this}onBeginEditingAnimate(){$ui.animate({duration:.3,animation:()=>{let t=this.cancelButtonWidth;$(this.id+\"-cancel-button\").updateLayout(((e,i)=>{e.left.equalTo(i.super.right).offset(-t)})),$(this.id+\"-cancel-button\").alpha=1,$(this.id+\"-cancel-button\").relayout(),$(this.id+\"-input\").updateLayout((e=>{e.right.inset(t+this.horizontalOffset/2)})),$(this.id+\"-input\").relayout()}})}onEndEditingAnimate(){$ui.animate({duration:.3,animation:()=>{$(this.id+\"-cancel-button\").updateLayout(((t,e)=>{t.left.equalTo(e.super.right)})),$(this.id+\"-cancel-button\").alpha=0,$(this.id+\"-cancel-button\").relayout(),$(this.id+\"-input\").updateLayout($layout.fill),$(this.id+\"-input\").relayout()}})}cancel(){$(this.id+\"-input\").blur(),$(this.id+\"-input\").text=\"\",this.onEndEditingAnimate(),this.controller.callEvent(\"onCancel\")}getView(){return this.props={id:this.id,smoothCorners:!0,cornerRadius:6},this.views=[{type:\"input\",props:{id:this.id+\"-input\",type:this.kbType,bgcolor:$color(\"#EEF1F1\",\"#212121\"),placeholder:this.placeholder,keyboardView:this.keyboardView,accessoryView:this.accessoryView},layout:$layout.fill,events:Object.assign({didBeginEditing:t=>{this.onBeginEditingAnimate(),this.controller.callEvent(\"onBeginEditing\",t.text)},didEndEditing:t=>{this.controller.callEvent(\"onEndEditing\",t.text)},changed:t=>this.controller.callEvent(\"onChange\",t.text),returned:t=>this.controller.callEvent(\"onReturn\",t.text)},this.inputEvents)},{type:\"button\",props:{id:this.id+\"-cancel-button\",title:$l10n(\"CANCEL\"),font:this.cancelButtonFont,titleColor:$color(\"tintColor\"),bgcolor:$color(\"clear\"),alpha:0,hidden:!1},events:{tapped:()=>this.cancel()},layout:(t,e)=>{t.height.equalTo(e.super),t.width.equalTo(this.cancelButtonWidth),t.left.equalTo(e.super.right)}}],this.layout=(t,e)=>{t.height.equalTo(this.height),t.top.equalTo(e.super.safeArea).offset(this.topOffset),t.left.equalTo(e.super.safeArea).offset(this.horizontalOffset),t.right.equalTo(e.super.safeArea).offset(-this.horizontalOffset)},this}},SearchBarController:C,ViewController:D,Plist:class{constructor(t){this.content=t}valueToJs(t){switch(t.tag){case\"dict\":return this.dictToJs(t);case\"true\":case\"false\":return\"true\"===t.tag;case\"integer\":return t.number;case\"key\":case\"string\":return t.string;case\"date\":return new Date(t.string);case\"array\":return this.arrayToJs(t);default:return t.node}}arrayToJs(t){let e=[];return t.children().forEach((t=>{e.push(this.valueToJs(t))})),e}dictToJs(t){let e=[],i=[];return t.children().forEach((t=>{\"key\"===t.tag?e.push(this.valueToJs(t)):i.push(this.valueToJs(t))})),Object.fromEntries(e.map(((t,e)=>[t,i[e]])))}getObject(){if(!this.content)return!1;let t=$xml.parse({string:this.content,mode:\"xml\"});return this.valueToJs(t.rootElement.firstChild({xPath:\"//plist/dict\"}))}static get(t){return new this(t).getObject()}},RequestError:w,Request:l,SettingItem:h,SettingInfo:k,SettingSwitch:B,SettingString:L,SettingStepper:O,SettingScript:N,SettingTab:P,SettingMenu:V,SettingColor:R,SettingDate:_,SettingInput:M,SettingNumber:q,SettingIcon:F,SettingPush:U,SettingChild:H,SettingImage:j,SettingLoadConfigError:m,SettingReadonlyError:y,Setting:class extends s{name;setting={};settingItems={};userData;fileStorage;logger;imagePath;viewController=new D;method={readme:()=>{let t=(()=>{let t=$device.info?.language?.startsWith(\"zh\")?\"README_CN.md\":\"README.md\";try{return __README__[t]??__README__[\"README.md\"]}catch{return $file.read(t)?.string??$file.read(\"README.md\")?.string}})();(new c).setView({type:\"markdown\",props:{content:t},layout:(t,e)=>{t.size.equalTo(e.super)}}).addNavBar({title:\"README\",popButton:{symbol:\"x.circle\"}}).init().present()}};#e=!1;#i=!1;#s;constructor(t={}){super(),\"function\"==typeof t.set&&\"function\"==typeof t.get?(this.set=t.set,this.getOriginal=t.get,this.setUserData(t.userData??{})):(this.fileStorage=t.fileStorage??new n,this.dataFile=t.dataFile??\"setting.json\"),t.structure?this.setStructure(t.structure):this.setStructurePath(t.structurePath??\"setting.json\"),this.logger=t.logger??new a,this.isUseJsboxNav=t.isUseJsboxNav??!1,this.imagePath=(t.name??\"default\")+\".image/\",this.setName(t.name??$text.uuid)}useJsboxNav(){return this.isUseJsboxNav=!0,this}#n(){if(!this.#i)throw new m}loader(t){let e=null;switch(t.type){case\"info\":e=new k(t);break;case\"switch\":e=new B(t);break;case\"string\":e=new L(t);break;case\"stepper\":e=new O(t).with({min:t.min??1,max:t.max??12});break;case\"script\":e=new N(t).with({script:t.script??t.value});break;case\"tab\":e=new P(t).with({items:t.items,values:t.values});break;case\"menu\":e=new V(t).with({items:t.items,values:t.values,pullDown:t.pullDown??!1});break;case\"color\":e=new R(t);break;case\"date\":e=new _(t).with({mode:t.mode});break;case\"input\":e=new M(t).with({secure:t.secure});break;case\"number\":e=new q(t);break;case\"icon\":e=new F(t).with({bgcolor:t.bgcolor});break;case\"push\":e=new U(t).with({view:t.view,navButtons:t.navButtons});break;case\"child\":e=new H(t).with({children:t.children});break;case\"image\":e=new j(t);break;default:e=t,e.default=t.value,e.get=(...t)=>this.get(...t),e.set=(...t)=>this.set(...t)}return e}loadConfig(){this.#i=!1;let t=this.userData??this.fileStorage.readAsJSON(this.dataFile,{}),e=i=>{for(let s in i)for(let n in i[s].items){let r=i[s].items[n];r instanceof h||(i[s].items[n]=this.loader(r),r=i[s].items[n]),r.setting||(r.setting=this),this.settingItems[r.key]=r,r instanceof H?e(r.options.children):r instanceof N||r instanceof k||(r.key in t?this.setting[r.key]=t[r.key]:this.setting[r.key]=r.default)}};return e(this.structure),this.#i=!0,this}hasSectionTitle(t){return this.#n(),!!t[0]?.title}setUserData(t){return this.userData=t,this}setStructure(t){return this.structure=t,this.loadConfig()}setStructurePath(t){return this.structure||this.setStructure(n.readFromRootAsJSON(t)),this}setName(t){return this.name=t,this}setFooter(t){return this.#s=t,this}set footer(t){this.#s=t}get footer(){if(void 0===this.#s){let t=n.readFromRootAsJSON(\"config.json\",{}).info??{};if(!t.version||!t.author)try{t=__INFO__}catch{}this.#s={},t.version&&t.author&&(this.#s={type:\"view\",props:{height:70},views:[{type:\"label\",props:{font:$font(14),text:`${$l10n(\"VERSION\")} ${t.version} ♥ ${t.author}`,textColor:$color({light:\"#C0C0C0\",dark:\"#545454\"}),align:$align.center},layout:t=>{t.left.right.inset(0),t.top.inset(10)}}]})}return this.#s}setReadonly(){return this.#e=!0,this}set(t,e){if(this.#e)throw new y;return this.#n(),this.setting[t]=e,this.fileStorage.write(this.dataFile,$data({string:JSON.stringify(this.setting)})),this.callEvent(\"onSet\",t,e),!0}getOriginal(t,e=null){return this.#n(),Object.prototype.hasOwnProperty.call(this.setting,t)?this.setting[t]:e}getItem(t){return this.settingItems[t]}get(t,e=null){return this.#n(),this.getItem(t)?this.getItem(t).get(e):this.getOriginal(t,e)}#r(t){let e=[];for(let i in t){let s=[];for(let e in t[i].items){let n=t[i].items[e];n instanceof h&&s.push(n.create())}e.push({title:$l10n(t[i].title??\"\"),rows:s})}return e}getListView(t=this.structure,e=this.footer,i=this.name){return{type:\"list\",props:{id:i,style:2,separatorInset:$insets(0,h.iconSize+2*h.edgeOffset,0,h.edgeOffset),footer:e,data:this.#r(t)},layout:$layout.fill,events:{rowHeight:(t,e)=>(t.object(e)?.props?.info??{}).rowHeight??h.rowHeight,didSelect:async(t,e,i)=>{t=t.ocValue();let s=this.getItem(i.props.info.key);if(\"function\"==typeof s?.tapped){t.$selectRowAtIndexPath_animated_scrollPosition(e.ocValue(),!1,0);try{await s.tapped()}catch(t){this.logger.error(t)}}t.$deselectRowAtIndexPath_animated(e,!0)}}}}getNavigationView(){let t=new x;return t.setView(this.getListView(this.structure)).navigationBarTitle($l10n(\"SETTING\")),this.hasSectionTitle(this.structure)&&t.navigationBar.setContentViewHeightOffset(-10),t}getPage(){return this.getNavigationView().getPage()}},SheetViewUndefinedError:v,SheetViewTypeError:z,Sheet:c,TabBarCellView:W,TabBarHeaderView:class extends p{height=60;getView(){return this.type=\"view\",this.setProp(\"bgcolor\",this.props.bgcolor??u.primaryViewBackgroundColor),this.layout=(t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.height-K.tabBarHeight)},this.views=[p.create({props:this.props,views:this.views,layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.height.equalTo(this.height)}})],this}},TabBarController:K,Tasks:class{#e={};addTask(t,e=0){let i=$text.uuid;return this.#e[i]=$delay(e,(async()=>{await t(),delete this.#e[i]})),i}cancelTask(t){this.#e[t].cancel()}clearTasks(){Object.values(this.#e).forEach((t=>t.cancel()))}},Toast:d,UIKit:u,UILoading:class{#e;text=\"\";interval;fullScreen=!1;#i=()=>{};constructor(){this.#e=$text.uuid}updateText(t){$(this.#e).text=t}setLoop(t){if(\"function\"!=typeof t)throw\"loop must be a function\";this.#i=t}done(){clearInterval(this.interval)}load(){$ui.render({props:{navBarHidden:this.fullScreen},views:[{type:\"spinner\",props:{loading:!0},layout:(t,e)=>{t.centerY.equalTo(e.super).offset(-15),t.width.equalTo(e.super)}},{type:\"label\",props:{id:this.#e,align:$align.center,text:\"\"},layout:(t,e)=>{t.top.equalTo(e.prev.bottom).offset(10),t.left.right.equalTo(e.super)}}],layout:$layout.fill,events:{appeared:()=>{this.interval=setInterval((()=>{this.#i()}),100)}}})}},ValidationError:b,View:p,PageView:G,WebDAV:class extends l{#e;user;password;#i;namespace=\"JSBox.WebDAV\";lockTokenCacheKey=this.namespace+\".lockToken\";get host(){return this.#e}set host(t){for(this.#e=t.trim();this.#e.endsWith(\"/\");)this.#e=this.#e.substring(0,this.#e.length-1);this.#e.startsWith(\"http\")||(this.#e=\"http://\"+this.#e)}get basepath(){return this.#i}set basepath(t){for(this.#i=t.trim();this.#i.endsWith(\"/\");)this.#i=this.#i.substring(0,this.#i.length-1);for(;this.#i.startsWith(\"/\");)this.#i=this.#i.substring(1);this.#i=\"/\"+this.#i}constructor({host:t,user:e,password:i,basepath:s=\"\"}={}){super(),this.host=t,this.user=e,this.password=i,this.basepath=s}#s(t){return t=(t=t.trim()).startsWith(\"/\")?t:\"/\"+t,this.basepath+t}async request(t,e,i=null,s={}){return s=Object.assign({\"Content-Type\":\"text/xml; charset=UTF-8\",Authorization:\"Basic \"+$text.base64Encode(`${this.user}:${this.password}`)},s),await super.request(this.host+this.#s(t),e,i,s)}async allow(t){let e=await this.request(t,l.method.options);return(e.response.headers?.allow??e.response.headers?.Allow)?.split(\",\").map((t=>t.trim().toUpperCase()))??[]}async propfind(t,e=[],i=0){Array.isArray(e)||(e=[e]);let s=`<?xml version=\"1.0\" encoding=\"utf-8\" ?><D:propfind xmlns:D=\"DAV:\"><D:prop>${e.map((t=>`<D:${t}/>`)).join()}</D:prop></D:propfind>`,n=await this.request(t,\"PROPFIND\",s,{Depth:i});return $xml.parse({string:n.data})}async propfindAll(t,e=0){let i=await this.request(t,\"PROPFIND\",'<?xml version=\"1.0\" encoding=\"utf-8\" ?><D:propfind xmlns:D=\"DAV:\"><D:allprop/></D:propfind>',{Depth:e});return $xml.parse({string:i.data})}async ls(t,e=1){let i=await this.request(t,\"PROPFIND\",null,{Depth:e});return $xml.parse({string:i.data})}async exists(t){try{return(await this.allow(t)).includes(l.method.get)?await this.request(t,l.method.head):await this.ls(t,0),!0}catch(t){if(404===t?.code)return!1;throw t}}async mkdir(t){return await this.request(t,\"MKCOL\")}async get(t){return await this.request(t,l.method.get,null)}async put(t,e,{withLock:i=!0,waitInterval:s=2,maxTry:n=3}={}){let r={};for(;await this.isLocked(t);){if(--n<=0)throw new Error(\"Resource Locked\");await $wait(s)}if(i)try{await this.lock(t),r.If=`(${this.#r(t)})`}catch(t){if(404!==t.code)throw t;i=!1}await this.request(t,l.method.put,e,r),i&&await this.unlock(t)}async delete(t){if(!t)throw new Error(\"path empty\");return await this.request(t,l.method.delete)}#n(t,e){let i=$cache.get(this.lockTokenCacheKey)??{};i[t]=e,$cache.set(this.lockTokenCacheKey,i)}#r(t){return($cache.get(this.lockTokenCacheKey)??{})[t]}async isSupportLock(t){try{return!!(await this.propfind(t,\"supportedlock\")).rootElement.firstChild({xPath:\"//D:response/D:propstat/D:prop/D:supportedlock/D:lockentry\"}).firstChild({xPath:\"//D:locktype/D:write\"})}catch(t){if(404!==t.code)return!1;throw t}}async lock(t,{infinity:e=!1,timeout:i=\"Second-10\"}={}){if(!await this.isSupportLock(t))throw new Error(\"Your WebDAV service does not support the `LOCK` method.\");let s=`<?xml version=\"1.0\" encoding=\"utf-8\" ?><D:lockinfo xmlns:D='DAV:'><D:lockscope><D:exclusive/></D:lockscope><D:locktype><D:write/></D:locktype><D:owner><D:href>${this.namespace}</D:href></D:owner></D:lockinfo>`,n=await this.request(t,\"LOCK\",s,{Timeout:i,Depth:e?\"infinity\":0}),r=n.response.headers[\"lock-token\"]??n.response.headers[\"Lock-Token\"];return this.#n(t,r),$xml.parse({string:n.data})}async isLocked(t){try{let e=(await this.propfind(t,\"lockdiscovery\")).rootElement;if(e.firstChild({xPath:\"//D:response/D:propstat/D:status\"}).string.includes(\"404\"))await this.lock(t,{timeout:\"Second-0\"});else{let i=e.firstChild({xPath:\"//D:response/D:propstat/D:prop/D:lockdiscovery\"}).children()??[];for(let e=0;e<i.length;e++)if(i[e].firstChild({tag:\"lockroot\"}).string===this.host+this.#s(t))return!0}}catch(t){if(423===t.code)return!0}return!1}async refreshLock(t,{infinity:e=!1,timeout:i=\"Second-10\"}={}){let s=await this.request(t,\"LOCK\",null,{Timeout:i,If:this.#r(t),Depth:e?\"infinity\":0});return $xml.parse({string:s.data})}async unlock(t){await this.request(t,\"UNLOCK\",null,{\"Lock-Token\":this.#r(t)})}}}})),s.register(\"2EAPF\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingInfo,r=i.SettingScript,a=i.SettingTab,o=s(\"1tFrB\"),l=s(\"fEWdA\");const h={items:[new a({icon:[\"rectangle.topthird.inset.filled\",\"#A569BD\"],title:\"DISPLAY_MODE\",key:\"mainUIDisplayMode\",value:0}).with({items:[\"CLASSIC\",\"MODERN\"]}),new r({icon:[\"folder.fill\",\"#FF9900\"],title:\"FILE_MANAGEMENT\"}).with({script:\"this.method.fileManager\"})]},c={items:[new n({icon:[\"/assets/icon/github.com.jpeg\",\"white\"],title:\"Github\",value:[\"ipuppet/CAIO\",\"https://github.com/ipuppet/CAIO\"]}),new n({icon:[\"/assets/icon/telegram.png\",\"white\"],title:\"Telegram\",value:[\"JSBoxTG\",\"https://t.me/JSBoxTG\"]}),new n({icon:[\"person.fill\",\"#FF9900\"],title:\"AUTHOR\",value:[\"ipuppet\",\"https://blog.ultagic.com\"]}),new r({icon:\"arrow.2.circlepath\",title:\"CHECK_UPDATE\"}).with({script:\"this.method.checkUpdate\"}),new r({icon:[\"book.fill\",\"#A569BD\"],title:\"README\"}).with({script:\"this.method.readme\"})]};t.exports=[o,h,l,c]})),s.register(\"1tFrB\",(function(t,e){var i=s(\"gxpqj\").UIKit,n=s(\"3dE3D\"),r=s(\"2jPf3\"),a=s(\"iN4Y6\"),o=s(\"knZRr\"),l=s(\"aziQd\"),h=s(\"5xoIG\");t.exports={items:[n,r,a].concat(i.isTaio?[]:[o,l,h])}})),s.register(\"3dE3D\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingSwitch,r=i.SettingScript,a=i.SettingNumber,o=i.SettingPush,l=i.SettingChild;t.exports=new l({icon:[\"doc.on.clipboard\",\"#FFCC66\"],title:\"CLIPS\"}).with({children:[{items:[new n({icon:[\"link\",\"#FF6633\"],title:\"UNIVERSAL_CLIPBOARD\",key:\"clipboard.universal\",value:!0}),new r({icon:[\"cursorarrow.rays\",\"#FF6633\"],title:\"Tips\"}).with({script:\"$ui.alert({title:$l10n('UNIVERSAL_CLIPBOARD'),message:$l10n('UNIVERSAL_CLIPBOARD_TIPS')})\"})]},{items:[new o({icon:[\"trash\",\"red\"],title:\"RECYCLE_BIN\",key:\"clipboard.recycleBin\"}).with({view:\"this.method.recycleBin\",navButtons:\"this.method.recycleBinNavButtons\"})]},{items:[new a({icon:[\"text.alignleft\",\"#FFCC66\"],title:\"MAX_ITEM_LENGTH\",key:\"clipboard.maxItemLength\",value:100}),new n({icon:[\"square.and.arrow.down.on.square\",\"#FF6633\"],title:\"AUTO_SAVE\",key:\"clipboard.autoSave\",value:!0})]},{items:[new r({icon:\"square.and.arrow.up\",title:\"EXPORT\"}).with({script:\"this.method.exportClipboard\"}),new r({icon:[\"square.and.arrow.down\",\"#FFCC33\"],title:\"IMPORT\"}).with({script:\"this.method.importClipboard\"})]},{items:[new r({icon:[\"arrow.2.circlepath\",\"red\"],title:\"REBUILD_DATABASE\"}).with({script:\"this.method.rebuildDatabase\"}),new r({icon:[\"trash\",\"red\"],title:\"DELETE_ALL_DATA\"}).with({script:\"this.method.deleteAllData\"})]}]})})),s.register(\"2jPf3\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingScript,r=i.SettingChild;t.exports=new r({icon:[\"bolt.circle\",\"#FF6633\"],title:\"ACTIONS\"}).with({children:[{items:[new n({icon:[\"bolt.circle\",\"#FF6633\"],title:\"IMPORT_EXAMPLE_ACTIONS\",value:\"this.method.importExampleAction\"}).with({script:\"this.method.importExampleAction\"})]},{items:[new n({icon:\"square.and.arrow.up\",title:\"EXPORT\"}).with({script:\"this.method.exportAction\"}),new n({icon:[\"square.and.arrow.down\",\"#FFCC33\"],title:\"IMPORT\"}).with({script:\"this.method.importAction\"})]},{items:[new n({icon:[\"arrow.2.circlepath\",\"red\"],title:\"REBUILD_ACTION_DATABASE\"}).with({script:\"this.method.rebuildAction\"})]}]})})),s.register(\"iN4Y6\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingSwitch,r=i.SettingInput,a=i.SettingNumber,o=i.SettingChild;t.exports=new o({icon:[\"pencil.circle\",\"#CC0099\"],title:\"EDITOR\"}).with({children:[{title:\"CLIPS\",items:[new a({icon:[\"wand.and.stars\",\"#FF6633\"],title:\"TEXT_INSETS\",key:\"editor.text.insets\",value:300})]},{title:\"CODE\",items:[new n({icon:[\"list.number\",\"#6699CC\"],title:\"SHOW_LINE_NUMBER\",key:\"editor.code.lineNumbers\",value:!1}),new r({icon:[\"wand.and.stars\",\"#FF6633\"],title:\"LIGHT_MODE_THEME\",key:\"editor.code.lightTheme\",value:\"atom-one-light\"}),new r({icon:[\"wand.and.stars\",\"#FF6633\"],title:\"DARK_MODE_THEME\",key:\"editor.code.darkTheme\",value:\"atom-one-dark\"})]}]})})),s.register(\"knZRr\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingSwitch,r=i.SettingStepper,a=i.SettingScript,o=i.SettingTab,l=i.SettingNumber,h=i.SettingPush,c=i.SettingChild,d=i.SettingImage;t.exports=new c({icon:[\"keyboard\",\"#a2a5a6\"],title:\"KEYBOARD\"}).with({children:[{items:[new h({icon:\"rectangle.3.offgrid.fill\",title:\"PREVIEW\",key:\"keyboard.previewAndHeight\",value:267}).with({view:\"this.method.previewKeyboard\"})]},{items:[new o({icon:[\"rectangle.topthird.inset.filled\",\"#A569BD\"],title:\"DISPLAY_MODE\",key:\"keyboard.displayMode\",value:0}).with({items:[\"list\",\"matrix\"]}),new n({icon:[\"checkerboard.rectangle\",\"#1899c4\"],title:\"USE_BLUR\",key:\"keyboard.blur\",value:!1}),new d({icon:[\"photo\",\"#FFCC66\"],title:\"BACKGROUND_IMAGE\",key:\"keyboard.background.image\"})]},{items:[new n({icon:[\"globe\",\"#1899c4\"],title:\"SWITCH_AFTER_INSERT\",key:\"keyboard.switchAfterInsert\",value:!1}),new n({icon:[\"cursor.rays\",\"#FF8C00\"],title:\"TAPTIC_ENGINE\",key:\"keyboard.tapticEngine\",value:!0}),new r({icon:[\"cursor.rays\",\"#FF8C00\"],title:\"TAPTIC_ENGINE_LEVEL\",key:\"keyboard.tapticEngineLevel\",value:1}).with({min:0,max:2}),new a({icon:\"paperplane\",title:\"QUICK_START_SCRIPTS\"}).with({script:\"this.method.setKeyboardQuickStart\"})]},{items:[new l({icon:[\"rays\",\"#FFCC33\"],title:\"DELETE_DELAY\",key:\"keyboard.deleteDelay\",value:.05})]}]})})),s.register(\"aziQd\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingScript,r=i.SettingMenu,a=i.SettingChild;t.exports=new a({icon:[\"rectangle.3.offgrid.fill\",\"#1899c4\"],title:\"WIDGET\"}).with({children:[{items:[new n({icon:\"rectangle.3.offgrid.fill\",title:\"PREVIEW\"}).with({script:\"this.method.previewWidget\"})]},{title:\"2x2\",items:[new r({icon:\"link\",title:\"CLICK_ACTION\",key:\"widget.2x2.widgetURL\",value:2}).with({pullDown:!0,items:[\"ADD\",\"ACTIONS\",\"CLIPS\"]})]}]})})),s.register(\"5xoIG\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingScript,r=i.SettingChild;t.exports=new r({icon:[\"filemenu.and.selection\",\"#ebcc34\"],title:\"TODAY_WIDGET\"}).with({children:[{items:[new n({icon:\"rectangle.3.offgrid.fill\",title:\"PREVIEW\"}).with({script:\"this.method.previewTodayWidget\"})]},{items:[new n({icon:\"bolt.circle\",title:\"ACTIONS\"}).with({script:\"this.method.setTodayWidgetActions\"})]}]})})),s.register(\"fEWdA\",(function(t,e){var i=s(\"gxpqj\").SettingChild,n=s(\"fiqsI\");t.exports={items:[new i({icon:\"wrench.and.screwdriver\",title:\"EXPERIMENTAL\"}).with({children:[{items:[n]}]})]}})),s.register(\"fiqsI\",(function(t,e){var i=s(\"gxpqj\"),n=i.SettingSwitch,r=i.SettingInput,a=i.SettingChild;t.exports=new a({icon:[\"cloud\",\"#FF9900\"],title:\"WebDAV\"}).with({children:[{items:[new n({icon:[\"cloud\",\"#FF9900\"],title:\"WebDAV\",key:\"webdav.status\",value:!1})]},{items:[new r({icon:\"link\",title:\"HOST\",key:\"webdav.host\",value:\"\"}),new r({icon:\"person\",title:\"USER\",type:\"input\",key:\"webdav.user\",value:\"\"}),new r({icon:\"person.badge.key\",title:\"PASSWORD\",type:\"input\",key:\"webdav.password\",value:\"\"}),new r({icon:\"link\",title:\"BASEPATH\",type:\"input\",key:\"webdav.basepath\",value:\"\"})]}]})})),s.register(\"jEwwi\",(function(t,e){var i=s(\"gxpqj\").UIKit,n=s(\"7GYtH\");class r{fileStorage;fsPath;imagePath;#h;static isImage(t=\"\"){return t?.startsWith(\"@image=\")}static pathToKey(t){return`@image=${t=JSON.stringify(t)}`}static keyToPath(t){if(r.isImage(t)){return JSON.parse(t.slice(7))}return!1}constructor({uuid:t,section:e,text:i=\"\",md5:s,tag:n=null,prev:r=null,next:a=null}={}){if(!t)throw new Error(\"Clip create faild: uuid undefined\");if(!e)throw new Error(\"Clip create faild: section undefined\");this.uuid=t,this.section=e,this.text=i,this.md5=s??$text.MD5(this.text),this.tag=n,this.prev=r,this.next=a}get text(){return this.#h}set text(t){this.#h=t,r.isImage(t)&&this.#c(r.keyToPath(t))}get hasTag(){return null!==this.tag}get image(){return r.isImage(this.text)}get imageOriginal(){return this.#d(\"original\")}get imagePreview(){return this.#d(\"preview\")}#d(t){if(this.image&&this.fileStorage.exists(this.fsPath[t]))return this.fileStorage.readSync(this.fsPath[t])}#c(t){this.fileStorage&&(this.fsPath=t,this.imagePath={original:this.fileStorage.filePath(t.original),preview:this.fileStorage.filePath(t.preview)})}}class a{sqlite;constructor(t){this.kernel=t,this.dbName=\"CAIO.db\",this.localDb=`/${this.dbName}`;const e=\"/image\";this.imagePath={base:e,original:`${e}/original`,preview:`${e}/preview`},this.tempPath=\"/temp\",this.tempDbFile=`${this.tempPath}/${this.dbName}`,this.tempImagePath=`${this.tempPath}/image`,this.exportFileName=\"CAIO.zip\",this.initWebdavSync(),this.init()}async initWebdavSync(){if(this.kernel.setting.get(\"webdav.status\"))try{this.webdavSync=new n({kernel:this.kernel,host:this.kernel.setting.get(\"webdav.host\"),user:this.kernel.setting.get(\"webdav.user\"),password:this.kernel.setting.get(\"webdav.password\"),basepath:this.kernel.setting.get(\"webdav.basepath\")}),await this.webdavSync.init()}catch(t){throw this.kernel.logger.error(t),t}}needUpload(){this.kernel.setting.get(\"webdav.status\")&&this.webdavSync.needUpload()}sync(){this.kernel.setting.get(\"webdav.status\")&&this.webdavSync.sync()}init(){this.sqlite&&this.sqlite.close(),this.sqlite=$sqlite.open(this.kernel.fileStorage.filePath(this.localDb)),this.sqlite.update(\"CREATE TABLE IF NOT EXISTS clips(uuid TEXT PRIMARY KEY NOT NULL, text TEXT, md5 TEXT, prev TEXT, next TEXT)\"),this.sqlite.update(\"CREATE TABLE IF NOT EXISTS favorite(uuid TEXT PRIMARY KEY NOT NULL, text TEXT, md5 TEXT, prev TEXT, next TEXT)\"),this.sqlite.update(\"CREATE TABLE IF NOT EXISTS tag(uuid TEXT PRIMARY KEY NOT NULL, tag TEXT)\"),this.kernel.logger.info(\"init database\")}rebuild(){const t=this.tempPath+\"/rebuild.db\";this.kernel.fileStorage.delete(t);const e=new a(this.kernel);e.localDb=t,e.init();const i=(t,i)=>{const s=[];t.forEach((t=>{const n=new r({uuid:t.uuid,text:t.text,section:t.section,md5:t.md5,tag:t.tag,prev:null,next:s[0]?.uuid??null});e.beginTransaction();try{e.insert(n),n.next&&(s[0].prev=n.uuid,s[0].section=i,e.update(s[0])),e.commit(),s.unshift(n)}catch(t){throw e.rollback(),this.kernel.logger.error(t),t}}))};[\"clips\",\"favorite\"].map((t=>{let e=this.all(t);try{const t=this.sort(e);if(t.length>e.length)throw new Error;e=t.reverse()}catch{}i(e,t)}));const s=this.sqlite.query(\"SELECT * FROM tag\");this.parseTag(s).forEach((t=>{e.beginTransaction();try{e.setTag(t.uuid,t.tag),e.commit()}catch(t){throw e.rollback(),this.kernel.logger.error(t),t}})),this.kernel.fileStorage.copy(t,this.localDb),this.needUpload(),this.kernel.logger.info(\"database rebuild\")}deleteAllData(){this.kernel.fileStorage.delete(this.imagePath.base),this.kernel.fileStorage.delete(this.localDb),this.needUpload(),this.kernel.logger.info(\"delete all database\")}clearTemp(){this.kernel.fileStorage.delete(this.tempPath)}async export(t){this.clearTemp(),this.kernel.fileStorage.copy(this.localDb,this.tempDbFile),this.kernel.fileStorage.copy(this.imagePath.base,this.tempImagePath);const e=this.tempPath+\"/\"+this.exportFileName;await $archiver.zip({directory:this.kernel.fileStorage.filePath(this.tempPath),dest:this.kernel.fileStorage.filePath(e)}),$share.sheet({items:[{name:this.exportFileName,data:$data({path:this.kernel.fileStorage.filePath(e)})}],handler:i=>{this.kernel.fileStorage.delete(e),t(i)}})}async import(t){if(\"db\"===t.fileName.slice(-2)){if(!this.kernel.fileStorage.writeSync(this.localDb,t))throw new Error($l10n(\"WRITE_DB_FILE_FAILED\"))}else if(\"zip\"===t.fileName.slice(-3)){if(!await $archiver.unzip({file:t,dest:this.kernel.fileStorage.filePath(this.tempPath)}))throw new Error($l10n(\"UNZIP_FAILED\"));this.kernel.fileStorage.move(this.tempDbFile,this.localDb),this.kernel.fileStorage.move(this.tempImagePath,this.imagePath.base)}this.webdavSync&&this.webdavSync.updateLocalTimestamp()}sort(t,e=9e3){const i={};let s=0,n=null;t.forEach((t=>{i[t.uuid]=t,null===t.prev&&(n=t.uuid),s++}));const r=[];if(s>0)try{let t=i[n];for(;null!==t.next&&e>0;)e--,r.push(t),t=i[t.next];r.push(t)}catch(t){throw\"Unable to sort: \"+t}return r}replaceString(t){return[\"\\\\\",'\"',\"'\",\"%\",\"-\",\"_\",\";\"].forEach((e=>{t=t.replaceAll(e,`\\\\${e}`)})),t}parse(t){const e=t.result,i=t.error,s=[];try{if(null!==i)throw new Error(`Code [${i.code}] ${i.domain} ${i.localizedDescription}`);for(;e.next();){const t=e.get(\"text\"),i=new r({uuid:e.get(\"uuid\"),section:e.get(\"section\"),md5:e.get(\"md5\"),tag:e.get(\"tag\"),prev:e.get(\"prev\"),next:e.get(\"next\")});r.isImage(t)&&(i.fileStorage=this.kernel.fileStorage),i.text=t,s.push(i)}}catch(i){throw i}finally{e?.close()}return s}parseTag(t){if(null!==t.error)throw t.error;const e=[];for(;t.result.next();)e.push({uuid:t.result.get(\"uuid\"),tag:t.result.get(\"tag\")});return t.result.close(),e}beginTransaction(){this.sqlite.beginTransaction()}commit(){this.sqlite.commit()}rollback(){this.sqlite.rollback()}getByUUID(t=\"\"){const e=this.sqlite.query({sql:\"\\n                SELECT a.*, tag from\\n                (SELECT *, 'clips' AS section FROM clips WHERE uuid = ?\\n                UNION\\n                SELECT *, 'favorite' AS section FROM favorite WHERE uuid = ?) a\\n                LEFT JOIN tag ON a.uuid = tag.uuid\\n            \",args:[t,t]});return this.parse(e)[0]}getByMD5(t=\"\"){const e=this.sqlite.query({sql:\"\\n                SELECT a.*, tag from\\n                (SELECT *, 'clips' AS section FROM clips WHERE md5 = ?\\n                UNION\\n                SELECT *, 'favorite' AS section FROM favorite WHERE md5 = ?) a\\n                LEFT JOIN tag ON a.uuid = tag.uuid\\n            \",args:[t,t]});return this.parse(e)[0]}async search(t){const e=(await $text.tokenize({text:t})).map((t=>this.replaceString(t))),i=`%${e.join(\"%\")}%`,s=this.sqlite.query({sql:`\\n                SELECT a.*, tag from\\n                (SELECT *, 'clips' AS section FROM clips WHERE text like \"${i}\"\\n                UNION\\n                SELECT *, 'favorite' AS section FROM favorite WHERE text like \"${i}\") a\\n                LEFT JOIN tag ON a.uuid = tag.uuid\\n            `});return{result:this.parse(s),keyword:e}}searchByTag(t){t.startsWith(\"#\")&&(t=t.substring(1));const e=this.sqlite.query({sql:`SELECT * FROM tag WHERE tag like \"%${this.replaceString(t)}%\"`}),i=this.parseTag(e),s=[];return i.forEach((t=>{s.push(this.getByUUID(t.uuid))})),{result:s,keyword:[t]}}deleteTable(t){const e=this.sqlite.update(`DELETE FROM ${t}`);if(!e.result)throw e.error;this.needUpload(),this.kernel.logger.info(`delete table ${t}`)}all(t){const e=this.sqlite.query(`SELECT ${t}.*, tag, '${t}' AS section FROM ${t} LEFT JOIN tag ON ${t}.uuid = tag.uuid`);return this.parse(e)}saveImage(t){if(\"object\"==typeof t){const e=$text.uuid,s={original:`${this.imagePath.original}/${e}.png`,preview:`${this.imagePath.preview}/${e}.jpg`};return this.kernel.fileStorage.write(s.original,t.png),this.kernel.fileStorage.write(s.preview,i.compressImage(t).jpg(.8)),r.pathToKey(s)}throw new Error(\"saveImageError: image not an object\")}insert(t){const e=this.sqlite.update({sql:`INSERT INTO ${t.section} (uuid, text, md5, prev, next) values (?, ?, ?, ?, ?)`,args:[t.uuid,t.text,$text.MD5(t.text),t.prev,t.next]});if(!e.result)throw e.error;this.needUpload()}update(t){if(Object.keys(t).length<4||\"string\"!=typeof t.uuid)return;const e=this.sqlite.update({sql:`UPDATE ${t.section} SET text = ?, md5 = ?, prev = ?, next = ? WHERE uuid = ?`,args:[t.text,$text.MD5(t.text),t.prev,t.next,t.uuid]});if(!e.result)throw e.error;this.needUpload()}updateText(t,e,i){if(\"string\"!=typeof e)return;const s=this.sqlite.update({sql:`UPDATE ${t} SET text = ?, md5 = ? WHERE uuid = ?`,args:[i,$text.MD5(i),e]});if(!s.result)throw s.error;this.needUpload()}delete(t,e){this.getByUUID(e);const i=this.sqlite.update({sql:`DELETE FROM ${t} WHERE uuid = ?`,args:[e]});if(!i.result)throw i.error;this.needUpload()}isEmpty(){const t=this.sqlite.query(\"SELECT * FROM clips limit 1\").result,e=this.sqlite.query(\"SELECT * FROM favorite limit 1\").result;return t.next(),e.next(),t.isNull(0)&&e.isNull(0)}allImageFromDb(t=!0){const e=this.sqlite.query(\"\\n            SELECT a.* from\\n            (SELECT *, 'clips' AS section FROM clips WHERE text like \\\"@image=%\\\"\\n            UNION\\n            SELECT *, 'favorite' AS section FROM favorite WHERE text like \\\"@image=%\\\") a\\n            LEFT JOIN tag ON a.uuid = tag.uuid\\n        \"),i=this.parse(e)?.map((t=>{if(t.image){const e=t.fsPath;return e.preview=e.preview.replaceAll(this.imagePath.preview,\"\"),e.preview.startsWith(\"/\")&&(e.preview=e.preview.substring(1)),e.original=e.original.replaceAll(this.imagePath.original,\"\"),e.original.startsWith(\"/\")&&(e.original=e.original.substring(1)),e}})),s=[],n=[];return t||i.forEach((t=>{s.push(t.original),n.push(t.preview)})),t?i:{original:s,preview:n}}localImagesFromFile(){return{original:this.kernel.fileStorage.readSync(this.kernel.storage.imagePath.original),preview:this.kernel.fileStorage.readSync(this.kernel.storage.imagePath.preview)}}setTag(t,e){const i=this.sqlite.update({sql:\"INSERT OR REPLACE INTO tag (uuid, tag) values (?, ?)\",args:[t,e]});if(!i.result)throw i.error;this.needUpload()}deleteTag(t){const e=this.sqlite.update({sql:\"DELETE FROM tag WHERE uuid = ?\",args:[t]});if(!e.result)throw e.error;this.needUpload()}}t.exports={Clip:r,Storage:a}})),s.register(\"7GYtH\",(function(t,e){var i=s(\"gxpqj\").FileStorage,n=s(\"2VUvw\");class r extends n{localSyncDataPath=\"/sync.json\";webdavSyncDataPath=\"/sync.json\";webdavDbPath=\"/CAIO.db\";webdavImagePath=\"/image\";get localDb(){return $data({path:this.kernel.fileStorage.filePath(this.kernel.storage.localDb)})}set localDb(t){this.kernel.fileStorage.writeSync(this.kernel.storage.localDb,t)}get localImagePath(){return this.kernel.fileStorage.filePath(\"/image\")}async init(){await super.init(),await this.initImagePath(),this.sync()}async initImagePath(){if(!await this.webdav.exists(this.webdavImagePath)){await this.webdav.mkdir(this.webdavImagePath);[\"/image/original\",\"/image/preview\"].map((async t=>{await this.webdav.exists(t)||await this.webdav.mkdir(t)}))}}isNew(){return this.kernel.storage.isEmpty()}async webdavImages(){const t=(await this.webdav.ls(this.webdavImagePath,\"infinity\")).rootElement,e=t.firstChild({xPath:\"//D:response/D:href\"}).string,i=[],s=[];return t.children().map((t=>{const n=t.firstChild({tag:\"href\"})?.string?.replaceAll(e,\"\");n.endsWith(\"/\")||(n.startsWith(\"original\")?i.push(n.substring(9)):n.startsWith(\"preview\")&&s.push(n.substring(8)))})),{original:i,preview:s}}async syncImages(){const t=await this.webdavImages(),e=this.kernel.storage.allImageFromDb(!1),s=this.kernel.storage.localImagesFromFile();Object.keys(s).map((t=>{s[t].forEach((async s=>{if(!e[t].includes(s)){const e=i.join(this.kernel.storage.imagePath[t],s);this.kernel.fileStorage.delete(e),this.kernel.logger.info(`Local image deleted: ${e}`)}}))})),Object.keys(e).map((s=>{e[s].forEach((async e=>{const n=i.join(this.webdavImagePath,s,e),r=i.join(this.kernel.storage.imagePath[s],e);if(t[s].includes(e)&&!this.kernel.fileStorage.exists(r)){const t=await this.webdav.get(n);this.kernel.fileStorage.writeSync(r,t.rawData),this.kernel.logger.info(`WebDAV image downloaded: ${r}`)}else if(!t[s].includes(e)){const t=this.kernel.fileStorage.readSync(r);await this.webdav.put(n,t),this.kernel.logger.info(`WebDAV image uploaded: ${n}`)}}))})),Object.keys(t).map((s=>{t[s].forEach((async t=>{if(!e[s].includes(t)){const e=i.join(this.webdavImagePath,s,t);await this.webdav.delete(e),this.kernel.logger.info(`WebDAV image deleted: ${e}`)}}))}))}async pull(){this.webdav.clearNSURLCache();let t=await this.webdav.get(this.webdavDbPath);this.localDb=t.rawData,await this.downloadSyncData(),this.kernel.storage.init(),await this.syncImages(),this.kernel.logger.info(\"clip webdav sync: pulled\")}async push(){await this.webdav.put(this.webdavDbPath,this.localDb),await this.uploadSyncData(),await this.syncImages(),this.kernel.logger.info(\"clip webdav sync: pushed\")}notify(t){$app.notify({name:\"clipSyncStatus\",object:t})}async#u(){let t=!1;try{const e=await this.nextSyncStep();if(this.kernel.logger.info(`clip nextSyncStep: ${n.stepName[e]}`),e===n.step.needPush||e===n.step.init)await this.push();else if(e===n.step.needPull)await this.pull(),t=!0;else{if(e!==n.step.conflict)return void this.notify({status:n.status.nochange});await this.conflict($l10n(\"CLIPS\"))===r.conflictKeep.webdav&&(t=!0)}}catch(t){throw this.notify({status:n.status.fail,error:t}),this.kernel.logger.error(\"clip sync error\"),this.kernel.logger.error(t),t}finally{this.notify({status:n.status.success,updateList:t})}}sync(){this.notify({status:n.status.syncing,animate:!0}),this.syncTimer&&this.syncTimer.cancel(),this.syncTimer=$delay(.5,(()=>{this.#u()}))}needUpload(){this.notify({status:n.status.syncing}),this.uploadTimer&&this.uploadTimer.cancel(),this.uploadTimer=$delay(.5,(()=>{this.updateLocalTimestamp(),this.#u()}))}}t.exports=r})),s.register(\"2VUvw\",(function(t,e){var i=s(\"gxpqj\").WebDAV;class n{static step={init:-1,stay:0,needPush:2,needPull:3,conflict:4};static stepName=(()=>{const t={};return Object.keys(n.step).map((e=>{const i=n.step[e];t[i]=String(e)})),t})();static status={syncing:0,success:1,nochange:2,fail:3};static conflictKeep={local:0,webdav:1,cancel:2};static initLocalTimestamp=0;webdav;kernel;localSyncDataPath;webdavSyncDataPath;constructor({host:t,user:e,password:s,basepath:n,kernel:r}={}){this.kernel=r,this.webdav=new i({host:t,user:e,password:s,basepath:n}),this.webdav.namespace=\"JSBox.CAIO\"}get mustLocalSyncDataPath(){if(!this.localSyncDataPath)throw new Error(\"localSyncDataPath not set\");return this.localSyncDataPath}get mustWebdavSyncDataPath(){if(!this.webdavSyncDataPath)throw new Error(\"webdavSyncDataPath not set\");return this.webdavSyncDataPath}get localSyncData(){return this.kernel.fileStorage.exists(this.mustLocalSyncDataPath)||(this.localSyncData={timestamp:n.initLocalTimestamp}),this.kernel.fileStorage.readSync(this.mustLocalSyncDataPath)}set localSyncData(t){this.kernel.fileStorage.writeSync(this.mustLocalSyncDataPath,$data({string:JSON.stringify(t)}))}get localTimestamp(){return Number(JSON.parse(this.localSyncData.string).timestamp)}set localTimestamp(t){this.localSyncData=Object.assign(this.localSyncData,{timestamp:t})}async init(t=this.webdav.basepath){const e=new i({host:this.webdav.host,user:this.webdav.user,password:this.webdav.password,basepath:t});if(!await e.exists(\"/\"))try{await e.mkdir(\"/\")}catch(e){if(409===e.code)return await this.init(t.substring(0,t.lastIndexOf(\"/\"))),void await this.init(t);throw e}}isNew(){return!1}async webdavSyncData(){this.webdav.clearNSURLCache();let t=(await this.webdav.get(this.mustWebdavSyncDataPath)).data;return\"string\"==typeof t&&(t=JSON.parse(t)),t}async webdavTimestamp(){try{let t=await this.webdavSyncData();return Number(t.timestamp)}catch(t){if(404===t.code)return n.step.init;throw t}}updateLocalTimestamp(){this.localTimestamp!==n.initLocalTimestamp&&(this.localTimestamp=Date.now())}async uploadSyncData(){this.localTimestamp===n.initLocalTimestamp&&(this.localTimestamp=Date.now()),await this.webdav.put(this.mustWebdavSyncDataPath,this.localSyncData)}async downloadSyncData(){this.localSyncData=await this.webdavSyncData()}async nextSyncStep(){const t=this.localTimestamp,e=await this.webdavTimestamp();return e===n.step.init?n.step.init:e===n.initLocalTimestamp?(this.localTimestamp=Date.now(),await this.push(),n.step.stay):t>e?n.step.needPush:t===e?n.step.stay:t<e?this.isNew()||t!==n.initLocalTimestamp?n.step.needPull:n.step.conflict:void 0}async conflict(t=\"\"){const e=[];e[n.conflictKeep.local]=$l10n(\"LOCAL_DATA\"),e[n.conflictKeep.webdav]=$l10n(\"WEBDAV_DATA\"),e[n.conflictKeep.cancel]=$l10n(\"CANCEL\");const i=await $ui.alert({title:$l10n(\"DATA_CONFLICT\"),message:$l10n(\"DATA_CONFLICT_MESSAGE\")+` (${t})`,actions:e});return i.index!==n.conflictKeep.cancel&&(i.index===n.conflictKeep.local?(this.kernel.logger.info(\"conflict resolve: keep local database\"),await this.push()):(this.kernel.logger.info(\"conflict resolve: keep WebDAV database\"),await this.pull())),i.index}}t.exports=n})),s.register(\"4c0o0\",(function(t,e){var i=s(\"gxpqj\"),n=i.View,r=i.UIKit,a=i.Sheet,o=i.NavigationView,l=i.NavigationBar,h=i.Toast,c=s(\"ZnuTV\"),d=s(\"5dzom\"),u=s(\"iGysH\"),p=s(\"a4uPv\"),g=s(\"2VUvw\");t.exports=class extends c{copied=$cache.get(\"clips.copied\")??{};navigationView;constructor(t){super(t),this.views=new u(t),this.delegates=new p(t,this,this.views)}getByIndex(t){return\"object\"==typeof t&&(t=t.row),this.clips[t]}appListen(){r.isTaio||$app.listen({resume:()=>{!this.needReload&&$(this.views.listId).ocValue().$isEditing()||(this.updateList(!0),$delay(.5,(()=>{this.readClipboard()})))},clipSyncStatus:t=>{const e=$(this.views.listId);t.status===g.status.success?(t.updateList&&this.updateList(!0),e&&e.endRefreshing()):t.status===g.status.syncing&&t.animate&&e&&e.beginRefreshing()}})}setDelegate(){this.delegates.setEditingCallback((t=>{this.navigationView.navigationBarItems.getButtons().forEach((e=>{e.id===this.views.listId+\"-navbtn-edit\"?e.setTitle(t?$l10n(\"DONE\"):$l10n(\"EDIT\")):t?e.hide():e.show()}))})),this.delegates.setDelegate()}listReady(){this.setDelegate(),this.updateList(),$delay(.5,(()=>{this.readClipboard()})),r.isTaio||($delay(.5,(()=>{if($context.query.copy){const t=$context.query.copy;this.setCopied(t),$ui.success($l10n(\"COPIED\"))}else $context.query.add?this.getAddTextView():$context.query.actions&&(this.kernel.isUseJsboxNav?this.kernel.actions.present():this.kernel.tabBarController.switchPageTo(\"actions\"))})),this.appListen())}updateList(t=!1){t&&this.setNeedReload(),$(this.views.listId).data=this.clips.map((t=>this.views.lineData(t,this.copied.uuid===t.uuid))),this.updateListBackground()}updateListBackground(){this.clips.length>0?$(this.views.listId).ocValue().$setBackgroundView(void 0):$(this.views.listId).ocValue().$setBackgroundView($ui.create(this.views.getEmptyBackground(this.clips.length>0)))}updateCopied(t=null){const e=this.copied?.uuid;$delay(.3,(()=>{try{const i=$(this.views.listId),s=i.cell($indexPath(0,this.getIndexByUUID(e)));s&&(s.get(\"copied\").hidden=!0),t&&(i.cell($indexPath(0,this.getIndexByUUID(t.uuid))).get(\"copied\").hidden=!1)}catch(t){this.kernel.logger.error(\"set copied error\"),this.kernel.logger.error(t)}})),t?Object.assign(this.copied,t):this.copied={},this.kernel.logger.info(`this.copied: ${JSON.stringify(this.copied,null,2)}`),$cache.set(\"clips.copied\",this.copied)}setCopied(t){if(!t||t===this.copied.uuid&&this.tabIndex===this.copied?.tabIndex)return;let e={};this.copied.uuid!==t&&(e=this.getClip(t)??{}),e.tabIndex=this.tabIndex,this.updateCopied(e),this.setClipboardText(e.text)}clearCopied(){const t=$(this.views.listId).cell($indexPath(0,this.getIndexByUUID(this.copied.uuid)));t&&(t.get(\"copied\").hidden=!0),this.updateCopied(null)}async readClipboard(t=!1){if(t||this.kernel.setting.get(\"clipboard.autoSave\")){if(this.kernel.logger.info(\"read clipboard\"),!t&&!this.isPasteboardChanged)return;if($clipboard.images?.length>0)return t?(await $wait(.1),void $clipboard.images.forEach((t=>{this.add(t)}))):void 0;const e=$clipboard.text;if(!e||\"\"===e)return void this.clearCopied();if(this.getClip(this.copied?.uuid)?.text===e)return void(t&&$ui.toast($l10n(\"CLIPBOARD_NO_CHANGE\")));if(this.exists(e)){const t=this.kernel.storage.getByMD5($text.MD5(e));this.switchTab(this.tabItemsMap[t.section],!0),this.setCopied(t.uuid)}else{this.switchTab(1,!0);const t=this.add(e);this.setCopied(t.uuid)}}}add(t,e=!0){try{const i=super.addItem(t);if(!e)return;return this.updateListBackground(),$(this.views.listId).insert({indexPath:$indexPath(0,0),value:this.views.lineData(i)}),i}catch(t){$ui.alert(t)}}delete(t){try{super.deleteItem(t),this.copied.uuid===t&&(this.updateCopied(null),$clipboard.clear()),this.updateListBackground()}catch(t){$ui.alert(t)}}update(t,e){try{return super.updateItem(t,e),this.updateList(),e===this.copied.uuid&&this.setClipboardText(t),!0}catch(t){return $ui.alert(t),!1}}favorite(t){const e=this.getByIndex(t);if(\"favorite\"===e?.section)return;const i=this.kernel.storage.getByUUID(e.uuid);if(\"favorite\"!==i?.section)try{super.favoriteItem(e.uuid),$(this.views.listId).delete(t)}catch(t){$ui.alert(t)}else h.warning(\"Already exists\")}copy(t){const e=this.getClip(t);if(e.image?$clipboard.image=e.imageOriginal:this.setCopied(t),0!==this.tabIndex){const e=this.getIndexByUUID(t),i=0;try{super.moveItem(e,i);const t=$(this.views.listId).ocValue(),s=$indexPath(0,e).ocValue(),n=$indexPath(0,i).ocValue();t.$moveRowAtIndexPath_toIndexPath(s,n)}catch(t){$ui.alert(t)}}}getAddTextView(){this.views.edit(\"\",(t=>{\"\"!==t&&this.add(t)}))}switchTab(t,e=!1){this.tabIndex=t,this.updateList(),e&&($(this.views.listId+\"-tab\").index=this.tabIndex),this.delegates.setEditing(!1)}getTabView(){return this.views.tabView(this.tabItems,this.tabIndex,{changed:t=>this.switchTab(t.index)})}getListView(){return this.views.getListView(this.views.listId,[],{ready:()=>this.listReady(),pulled:t=>{this.updateList(!0),this.kernel.storage.sync(),this.kernel.setting.get(\"webdav.status\")||$delay(.5,(()=>t.endRefreshing()))}})}getNavigationView(){const t=new d(this.kernel);t.setCallback((e=>{const i=new a;i.setView((t=>{const{keyword:e,result:s,isTagKeyword:n}=t;return this.views.getListView(this.views.listId+\"-search-result\",s.map((t=>{const i=n?t.tag:t.text;let s=[];return e.forEach((t=>{let e=i.indexOf(t);for(;e>-1;)s.push({range:$range(e,t.length),color:$color(\"red\")}),e=i.indexOf(t,e+1)})),t.styledText={},n?t.tagStyledText={color:this.views.tagColor,text:i,styles:s}:t.textStyledText={text:i,styles:s},this.views.lineData(t,!1)})),{ready:()=>this.updateList(),didSelect:(t,e)=>{const n=s[e.row];n.image?a.quickLookImage(n.imageOriginal):(i.dismiss(),this.views.edit(n.text,(t=>{n.md5!==$text.MD5(t)&&this.update(t,n.uuid)})))},rowHeight:(t,e)=>{const i=s[e.row],n=i?.hasTag?this.views.tagHeight:this.views.verticalMargin,r=i.image?this.views.imageContentHeight:this.getContentHeight(i.text);return this.views.verticalMargin+r+n}})})(e)).addNavBar({title:$l10n(\"SEARCH_RESULT\"),popButton:{title:$l10n(\"DONE\"),tapped:()=>t.dismiss()}}).init().present()}));const e=this.getTabView();e.type=\"menu\",e.layout=(t,e)=>{t.left.right.equalTo(e.super),t.height.equalTo(this.views.tabHeight),this.kernel.isUseJsboxNav&&r.isTaio?t.top.equalTo(e.super).offset(r.PageSheetNavigationBarNormalHeight):t.top.equalTo(e.super)};const i=n.createFromViews([e,this.getListView(),t.getSearchHistoryView()]);return this.navigationView=(new o).navigationBarTitle($l10n(\"CLIPS\")).setView(i),this.navigationView.navigationBarItems.setTitleView(t.getSearchBarView()).pinTitleView().setRightButtons([{symbol:\"plus.circle\",tapped:()=>this.getAddTextView()}]).setLeftButtons([{id:this.views.listId+\"-navbtn-edit\",title:$l10n(\"EDIT\"),tapped:()=>this.delegates.setEditing()},{symbol:\"square.and.arrow.down.on.square\",tapped:async t=>{t.start();try{await this.readClipboard(!0),t.done()}catch(e){t.cancel(),this.kernel.logger.error(e)}}}]),this.navigationView.navigationBar.setBackgroundColor(r.primaryViewBackgroundColor).setLargeTitleDisplayMode(l.largeTitleDisplayModeNever),this.kernel.isUseJsboxNav&&this.navigationView.navigationBar.removeTopSafeArea(),this.navigationView}}})),s.register(\"ZnuTV\",(function(t,e){var i=s(\"gxpqj\").UIKit,n=s(\"jEwwi\").Clip;t.exports=class{kernel;pasteboard=$objc(\"UIPasteboard\").$generalPasteboard();#p=[];clipsUUIDMap={};clipsMD5Map={};rememberTabIndex=!0;#g=0;tabItems=[$l10n(\"FAVORITE\"),$l10n(\"CLIPS\")];tabItemsIndex=[\"favorite\",\"clips\"];tabItemsMap=function(t){const e={};return t.forEach(((t,i)=>{e[t]=i})),e}(this.tabItemsIndex);constructor(t){this.kernel=t}get tabIndex(){return this.rememberTabIndex?$cache.get(\"caio.main.tab.index\")??0:this.#g}set tabIndex(t){this.rememberTabIndex?$cache.set(\"caio.main.tab.index\",t):this.#g=t}get table(){return this.tabItemsIndex[this.tabIndex]}get tableL10n(){return this.tabItems[this.tabIndex]}get allClips(){return this.tabItemsIndex.forEach(((t,e)=>{this.#p[e]||(this.#p[e]=this.#f(t),this.kernel.logger.info(`init clips: ${t}`))})),this.#p}get clips(){return this.#p[this.tabIndex]||(this.#p[this.tabIndex]=this.#f(this.table),this.kernel.logger.info(`init clips: ${this.table}`)),this.#p[this.tabIndex]}get isPasteboardChanged(){const t=this.pasteboard.$changeCount(),e=$cache.get(\"clipboard.changeCount\");return $cache.set(\"clipboard.changeCount\",t),e!==t}get needReload(){return $cache.get(\"caio.needReload\")??!1}set needReload(t){$cache.get(\"caio.needReload\",t)}#f(t){try{const e=this.kernel.storage.all(t),i=this.kernel.storage.sort(e,this.kernel.setting.get(\"clipboard.maxItemLength\"));return i.forEach(((e,i)=>{this.clipsMD5Map[e.md5]=!0,this.clipsUUIDMap[e.uuid]={tab:t,index:i}})),this.#w(i)}catch(t){this.kernel.logger.error(t),this.rebuildDatabase()}}#w(t){return new Proxy(t??[],{set:(t,e,i)=>Reflect.set(t,e,i),get:(t,e)=>Reflect.get(t,e)})}rebuildDatabase(){$ui.alert({title:$l10n(\"REBUILD_DATABASE\"),message:$l10n(\"CLIPS_STRUCTURE_ERROR\"),actions:[{title:$l10n(\"OK\"),handler:()=>{const t=i.loading();t.start(),this.kernel.storage.rebuild(),t.end(),$delay(.8,(()=>$addin.restart()))}},{title:$l10n(\"CANCEL\")}]})}setNeedReload(t){t?this.#p[this.tabItemsMap[t]]=null:this.#p=[],this.needReload=!0,this.kernel.logger.info(`set need reload: ${t??\"all\"}`)}getClipCopy(t,e={}){if(!t.uuid)return t;const i=new n(t);return i.fileStorage=t.fileStorage,Object.assign(i,e),i}getIndexByUUID(t){return this.clipsUUIDMap[t]?.index??-1}getClip(t){const e=this.clips[this.getIndexByUUID(t)];return e||this.kernel.storage.getByUUID(t)}exists(t){return 0===Object.keys(this.clipsMD5Map).length&&this.clips,Boolean(this.clipsMD5Map[$text.MD5(t)])}setClipboardText(t){this.kernel.setting.get(\"clipboard.universal\")?$clipboard.text=t:$clipboard.setTextLocalOnly(t)}addItem(t){if(this.exists(t))throw new Error(\"Item already exists\");const e=new n({uuid:$text.uuid,section:this.table,md5:null,prev:null,next:this.clips[0]?this.clips[0].uuid:null});if(\"string\"==typeof t){if(\"\"===t.trim())return;e.text=t}else{if(\"object\"!=typeof t)return;e.fileStorage=this.kernel.fileStorage,e.text=this.kernel.storage.saveImage(t)}try{return this.kernel.storage.beginTransaction(),this.kernel.storage.insert(e),e.next&&(this.clips[0].prev=e.uuid,this.kernel.storage.update(this.clips[0])),this.kernel.storage.commit(),this.setNeedReload(this.table),e}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}getRecycleBin(){return $cache.get(\"caio.recycleBin\")??[]}moveToRecycleBin(t){const e=this.getRecycleBin();e.push({text:t.text,tag:t.tag}),$cache.set(\"caio.recycleBin\",e)}removeFromRecycleBin(t){const e=this.getRecycleBin();e.splice(t,1),$cache.set(\"caio.recycleBin\",e)}clearRecycleBin(){$cache.set(\"caio.recycleBin\",[])}deleteItem(t,e=!0){const i=this.getIndexByUUID(t),s=this.clips[i],n=this.clips[i-1],r=this.clips[i+1];try{this.kernel.storage.beginTransaction(),this.kernel.storage.delete(this.table,t),n&&(n.next=s.next,this.kernel.storage.update(n)),r&&(r.prev=s.prev,this.kernel.storage.update(r)),this.kernel.storage.commit(),e&&(this.kernel.storage.deleteTag(t),s?.image?(this.kernel.fileStorage.delete(s.fsPath.original),this.kernel.fileStorage.delete(s.fsPath.preview)):this.moveToRecycleBin(s)),this.setNeedReload(this.table)}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}updateItem(t,e){const i=$text.MD5(t),s=this.getClip(e);delete this.clipsMD5Map[s.md5],this.clipsMD5Map[i]=!0;const n=s.text;Object.assign(s,{text:t,md5:i});try{this.kernel.storage.updateText(this.table,s.uuid,t),this.kernel.logger.info(`data changed at index [${this.getIndexByUUID(e)}]\\n${n}\\n↓\\n${t}`)}catch(t){throw this.kernel.logger.error(t),t}}moveItem(t,e){if(t!==e&&1!==this.clips.length){t<e&&e++,this.clips[e]||(this.clips[e]={uuid:null,text:\"\",hasTag:!1,image:null,next:null,prev:this.clips[e-1].uuid});try{this.kernel.storage.beginTransaction();const i=this.getClipCopy(this.clips[t]),s=this.getClipCopy(this.clips[e]);if(this.clips[t-1]){const e=this.getClipCopy(this.clips[t-1],{next:this.clips[t].next});this.kernel.storage.update(e),this.clips[t-1]=e}if(this.clips[t+1]){const e=this.getClipCopy(this.clips[t+1],{prev:this.clips[t].prev});this.kernel.storage.update(e),this.clips[t+1]=e}if(this.clips[e-1]){const i=this.getClipCopy(this.clips[e-1],{next:this.clips[t].uuid});this.kernel.storage.update(i),this.clips[e-1]=i}const n=this.getClipCopy(s,{prev:i.uuid,next:this.clips[e].next});this.kernel.storage.update(n);const r=this.getClipCopy(i,{prev:this.clips[e].prev,next:s.uuid});this.kernel.storage.update(r),this.kernel.storage.commit()}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}finally{this.setNeedReload(this.table)}}}favoriteItem(t){const e=this.getClipCopy(this.getClip(t),{next:this.allClips[0][0]?.uuid??null,prev:null,section:\"favorite\"});try{this.kernel.storage.beginTransaction(),this.kernel.storage.insert(e),e.next&&(this.allClips[0][0].prev=e.uuid,this.allClips[0][0].section=\"favorite\",this.kernel.storage.update(this.allClips[0][0])),this.kernel.storage.commit(),this.deleteItem(e.uuid,!1),this.setNeedReload()}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}}})),s.register(\"5dzom\",(function(t,e){var i=s(\"gxpqj\"),n=i.UIKit,r=i.SearchBar;t.exports=class{listId=$text.uuid;kernel;callback=()=>{};onBegin=()=>{};onDismiss=()=>{};constructor(t){this.kernel=t,this.searchBar=new r,this.searchBarId=this.searchBar.id+\"-input\"}get searchHistoryView(){return{hide:()=>$(this.listId+\"-history\").hidden=!0,show:()=>$(this.listId+\"-history\").hidden=!1}}get searchHistory(){return[{title:$l10n(\"SEARCH_HISTORY\"),rows:$cache.get(\"caio.search.history\")?.reverse()??[]}]}getAccessoryView(){return n.blurBox({height:50},[{type:\"button\",props:{bgcolor:$color(\"clear\"),tintColor:$color(\"primaryText\"),symbol:\"xmark.circle\"},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(e.super),t.width.equalTo(e.super.height)},events:{tapped:()=>this.dismiss()}},{type:\"button\",props:{bgcolor:$color(\"clear\"),tintColor:$color(\"primaryText\"),symbol:\"keyboard.chevron.compact.down\"},layout:(t,e)=>{t.right.equalTo(e.prev.left),t.height.equalTo(e.super),t.width.equalTo(e.super.height)},events:{tapped:()=>$(this.searchBarId).blur()}}])}getSearchHistoryView(){return{type:\"list\",props:{id:this.listId+\"-history\",hidden:!0,stickyHeader:!0,data:this.searchHistory,separatorInset:$insets(0,13,0,0),actions:[{title:$l10n(\"DELETE\"),handler:(t,e)=>{const i=t.data;this.updateSearchHistory(i[0].rows.reverse())}}]},events:{didSelect:(t,e,i)=>{this.searchAction(i),$(this.searchBarId).text=i}},layout:$layout.fill}}setCallback(t){this.callback=t}setOnBegin(t){this.onBegin=t}setOnDismiss(t){this.onDismiss=t}begin(){this.searchHistoryView.show(),this.onBegin()}dismiss(){this.searchBar.cancel()}async searchAction(t){try{if(\"\"!==t){let e,i=t.startsWith(\"#\");e=i?this.kernel.storage.searchByTag(t.substring(1)):await this.kernel.storage.search(t);const{result:s,keyword:n}=e;s&&s.length>0?($(this.searchBarId).blur(),this.callback({keyword:n,result:s,isTagKeyword:i})):$ui.toast($l10n(\"NO_SEARCH_RESULT\")),this.pushSearchHistory(t)}}catch(t){throw t}}pushSearchHistory(t){let e=$cache.get(\"caio.search.history\")??[];-1===e.indexOf(t)&&(e.push(t),e.length>20&&(e=e.slice(-20)),$cache.set(\"caio.search.history\",e),$(this.listId+\"-history\").data=this.searchHistory)}updateSearchHistory(t=[]){$cache.set(\"caio.search.history\",t)}getSearchBarView(){return this.searchBar.controller.setEvent(\"onReturn\",(t=>{\"\"!==t?this.searchAction(t):this.searchHistoryView.show()})),this.searchBar.controller.setEvent(\"onChange\",(t=>{\"\"===t&&this.searchHistoryView.show()})),this.searchBar.controller.setEvent(\"onBeginEditing\",(t=>{\"\"===t&&this.begin()})),this.searchBar.controller.setEvent(\"onCancel\",(()=>{this.searchHistoryView.hide(),this.onDismiss()})),this.searchBar.setAccessoryView(this.getAccessoryView()),this.searchBar}}})),s.register(\"iGysH\",(function(t,e){var i=s(\"gxpqj\"),n=i.UIKit,r=i.ViewController,a=s(\"f0nX9\");t.exports=class{listId=$text.uuid;editingToolBarId=this.listId+\"-edit-mode-tool-bar\";#m=!1;#y=0;tabLeftMargin=20;horizontalMargin=20;verticalMargin=14;containerMargin=0;fontSize=16;copiedIndicatorSize=6;imageContentHeight=50;tagHeight=this.verticalMargin+5;tagColor=$color(\"lightGray\");tabHeight=44;editModeToolBarHeight=44;#$={};viewController;constructor(t){this.kernel=t,this.viewController=new r}get singleLineContentHeight(){return 0===this.#y&&(this.#y=this.getTextHeight($font(this.fontSize))),this.#y}setSingleLine(){this.#m=!0,this.imageContentHeight=this.singleLineContentHeight,this.#y=0}getTextHeight(t,e=\"a\"){return $text.sizeThatFits({text:e,font:t,width:n.windowSize.width-2*(this.horizontalMargin+this.containerMargin)}).height}getContentHeight(t){return this.#$[t]||(this.#$[t]=this.#m?this.singleLineContentHeight:Math.min(this.getTextHeight($font(this.fontSize),t),2*this.singleLineContentHeight)),this.#$[t]}edit(t,e){const i=new a(this.kernel),s=[{symbol:\"square.and.arrow.up\",tapped:()=>{i.text?$share.sheet(i.text):$ui.warning($l10n(\"NONE\"))}}];if(this.kernel.isUseJsboxNav)i.uikitPush(t,(t=>e(t)),s);else{const n=i.getNavigationView(t,(t=>e(t)),s);this.viewController.push(n)}}tabView(t,e,i){return{type:\"tab\",props:{id:this.listId+\"-tab\",items:t,index:e,dynamicWidth:!0},events:i,layout:(t,e)=>{t.centerY.equalTo(e.super),e.prev?t.left.equalTo(e.prev.right).offset(this.tabLeftMargin):t.left.inset(this.tabLeftMargin)}}}lineData(t,e=!1){const i={hidden:!0},s={text:\"\"},n={hidden:!t?.hasTag};return t.image?(i.src=t.imagePath.preview,i.hidden=!1):(t.textStyledText?s.styledText=t.textStyledText:s.text=t.text,t.tagStyledText?n.styledText=t.tagStyledText:n.text=t.tag),{copied:{hidden:!e},image:i,tag:n,content:s}}listTemplate(){return{props:{bgcolor:$color(\"clear\")},views:[{type:\"view\",views:[{type:\"view\",props:{id:\"copied\",circular:this.copiedIndicatorSize,hidden:!0,bgcolor:$color(\"green\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.size.equalTo(this.copiedIndicatorSize),t.left.equalTo(e.super).inset(this.horizontalMargin/2-this.copiedIndicatorSize/2)}},{type:\"label\",props:{id:\"content\",lines:this.#m?1:2,font:$font(this.fontSize)},layout:(t,e)=>{t.left.right.equalTo(e.super).inset(this.horizontalMargin),t.top.equalTo(this.verticalMargin)}},{type:\"label\",props:{id:\"tag\",lines:1,color:this.tagColor,autoFontSize:!0,align:$align.leading},layout:(t,e)=>{t.bottom.equalTo(e.super),t.left.right.equalTo(e.prev),t.height.equalTo(this.tagHeight)}}],layout:$layout.fill},{type:\"image\",props:{id:\"image\",hidden:!0},layout:$layout.fill}]}}getEmptyBackground(t=!1){return{type:\"label\",props:{color:$color(\"secondaryText\"),hidden:t,text:$l10n(\"NONE\"),align:$align.center},events:{ready:t=>{t.layout(((t,e)=>{t.top.equalTo(this.tabHeight),t.left.right.bottom.equalTo(e.super)}))}}}}getListEditModeToolBarView({selectButtonEvents:t,deleteButtonEvents:e}={}){return n.blurBox({id:this.editingToolBarId},[n.separatorLine(),{type:\"view\",views:[{type:\"button\",props:{id:this.editingToolBarId+\"-select-button\",title:$l10n(\"SELECT_ALL\"),titleColor:$color(\"tint\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.left.inset(this.horizontalMargin),t.centerY.equalTo(e.super)},events:t},{type:\"button\",props:{id:this.editingToolBarId+\"-delete-button\",symbol:\"trash\",hidden:!0,tintColor:$color(\"red\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.height.equalTo(e.super),t.width.equalTo(2*this.horizontalMargin),t.right.inset(this.horizontalMargin/2),t.centerY.equalTo(e.super)},events:e}],layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom)}}])}getListView(t=this.listId,e=[],i){return{type:\"list\",props:{id:t,associateWithNavigationBar:!1,bgcolor:$color(\"clear\"),separatorInset:$insets(0,this.horizontalMargin,0,0),data:e,allowsMultipleSelectionDuringEditing:!0,template:this.listTemplate(),backgroundView:$ui.create(this.getEmptyBackground())},events:i,layout:(t,e)=>{e.prev?t.top.equalTo(e.prev.bottom):t.top.equalTo(e.super),t.left.right.bottom.equalTo(e.super)}}}}})),s.register(\"f0nX9\",(function(t,e){var i=s(\"gxpqj\"),n=i.UIKit,r=i.NavigationBar,a=i.NavigationView,o=i.Sheet,l=s(\"eSp9Z\"),h=l.ActionEnv,c=l.ActionData;t.exports=class{#h=\"\";originalContent;constructor(t){this.kernel=t,this.id=\"editor\"}set text(t=\"\"){void 0===this.originalContent&&(this.originalContent=t),this.#h=t}get text(){return this.#h}getActionButton(){return{symbol:\"bolt.circle\",tapped:(t,e)=>{e&&(t=e);const i=$(this.id).selectedRange,s=new c({env:h.editor,editor:{originalContent:this.originalContent,setContent:t=>this.setContent(t)},text:i.length>0?this.text.slice(i.location,i.location+i.length):this.text,allText:this.text,selectedText:this.text.slice(i.location,i.location+i.length),selectedRange:i}),n=$ui.popover({sourceView:t,directions:$popoverDirection.up,size:$size(200,300),views:[this.kernel.actions.views.getActionListView((t=>{n.dismiss(),$delay(.5,(()=>t(s)))}))]})}}}setContent(t){this.text=t,$(this.id).text=t}getView(t=\"text\"){return{type:t,layout:$layout.fill,props:{id:this.id,lineNumbers:this.kernel.setting.get(\"editor.code.lineNumbers\"),theme:this.kernel.setting.get($device.isDarkMode?\"editor.code.darkTheme\":\"editor.code.lightTheme\"),text:this.text,insets:$insets(15,15,\"text\"===t?this.kernel.setting.get(\"editor.text.insets\"):15,15)},events:{ready:t=>{\"\"===this.text&&$delay(.5,(()=>t.focus()))},didChange:t=>{this.text=t.text}}}}pageSheet(t=\"\",e,i,s=[],n=\"text\"){this.text=t,s.unshift(this.getActionButton());const r=new o;r.setView(this.getView(n)).addNavBar({title:i,popButton:{title:$l10n(\"DONE\"),tapped:()=>e(this.text)},rightButtons:s}).init(),r.navigationView.navigationBar.contentViewHeightOffset=0,r.present()}getViewController(t,e){return $define({type:\"EditorViewController: UIViewController\",events:{viewDidLoad:()=>{self.$super().$viewDidLoad(),self.$view().jsValue().add(this.getView(t));self.$navigationItem().$setLargeTitleDisplayMode(2)},\"viewDidDisappear:\":t=>{e()}}}),$objc(\"EditorViewController\").$new()}uikitPush(t=\"\",e,i=[],s=\"text\"){this.text=t,i.unshift(this.getActionButton()),n.push({title:\"\",navButtons:i.map((t=>(t.handler=t.tapped,t.tapped=void 0,t))),views:[this.getView(s)],disappeared:()=>e(this.text)})}getNavigationView(t=\"\",e,i=[],s=\"text\"){this.text=t,i.unshift(this.getActionButton());const n=new a;return n.navigationBar.contentViewHeightOffset=0,n.navigationBar.setLargeTitleDisplayMode(r.largeTitleDisplayModeNever),n.navigationBarItems.setRightButtons(i),n.setView(this.getView(s)).navigationBarTitle(\"\"),n.setEvent(\"onPop\",(()=>e(this.text))),n}}})),s.register(\"eSp9Z\",(function(t,e){var i=s(\"gxpqj\"),n=i.L10n,r=i.Sheet,a=s(\"jVlss\").SecureFunction;class o{static build=-1;static today=0;static editor=1;static clipboard=2;static action=3;static keyboard=4}class l{env;args;text;allText;section;uuid;selectedRange;selectedText;textBeforeInput;textAfterInput;editor;constructor({env:t,args:e,text:i,allText:s=null,section:n=null,uuid:r=null,selectedRange:a=null,selectedText:o=null,textBeforeInput:l=null,textAfterInput:h=null,editor:c=null}={}){this.env=t,this.args=e,this.text=i,this.allText=s??i,this.section=n,this.uuid=r,this.selectedRange=a,this.selectedText=o,this.textBeforeInput=l,this.textAfterInput=h,this.editor=c}}t.exports={ActionEnv:o,ActionData:l,Action:class{#v;secureFunction;constructor(t,e,i){this.#v=t,this.config=e,this.secureFunction=new a(this.#v,this.config),i.env===o.build&&((i=this.preview()).env=o.build),Object.assign(this,i),this.originalContent=String(this.text);const s=this.l10n();Object.keys(s).forEach((t=>{n.add(t,s[t])}))}preview(){return new l({env:o.build})}l10n(){return{}}pageSheet({view:t,title:e=\"\",done:i,doneText:s=$l10n(\"DONE\"),rightButtons:n=[]}){(new r).setView(t).addNavBar({title:e,popButton:{title:s,tapped:()=>{i&&i()}},rightButtons:n}).init().present()}quickLookImage(t){r.quickLookImage(t)}getAllClips(){return{favorite:this.#v.storage.all(\"favorite\").map((t=>t.text)),clips:this.#v.storage.all(\"clips\").map((t=>t.text))}}async clearAllClips(){if(0!==(await $ui.alert({title:$l10n(\"DELETE_DATA\"),message:$l10n(\"DELETE_TABLE\").replaceAll(\"${table}\",$l10n(\"CLIPS\")),actions:[{title:$l10n(\"DELETE\"),style:$alertActionType.destructive},{title:$l10n(\"CANCEL\")}]})).index)return!1;try{return this.#v.storage.deleteTable(\"clips\"),!0}catch(t){throw this.#v.logger.error(t),t}}setContent(t){this.text=t,this.env===o.editor?this.editor.setContent(t):this.env===o.clipboard&&(this.#v.storage.updateText(this.section,this.uuid,t),this.#v.clips.updateList(!0))}getAction(t,e,i){const s=this.#v.actions.getActionDirByName(e);return this.#v.actions.getAction(t,s,i)}async runAction(t,e){const i=this.getAction(t,e);return await i.do()}async request(t,e,i,s){return this.secureFunction.http.request({url:t,method:e,body:i,header:s,timeout:3})}getUrls(){return(this.text??\"\").match(/(https?:\\/\\/)([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([:0-9])*([\\/\\w\\#\\.\\-\\?\\=\\&])*\\s?/gi)??[]}}}})),s.register(\"jVlss\",(function(t,e){class i{#v;#b;notAllowed='\"The parameter or method is not allowed in Action.\"';constructor(t,e){if(this.#v=t,this.#b=JSON.parse(JSON.stringify(e)),!this.#b?.name||\"undefined\"===this.#b?.name)throw new Error(\"Cannot get Action name.\")}get name(){return this.#b.name}set name(t){const e=$l10n(\"ACTION_RESET_NAME_WARNING\").replaceAll(\"${name}\",this.name).replaceAll(\"${to_name}\",t);throw $ui.alert({title:$l10n(\"ACTION_SAFETY_WARNING\"),message:e}),new Error(e)}info(t){this.#v.logger.info(t)}error(t){this.#v.logger.error(t)}}class s extends i{rootPath=this.notAllowed;extensions=this.notAllowed;read(){throw new Error(this.notAllowed)}async download(){throw new Error(this.notAllowed)}write(){throw new Error(this.notAllowed)}delete(){throw new Error(this.notAllowed)}list(){throw new Error(this.notAllowed)}copy(){throw new Error(this.notAllowed)}move(){throw new Error(this.notAllowed)}mkdir(){throw new Error(this.notAllowed)}exists(){throw new Error(this.notAllowed)}isDirectory(){throw new Error(this.notAllowed)}merge(){throw new Error(this.notAllowed)}absolutePath(){throw new Error(this.notAllowed)}}class n extends i{#T=\"ActionHttpPermission\";get#E(){const t=$cache.get(this.#T);return t||(this.#E={},{})}set#E(t={}){return $cache.set(this.#T,t)}async#A(){if(0===(await $ui.alert({title:$l10n(\"ACTION_PERMISSION_REQUEST\"),message:$l10n(\"ACTION_NETWORK_PERMISSION_MESSAGE\").replaceAll(\"${name}\",this.name),actions:[{title:$l10n(\"OK\"),style:$alertActionType.destructive},{title:$l10n(\"CANCEL\")}]})).index){const t=this.#E;return t[this.name]=!0,this.#E=t,!0}return!1}async#S(){const t=this.#E;return\"boolean\"==typeof t[this.name]?t[this.name]:!!await this.#A()}async request(t={}){try{if(!await this.#S())throw new Error(\"No network permission.\");this.info(`sending request [${t.method}]: ${t.url}`);const e=await $http.request(Object.assign({timeout:3},t));if(\"function\"==typeof t?.handler&&t?.handler(e),e.error)throw e.error;if(e?.response?.statusCode>=400){let t=e.data;throw\"object\"==typeof t&&(t=JSON.stringify(t)),new Error(\"Http error: [\"+e.response.statusCode+\"] \"+t)}return e}catch(t){throw t.code&&(t=new Error(\"Network error: [\"+t.code+\"] \"+t.localizedDescription)),this.error(`Action request error: ${this.name}`),this.error(t),t}}async get(t){return\"string\"==typeof t&&(t={url:t}),t.method=\"GET\",await this.request(t)}async post(t){return\"string\"==typeof t&&(t={url:t}),t.method=\"POST\",await this.request(t)}async download(){throw new Error(this.notAllowed)}async upload(){throw new Error(this.notAllowed)}async startServer(){throw new Error(this.notAllowed)}async stopServer(){throw new Error(this.notAllowed)}async shorten(t){return await $http.shorten(t)}async lengthen(t){return await $http.lengthen(t)}}t.exports={SecureFunction:class extends i{constructor(...t){super(...t),this.file=new s(...t),this.http=new n(...t)}addin(){throw new Error(this.notAllowed)}},SecureScript:class{script;sf=\"this.secureFunction\";constructor(t){this.script=t}#I(t,e){this.script=this.script.replaceAll(t,e)}replaceEval(){this.#I(/\\$addin\\.*[a-zA-Z0-9\\[\\]'\"`]+/gi,`${this.sf}.addin()`),this.#I(\"eval\",`${this.sf}.addin()`)}replaceFile(){this.#I(\"$file\",`${this.sf}.file`)}replaceHttp(){this.#I(\"$http\",`${this.sf}.http`)}secure(){return this.replaceEval(),this.replaceFile(),this.replaceHttp(),this.script}}}})),s.register(\"a4uPv\",(function(t,e){var i=s(\"gxpqj\"),n=i.UIKit,r=i.Sheet,a=s(\"eSp9Z\"),o=a.ActionData,l=a.ActionEnv;t.exports=class{#x;menuItemActionMaxCount=5;placeholderReuseIdentifier=\"UITableViewPlaceholderReuseIdentifier\";isCollectionView=!1;constructor(t,e,i){this.kernel=t,this.data=e,this.views=i}initReuseIdentifier(t){if(!t.$dequeueReusableCellWithIdentifier(this.placeholderReuseIdentifier)){const e=$objc(\"UITableViewCell\").$class();t.$registerClass_forCellReuseIdentifier(e,this.placeholderReuseIdentifier)}}get listSelected(){const t=$(this.views.listId)?.ocValue()?.$indexPathsForSelectedRows()?.jsValue();return Array.isArray(t)?t:[]}get defaultMenuItems(){return[{inline:!0,items:[{title:$l10n(\"TAG\"),symbol:\"tag\",handler:(t,e)=>{const i=this.data.getByIndex(e);$input.text({placeholder:$l10n(\"ADD_TAG\"),text:i.tag,handler:t=>{(t=t.trim()).length>0?this.kernel.storage.setTag(i.uuid,t):this.kernel.storage.deleteTag(i.uuid),this.data.updateList(!0)}})}}]},{inline:!0,items:[{title:$l10n(\"SHARE\"),symbol:\"square.and.arrow.up\",handler:(t,e)=>{const i=this.data.getByIndex(e);$share.sheet(i.image?i.imageOriginal:i.text)}},{title:$l10n(\"COPY\"),symbol:\"square.on.square\",handler:(t,e)=>this.data.copy(this.data.getByIndex(e).uuid)},{title:$l10n(\"DELETE\"),symbol:\"trash\",destructive:!0,items:[{title:$l10n(\"CONFIRM\"),destructive:!0,handler:(t,e)=>{t.delete(e),this.data.delete(this.data.getByIndex(e).uuid),$delay(.25,(()=>t.reload()))}}]}]}]}get menu(){const t=t=>{const e=this.kernel.actions.getActionHandler(t.type,t.dir);return t.handler=(t,i)=>{const s=this.data.getByIndex(i),n=new o({env:l.clipboard,text:s.text,section:s.section,uuid:s.uuid});e(n)},t.title=t.name,t.symbol=t.icon,t},e=this.kernel.actions.getActions(\"clipboard\"),i={inline:!0,items:e.slice(0,this.menuItemActionMaxCount).map(t)};return e.length>this.menuItemActionMaxCount&&i.items.push({title:$l10n(\"MORE_ACTIONS\"),symbol:\"square.grid.2x2\",items:e.slice(this.menuItemActionMaxCount).map(t)}),{items:[i,...this.defaultMenuItems]}}setEditingCallback(t){this.#x=t}createUIMenu=({title:t,image:e,actions:i,inline:s=!1,destructive:n=!1}={})=>{let r;return s&&(r|=1),n&&(r|=2),$objc(\"UIMenu\").$menuWithTitle_image_identifier_options_children(t??\"\",e,null,r??0,i)};createUIAction=({title:t,image:e,handler:i,destructive:s=!1}={})=>{const n=$objc(\"UIAction\").$actionWithTitle_image_identifier_handler(t,e,null,$block(\"void, UIAction *\",(t=>{i(t)})));return s&&n.$setAttributes(2),n};createUIContextualAction=({title:t,handler:e,color:i,image:s,destructive:n=!1}={})=>{const r=$objc(\"UIContextualAction\").$contextualActionWithStyle_title_handler(n?1:0,t,$block(\"void, UIContextualAction *, UIView *, block\",(async(t,i,s)=>{s=t=>{t&&$(this.views.listId).ocValue().$setEditing_animated(!1,!0)},await e(t,i,s)})));return i&&r.$setBackgroundColor(i),s&&r.$setImage(s),r};createUITableViewDropPlaceholder(t){const e=$objc(\"UITableViewDropPlaceholder\").$alloc(),i=2*this.views.verticalMargin+this.views.getContentHeight(\"A\");return e.$initWithInsertionIndexPath_reuseIdentifier_rowHeight(t,this.placeholderReuseIdentifier,i),e}updateEditingToolBar(){const t=0===this.listSelected.length,e=$(this.views.editingToolBarId+\"-select-button\"),i=$(this.views.editingToolBarId+\"-delete-button\");e.title=t?$l10n(\"SELECT_ALL\"):$l10n(\"DESELECT_ALL\"),i.hidden=t}toggleAllSelected(t=!1,e=!0){const i=this.data.clips.length,s=$(this.views.listId).ocValue();if(t||0!==this.listSelected.length)for(let t=0;t<i;t++){const e=$indexPath(0,t).ocValue();s.$deselectRowAtIndexPath_animated(e,!1)}else if(0===this.listSelected.length)for(let t=0;t<i;t++){const e=$indexPath(0,t).ocValue();s.$selectRowAtIndexPath_animated_scrollPosition(e,!1,0)}e&&s.$isEditing()&&this.updateEditingToolBar()}deleteSelected(){n.deleteConfirm($l10n(\"DELETE_CONFIRM_MSG\"),(()=>{const t=this.listSelected.sort(((t,e)=>t.row<e.row)),e=t.map((t=>this.data.getByIndex(t).uuid));this.setEditing(!1),e.forEach((t=>this.data.delete(t))),t.forEach((t=>{$(this.views.listId).delete(t)}))}))}setEditing(t){const e=$(this.views.listId).ocValue();let i=void 0!==t?t:!e.$isEditing();if(i!==e.$isEditing())if(e.$setEditing(i),\"function\"==typeof this.#x&&this.#x(i),i){const t=$ui.create(this.views.getListEditModeToolBarView({selectButtonEvents:{tapped:()=>this.toggleAllSelected()},deleteButtonEvents:{tapped:()=>this.deleteSelected()}}));$ui.window.add(t),$(this.views.editingToolBarId).layout(((t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.views.editModeToolBarHeight)}))}else $(this.views.editingToolBarId).remove()}shouldBeginMultipleSelectionInteractionAtIndexPath(){return this.setEditing(!0),!0}didSelectRowAtIndexPath(t,e){if(t.$isEditing())return void this.updateEditingToolBar();if(t.$hasActiveDrag())return;const i=this.data.getByIndex(e.jsValue());i.image?(r.quickLookImage(i.imageOriginal),t.$deselectRowAtIndexPath_animated(e,!0)):this.views.edit(i.text,(s=>{t.$deselectRowAtIndexPath_animated(e,!0),i.md5!==$text.MD5(s)&&this.data.update(s,i.uuid)}))}didDeselectRowAtIndexPath(t,e){t.$isEditing()&&this.updateEditingToolBar()}contextMenuConfigurationForRowAtIndexPath(t,e,i){if(t.$isEditing())return;const s=i=>{const n=[];return i.items.forEach((i=>{i.items?n.push(s(i)):n.push(this.createUIAction({title:i.title,image:i.symbol,handler:()=>{i.handler(t.jsValue(),e.jsValue())},destructive:i.destructive}))})),this.createUIMenu({title:i.title,image:i.symbol,actions:n,inline:i.inline,destructive:i.destructive})};return $objc(\"UIContextMenuConfiguration\").$configurationWithIdentifier_previewProvider_actionProvider(null,null,$block(\"UIMenu *, NSArray *\",(()=>s(this.menu))))}leadingSwipeActionsConfigurationForRowAtIndexPath(t,e){return $objc(\"UISwipeActionsConfiguration\").$configurationWithActions([this.createUIContextualAction({title:$l10n(\"COPY\"),color:$color(\"systemLink\"),handler:async(t,i,s)=>{this.data.copy(this.data.getByIndex(e.jsValue()).uuid),s(!0)}})])}trailingSwipeActionsConfigurationForRowAtIndexPath(t,e){t=t.jsValue(),e=e.jsValue();const i=[this.createUIContextualAction({destructive:!0,title:$l10n(\"DELETE\"),handler:(i,s,n)=>{this.data.delete(this.data.getByIndex(e).uuid),t.delete(e),$delay(.25,(()=>t.reload()))}})];return 1===this.data.tabIndex&&i.push(this.createUIContextualAction({title:$l10n(\"FAVORITE\"),color:$color(\"orange\"),handler:(t,i,s)=>{this.data.favorite(e.row)}})),$objc(\"UISwipeActionsConfiguration\").$configurationWithActions(i)}heightForRowAtIndexPath(t,e){t=t.jsValue(),e=e.jsValue();const i=this.data.getByIndex(e),s=i?.hasTag?this.views.tagHeight:this.views.verticalMargin,n=i?.image?this.views.imageContentHeight:this.views.getContentHeight(i?.text??\"a\");return this.views.verticalMargin+n+s}delegate(){return $delegate({type:\"UITableViewDelegate\",events:{\"tableView:shouldBeginMultipleSelectionInteractionAtIndexPath:\":()=>this.shouldBeginMultipleSelectionInteractionAtIndexPath(),\"tableView:didBeginMultipleSelectionInteractionAtIndexPath:\":(t,e)=>{this.setEditing(!0)},\"tableView:didSelectRowAtIndexPath:\":(t,e)=>{this.didSelectRowAtIndexPath(t,e)},\"tableView:didDeselectRowAtIndexPath:\":(t,e)=>{this.didDeselectRowAtIndexPath(t,e)},\"tableView:contextMenuConfigurationForRowAtIndexPath:point:\":(t,e,i)=>this.contextMenuConfigurationForRowAtIndexPath(t,e,i),\"tableView:leadingSwipeActionsConfigurationForRowAtIndexPath:\":(t,e)=>this.leadingSwipeActionsConfigurationForRowAtIndexPath(t,e),\"tableView:trailingSwipeActionsConfigurationForRowAtIndexPath:\":(t,e)=>this.trailingSwipeActionsConfigurationForRowAtIndexPath(t,e),\"tableView:heightForRowAtIndexPath:\":(t,e)=>this.heightForRowAtIndexPath(t,e)}})}itemsForBeginningDragSession(t,e){const i=this.data.getByIndex(e.jsValue()),s=$objc(\"NSItemProvider\").$alloc();if(i.image){const t=$file.absolutePath(i.imagePath.original),e=NSURL.$fileURLWithPath(t);s.$initWithContentsOfURL(e)}else s.$initWithObject(i.text);const n=$objc(\"UIDragItem\").$alloc().$initWithItemProvider(s),r=t.$localContext();if(r)r.$addObject(n);else{const e=NSMutableArray.$new();e.$addObject(n),t.$setLocalContext(e)}return[n]}dragDelegate(){return $delegate({type:\"UITableViewDragDelegate\",events:{\"tableView:itemsForBeginningDragSession:atIndexPath:\":(t,e,i)=>this.itemsForBeginningDragSession(e,i)}})}collectionViewDragDelegate(){return $delegate({type:\"UICollectionViewDragDelegate\",events:{\"collectionView:itemsForBeginningDragSession:atIndexPath:\":(t,e,i)=>this.itemsForBeginningDragSession(e,i)}})}reorder(t){const e=t.$items().$firstObject(),i=e.$sourceIndexPath().jsValue().row,s=t.$destinationIndexPath(),n=s.jsValue().row;this.data.moveItem(i,n),this.data.updateList(),t.$dropItem_toRowAtIndexPath(e.$dragItem(),s)}dropItems(t){const e=t.$destinationIndexPath(),i=t.$items(),s=i.$count();for(let n=0;n<s;n++){const s=i.$objectAtIndex(n),r=this.createUITableViewDropPlaceholder(e),a=t.$dropItem_toPlaceholder(s.$dragItem(),r),o=a.$dragItem().$itemProvider(),l=o.$registeredTypeIdentifiers().jsValue(),h=o.$hasItemConformingToTypeIdentifier(\"public.text\"),c=o.$hasItemConformingToTypeIdentifier(\"public.image\");if(!h&&!c)return;const d=(t,e)=>{e&&($ui.alert(e.jsValue()),this.kernel.logger.error(e.jsValue())),a.$commitInsertionWithDataSourceUpdates($block(\"void, NSIndexPath *\",(e=>{h?this.data.add(t.jsValue().string,!1):c&&this.data.add(t.jsValue().image,!1),this.data.moveItem(0,e.jsValue().row),this.data.updateList()})))};o.$loadDataRepresentationForTypeIdentifier_completionHandler(l[0],$block(\"void, NSData *, NSError *\",((t,e)=>{$delay(0,(()=>d(t,e)))})))}}dropDelegate(){return $delegate({type:\"UITableViewDropDelegate\",events:{\"tableView:canHandleDropSession:\":(t,e)=>!t.$isEditing(),\"tableView:dropSessionDidUpdate:withDestinationIndexPath:\":(t,e,i)=>{const s=$objc(\"UITableViewDropProposal\").$alloc();return e.$localDragSession()?s.$initWithDropOperation_intent(3,1):s.$initWithDropOperation_intent(2,1),s},\"tableView:performDropWithCoordinator:\":(t,e)=>{e.$session().$localDragSession()?this.reorder(e):this.dropItems(e)}}})}setDelegate(){const t=$(this.views.listId).ocValue();this.isCollectionView?t.$setDragDelegate(this.collectionViewDragDelegate()):(this.initReuseIdentifier(t),t.$setDelegate(this.delegate()),t.$setDragDelegate(this.dragDelegate()),t.$setDropDelegate(this.dropDelegate()))}}})),s.register(\"gVMQa\",(function(t,e){var i=s(\"gxpqj\"),n=i.NavigationView,r=i.Sheet,a=s(\"7TSVv\"),o=s(\"2VUvw\"),l=s(\"42nBp\"),h=s(\"kgD3J\"),c=s(\"r5Q7t\");t.exports=class extends a{collectionView;placeholderReuseIdentifier=\"UICollectionViewPlaceholderReuseIdentifier\";cellReuseIdentifier=\"ActionCollectionViewCellReuseIdentifier\";headerReuseIdentifier=\"ActionViewCustomHeaderReuseIdentifier\";footerReuseIdentifier=\"ActionViewCustomFooterReuseIdentifier\";constructor(...t){super(...t),this.views=new h(this.kernel,this),this.delegates=new c(this.kernel,this,this.views)}get actionList(){return super.actions.map((t=>{const e=[];return t.items.forEach((t=>{e.push(this.views.actionToData(t))})),{title:t.title,items:e}}))}actionSyncStatus(){$app.listen({actionSyncStatus:t=>{if(t.status===o.status.syncing&&t.animate)this.updateNavButton(!0),this.updateSyncLabel($l10n(\"SYNCING\"));else if(t.status===o.status.success)try{this.applySnapshotAnimatingDifferences()}catch(t){this.kernel.logger.error(t),this.updateSyncLabel(t)}finally{this.updateSyncLabel(),this.updateNavButton(!1),this.collectionView.jsValue().endRefreshing()}}})}editActionInfoPageSheet(t,e){new l(this,t).editActionInfoPageSheet(e)}editActionMainJs(t=\"\",e){new l(this,e).editActionMainJs(t)}getNavButtons(){const t=[{title:$l10n(\"IMPORT_FROM_FILE\"),handler:async()=>{const t=await $drive.open();try{this.importAction(JSON.parse(t.string)),this.applySnapshotAnimatingDifferences()}catch(t){this.kernel.logger.error(t)}}}],e=[{title:$l10n(\"CREATE_NEW_ACTION\"),handler:()=>{this.editActionInfoPageSheet(null,(async t=>{const e=$file.read(`${this.actionPath}/template.js`).string;this.saveMainJs(t,e);const i=this.getActionTypeSection(t.type);this.applySnapshotToSectionAnimatingDifferences(i),await $wait(.3),this.editActionMainJs(e,t)}))}},{title:$l10n(\"CREATE_NEW_TYPE\"),handler:()=>{$input.text({text:\"\",placeholder:$l10n(\"CREATE_NEW_TYPE\"),handler:t=>{if(\"\"===(t=t.trim()))return void $ui.toast($l10n(\"INVALID_VALUE\"));const e=`${this.userActionPath}/${t}`;$file.isDirectory(e)?$ui.warning($l10n(\"TYPE_ALREADY_EXISTS\")):($file.mkdir(e),$ui.success($l10n(\"SUCCESS\")))}})}},{inline:!0,items:t}];return[{symbol:\"plus.circle\",id:this.views.addActionButtonId,menu:{pullDown:!0,asPrimary:!0,items:e}}]}updateSyncLabel(t){t||(t=$l10n(\"MODIFIED\")+this.getLocalSyncDate().toLocaleString()),$(this.views.syncLabelId)&&($(this.views.syncLabelId).text=t)}updateNavButton(t){const e=this.navigationView?.navigationBarItems?.getButton(this.views.addActionButtonId);e&&e.setLoading(t);const i=this.navigationView?.navigationBarItems?.getButton(this.views.sortActionButtonId);i&&i.setLoading(t);const s=this.navigationView?.navigationBarItems?.getButton(this.views.syncButtonId);s&&s.setLoading(t)}initReuseIdentifier(){this.collectionView.$registerClass_forCellWithReuseIdentifier($objc(\"UICollectionViewCell\").$class(),this.placeholderReuseIdentifier),this.collectionView.$registerClass_forCellWithReuseIdentifier($objc(\"UICollectionViewCell\").$class(),this.cellReuseIdentifier),this.views.actionViewCustomHeader(),this.collectionView.$registerClass_forSupplementaryViewOfKind_withReuseIdentifier($objc(\"ActionViewCustomHeader\").$class(),\"UICollectionElementKindSectionHeader\",this.headerReuseIdentifier),this.views.actionViewCustomFooter(),this.collectionView.$registerClass_forSupplementaryViewOfKind_withReuseIdentifier($objc(\"ActionViewCustomFooter\").$class(),\"UICollectionElementKindSectionFooter\",this.footerReuseIdentifier)}initDataSource(){const t=$block(\"UICollectionViewCell *, UICollectionView *, NSIndexPath *, id\",((t,e,i)=>{const s=t.$dequeueReusableCellWithReuseIdentifier_forIndexPath(this.cellReuseIdentifier,e);s.$contentView().$setClipsToBounds(!0),s.$contentView().$layer().$setCornerRadius(10);const{section:n,item:r}=e.jsValue(),a=this.views.matrixCell(this.actions[n].items[r]);return s.$contentView().jsValue().add(a),s})),e=$block(\"UICollectionReusableView *, UICollectionView *, NSString *, NSIndexPath *\",((t,e,i)=>{const{section:s}=i.jsValue();if(\"UICollectionElementKindSectionHeader\"===e.jsValue()){const n=t.$dequeueReusableSupplementaryViewOfKind_withReuseIdentifier_forIndexPath(e,this.headerReuseIdentifier,i);return n.$titleLabel().$setText(this.actions[s].title),n}return t.$dequeueReusableSupplementaryViewOfKind_withReuseIdentifier_forIndexPath(e,this.footerReuseIdentifier,i)})),i=$objc(\"UICollectionViewDiffableDataSource\").$alloc();i.$initWithCollectionView_cellProvider(this.collectionView,t),i.$setSupplementaryViewProvider(e),$objc_retain(i)}applySnapshotUsingReloadData(){const t=$objc(\"NSDiffableDataSourceSnapshot\").$alloc().$init(),e=this.actions;t.$appendSectionsWithIdentifiers(e.map((t=>t.dir)));for(const i in e)t.$appendItemsWithIdentifiers_intoSectionWithIdentifier(e[i].items.map((t=>t.dir)),e[i].dir);this.collectionView.$dataSource().$applySnapshotUsingReloadData(t)}applySnapshotAnimatingDifferences(t=!0){const e=$objc(\"NSDiffableDataSourceSnapshot\").$alloc().$init(),i=this.actions;e.$appendSectionsWithIdentifiers(i.map((t=>t.dir)));for(const t in i)e.$appendItemsWithIdentifiers_intoSectionWithIdentifier(i[t].items.map((t=>t.dir)),i[t].dir);this.collectionView.$dataSource().$applySnapshot_animatingDifferences(e,t)}applySnapshotToSectionAnimatingDifferences(t,e=!0){const i=$objc(\"NSDiffableDataSourceSectionSnapshot\").$alloc().$init(),{items:s,dir:n}=this.actions[t];i.$appendItems(s.map((t=>t.dir))),this.collectionView.$dataSource().$applySnapshot_toSection_animatingDifferences(i,n,e)}getMatrixView(){const t=this.views.getMatrixView({ready:t=>{this.collectionView=t.ocValue(),this.initReuseIdentifier(),this.delegates.setDelegate(),this.delegates.setRefreshControl(),this.initDataSource(),this.applySnapshotUsingReloadData()}});return this.actionSyncStatus(),t}getPage(){return this.navigationView=new n,this.navigationView.navigationBarItems.setRightButtons(this.getNavButtons()),this.navigationView.setView(this.getMatrixView()).navigationBarTitle($l10n(\"ACTIONS\")),this.navigationView.getPage()}present(){const t=new r,e=this.getNavButtons();this.kernel.setting.get(\"webdav.status\")&&e.push({id:this.views.syncButtonId,symbol:\"arrow.triangle.2.circlepath.circle\",tapped:()=>this.sync()}),t.setView(this.getMatrixView()).addNavBar({title:$l10n(\"ACTIONS\"),popButton:{symbol:\"xmark.circle\"},rightButtons:e}).init(),this.navigationView=t.navigationView,t.present()}}})),s.register(\"7TSVv\",(function(t,e){var i=s(\"gxpqj\"),n=i.FileStorage,r=i.UIKit,a=s(\"eSp9Z\"),o=a.ActionEnv,l=a.ActionData,h=a.Action,c=s(\"jVlss\").SecureScript,d=s(\"7pN8M\");t.exports=class{#C;#D;constructor(t){this.kernel=t,this.actionPath=\"scripts/action\",this.actionOrderFile=\"order.json\",this.tempPath=`${this.kernel.fileStorage.basePath}/temp`,this.userActionPath=`${this.kernel.fileStorage.basePath}/user_action`,this.localSyncFile=this.userActionPath+\"/sync.json\",this.checkUserAction(),this.sync()}get actions(){return this.#C||this.#k(),this.#C}get allActions(){return this.#D||this.#k(),this.#D}get isNew(){return $cache.get(\"caio.action.isNew\")??!1}set isNew(t){$cache.get(\"caio.action.isNew\",t)}get isEnableWebDavSync(){return this.kernel.setting.get(\"webdav.status\")}#k(){this.#C=this.getActionTypes().map((t=>({dir:t,title:this.getTypeTitle(t),items:this.getActions(t)}))),this.#D={},this.#C.map((t=>t.items.forEach((t=>{this.#D[t.name]=t})))),this.kernel.logger.info(\"init actions\")}setNeedReload(){this.#C=void 0,this.#D=void 0,this.isEnableWebDavSync&&this.webdavSync.needUpload()}importExampleAction(){try{Object.keys(__ACTIONS__).forEach((t=>{Object.keys(__ACTIONS__[t]).forEach((e=>{const i=__ACTIONS__[t][e],s=JSON.parse(i.config);this.exists(s.name)||this.importAction(i,t,!1)}))}))}catch{$file.list(this.actionPath).forEach((t=>{const e=`${this.actionPath}/${t}`;if($file.isDirectory(e)){const i=`${this.userActionPath}/${t}`;$file.list(e).forEach((t=>{const s=JSON.parse($file.read(`${e}/${t}/config.json`).string);this.exists(s.name)||($file.mkdir(i),$file.copy({src:`${e}/${t}`,dst:`${i}/${t}`}))}))}}))}this.setNeedReload()}actionToString(t,e){return JSON.stringify({config:this.getActionConfigString(t,e),main:this.getActionMainJs(t,e),readme:this.getActionReadme(t,e)})}exportAction(t){const e=r.loading();e.start();const{type:i,dir:s,name:n}=t,a=this.actionToString(i,s);e.end(),$share.sheet({items:[{name:n+\".json\",data:$data({string:a})}]})}importAction(t,e=\"uncategorized\",i=!0){const s=i?r.loading():null;s?.start();try{const{config:i,main:s,readme:r}=t;if(!i||!s||!r)throw new Error(\"Not an action\");let a=JSON.parse(i)?.name?.trim();if(!a||\"\"===a)throw new Error(\"Not an action\");const o=this.initActionDirByName(a),l=n.join(this.tempPath,o);return $file.mkdir(l),$file.write({data:$data({string:i}),path:n.join(l,\"config.json\")}),$file.write({data:$data({string:s}),path:n.join(l,\"main.js\")}),$file.write({data:$data({string:r}),path:n.join(l,\"README.md\")}),$file.move({src:l,dst:this.getActionPath(e,o)}),this.setNeedReload(),o}catch(t){throw t}finally{s?.end()}}getLocalSyncDate(){const t=JSON.parse($file.read(this.localSyncFile)?.string??\"{}\");return new Date(t.timestamp)}async sync(){if(this.isEnableWebDavSync)if(this.webdavSync)this.webdavSync.sync();else try{this.webdavSync=new d({kernel:this.kernel,host:this.kernel.setting.get(\"webdav.host\"),user:this.kernel.setting.get(\"webdav.user\"),password:this.kernel.setting.get(\"webdav.password\"),basepath:this.kernel.setting.get(\"webdav.basepath\")}),await this.webdavSync.init()}catch(t){throw this.kernel.logger.error(`${t}\\n${t.stack}`),t}}checkUserAction(){$file.exists(this.userActionPath)&&0!==$file.list(this.userActionPath).length||($file.mkdir(this.userActionPath),this.isNew=!1,this.importExampleAction())}getActionTypes(){const t=[\"clipboard\",\"editor\"];return t.concat($file.list(this.userActionPath).filter((e=>$file.isDirectory(`${this.userActionPath}/${e}`)&&t.indexOf(e)<0)))}getActionTypeSection(t){for(const e in this.actions)if(this.actions[e].dir===t)return e;return null}getActionOrder(t,e=!1){const i=`${this.userActionPath}/${t}`,s=`${i}/${this.actionOrderFile}`;if($file.exists(s)){const e=JSON.parse($file.read(s).string),n=e.filter((t=>!!$file.exists(`${i}/${t}`)));return n.length!==e.length&&this.saveOrder(t,n),n}if(e){const t=[];return $file.list(i).forEach((e=>{t.push(e)})),t}return[]}getActionPath(t,e){return`${this.userActionPath}/${t}/${e}`}getActionConfigString(t,e){return $file.read(`${this.getActionPath(t,e)}/config.json`).string}getActionConfig(t,e){return JSON.parse(this.getActionConfigString(t,e))}getActionMainJs(t,e){return $file.read(`${this.getActionPath(t,e)}/main.js`).string}getActionReadme(t,e){return $file.read(`${this.getActionPath(t,e)}/README.md`).string}initActionDirByName(t){return $text.MD5(t)}getActionDirByName(t){return this.allActions[t].dir}getAction(t,e,i){$file.exists(this.getActionPath(t,e))||(e=this.initActionDirByName(e));try{const s=this.getActionMainJs(t,e),n=new c(s),r=new Function(\"Action\",\"ActionEnv\",\"ActionData\",`${n.secure()}\\n return MyAction`)(h,o,l);return new r(this.kernel,this.getActionConfig(t,e),i)}catch(t){throw this.kernel.logger.error(t),t}}getActionHandler(t,e){return async i=>{try{const s=this.getAction(t,e,i);return await s.do()}catch(t){throw this.kernel.logger.error(t),t}}}getActions(t){const e=[],i=`${this.userActionPath}/${t}`;if(!$file.exists(i))return[];const s=s=>{const n=`${i}/${s}/`;if($file.isDirectory(n)){const i=this.getActionConfig(t,s);e.push(Object.assign(i,{type:t,dir:s}))}},n=this.getActionOrder(t);return n.forEach((t=>s(t))),$file.list(i).forEach((t=>{-1===n.indexOf(t)&&s(t)})),e}getTypeTitle(t){const e=t.toUpperCase(),i=$l10n(e);return i===e?t:i}#B(t,...e){\"string\"!=typeof t&&(t=JSON.stringify(t));const i=n.join(this.userActionPath,...e),s=i.substring(0,i.lastIndexOf(\"/\"));$file.exists(s)||$file.mkdir(s);const r=$file.read(i)?.string;let a;try{a=JSON.stringify(JSON.parse(r))}catch{a=r}t!==a&&($file.write({data:$data({string:t}),path:i}),this.setNeedReload())}saveActionInfo(t){this.#B({icon:t.icon,color:t.color,name:t.name},t.type,t.dir,\"config.json\"),this.#B(t.readme,t.type,t.dir,\"README.md\")}saveMainJs(t,e){this.#B(e,t.type,t.dir,\"main.js\")}saveOrder(t,e){this.#B(JSON.stringify(e),t,this.actionOrderFile)}move(t,e){if(t.section===e.section&&t.item===e.item)return;const i=this.actions[t.section];let s=i.items;const n=i.dir,r=t=>t.map((t=>t.dir));if(t.section===e.section){const i=t.item<e.item?e.item+1:e.item,a=t.item>e.item?t.item+1:t.item;s.splice(i,0,s[t.item]),s=s.filter(((t,e)=>e!==a)),this.saveOrder(n,r(s))}else{const i=this.actions[e.section],a=i.items,o=i.dir;a.splice(e.item,0,s[t.item]),s=s.filter(((e,i)=>i!==t.item)),$file.move({src:`${this.userActionPath}/${n}/${a[e.item].dir}`,dst:`${this.userActionPath}/${o}/${a[e.item].dir}`}),this.saveOrder(o,r(a)),this.saveOrder(n,r(s))}}delete(t){$file.delete(`${this.userActionPath}/${t.type}/${t.dir}`),this.setNeedReload()}exists(t){return void 0!==this.allActions[t]}}})),s.register(\"7pN8M\",(function(t,e){var i=s(\"gxpqj\").FileStorage,n=s(\"2VUvw\");class r extends n{localSyncDataPath=\"/user_action/sync.json\";webdavSyncDataPath=\"/sync.json\";tempPath=\"/temp\";webdavActionsPath=\"/actions.zip\";localActionsPath=\"/user_action\";constructor({host:t,user:e,password:s,basepath:n,kernel:r}={}){super({host:t,user:e,password:s,basepath:n=i.join(n,\"user_action\"),kernel:r})}async init(){await super.init(),this.sync()}isNew(){return this.kernel.actions.isNew}async pull(){const t=i.join(this.tempPath,\"user_action\"),e=this.kernel.fileStorage.filePath(t),s=await this.webdav.get(this.webdavActionsPath);if(!await $archiver.unzip({file:s.rawData,dest:e}))throw new Error($l10n(\"UNZIP_FAILED\"));await this.downloadSyncData(),this.kernel.fileStorage.move(t,this.localActionsPath),this.kernel.logger.info(\"action webdav sync: pulled\")}async push(){const t=i.join(this.tempPath,\"actions.zip\");if(!$archiver.zip({directory:this.kernel.fileStorage.filePath(this.localActionsPath),dest:this.kernel.fileStorage.filePath(t)}))throw new Error($l10n(\"ZIP_FAILED\"));await $wait(.5),await this.webdav.put(this.webdavActionsPath,this.kernel.fileStorage.readSync(t)),await this.uploadSyncData(),this.kernel.fileStorage.delete(t),this.kernel.logger.info(\"action webdav sync: pushed\")}notify(t){$app.notify({name:\"actionSyncStatus\",object:t})}async#u(){let t=!1;try{const e=await this.nextSyncStep();if(this.kernel.logger.info(`action nextSyncStep: ${n.stepName[e]}`),e===n.step.needPush||e===n.step.init)await this.push();else if(e===n.step.needPull)await this.pull(),t=!0;else{if(e!==n.step.conflict)return void this.notify({status:n.status.nochange});await this.conflict($l10n(\"ACTIONS\"))===r.conflictKeep.webdav&&(t=!0)}}catch(t){throw this.notify({status:n.status.fail,error:t}),t}finally{this.notify({status:n.status.success,updateList:t})}}sync(){this.notify({status:n.status.syncing,animate:!0}),this.syncTimer&&this.syncTimer.cancel(),this.syncTimer=$delay(.5,(()=>{this.#u(!0)}))}needUpload(){this.notify({status:n.status.syncing}),this.uploadTimer&&this.uploadTimer.cancel(),this.uploadTimer=$delay(.5,(()=>{this.updateLocalTimestamp(),this.#u()}))}}t.exports=r})),s.register(\"42nBp\",(function(t,e){var i=s(\"gxpqj\"),n=i.Setting,r=i.Sheet,a=s(\"f0nX9\"),o=s(\"eSp9Z\"),l=o.ActionEnv,h=o.ActionData;t.exports=class{editingActionInfo;constructor(t,e){this.data=t,this.info=e,this.actionTypes=this.data.getActionTypes(),this.initEditingActionInfo(),this.initSettingInstance()}initEditingActionInfo(){this.isNew=!Boolean(this.info),this.isNew?this.editingActionInfo={type:this.actionTypes[0],name:\"MyAction\",color:\"#CC00CC\",icon:\"icon_062.png\",readme:\"\"}:(this.editingActionInfo=this.info,this.editingActionInfo.readme=this.data.getActionReadme(this.info.type,this.info.dir))}initSettingInstance(){this.settingInstance=new n({structure:[],set:(t,e)=>(this.editingActionInfo[t]=e,!0),get:(t,e=null)=>Object.prototype.hasOwnProperty.call(this.editingActionInfo,t)?this.editingActionInfo[t]:e})}informationView(){const t=this.settingInstance.loader({setting:this.settingInstance,type:\"input\",key:\"name\",icon:[\"pencil.circle\",\"#FF3366\"],title:$l10n(\"NAME\")}).create(),e=this.settingInstance.loader({setting:this.settingInstance,type:\"color\",key:\"color\",icon:[\"pencil.tip.crop.circle\",\"#0066CC\"],title:$l10n(\"COLOR\")}).create(),i=this.settingInstance.loader({setting:this.settingInstance,type:\"icon\",key:\"icon\",icon:[\"star.circle\",\"#FF9933\"],title:$l10n(\"ICON\"),bgcolor:this.data.views.getColor(this.editingActionInfo.color)}).create(),s=this.settingInstance.loader({setting:this.settingInstance,type:\"menu\",key:\"type\",icon:[\"tag.circle\",\"#33CC33\"],title:$l10n(\"TYPE\"),items:this.actionTypes,values:this.actionTypes,pullDown:!0}).create();let n=[t,e,i];return this.isNew&&n.push(s),n}actionInfoView(){const t={type:\"view\",views:[{type:\"text\",props:{id:\"action-text\",textColor:$color(\"#000000\",\"secondaryText\"),bgcolor:$color(\"systemBackground\"),text:this.editingActionInfo.readme,insets:$insets(10,10,10,10)},layout:$layout.fill,events:{tapped:t=>{$(\"actionInfoPageSheetList\").scrollToOffset($point(0,this.isNew?280:230)),$delay(.2,(()=>t.focus()))},didChange:t=>{this.editingActionInfo.readme=t.text}}}],layout:$layout.fill},e=[{title:$l10n(\"INFORMATION\"),rows:this.informationView()},{title:$l10n(\"DESCRIPTION\"),rows:[t]}];return{type:\"list\",props:{id:\"actionInfoPageSheetList\",bgcolor:$color(\"insetGroupedBackground\"),style:2,separatorInset:$insets(0,50,0,10),data:e},layout:$layout.fill,events:{rowHeight:(t,e)=>1===e.section?120:50}}}editActionInfoPageSheet(t){const e=new r,i=async()=>{if(this.isNew){if(this.editingActionInfo.dir=this.data.initActionDirByName(this.editingActionInfo.name),this.data.exists(this.editingActionInfo.name)){if(1===(await $ui.alert({title:$l10n(\"UNABLE_CREATE_ACTION\"),message:$l10n(\"ACTION_NAME_ALREADY_EXISTS\").replaceAll(\"${name}\",this.editingActionInfo.name)})).index)return}const t=this.data.getActionOrder(this.editingActionInfo.type,!0);t.unshift(this.editingActionInfo.dir),this.data.saveOrder(this.editingActionInfo.type,t)}e.dismiss(),this.data.saveActionInfo(this.editingActionInfo),await $wait(.3),t&&t(this.editingActionInfo)};e.setView(this.actionInfoView()).addNavBar({title:\"\",popButton:{title:$l10n(\"CANCEL\")},rightButtons:[{title:$l10n(\"DONE\"),tapped:()=>i()}]}).init().present()}editorNavButtons(t){return[{symbol:\"book.circle\",tapped:()=>{let t=$file.read(\"scripts/action/README.md\")?.string;if(!t)try{t=__ACTION_README__.content}catch{}(new r).setView({type:\"markdown\",props:{content:t},layout:(t,e)=>{t.size.equalTo(e.super)}}).addNavBar({title:\"Document\",popButton:{symbol:\"x.circle\"}}).init().present()}},{symbol:\"play.circle\",tapped:async()=>{try{this.data.saveMainJs(this.info,t.text);let e=await this.data.getActionHandler(this.info.type,this.info.dir)(new h({env:l.build}));if(void 0!==e){\"object\"==typeof e&&(e=JSON.stringify(e,null,2));(new r).setView({type:\"code\",props:{lineNumbers:!0,editable:!1,text:e},layout:$layout.fill}).addNavBar({title:\"\",popButton:{title:$l10n(\"DONE\")}}).init().present()}}catch(t){this.data.kernel.logger.error(t)}}}]}editActionMainJs(t=\"\"){const e=new a(this.data.kernel);e.pageSheet(t,(t=>{this.data.saveMainJs(this.info,t)}),this.info.name,this.editorNavButtons(e),\"code\")}}})),s.register(\"kgD3J\",(function(t,e){var i=s(\"gxpqj\"),n=i.BarButtonItem,r=i.UIKit;t.exports=class{addActionButtonId=\"action-manager-button-add\";sortActionButtonId=\"action-manager-button-sort\";syncButtonId=\"action-manager-button-sync\";syncLabelId=\"action-manager-sync-label\";editingToolBarId=\"action-editingToolBarId\";horizontalMargin=20;verticalMargin=14;editModeToolBarHeight=44;columns=2;spacing=15;itemHeight=100;headerHeight=35;constructor(t,e){this.kernel=t,this.data=e}getActionListView(t,e={},i={}){return t&&(i.didSelect=(e,i,s)=>{const n=s.info.info,r=this.data.getActionHandler(n.type,n.dir);t(r)}),{type:\"list\",layout:(t,e)=>{t.top.width.equalTo(e.super.safeArea),t.bottom.inset(0)},events:i,props:Object.assign({reorder:!1,bgcolor:$color(\"clear\"),rowHeight:60,sectionTitleHeight:30,stickyHeader:!0,data:(()=>{const t=this.data.actionList;return t.map((t=>(t.rows=t.items,t))),t})(),template:{props:{bgcolor:$color(\"clear\")},views:[{type:\"image\",props:{id:\"color\",cornerRadius:8,smoothCorners:!0},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(15),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:\"icon\",tintColor:$color(\"#ffffff\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(20),t.size.equalTo($size(20,20))}},{type:\"label\",props:{id:\"name\",lines:1,font:$font(16)},layout:(t,e)=>{t.height.equalTo(30),t.centerY.equalTo(e.super),t.left.equalTo(e.prev.right).offset(15)}},{type:\"label\",props:{id:\"info\"}}]}},e)}}getActionMiniView(t,e){e||(e=[],this.data.actions.forEach((t=>{e=e.concat(t.items)})));return{type:\"matrix\",props:{bgcolor:$color(\"clear\"),columns:2,itemHeight:50,spacing:8,data:e.map((t=>this.actionToData(t))),template:{props:{smoothCorners:!0,cornerRadius:10,bgcolor:$color($rgba(255,255,255,.3),$rgba(0,0,0,.3))},views:[{type:\"image\",props:{id:\"color\",cornerRadius:8,smoothCorners:!0},layout:t=>{t.top.left.inset(10),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:\"icon\",tintColor:$color(\"#ffffff\")},layout:(t,e)=>{t.edges.equalTo(e.prev).insets(5)}},{type:\"label\",props:{id:\"name\",font:$font(14)},layout:(t,e)=>{t.bottom.top.inset(10),t.left.equalTo(e.prev.prev.right).offset(10),t.right.inset(10)}},{type:\"view\",props:{id:\"info\",hidden:!0}}]}},layout:$layout.fill,events:{didSelect:async(e,i,s)=>{const n=s.info.info,r=await t(n);this.data.getActionHandler(n.type,n.dir)(r)}}}}getMatrixEditModeToolBarView({selectButtonEvents:t,deleteButtonEvents:e}={}){return r.blurBox({id:this.editingToolBarId},[r.separatorLine(),{type:\"view\",views:[{type:\"button\",props:{id:this.editingToolBarId+\"-select-button\",title:$l10n(\"SELECT_ALL\"),titleColor:$color(\"tint\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.left.inset(this.horizontalMargin),t.centerY.equalTo(e.super)},events:t},{type:\"button\",props:{id:this.editingToolBarId+\"-delete-button\",symbol:\"trash\",hidden:!0,tintColor:$color(\"red\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.height.equalTo(e.super),t.width.equalTo(2*this.horizontalMargin),t.right.inset(this.horizontalMargin/2),t.centerY.equalTo(e.super)},events:e}],layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom)}}])}getColor(t,e=null){return t?\"string\"==typeof t?$color(t):$rgba(t.red,t.green,t.blue,t.alpha):e}actionToData(t){return{name:{text:t.name},icon:\"icon_\"===t?.icon?.slice(0,5)?{icon:$icon(t.icon.slice(5,t.icon.indexOf(\".\")),$color(\"#ffffff\"))}:{image:$image(t?.icon)},color:{bgcolor:this.getColor(t.color)},info:{info:t}}}matrixCell(t){return{props:{bgcolor:$color(\"#ffffff\",\"#242424\")},views:[{type:\"image\",props:{bgcolor:this.getColor(t.color),cornerRadius:8,smoothCorners:!0},layout:t=>{t.top.left.inset(10),t.size.equalTo($size(30,30))}},{type:\"image\",props:Object.assign({tintColor:$color(\"#ffffff\")},\"icon_\"===t?.icon?.slice(0,5)?{icon:$icon(t.icon.slice(5,t.icon.indexOf(\".\")),$color(\"#ffffff\"))}:{image:$image(t?.icon)}),layout:t=>{t.top.left.inset(15),t.size.equalTo($size(20,20))}},{type:\"button\",props:{bgcolor:$color(\"clear\"),tintColor:r.textColor,titleColor:r.textColor,contentEdgeInsets:$insets(0,0,0,0),titleEdgeInsets:$insets(0,0,0,0),imageEdgeInsets:$insets(0,0,0,0)},views:[{type:\"image\",props:{symbol:\"ellipsis.circle\"},layout:(t,e)=>{t.center.equalTo(e.super),t.size.equalTo(n.style.iconSize)}}],events:{tapped:e=>{const i=this.data.getActionMainJs(t.type,t.dir);this.data.editActionMainJs(i,t)}},layout:t=>{t.top.right.inset(0),t.size.equalTo(n.style.width)}},{type:\"label\",props:{text:t.name,font:$font(16)},layout:(t,e)=>{t.bottom.left.inset(10),t.width.equalTo(e.super)}}],layout:$layout.fill}}actionViewCustomHeader(){$define({type:\"ActionViewCustomHeader: UICollectionReusableView\",props:[\"titleLabel\"],events:{\"initWithFrame:\":t=>{self=self.$super().$initWithFrame(t);const e=self.$bounds();e.x=this.spacing,e.y=this.headerHeight-21;const i=$objc(\"UILabel\").$alloc().$initWithFrame(e);return i.$setFont($font(\"bold\",21).ocValue()),i.$setTextAlignment($align.left),i.$setNumberOfLines(1),self.$setTitleLabel(i),self.$addSubview(self.$titleLabel()),self}}})}actionViewCustomFooter(){$define({type:\"ActionViewCustomFooter: UICollectionReusableView\",props:[\"titleLabel\"],events:{\"initWithFrame:\":t=>{self=self.$super().$initWithFrame(t);const e=self.$bounds();e.x=this.spacing;const i=$objc(\"UILabel\").$alloc().$initWithFrame(e);return i.$setFont($font(16).ocValue()),i.$setTextAlignment($align.left),self.$setTitleLabel(i),self.$addSubview(self.$titleLabel()),self}}})}collectionViewFlowLayout(){const t=$objc(\"UICollectionViewFlowLayout\").$alloc().$init();t.$setScrollDirection($scrollDirection.vertical),t.$setMinimumLineSpacing(this.spacing),t.$setMinimumInteritemSpacing(this.spacing);const e=$insets(this.spacing,this.spacing,0,this.spacing).ocValue();return t.$setSectionInset(e.$UIEdgeInsetsValue()),t}getMatrixView(t){return{type:\"matrix\",props:{bgcolor:r.scrollViewBackgroundColor},layout:$layout.fill,events:t}}}})),s.register(\"r5Q7t\",(function(t,e){var i=s(\"gxpqj\"),n=i.UIKit,r=i.Sheet,a=s(\"eSp9Z\"),o=a.ActionEnv,l=a.ActionData;t.exports=class{collectionView;#x;constructor(t,e,i){this.kernel=t,this.data=e,this.views=i}getActionByIndexPath(t){const e=t.$section(),i=t.$item();return this.data.actions[e].items[i]}get matrixSelected(){const t=this.collectionView?.$indexPathsForSelectedItems()?.jsValue();return Array.isArray(t)?t:[]}get menu(){return{items:[{title:$l10n(\"EDIT_DETAILS\"),symbol:\"slider.horizontal.3\",handler:(t,e,i)=>{this.data.editActionInfoPageSheet(i,(t=>{this.data.applySnapshotToSectionAnimatingDifferences(e.$section())}))}},{title:$l10n(\"EDIT_SCRIPT\"),symbol:\"square.and.pencil\",handler:(t,e,i)=>{const s=this.data.getActionMainJs(i.type,i.dir);this.data.editActionMainJs(s,i)}},{inline:!0,items:[{title:\"README\",symbol:\"book\",handler:(t,e,i)=>{let s;try{s=__ACTIONS__[i.type][i.dir][\"README.md\"]}catch{s=this.data.getActionReadme(i.type,i.dir)}(new r).setView({type:\"markdown\",props:{content:s},layout:(t,e)=>{t.size.equalTo(e.super)}}).init().present()}}]},{inline:!0,items:[{title:$l10n(\"SHARE\"),symbol:\"square.and.arrow.up\",handler:(t,e,i)=>{this.exportAction(i)}},{title:$l10n(\"DELETE\"),symbol:\"trash\",destructive:!0,handler:(t,e,i)=>{n.deleteConfirm($l10n(\"DELETE_CONFIRM_MSG\"),(()=>{this.data.delete(i),this.data.applySnapshotToSectionAnimatingDifferences(e.$section())}))}}]}]}}setEditingCallback(t){this.#x=t}createUIMenu=({title:t,image:e,actions:i,inline:s=!1,destructive:n=!1}={})=>{let r;return s&&(r|=1),n&&(r|=2),$objc(\"UIMenu\").$menuWithTitle_image_identifier_options_children(t??\"\",e,null,r??0,i)};createUIAction=({title:t,image:e,handler:i,destructive:s=!1}={})=>{const n=$objc(\"UIAction\").$actionWithTitle_image_identifier_handler(t,e,null,$block(\"void, UIAction *\",(t=>{i(t)})));return s&&n.$setAttributes(2),n};createUICollectionViewDropPlaceholder(t){const e=$objc(\"UICollectionViewDropPlaceholder\").$alloc();return e.$initWithInsertionIndexPath_reuseIdentifier(t,this.data.placeholderReuseIdentifier),e}updateEditingToolBar(){const t=0===this.matrixSelected.length,e=$(this.views.editingToolBarId+\"-select-button\"),i=$(this.views.editingToolBarId+\"-delete-button\");e.title=t?$l10n(\"SELECT_ALL\"):$l10n(\"DESELECT_ALL\"),i.hidden=t}toggleAllSelected(t=!1,e=!0){const i=this.data.clips.length;if(t||0!==this.matrixSelected.length)for(let t=0;t<i;t++){const e=$indexPath(0,t).ocValue();this.collectionView.$deselectItemAtIndexPath_animated(e,!1)}else if(0===this.matrixSelected.length)for(let t=0;t<i;t++){const e=$indexPath(0,t).ocValue();this.collectionView.$selectItemAtIndexPath_animated_scrollPosition(e,!1,0)}e&&this.collectionView.$isEditing()&&this.updateEditingToolBar()}deleteSelected(){n.deleteConfirm($l10n(\"DELETE_CONFIRM_MSG\"),(()=>{const t=this.matrixSelected.sort(((t,e)=>t.item<e.item));console.log(t),this.setEditing(!1)}))}setEditing(t){let e=void 0!==t?t:!this.collectionView.$isEditing();if(e!==this.collectionView.$isEditing())if(this.collectionView.$setEditing(e),\"function\"==typeof this.#x&&this.#x(e),e){const t=$ui.create(this.views.getMatrixEditModeToolBarView({selectButtonEvents:{tapped:()=>this.toggleAllSelected()},deleteButtonEvents:{tapped:()=>this.deleteSelected()}}));$ui.window.add(t),$(this.views.editingToolBarId).layout(((t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.views.editModeToolBarHeight)}))}else $(this.views.editingToolBarId).remove()}didSelectItemAtIndexPath(t,e){if(t.$isEditing())return void this.updateEditingToolBar();if(t.$hasActiveDrag())return;const i=this.getActionByIndexPath(e),s=new l({env:o.action,text:\"clipboard\"===i.type||\"uncategorized\"===i.type?$clipboard.text:null});this.data.getActionHandler(i.type,i.dir)(s)}didDeselectItemAtIndexPath(t,e){t.$isEditing()&&this.updateEditingToolBar()}contextMenuConfigurationForItemAtIndexPath(t,e,i){if(t.$isEditing())return;const s=i=>{const n=[];return i.items.forEach((i=>{i.items?n.push(s(i)):n.push(this.createUIAction({title:i.title,image:i.symbol,handler:()=>{i.handler(t,e,this.getActionByIndexPath(e))},destructive:i.destructive}))})),this.createUIMenu({title:i.title,image:i.symbol,actions:n,inline:i.inline,destructive:i.destructive})};return $objc(\"UIContextMenuConfiguration\").$configurationWithIdentifier_previewProvider_actionProvider(null,null,$block(\"UIMenu *, NSArray *\",(()=>s(this.menu))))}scrollViewDelegate(){const t=this.data.navigationView.view.scrollableView.events;return{\"scrollViewDidScroll:\":e=>{t.didScroll(e.jsValue())},\"scrollViewDidEndDragging:willDecelerate:\":(e,i)=>{t.didEndDragging(e.jsValue(),i)},\"scrollViewDidEndDecelerating:\":e=>{t.didEndDecelerating(e.jsValue())},\"handleRefresh:\":async t=>{this.kernel.setting.get(\"webdav.status\")?this.data.sync():(this.data.applySnapshotAnimatingDifferences(),t.$endRefreshing())}}}setRefreshControl(){const t=$objc(\"UIRefreshControl\").$alloc().$init();if(t.$addTarget_action_forControlEvents(this.collectionView.$delegate(),\"handleRefresh:\",4096),this.kernel.setting.get(\"webdav.status\")){const e=$l10n(\"MODIFIED\")+this.data.getLocalSyncDate().toLocaleString(),i=$objc(\"NSAttributedString\").$alloc().$initWithString(e);t.$setAttributedTitle(i)}this.collectionView.$setRefreshControl(t)}delegate(){const t={...this.scrollViewDelegate(),\"collectionView:shouldBeginMultipleSelectionInteractionAtIndexPath:\":(t,e)=>!1,\"collectionView:didSelectItemAtIndexPath:\":(t,e)=>{this.didSelectItemAtIndexPath(t,e)},\"collectionView:didDeselectItemAtIndexPath:\":(t,e)=>{this.didDeselectItemAtIndexPath(t,e)},\"collectionView:contextMenuConfigurationForItemsAtIndexPaths:point:\":(t,e,i)=>this.contextMenuConfigurationForItemAtIndexPath(t,e.$firstObject(),i),\"collectionView:contextMenuConfigurationForItemAtIndexPath:point:\":(t,e,i)=>this.contextMenuConfigurationForItemAtIndexPath(t,e,i),\"collectionView:layout:sizeForItemAtIndexPath:\":(t,e,i)=>{const s=this.views.spacing*(this.views.columns+1),r=(n.windowSize.width-s)/this.views.columns;return $size(r,this.views.itemHeight)},\"collectionView:layout:referenceSizeForHeaderInSection:\":(t,e,i)=>{const s=n.windowSize.width-2*this.views.spacing;return $size(s,this.views.headerHeight)}};return $delegate({type:\"UICollectionViewDelegate, UICollectionViewDelegateFlowLayout\",events:t})}itemsForBeginningDragSession(t,e){const i=this.getActionByIndexPath(e),s=$objc(\"NSItemProvider\").$alloc().$init();s.$setSuggestedName(i.name+\".json\"),s.$registerDataRepresentationForTypeIdentifier_visibility_loadHandler(\"public.text\",0,$block(\"NSProgress *, block\",(t=>{const e=this.data.actionToString(i.type,i.dir);return t($data({string:e}).ocValue(),null),null})));const n=$objc(\"UIDragItem\").$alloc().$initWithItemProvider(s),r=t.$localContext();if(r)r.$addObject(n);else{const e=NSMutableArray.$new();e.$addObject(n),t.$setLocalContext(e)}return[n]}dragDelegate(){return $delegate({type:\"UICollectionViewDragDelegate\",events:{\"collectionView:itemsForBeginningDragSession:atIndexPath:\":(t,e,i)=>this.itemsForBeginningDragSession(e,i)}})}reorder(t){const e=t.$items().$firstObject(),i=e.$sourceIndexPath().jsValue(),s=t.$destinationIndexPath(),n=s.jsValue();this.data.move(i,n),this.data.applySnapshotToSectionAnimatingDifferences(i.section),i.section!==n.section&&this.data.applySnapshotToSectionAnimatingDifferences(n.section),t.$dropItem_toItemAtIndexPath(e.$dragItem(),s)}dropItems(t){const e=t.$destinationIndexPath(),i=t.$items(),s=i.$count();for(let n=0;n<s;n++){const s=i.$objectAtIndex(n),r=this.createUICollectionViewDropPlaceholder(e),a=t.$dropItem_toPlaceholder(s.$dragItem(),r),o=a.$dragItem().$itemProvider(),l=o.$registeredTypeIdentifiers().jsValue();if(!o.$hasItemConformingToTypeIdentifier(\"public.text\")&&!hasImage)return;const h=(t,e)=>{e&&($ui.alert(e.jsValue()),this.kernel.logger.error(e.jsValue())),a.$commitInsertionWithDataSourceUpdates($block(\"void, NSIndexPath *\",(e=>{const i=(e=e.jsValue()).section,s=this.data.getActionTypes(),n=JSON.parse(t.jsValue().string),r=this.data.importAction(n,s[i]),a=this.data.actions[i].items;let o;for(const t in a)if(a[t].dir===r){o=t;break}void 0!==o&&this.data.move($indexPath(i,o),e),this.data.applySnapshotToSectionAnimatingDifferences(i)})))};o.$loadDataRepresentationForTypeIdentifier_completionHandler(l[0],$block(\"void, NSData *, NSError *\",((t,e)=>{$delay(0,(()=>h(t,e)))})))}}dropDelegate(){return $delegate({type:\"UICollectionViewDropDelegate\",events:{\"collectionView:canHandleDropSession:\":(t,e)=>!t.$isEditing(),\"collectionView:dropSessionDidUpdate:withDestinationIndexPath:\":(t,e,i)=>{const s=$objc(\"UICollectionViewDropProposal\").$alloc();return e.$localDragSession()?s.$initWithDropOperation_intent(3,1):s.$initWithDropOperation_intent(2,1),s},\"collectionView:performDropWithCoordinator:\":(t,e)=>{e.$session().$localDragSession()?this.reorder(e):this.dropItems(e)}}})}setDelegate(){this.collectionView=this.data.collectionView,this.collectionView.$setDelegate(this.delegate()),this.collectionView.$setCollectionViewLayout(this.views.collectionViewFlowLayout()),this.collectionView.$setDragDelegate(this.dragDelegate()),this.collectionView.$setDropDelegate(this.dropDelegate())}}})),s.register(\"7eNYp\",(function(t,e){var i=s(\"eSp9Z\"),n=i.ActionData,r=i.ActionEnv,a=s(\"gxpqj\"),o=a.UIKit,l=a.Sheet,h=a.BarButtonItem,c=s(\"4c0o0\"),d=s(\"2aNLD\");t.exports=class extends c{#L;keyboardId=\"keyboard.main\";actionsId=\"keyboard-list-actions\";keyboardSwitchLockId=\"keyboard-switch-lock\";keyboardSwitchLockKey=\"caio.keyboard.switch.lock\";deleteTimer=void 0;continuousDeleteTimer=void 0;continuousDeleteTapticTimer=void 0;continuousDeleteDelay=.5;matrixBoxMargin=10;navHeight=50;bottomBarHeight=50;bottomButtonSize=$size(46,40);itemBackground=$color(\"#FFFFFF\",$rgba(151,151,151,.4));buttonBackground=$color($rgba(0,0,0,.15),$rgba(117,117,117,.4));constructor(t){super(t),this.keyboardDisplayMode=this.kernel.setting.get(\"keyboard.displayMode\"),this.backgroundImage=this.kernel.setting.get(\"keyboard.background.image\")?.image,this.useBlur=this.backgroundImage&&this.kernel.setting.get(\"keyboard.blur\"),this.deleteDelay=this.kernel.setting.get(\"keyboard.deleteDelay\"),\"boolean\"!=typeof $cache.get(this.keyboardSwitchLockKey)&&$cache.set(this.keyboardSwitchLockKey,!1),this.views.listId+=\"keyboard\",this.views.tabLeftMargin=10,this.views.horizontalMargin=15,this.views.verticalMargin=12,this.views.copiedIndicatorSize=5,this.views.containerMargin=4,this.views.fontSize=14,this.views.tagHeight=this.views.verticalMargin+3,this.delegates.menuItemActionMaxCount=3}get keyboardHeight(){return this.kernel.setting.get(\"keyboard.previewAndHeight\")}get menu(){const t=this.delegates.menu.items;return{items:[t[0],t[2]]}}setKeyboardHeight(t){this.kernel.setting.set(\"keyboard.previewAndHeight\",t)}getKeyboardSwitchLock(){const t=$cache.get(this.keyboardSwitchLockKey);return\"boolean\"!=typeof t&&$cache.set(this.keyboardSwitchLockKey,!0),t}switchKeyboardSwitchLock(){const t=$cache.get(this.keyboardSwitchLockKey);$cache.set(this.keyboardSwitchLockKey,!t),$(this.keyboardSwitchLockId).symbol=t?\"lock.open\":\"lock\"}listReady(){this.setDelegate(),this.updateList(),this.kernel.setting.get(\"clipboard.autoSave\")&&$app.env===$env.keyboard&&(this.#L=$timer.schedule({interval:1,handler:()=>{this.kernel.setting.get(\"clipboard.autoSave\")?this.readClipboard():this.#L.invalidate()}}))}keyboardTapped(t,e=!0){return async(...i)=>{if(e&&this.kernel.setting.get(\"keyboard.tapticEngine\")&&$device.taptic(this.kernel.setting.get(\"keyboard.tapticEngineLevel\")),\"function\"==typeof t)try{await t(...i)}catch(t){throw this.kernel.logger.error(t),t}}}topButtonsView(){const t=[{symbol:\"keyboard.chevron.compact.down\",tapped:this.keyboardTapped((()=>$keyboard.dismiss()))},{symbol:\"square.and.arrow.down.on.square\",tapped:this.keyboardTapped((async t=>{t.start();try{await this.readClipboard(!0),t.done()}catch(e){throw t.cancel(),e}}))},{symbol:\"doc.on.clipboard\",tapped:this.keyboardTapped((()=>{$keyboard.insert($clipboard.text)}))},{symbol:\"bolt.circle\",tapped:this.keyboardTapped((()=>{let t=!0===$(this.actionsId).hidden;$(this.views.listId).hidden=t,$(this.actionsId).hidden=!t}))}];return{type:\"view\",views:t.map(((t,e)=>{const i=new h;return i.buttonEdges=0,i.setAlign(o.align.right).setSymbol(t.symbol).setEvent(\"tapped\",t.tapped).definition})),layout:(e,i)=>{const s=new h;e.height.equalTo(i.super),e.right.inset(this.views.containerMargin-s.edges),e.width.equalTo(s.width*t.length+s.edges)}}}getTopBarView(){return{type:\"view\",views:[{type:\"view\",layout:$layout.fill,views:[{type:\"image\",props:{image:$image(\"assets/icon.png\",\"assets/icon.white.png\")},events:{tapped:()=>this.kernel.openInJsbox(),ready:t=>{$cache.get(\"tips.keyboard.title\")||($cache.set(\"tips.keyboard.title\",!0),$ui.popover({sourceView:t,size:$size(200,60),directions:$popoverDirection.up,views:[{type:\"label\",props:{lines:0,text:$l10n(\"CLICK_TO_OPEN_JSBOX\"),align:$align.center},layout:$layout.fillSafeArea}]}))}},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(this.views.containerMargin),t.size.equalTo($size(28,28))}}].concat(super.getTabView(),this.topButtonsView())}],layout:(t,e)=>{t.top.width.equalTo(e.super),t.height.equalTo(this.navHeight)}}}#O(t,e){const i=this.bottomButtonSize,s=this.views.containerMargin,n=(n,r)=>{if(t.title){const e=$text.sizeThatFits({text:t.title,width:o.windowSize.width,font:$font(16)}),r=Math.ceil(e.width)+2*(s+12);n.size.equalTo($size(r,i.height))}else n.size.equalTo(i);n.centerY.equalTo(r.super),r.prev&&r.prev.info.align===e?e===o.align.right?n.right.equalTo(r.prev.left).offset(1.5*-s):n.left.equalTo(r.prev.right).offset(1.5*s):e===o.align.right?n.right.inset(s):n.left.inset(s)},r={type:\"button\",props:Object.assign({smoothCorners:!1,cornerRadius:5,symbol:t.symbol,title:t.title,id:t.id??$text.uuid,font:$font(16),bgcolor:this.useBlur?$color(\"clear\"):this.buttonBackground,tintColor:o.textColor,titleColor:o.textColor,info:{align:e}},t.menu?{menu:t.menu}:{}),events:Object.assign({},t.tapped?{tapped:t.tapped}:{},t.events),layout:$layout.fill};return this.useBlur?o.blurBox({info:{align:e},style:$blurStyle.ultraThinMaterial,smoothCorners:!1,cornerRadius:5},[r],n):{type:\"view\",props:{info:{align:e}},views:[r],layout:n}}getBottomBarView(){const t=[],e=[];$device.hasFaceID&&!$device.isIpadPro||t.push({symbol:\"globe\",tapped:this.keyboardTapped((()=>$keyboard.next())),menu:{pullDown:!0,items:[{title:$l10n(\"SWITCH_KEYBOARD\"),handler:this.keyboardTapped((()=>$keyboard.next()))},{title:$l10n(\"OPEN_IN_JSBOX\"),handler:()=>this.kernel.openInJsbox()}]}}),this.kernel.setting.get(\"keyboard.switchAfterInsert\")&&t.push({symbol:this.getKeyboardSwitchLock()?\"lock\":\"lock.open\",id:this.keyboardSwitchLockId,tapped:this.keyboardTapped((()=>this.switchKeyboardSwitchLock()))}),t.push({symbol:\"paperplane\",menu:{pullDown:!0,asPrimary:!0,items:d.getAddins().reverse().map((t=>({title:t,handler:this.keyboardTapped((()=>$addin.run(t)))})))}}),e.push({title:$l10n(\"SEND\"),tapped:this.keyboardTapped((()=>$keyboard.send()))},{symbol:\"delete.left\",events:{touchesBegan:this.keyboardTapped((async()=>{$keyboard.delete(),this.continuousDeleteTapticTimer=$delay(this.continuousDeleteDelay,(()=>this.keyboardTapped()())),this.continuousDeleteTimer=$delay(this.continuousDeleteDelay,(()=>{this.deleteTimer=$timer.schedule({interval:this.deleteDelay,handler:()=>$keyboard.delete()})}))})),touchesEnded:()=>{this.deleteTimer?.invalidate(),this.continuousDeleteTimer?.cancel(),this.continuousDeleteTapticTimer?.cancel(),this.deleteTimer=void 0,this.continuousDeleteTimer=void 0}}});const i={type:\"button\",props:{smoothCorners:!1,cornerRadius:5,title:$l10n(\"SPACE\"),font:$font(16),bgcolor:this.itemBackground,titleColor:o.textColor},events:{tapped:this.keyboardTapped((()=>{$keyboard.insert(\" \")}))},layout:(t,i)=>{let s=i.prev;for(let t=0;t<e.length;t++)s=s.prev;t.height.top.equalTo(i.prev),t.left.equalTo(s.right).offset(1.5*this.views.containerMargin),t.right.equalTo(i.prev.left).offset(1.5*-this.views.containerMargin)}};return{type:\"view\",views:[...t.map((t=>this.#O(t,o.align.left))),...e.map((t=>this.#O(t,o.align.right))),i],layout:(t,e)=>{t.bottom.equalTo(e.super.safeArea).offset(-2),t.left.right.equalTo(e.super.safeArea),t.height.equalTo(this.bottomBarHeight)}}}itemContainer(t){return this.useBlur?o.blurBox({style:$blurStyle.ultraThinMaterial},t,$layout.fill):{type:\"view\",props:{bgcolor:this.itemBackground},views:t,layout:$layout.fill}}get matrixTemplate(){return{props:{smoothCorners:!0,cornerRadius:2*this.views.containerMargin},views:[this.itemContainer([{type:\"view\",props:{id:\"copied\",circular:this.views.copiedIndicatorSize,hidden:!0,bgcolor:$color(\"green\")},layout:(t,e)=>{t.size.equalTo(this.views.copiedIndicatorSize),t.left.top.inset(this.matrixBoxMargin/2)}},{type:\"label\",props:{id:\"content\",lines:0,font:$font(20)},layout:(t,e)=>{t.top.left.right.equalTo(e.super).inset(this.matrixBoxMargin),t.height.lessThanOrEqualTo(e.super).offset(2*-this.matrixBoxMargin-this.views.tagHeight)}},{type:\"label\",props:{id:\"tag\",lines:1,color:this.tagColor,autoFontSize:!0,align:$align.leading},layout:(t,e)=>{t.left.right.equalTo(e.prev),t.height.equalTo(this.views.tagHeight),t.bottom.equalTo(e.super).inset(this.matrixBoxMargin)}}]),{type:\"image\",props:{id:\"image\",hidden:!0},layout:$layout.fill}]}}get itemSelect(){return(t,e)=>{const i=this.clips[e.row];i.image?l.quickLookImage(i.imageOriginal):($keyboard.insert(i.text),this.kernel.setting.get(\"keyboard.switchAfterInsert\")&&!this.getKeyboardSwitchLock()&&$keyboard.next())}}getMatrixView(){return{type:\"matrix\",props:{id:this.views.listId,bgcolor:$color(\"clear\"),menu:this.delegates.menu,direction:$scrollDirection.horizontal,square:!0,alwaysBounceVertical:!1,showsHorizontalIndicator:!1,alwaysBounceHorizontal:!0,columns:1,spacing:this.matrixBoxMargin,template:this.matrixTemplate,backgroundView:$ui.create(this.views.getEmptyBackground())},layout:(t,e)=>{t.top.inset(0),t.width.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom).offset(-1*(this.bottomBarHeight-this.navHeight))},events:{ready:()=>{this.delegates.isCollectionView=!0,this.listReady()},didSelect:this.itemSelect,itemSize:(t,e)=>{let i=this.keyboardHeight-this.navHeight-this.bottomBarHeight;return i-=2*this.matrixBoxMargin,$size(i,i)}}}}getListView(){const t=super.getListView();t.layout=(t,e)=>{t.top.equalTo(this.navHeight-1),t.width.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom).offset(-this.bottomBarHeight-this.views.containerMargin)},this.delegates.didSelectRowAtIndexPath=(t,e)=>{t=t.jsValue(),e=e.jsValue(),this.itemSelect(t,e)},this.delegates.shouldBeginMultipleSelectionInteractionAtIndexPath=()=>!1,t.props.separatorColor=$color(\"lightGray\"),t.props.separatorInset=$insets(0,this.views.horizontalMargin,0,this.views.horizontalMargin),delete t.events.pulled,t.props.header={props:{height:1}},t.props.style=2;const e=t.props.template.views[0].views;return t.props.template.views[0]=this.itemContainer(e),t}getDataView(){return 0===this.keyboardDisplayMode?this.getListView():this.getMatrixView()}getActionView(){return{type:\"view\",props:{id:this.actionsId,hidden:!0},views:[this.kernel.actions.views.getActionMiniView((async()=>new n({env:r.keyboard,textBeforeInput:$keyboard.textBeforeInput,textAfterInput:$keyboard.textAfterInput,text:$keyboard.selectedText??await $keyboard.getAllText(),allText:await $keyboard.getAllText(),selectedText:$keyboard.selectedText})))],layout:(t,e)=>{t.top.equalTo(this.navHeight),t.left.equalTo(this.views.containerMargin),t.right.equalTo(-this.views.containerMargin),t.bottom.equalTo(-this.bottomBarHeight)}}}getView(){const t={type:\"view\",views:[{type:\"image\",props:{image:this.backgroundImage},layout:$layout.fill},{type:\"view\",props:{bgcolor:$color(\"clear\",$rgba(0,0,0,.3))},layout:$layout.fill}],layout:$layout.fill};return{type:\"view\",props:{id:this.keyboardId},views:[this.backgroundImage?t:{},this.getDataView(),this.getTopBarView(),this.getBottomBarView(),this.getActionView()],layout:(t,e)=>{t.width.bottom.equalTo(e.super),t.height.equalTo(this.keyboardHeight)}}}}})),s.register(\"2aNLD\",(function(t,e){var i=s(\"gxpqj\").Sheet;class n{constructor(){this.listId=\"keyboard-script-list\"}static getAddins(){const t=$cache.get(\"keyboard.addins\");if(!t)return[];if($cache.get(\"keyboard.addins.all\")){const t=$addin.current.name;return $addin.list?.filter((e=>t!==e.displayName)).map((t=>t.displayName))}try{return JSON.parse(t)}catch(t){return[]}}static setAddins(t=[]){t.map(((e,i)=>{null===e&&t.splice(i,1)}));try{$cache.set(\"keyboard.addins\",JSON.stringify(t))}catch(t){$cache.set(\"keyboard.addins\",void 0)}}static setAllAddins(t){$cache.set(\"keyboard.addins.all\",t)}getUnsetAddins(){const t=$addin.current.name,e=n.getAddins();return $addin.list?.filter((i=>-1===e.indexOf(i.displayName)&&t!==i.displayName)).map((t=>t.displayName))}add(){const t={type:\"list\",props:{data:this.getUnsetAddins()},events:{didSelect:(t,e,i)=>{const s=n.getAddins();s.unshift(i),n.setAddins(s),$(this.listId).insert({indexPath:$indexPath(0,0),value:i}),t.delete(e)}},layout:$layout.fill};(new i).setView(t).addNavBar({title:$l10n(\"ADD\")}).init().present()}getNavButtons(){return[{symbol:\"plus\",tapped:()=>this.add()}]}getListView(){return{type:\"list\",props:{id:this.listId,reorder:!0,data:n.getAddins(),actions:[{title:\"delete\",handler:(t,e)=>{n.setAddins(t.data)}}]},events:{reorderFinished:t=>{n.setAddins(t)}},layout:$layout.fill}}static async sheet(){if(0===(await $ui.menu({items:[$l10n(\"ALL_SCRIPTS\"),$l10n(\"SELECT_SCRIPTS\")]})).index)n.setAllAddins(!0);else{n.setAllAddins(!1);const t=new i,e=new n;t.setView(e.getListView()).addNavBar({title:$l10n(\"QUICK_START_SCRIPTS\"),popButton:{title:$l10n(\"DONE\")},rightButtons:e.getNavButtons()}),t.init().present()}}}t.exports=n})),s.register(\"49je6\",(function(t,e){var i=s(\"eSp9Z\"),n=i.ActionData,r=i.ActionEnv,a=s(\"gxpqj\"),o=a.View,l=a.UIKit,h=a.BarButtonItem,c=s(\"4c0o0\"),d=s(\"ilpYs\");t.exports=class extends c{actionsId=\"today-list-actions\";listContainerId=\"today-list-container\";readClipboardButtonId=\"today-nav-readClipboard\";pageIndexId=\"today-list-page-index\";navHeight=34;taptic=1;inLauncher=$app.env===$env.today&&-1===$app.widgetIndex;launcherNavHeight=44;constructor(t){super(t),this.tabItems.push($l10n(\"ACTIONS\")),this.todayActions=new d(this.kernel),this.setClipboarPageSize($widget.mode),this.listPageNow=[0,0],this.listSection=Math.min(this.tabIndex,1),this.views.listId+=\"today\",this.views.tabLeftMargin=8,this.views.horizontalMargin=15,this.views.verticalMargin=5,this.views.copiedIndicatorSize=5,this.views.fontSize=14,this.views.tagHeight=12,this.views.tagColor=$color(\"gray\",\"lightGray\"),this.views.setSingleLine()}get isActionPage(){return 2===this.tabIndex}set tabIndex(t){$cache.set(\"caio.today.tab.index\",t)}get tabIndex(){return $cache.get(\"caio.today.tab.index\")??0}get menu(){const t=this.delegates.defaultMenuItems.reverse();return t[0].items=t[0].items.reverse(),{items:t}}getByIndex(t){\"object\"==typeof t&&(t=t.row);return t+=this.listPageSize*this.listPageNow[this.listSection],this.clips[t]}listReady(){$widget.modeChanged=t=>{this.setClipboarPageSize(t),this.isActionPage||this.updateList()},this.setClipboarPageSize($widget.mode),this.isActionPage||this.updateList(),this.appListen(),$delay(.5,(()=>this.readClipboard()))}async readClipboard(t=!1){this.isActionPage||$app.env!==$env.today||await super.readClipboard(t)}setClipboarPageSize(t){if(0===t)this.listPageSize=1;else{const t=(($app.env===$env.app?l.windowSize.height:$widget.height)-2*this.navHeight-(this.inLauncher?this.launcherNavHeight:0))/(this.views.singleLineContentHeight+this.views.verticalMargin+Math.max(this.views.tagHeight,this.views.verticalMargin)),e=Math.floor(t);this.listPageSize=e,t-e>=.6&&this.listPageSize++}}buttonTapped(t,e=!0){return async(...i)=>{e&&this.kernel.setting.get(\"keyboard.tapticEngine\")&&$device.taptic(this.taptic),await t(...i)}}switchTab(t){this.tabIndex=t,this.isActionPage?($(this.listContainerId).hidden=!0,$(this.actionsId).hidden=!1,$(this.readClipboardButtonId).hidden=!0):(this.listSection=t,$(this.actionsId).hidden=!0,$(this.listContainerId).hidden=!1,$(this.readClipboardButtonId).hidden=!1,this.updateList())}getNavBarView(){const t=[{symbol:\"square.and.arrow.down.on.square\",props:{id:this.readClipboardButtonId,hidden:this.isActionPage},tapped:this.buttonTapped((async t=>{t.start();try{await this.readClipboard(!0),t.done()}catch(e){throw t.cancel(),e}}))}].map((t=>{const e=new h;return e.setAlign(l.align.right).setSymbol(t.symbol).setEvent(\"tapped\",t.tapped).setProps(t.props??{}),e.definition}));return{type:\"view\",views:[{type:\"view\",layout:$layout.fill,views:[this.getTabView(),...t]}],layout:(t,e)=>{t.top.width.equalTo(e.super),t.height.equalTo(this.navHeight)}}}getBottomBarView(){const t=t=>({type:\"button\",props:{symbol:t===l.align.left?\"chevron.backward.circle\":\"chevron.forward.circle\",bgcolor:$color(\"clear\"),tintColor:l.textColor},layout:i=>{t===l.align.left?i.left.inset(this.views.horizontalMargin):i.right.inset(this.views.horizontalMargin),i.centerY.equalTo(e.super)},events:{tapped:this.buttonTapped((()=>{t===l.align.left?this.clipboardPrevPage():this.clipboardNextPage()}))}}),e={type:\"view\",views:[t(l.align.left),t(l.align.right),{type:\"label\",props:{id:this.pageIndexId,align:$align.center,text:this.listPageNow[this.listSection]+1},layout:(t,e)=>{t.bottom.left.right.equalTo(e.super.safeArea),t.center.equalTo(e.super)}}],layout:(t,e)=>{t.bottom.left.right.equalTo(e.super.safeArea),t.height.equalTo(this.navHeight)}};return e}delete(...t){super.delete(...t),this.updateList()}updateList(t=!1){t&&this.setNeedReload();const e=this.listPageNow[this.listSection]*this.listPageSize,i=e+this.listPageSize,s=this.clips;$(this.views.listId).data=s.slice(e,i).map((t=>this.views.lineData(t,this.copied.uuid===t.uuid)));const n=this.listPageNow[this.listSection]+1,r=Math.ceil(s.length/this.listPageSize);$(this.pageIndexId).text=`${n}/${r}`}clipboardPrevPage(){this.listPageNow[this.listSection]>0&&(this.listPageNow[this.listSection]--,this.updateList())}clipboardNextPage(){const t=Math.ceil(this.clips.length/this.listPageSize);this.listPageNow[this.listSection]<t-1&&(this.listPageNow[this.listSection]++,this.updateList())}getListView(){return{type:\"view\",props:{id:this.listContainerId,hidden:this.isActionPage},views:[{type:\"list\",props:{id:this.views.listId,scrollEnabled:!1,bgcolor:$color(\"clear\"),menu:this.menu,separatorInset:$insets(0,this.views.horizontalMargin,0,this.views.horizontalMargin),data:[],template:this.views.listTemplate()},events:{ready:()=>this.listReady(),rowHeight:(t,e)=>{const i=this.getByIndex(e),s=i.hasTag?this.views.tagHeight:this.views.verticalMargin,n=i.image?this.views.imageContentHeight:this.views.getContentHeight(i.text);return this.views.verticalMargin+n+s},didSelect:this.buttonTapped(((t,e)=>{const i=this.getByIndex(e);i.image?$clipboard.image=i.imageOriginal:(this.setClipboardText(i.text),this.setCopied(i.uuid)),$ui.toast($l10n(\"COPIED\"))}))},layout:(t,e)=>{t.top.width.equalTo(e.super),t.bottom.equalTo(e.super).offset(-this.navHeight)}},this.getBottomBarView()],layout:(t,e)=>{t.top.equalTo(this.navHeight),t.bottom.left.right.equalTo(e.super.safeArea)}}}getActionView(){let t=this.todayActions.getActions();return 0===t.length&&(t=Object.values(this.kernel.actions.allActions)),{type:\"view\",props:{id:this.actionsId,hidden:!this.isActionPage},views:[this.kernel.actions.views.getActionMiniView((t=>new n({env:r.today,text:\"clipboard\"===t.type||\"uncategorized\"===t.type?$clipboard.text:null})),t)],layout:(t,e)=>{t.top.equalTo(this.navHeight),t.left.right.bottom.equalTo(e.super.safeArea)}}}getView(){return o.create({props:{titleColor:l.textColor,barColor:l.primaryViewBackgroundColor},views:[{type:\"view\",views:[this.getNavBarView(),this.getActionView(),this.getListView()],layout:$layout.fill}],events:{appeared:async()=>{if($app.env!==$env.today)return;const t=$timer.schedule({interval:0,handler:()=>{$ui.animate({duration:.3,animation:()=>{$ui.vc.ocValue().$view().$setBackgroundColor($color(\"clear\"))},completion:()=>{t.invalidate()}})}})}}})}}})),s.register(\"ilpYs\",(function(t,e){var i=s(\"gxpqj\").Sheet;class n{constructor(t){this.listId=\"today-action-list\",this.kernel=t}getActions(){let t=$cache.get(\"today.actions\")??[];\"string\"==typeof t&&(t=JSON.parse(t),this.setActions(t));const e=[];let i=!1;return t.forEach((t=>{const s=this.kernel.actions.allActions[t.name];s?e.push(s):i=!0})),i&&this.setActions(e),e}setActions(t=[]){t.map(((e,i)=>{e||t.splice(i,1)})),$cache.set(\"today.actions\",t)}getUnsetActions(){const t=this.getActions().map((t=>t.name)),e=[];return Object.values(this.kernel.actions.allActions).forEach((i=>{const s=i.name;-1===t.indexOf(s)&&e.push(i)})),e}getListData(t){return t.map((t=>({action:{text:t.name,info:t},icon:\"icon_\"===t.icon.slice(0,5)?{icon:$icon(t.icon.slice(5,t.icon.indexOf(\".\")),$color(\"#ffffff\"))}:{image:$image(t.icon)},color:{bgcolor:this.kernel.actions.views.getColor(t.color)}})))}getListTemplate(){return{views:[{type:\"image\",props:{id:\"color\",cornerRadius:8,smoothCorners:!0},layout:t=>{t.top.left.inset(10),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:\"icon\",tintColor:$color(\"#ffffff\")},layout:t=>{t.top.left.inset(15),t.size.equalTo($size(20,20))}},{type:\"label\",props:{id:\"action\"},layout:(t,e)=>{t.bottom.top.inset(10),t.left.equalTo(e.prev.prev.right).offset(10),t.right.inset(10)}}]}}add(){const t={type:\"list\",props:{data:this.getListData(this.getUnsetActions()),template:this.getListTemplate(),rowHeight:50},events:{didSelect:(t,e,i)=>{const s=i.action.info,n=this.getActions();n.unshift(s),this.setActions(n),$(this.listId).insert({indexPath:$indexPath(0,0),value:this.getListData([s])[0]}),t.delete(e)}},layout:$layout.fill};(new i).setView(t).addNavBar({title:$l10n(\"ADD\"),popButton:{title:$l10n(\"CLOSE\")}}).init().present()}getNavButtons(){return[{symbol:\"plus\",tapped:()=>this.add()}]}getListView(){return{type:\"list\",props:{id:this.listId,data:this.getListData(this.getActions()),template:this.getListTemplate(),rowHeight:50,reorder:!0,actions:[{title:\"delete\",handler:(t,e)=>{this.setActions(t.data.map((t=>t.action.info)))}}]},events:{reorderFinished:t=>{const e=[];t.forEach((t=>{e.push(t.action.info)})),this.setActions(e)}},layout:$layout.fill}}static sheet(t){const e=new i,s=new n(t);e.setView(s.getListView()).addNavBar({title:$l10n(\"ACTIONS\"),popButton:{title:$l10n(\"CLOSE\")},rightButtons:s.getNavButtons()}),e.init().present()}}t.exports=n})),s.register(\"gD12U\",(function(t,e){var i=s(\"gxpqj\"),n=i.Logger,r=i.Setting,a=i.FileStorage,o=s(\"2EAPF\"),l=s(\"jEwwi\").Storage;const h=new a;class c{static widgetInstance(t,...e){if($file.exists(`/scripts/widget/${t}.js`)){const{Widget:i}=require(`./widget/${t}.js`);return new i(...e)}return!1}static kernel(){const t=new n;t.printToFile(h,\"logs/widget.log\");const e={setting:new r({fileStorage:h,structure:o}),fileStorage:h,print:()=>{},error:e=>{t.error(e)}};e.setting.setReadonly();const i=new l(e);return e.storage=i,e}static renderError(){$widget.setTimeline({render:()=>({type:\"text\",props:{text:\"Invalid argument\"}})})}static renderClipboard(){(new r).setReadonly();c.widgetInstance(\"Clipboard\",c.kernel()).render()}static render(t=$widget.inputValue){\"Clipboard\"===(t=t??\"Clipboard\")?c.renderClipboard():c.renderError()}}t.exports={Widget:c,run:()=>{c.render()}}})),s.register(\"6olY1\",(function(t,e){var i=s(\"gxpqj\"),n=i.UIKit,r=i.ViewController,a=i.TabBarController,o=s(\"8Makm\").AppKernelBase,l=s(\"gYDdO\"),h=s(\"iuWEe\");class c extends o{constructor(){super(),this.query=$context.query,h(this)}}class d{static kernel=$app.env!==$env.widget?new c:void 0;static renderMainUI(){const t={clips:{icon:\"doc.on.clipboard\",title:$l10n(\"CLIPS\")},actions:{icon:\"command\",title:$l10n(\"ACTIONS\")},setting:{icon:\"gear\",title:$l10n(\"SETTING\")}};if(this.kernel.setting.setEvent(\"onSet\",(t=>{\"mainUIDisplayMode\"===t&&$delay(.3,(()=>n.isTaio?$actions.restart():$addin.restart()))})),0===this.kernel.setting.get(\"mainUIDisplayMode\"))this.kernel.useJsboxNav(),this.kernel.setting.useJsboxNav(),this.kernel.setNavButtons([{symbol:t.setting.icon,title:t.setting.title,handler:()=>{n.push({title:t.setting.title,views:[this.kernel.setting.getListView()]})}},{symbol:t.actions.icon,title:t.actions.title,handler:()=>{this.kernel.actions.present()}}]),this.kernel.UIRender(this.kernel.clips.getNavigationView().getPage());else{this.kernel.fileManager.setViewController(new r),this.kernel.tabBarController=new a;const e=this.kernel.clips.getNavigationView();this.kernel.tabBarController.setPages({clips:e.getPage(),actions:this.kernel.actions.getPage(),setting:this.kernel.setting.getPage()}).setCells({clips:t.clips,actions:t.actions,setting:t.setting}),this.kernel.UIRender(this.kernel.tabBarController.generateView().definition)}}}t.exports={run:()=>{l(d.kernel),d.renderMainUI()}}})),s.register(\"gYDdO\",(function(t,e){class i{files=[];databases=[];actions={};constructor(t){this.kernel=t}deleteFiles(t){t.forEach((t=>{this.files.includes(t)||this.files.push(t)}))}#N(){this.files.forEach((t=>{$file.exists(t)&&(this.kernel.logger.info(`delete file: ${t}`),$file.delete(t))}))}rebuildDatabase(t,e){this.databases.push([t,e])}#P(){const t=(t,e)=>{const i=this.kernel.storage.sqlite.query(`SELECT count(*), name FROM sqlite_master WHERE type = \"table\" AND name = \"${t}\"`);if(null!==i.error)throw new Error(`Code [${i.error.code}] ${i.error.domain} ${i.error.localizedDescription}`);i.result.next();const s=i.result.get(0);i.result.close(),s>0&&(this.kernel.logger.info(`copy data from old table: ${t}`),this.kernel.storage.sqlite.update(`INSERT INTO ${e} SELECT * FROM ${t}`),this.kernel.logger.info(`drop table: ${t}`),this.kernel.storage.sqlite.update(`DROP TABLE ${t}`))};this.databases.forEach((e=>{t(e[0],e[1])}))}rebuildUserActions(t={}){for(let e of Object.keys(t))t[e].forEach((t=>{this.actions[e]||(this.actions[e]=[]),this.actions[e].includes(t)||this.actions[e].push(t)}))}async#V(){if(0===Object.keys(this.actions).length)return;const t=\"scripts/action\",e=`${this.kernel.fileStorage.basePath}/user_action`,i=[];for(let e of Object.keys(this.actions))this.actions[e].forEach((s=>{let n;const r=`${t}/${e}/${s}/config.json`;n=$file.exists(r)?JSON.parse($file.read(`${t}/${e}/${s}/config.json`).string):__INFO__,i.push(n.name)}));if(1!==(await $ui.alert({title:$l10n(\"compatibility.rebuildUserAction.alert.title\"),message:$l10n(\"compatibility.rebuildUserAction.alert.message\")+\"\\n\"+JSON.stringify(i,null,2)+\"\\n\"+$l10n(\"compatibility.rebuildUserAction.alert.message2\"),actions:[{title:$l10n(\"OK\")},{title:$l10n(\"CANCEL\")}]})).index){for(let i of Object.keys(this.actions))this.actions[i].forEach((s=>{$file.exists(`${e}/${i}/${s}`)&&(this.kernel.logger.info(`rebuild user action: ${i}/${s}`),$file.copy({src:`${t}/${i}/${s}/main.js`,dst:`${e}/${i}/${s}/main.js`}))}));this.kernel.actions.setNeedReload()}}async do(){this.#N(),this.#P(),await this.#V()}}class s{version=7;userVersion=$cache.get(\"compatibility.version\")??0;constructor(t){this.kernel=t,this.compatibility=new i(this.kernel)}do(){if(this.userVersion>0&&this.userVersion<this.version){this.kernel.logger.info(`compatibility: userVersion [${this.userVersion}] lower than [${this.version}]`);for(let t=this.userVersion+1;t<=this.version;t++)this.call(t);this.compatibility.do().catch((t=>this.kernel.logger.error(t)))}$cache.set(\"compatibility.version\",this.version)}call(t){if(\"function\"!=typeof this[`ver${t}`])throw new ReferenceError(`Version ${t} undefined`);this[`ver${t}`]()}ver1(){this.compatibility.deleteFiles([\"scripts/action/clipboard/ClearClipboard\",\"scripts/ui/clipboard.js\",\"scripts/ui/clipboard-data.js\",\"scripts/ui/clipboard-search.js\"]),this.compatibility.rebuildDatabase(\"clipboard\",\"clips\"),this.compatibility.rebuildUserActions({uncategorized:[\"ExportAllContent\",\"DisplayClipboard\"],clipboard:[\"B23Clean\"]}),$cache.get(\"caio.keyboard.height\")&&(this.kernel.setting.set(\"keyboard.previewAndHeight\",$cache.get(\"caio.keyboard.height\")),$cache.remove(\"caio.keyboard.height\"))}ver2(){this.compatibility.deleteFiles([\"scripts/storage.js\",\"scripts/ui/clips-data.js\",\"scripts/ui/components/action-manager-data.js\"]),this.compatibility.rebuildDatabase(\"pin\",\"favorite\"),this.compatibility.rebuildUserActions({uncategorized:[\"ExportAllContent\"]})}ver3(){this.compatibility.rebuildUserActions({clipboard:[\"SendToWin\"]})}ver4(){const t=\"/storage/user_action/data.json\";if($file.exists(t)){const e=JSON.parse($file.read(t).string).date;$file.write({data:$data({string:JSON.stringify({timestamp:e})}),path:\"/storage/user_action/sync.json\"}),$file.delete(t)}}ver5(){this.compatibility.rebuildUserActions({uncategorized:[\"DisplayClipboard\"]})}ver6(){this.compatibility.rebuildUserActions({clipboard:[\"GetFromWin\"]})}ver7(){this.compatibility.rebuildUserActions({uncategorized:[\"Replace\"]})}}t.exports=async function(t){if(t)try{new s(t).do()}catch(e){throw t.logger.error(e),e}}})),s.register(\"iuWEe\",(function(t,e){var i=s(\"gxpqj\"),n=i.Kernel,r=i.UIKit,a=s(\"2aNLD\"),o=s(\"ilpYs\");let l;function h(){l.setting.method.exportClipboard=t=>{t.start(),l.storage.export((e=>{e?t.done():t.cancel()}))},l.setting.method.importClipboard=t=>{t.start(),$ui.alert({title:$l10n(\"ALERT_INFO\"),message:$l10n(\"OVERWRITE_ALERT\"),actions:[{title:$l10n(\"OK\"),handler:()=>{$drive.open({handler:e=>{void 0!==e?\"db\"===e.fileName.slice(-2)||\"zip\"===e.fileName.slice(-3)?l.storage.import(e).then((()=>{t.done(),$delay(.3,(()=>{$addin.restart()}))})).catch((e=>{$ui.error(e),l.logger.error(e),t.cancel()})):($ui.warning($l10n(\"FILE_TYPE_ERROR\")),t.cancel()):t.cancel()}})}},{title:$l10n(\"CANCEL\"),handler:()=>t.cancel()}]})},l.setting.method.rebuildDatabase=t=>{t.start();$ui.alert({title:$l10n(\"REBUILD_DATABASE_ALERT\"),actions:[{title:$l10n(\"REBUILD\"),style:$alertActionType.destructive,handler:()=>{(()=>{try{l.storage.rebuild(),t.done(),$delay(.8,(()=>$addin.restart()))}catch(e){t.cancel(),$ui.alert(e)}})()}},{title:$l10n(\"CANCEL\"),handler:()=>{t.cancel()}}]})},l.setting.method.deleteAllData=t=>{t.start(),$ui.alert({title:$l10n(\"DELETE_ALL_DATA_ALERT\"),actions:[{title:$l10n(\"DELETE\"),style:$alertActionType.destructive,handler:()=>{l.storage.deleteAllData(),t.done(),$delay(.5,(()=>$addin.restart()))}},{title:$l10n(\"CANCEL\"),handler:()=>{t.cancel()}}]})};const t=$text.uuid,e=()=>l.clips.getRecycleBin().map((t=>t?.text??\"None\"));l.setting.method.recycleBin=()=>({type:\"list\",props:{id:t,data:e(),actions:[{title:\"delete\",handler:(t,e)=>{l.clips.removeFromRecycleBin(e.row)}}]},events:{didSelect:(t,e)=>{const i=l.clips.getRecycleBin()[e.row]??{};if(i.text){const s=l.clips.addItem(i.text);i.tag&&l.storage.setTag(s.uuid,i.tag),l.clips.removeFromRecycleBin(e.row),l.clips.updateList(!0),t.delete(e)}}},layout:$layout.fill}),l.setting.method.recycleBinNavButtons=()=>[{symbol:\"trash\",tapped:()=>{r.deleteConfirm($l10n(\"DELETE_TABLE\").replace(\"${table}\",$l10n(\"RECYCLE_BIN\")),(()=>{l.clips.clearRecycleBin(),$(t).data=e()}))}}]}t.exports=function(t){l=t,l.setting.method.checkUpdate=async t=>{t.start();const e=\"scripts/libs/easy-jsbox.js\";if($file.exists(e))try{const t=await l.checkUpdate();t&&($file.write({data:$data({string:t}),path:e}),$ui.toast(\"The framework has been updated.\"))}catch{}const i=await $http.get({url:\"https://raw.githubusercontent.com/ipuppet/CAIO/master/config.json\"}),s=i.data?.info.version;let r;try{r=__INFO__}catch{r=JSON.parse($file.read(\"config.json\").string).info}n.versionCompare(s,r.version)>0?$ui.alert({title:\"New Version\",message:`New version found: ${s}\\nUpdate via Github or click the button to open Erots.`,actions:[{title:$l10n(\"CANCEL\")},{title:\"Erots\",handler:()=>{$addin.run({name:\"Erots\",query:{q:\"show\",objectId:\"603e6eaaca0dd64fcef93e2d\"}})}}]}):$ui.toast(\"No need to update\"),t.done()},l.setting.method.previewWidget=t=>{const{Widget:e}=s(\"gD12U\"),i={};try{JSON.parse($file.read(\"widget-options.json\").string).forEach((t=>{i[t.name]=t.value}))}catch(t){return void $ui.error(t)}$ui.menu({items:Object.keys(i),handler:t=>{e.render(i[t])}})},l.setting.method.fileManager=()=>{l.fileManager.push(\"storage\")},h(),l.setting.method.exportAction=t=>{t.start();const e=\"actions.zip\",i=`/${e}`,s=l.fileStorage.filePath(i);$archiver.zip({directory:l.actions.userActionPath,dest:s,handler:()=>{$share.sheet({items:[{name:e,data:$data({path:s})}],handler:e=>{e?t.done():t.cancel(),l.fileStorage.delete(i)}})}})},l.setting.method.importAction=t=>{t.start(),$drive.open({handler:e=>{if(void 0!==e)if(\"zip\"===e.fileName.slice(-3)){const i=`${l.fileStorage.basePath}/action_import`;$archiver.unzip({file:e,dest:i,handler:()=>{$file.list(i).forEach((t=>{$file.isDirectory(`${i}/${t}`)&&$file.copy({src:`${i}/${t}`,dst:`${l.actions.userActionPath}/${t}`})})),$file.delete(i),t.done()}})}else $ui.warning($l10n(\"FILE_TYPE_ERROR\")),t.cancel();else t.cancel()}})},l.setting.method.importExampleAction=t=>{t.start(),l.actions.importExampleAction(),t.done()},l.setting.method.rebuildAction=t=>{t.start(),$ui.alert({title:$l10n(\"REBUILD_ACTION_DATABASE_ALERT_TITLE\"),message:$l10n(\"REBUILD_ACTION_DATABASE_ALERT_MESSAGE\"),actions:[{title:$l10n(\"REBUILD\"),style:$alertActionType.destructive,handler:()=>{$file.delete(l.actions.userActionPath),l.actions.setNeedReload(),t.done(),$delay(.8,(()=>$addin.restart()))}},{title:$l10n(\"CANCEL\"),handler:()=>t.cancel()}]})},function(){const t=s(\"7eNYp\"),e=200;l.setting.method.previewKeyboard=()=>{const i=new t(l),s=t=>{i.setKeyboardHeight(t),$(i.keyboardId).updateLayout((t=>{t.height.equalTo(i.keyboardHeight)})),1===i.keyboardDisplayMode&&$(i.keyboardId).get(i.listId).reload()},n=t=>(t-e)/200;return{views:[{type:\"label\",layout:(t,e)=>{t.top.inset(20),t.centerX.equalTo(e.super)},events:{ready:t=>t.text=i.keyboardHeight,tapped:t=>{$input.text({type:$kbType.number,text:i.keyboardHeight,handler:i=>{if(/^[0-9]+$/.test(i)){let r=Number(i);r=Math.min(r,400),r=Math.max(r,e),t.text=r,t.next.value=n(r),s(r)}else $ui.toast(\"Only integers can be entered.\")}})}}},{type:\"slider\",props:{max:1,min:0},layout:(t,e)=>{t.top.equalTo(e.prev.bottom),t.right.inset(20),t.width.equalTo(e.super).offset(-40)},events:{ready:t=>t.value=n(i.keyboardHeight),changed:t=>{const i=Math.floor(200*t.value+e);t.prev.text=i,s(i)}}},i.getView()],layout:(t,e)=>{t.left.right.bottom.equalTo(e.super.safeArea);let i=0;1===l.setting.get(\"mainUIDisplayMode\")&&(i=r.NavigationBarNormalHeight),t.top.equalTo(e.super.safeArea).inset(i)}}},l.setting.method.setKeyboardQuickStart=()=>a.sheet()}(),l.setting.method.previewTodayWidget=t=>{const e=new(s(\"49je6\"))(l).getView();r.push({views:[e]})},l.setting.method.setTodayWidgetActions=t=>{o.sheet(l)}}})),$app.strings={en:{ALERT_INFO:\"Alert\",NONE:\"Nothing\",DONE:\"Done\",CLOSE:\"Close\",FAILED_TO_LOAD_VIEW:\"Faild to load view\",VIEW_NOT_PROVIDED:\"The view is not provided\",UNCATEGORIZED:\"Uncategorized\",SHARE:\"Share\",CLICK_TO_OPEN_JSBOX:\"Click the title to open the main app.\",CLIPS:\"Clips\",CLIPBOARD:\"Clipboard\",UNIVERSAL_CLIPBOARD:\"Universal Clipboard\",UNIVERSAL_CLIPBOARD_TIPS:\"Universal Clipboard allows you to copy something on your iPhone, and paste it on your Mac–or vice-versa–using iCloud.\",CLIPS_STRUCTURE_ERROR:\"Clips data structure is abnormal\",CLIPBOARD_NO_CHANGE:\"Clipboard no change\",RECYCLE_BIN:\"Recycle Bin\",ADD:\"Add\",TAG:\"Tag\",ADD_TAG:\"Add Tag\",EDIT:\"Edit\",SEARCH:\"Search\",SEARCH_HISTORY:\"Search History\",SEARCH_RESULT:\"Search Result\",NO_SEARCH_RESULT:\"No item found.\",FAVORITE:\"Favorite\",COPY:\"Copy\",COPIED:\"Copied\",SORT:\"Sort\",ACTIONS:\"Actions\",MORE_ACTIONS:\"More Actions\",PREVIEW:\"Preview\",MAX_ITEM_LENGTH:\"Line Limit\",TEXT_MAX_LENGTH:\"Display Character Length\",AUTO_SAVE:\"Auto Save\",AUTO_SYNC:\"Auto Sync\",SYNC_NOW:\"Sync Now\",UNZIP_FAILED:\"Unzip file failed\",REBUILD:\"Rebuild\",REBUILD_DATABASE:\"Rebuild Database\",REBUILD_DATABASE_ALERT:\"Rebuilding the database will lose the order information, do you want to confirm the rebuild?\",DELETE_ALL_DATA:\"Delete All Data\",DELETE_ALL_DATA_ALERT:\"Are you sure you want to delete all your data?\",DELETE_DATA:\"Delete Data\",DELETE_TABLE:\"Delete all data from `${table}`?\",SELECT_ALL:\"Select All\",DESELECT_ALL:\"Deselect All\",EDITOR:\"Editor\",CREATE_NEW:\"Create New\",CREATE_NEW_ACTION:\"New Action\",CREATE_NEW_TYPE:\"New Category\",TYPE_ALREADY_EXISTS:\"This category already exists\",EDIT_DETAILS:\"Edit Details\",EDIT_SCRIPT:\"Edit Script\",INFORMATION:\"Information\",NAME:\"Name\",ICON:\"Icon\",TYPE:\"Category\",DESCRIPTION:\"Description\",CODE:\"Code\",TEXT_INSETS:\"Text bottom margin\",SHOW_LINE_NUMBER:\"Show line number\",LIGHT_MODE_THEME:\"Light Mode Theme\",DARK_MODE_THEME:\"Dark Mode Theme\",SAVE:\"Save\",SAVE_SUCCESS:\"Save success\",SAVE_ERROR:\"Save failed\",DELETE:\"Delete\",CONFIRM:\"Confirm\",DELETE_CONFIRM_MSG:\"Are you sure you want to delete?\",DELETE_SUCCESS:\"Delete success\",DELETE_ERROR:\"Delete failed\",IMPORT_EXAMPLE_ACTIONS:\"Import example actions\",REBUILD_ACTION_DATABASE:\"Rebuild Action Database\",REBUILD_ACTION_DATABASE_ALERT_TITLE:\"Are you sure you want to rebuild?\",REBUILD_ACTION_DATABASE_ALERT_MESSAGE:\"Rebuild also deletes the data saved in WebDAV Drive! (If enabled)\",EXPORT:\"Export\",IMPORT:\"Import\",FILE_TYPE_ERROR:\"File type does not match\",OVERWRITE_ALERT:\"This operation will overwrite the current data. Do you want to continue?\",UNABLE_CREATE_ACTION:\"Unable to create action\",ACTION_NAME_ALREADY_EXISTS:\"Action `${name}` already exists\",IMPORT_FROM_FILE:\"Import from Files\",KEYBOARD:\"Keyboard\",KEYBOARD_HEIGHT:\"Keyboard Height\",USE_BLUR:\"Use Blur\",BACKGROUND_IMAGE:\"Background Image\",DELETE_DELAY:\"Delete Delay\",SWITCH_AFTER_INSERT:\"Switch After Insert\",JSBOX_TOOLBAR:\"JSBox Toolbar\",QUICK_START_SCRIPTS:\"Quick Start Scripts\",SEND:\"Send\",OPEN_IN_JSBOX:\"Open in JSBox\",SWITCH_KEYBOARD:\"Switch Keyboard\",TAPTIC_ENGINE:\"Taptic Engine\",TAPTIC_ENGINE_LEVEL:\"Taptic Engine Level\",TAPTIC_ENGINE_FOR_DELETE:\"Taptic Engine For Delete\",SPACE:\"Space\",ALL_SCRIPTS:\"All Scripts\",SELECT_SCRIPTS:\"Select Scripts\",CHECK_UPDATE:\"Check Update\",UPDATE:\"Update\",WIDGET:\"Widget\",RECENT:\"Recent\",CLICK_ACTION:\"Click Action\",TODAY_WIDGET:\"Today Widget\",PREV_PAGE:\"Prev\",NEXT_PAGE:\"Next\",DISPLAY_MODE:\"Display Mode\",CLASSIC:\"Classic\",MODERN:\"Modern\",FILE_MANAGEMENT:\"File Management\",\"compatibility.rebuildUserAction.alert.title\":\"We need to rebuild some of the action!\",\"compatibility.rebuildUserAction.alert.message\":\"If you tap the OK button, the following actions will be rebuilt:\",\"compatibility.rebuildUserAction.alert.message2\":\"Only the action logic will be changed, and the name and icon will remain as it is.\",EXPERIMENTAL:\"Experimental\",SYNC_ACTIONS:\"Sync Actions\",SYNCING:\"Syncing...\",LAST_SYNC_AT:\"Last sync at: \",MODIFIED:\"Modified: \",HOST:\"Host\",USER:\"User\",PASSWORD:\"Password\",BASEPATH:\"Base Path\",DATA_CONFLICT:\"A data synchronization conflict occurred\",DATA_CONFLICT_MESSAGE:\"Select the data you want to keep\",WEBDAV_DATA:\"WebDAV data\",LOCAL_DATA:\"Local data\",ACTION_SAFETY_WARNING:\"Action safety warning\",ACTION_PERMISSION_REQUEST:\"Action permission request\",ACTION_RESET_NAME_WARNING:\"Action `${name}` is attempting to change its name to `${to_name}`, which may result in it gaining all permissions associated with `${to_name}`.\",ACTION_NETWORK_PERMISSION_MESSAGE:\"Would you like to grant Action `${name}` network permissions?\"},\"zh-Hans\":{ALERT_INFO:\"提示\",NONE:\"什么都没有\",DONE:\"完成\",CLOSE:\"关闭\",FAILED_TO_LOAD_VIEW:\"加载视图失败\",VIEW_NOT_PROVIDED:\"未提供该视图\",UNCATEGORIZED:\"未分类\",SHARE:\"分享\",CLICK_TO_OPEN_JSBOX:\"点击标题打开主应用。\",CLIPS:\"剪切板\",CLIPBOARD:\"剪切板\",UNIVERSAL_CLIPBOARD:\"通用剪贴板\",UNIVERSAL_CLIPBOARD_TIPS:\"用剪贴板允许您在 iPhone 上复制某些内容，然后使用 iCloud 将其粘贴到 Mac 上(反之亦然)。\",CLIPS_STRUCTURE_ERROR:\"剪切板数据结构异常\",CLIPBOARD_NO_CHANGE:\"剪切板无变化\",RECYCLE_BIN:\"回收站\",ADD:\"添加\",TAG:\"标签\",ADD_TAG:\"添加标签\",EDIT:\"编辑\",SEARCH:\"搜索\",SEARCH_HISTORY:\"搜索历史\",SEARCH_RESULT:\"搜索结果\",NO_SEARCH_RESULT:\"搜索无结果\",FAVORITE:\"收藏\",COPY:\"复制\",COPIED:\"已复制\",SORT:\"排序\",ACTIONS:\"动作\",MORE_ACTIONS:\"更多动作\",PREVIEW:\"预览\",MAX_ITEM_LENGTH:\"行数限制\",TEXT_MAX_LENGTH:\"显示字符长度\",AUTO_SAVE:\"自动保存\",AUTO_SYNC:\"自动同步\",SYNC_NOW:\"立即同步\",UNZIP_FAILED:\"解压文件失败\",REBUILD:\"重建\",REBUILD_DATABASE:\"重建数据库\",REBUILD_DATABASE_ALERT:\"重建数据库将会丢失顺序信息，是否确认重建？\",DELETE_ALL_DATA:\"删除所有数据\",DELETE_ALL_DATA_ALERT:\"确定要删除所有数据吗？\",DELETE_DATA:\"删除数据\",DELETE_TABLE:\"删除 `${table}` 的所有数据？\",SELECT_ALL:\"全选\",DESELECT_ALL:\"取消全选\",EDITOR:\"编辑器\",CREATE_NEW:\"新建\",CREATE_NEW_ACTION:\"新建动作\",CREATE_NEW_TYPE:\"新建分类\",TYPE_ALREADY_EXISTS:\"该类别已经存在\",EDIT_DETAILS:\"编辑信息\",EDIT_SCRIPT:\"编辑脚本\",INFORMATION:\"信息\",NAME:\"名称\",ICON:\"图标\",TYPE:\"分类\",DESCRIPTION:\"描述\",CODE:\"代码\",TEXT_INSETS:\"文本下边距\",SHOW_LINE_NUMBER:\"显示行号\",LIGHT_MODE_THEME:\"浅色模式主题\",DARK_MODE_THEME:\"深色模式主题\",SAVE:\"保存\",SAVE_SUCCESS:\"保存成功\",SAVE_ERROR:\"保存失败\",DELETE:\"删除\",CONFIRM:\"确认\",DELETE_CONFIRM_MSG:\"确认要删除吗？\",DELETE_SUCCESS:\"删除成功\",DELETE_ERROR:\"删除失败\",IMPORT_EXAMPLE_ACTIONS:\"导入示例动作\",REBUILD_ACTION_DATABASE:\"重建动作库\",REBUILD_ACTION_DATABASE_ALERT_TITLE:\"您确认要重建？\",REBUILD_ACTION_DATABASE_ALERT_MESSAGE:\"重建会同时删除保存在 WebDAV 中的数据！(如果开启的话)\",EXPORT:\"导出\",IMPORT:\"导入\",FILE_TYPE_ERROR:\"文件类型不符\",OVERWRITE_ALERT:\"该操作将会覆盖当前数据，是否继续？\",UNABLE_CREATE_ACTION:\"无法创建动作\",ACTION_NAME_ALREADY_EXISTS:\"动作 `${name}` 已存在\",IMPORT_FROM_FILE:\"从文件导入\",KEYBOARD:\"键盘\",KEYBOARD_HEIGHT:\"键盘高度\",USE_BLUR:\"使用模糊效果\",BACKGROUND_IMAGE:\"背景图片\",DELETE_DELAY:\"删除延时\",SWITCH_AFTER_INSERT:\"输入后切换\",JSBOX_TOOLBAR:\"JSBox 工具栏\",QUICK_START_SCRIPTS:\"快速启动脚本\",SEND:\"发送\",OPEN_IN_JSBOX:\"在 JSBox 中打开\",SWITCH_KEYBOARD:\"切换键盘\",TAPTIC_ENGINE:\"触感反馈\",TAPTIC_ENGINE_LEVEL:\"触感反馈强度\",TAPTIC_ENGINE_FOR_DELETE:\"删除按钮触感反馈\",SPACE:\"空格\",ALL_SCRIPTS:\"所有脚本\",SELECT_SCRIPTS:\"选择脚本\",CHECK_UPDATE:\"检查更新\",UPDATE:\"更新\",WIDGET:\"小组件\",RECENT:\"最近内容\",CLICK_ACTION:\"点击事件\",TODAY_WIDGET:\"通知中心小组件\",PREV_PAGE:\"上一页\",NEXT_PAGE:\"下一页\",DISPLAY_MODE:\"显示模式\",CLASSIC:\"经典\",MODERN:\"现代\",FILE_MANAGEMENT:\"文件管理\",\"compatibility.rebuildUserAction.alert.title\":\"我们需要重建部分动作！\",\"compatibility.rebuildUserAction.alert.message\":\"如果您点击 好，以下动作将会被重建：\",\"compatibility.rebuildUserAction.alert.message2\":\"只有动作逻辑会被更改，名称和图标将维持现状。\",EXPERIMENTAL:\"实验功能\",SYNC_ACTIONS:\"动作同步\",SYNCING:\"正在同步...\",LAST_SYNC_AT:\"最后同步：\",MODIFIED:\"最近修改：\",HOST:\"Host\",USER:\"User\",PASSWORD:\"Password\",BASEPATH:\"Base Path\",DATA_CONFLICT:\"数据同步发生冲突\",DATA_CONFLICT_MESSAGE:\"请选择想要保留的数据\",WEBDAV_DATA:\"WebDAV 数据\",LOCAL_DATA:\"本地数据\",ACTION_SAFETY_WARNING:\"动作安全警告\",ACTION_PERMISSION_REQUEST:\"动作权限申请\",ACTION_RESET_NAME_WARNING:\"动作 `${name}` 正在尝试将名称改为 `${to_name}`，这可能导致其获取 `${to_name}` 的所有权限\",ACTION_NETWORK_PERMISSION_MESSAGE:\"是否允许动作 `${name}` 获取网络权限？\"}},$app.theme=\"auto\",$app.minSDKVer=\"2.19.0\",$app.minOSVer=\"14.0.0\",$app.idleTimerDisabled=!1,$app.keyboardToolbarEnabled=!0,$app.rotateDisabled=!1,__INFO__={name:\"CAIO\",version:\"2.0.2\",author:\"ipuppet\",module:!1},__README__={\"README.md\":'# CAIO\\r\\n\\r\\n> Clipboard all in one.\\r\\n> \\r\\n> A Clipboard tool based on JSBox.\\r\\n\\r\\nSupport for home widget and notification center widgets.\\r\\n\\r\\n## Build Taio Action\\r\\n\\r\\nBuild script depend on [Parcel](https://parceljs.org/).\\r\\n\\r\\n```shell\\r\\nnpm i -g parcel\\r\\nnpm run build\\r\\n```\\r\\n\\r\\nYou can also use the packaged files directly [dist/CAIO-en.json](./dist/CAIO-en.json).\\r\\n\\r\\n## Actions\\r\\n\\r\\n> For details on how to write, see `scripts/action/README.md` or the book button in the upper right corner of the `Action` edit page in the app.\\r\\n\\r\\n### `Action` data difference in different environments\\r\\n\\r\\n- The data processed by the `Action` button at the top of the home page is the currently copied content.\\r\\n- The data processed by the `Action` menu that pops up by long-pressing the list is the selected content.\\r\\n- The data processed by the `Action` button in the editor is whatever is being edited.\\r\\n\\r\\n\\r\\n## Today Widget\\r\\n\\r\\n> Click to copy, long press to trigger the action.\\r\\n\\r\\nPlease try to avoid using the Today Widget when JSBox is running CAIO.\\r\\n\\r\\n## WebDAV\\r\\n\\r\\n> Sync data with WebDAV.\\r\\n\\r\\nConfig Example:  \\r\\nHost: https://example.com/dav  \\r\\nUser: guest  \\r\\nPassword: password123  \\r\\nBast Path: /path/to/save/appdata\\r\\n\\r\\n## Shortcuts\\r\\n\\r\\nPlease add a new action called `Run JSBox script` and set the `Name` parameter to `CAIO`.\\r\\n\\r\\nNext, set the `Parameter Dictionary` to a `Dictionary`. \\r\\n\\r\\n| Parameter | Type   |\\r\\n| --------- | ------ |\\r\\n| set       | Text   |\\r\\n| get       | Number |\\r\\n| table     | Text   |\\r\\n\\r\\n`set`: The content will be saved to CAIO unless there is already an existing item with the same name.\\r\\n\\r\\n`get`: The item at the specified index (e.g., 0) will be returned.\\r\\n\\r\\n`table`: It will specify the table to either set or get the item from, with options being `[\"favorite\", \"clips\"]`. This parameter is optional and has a default value of `clips`.\\r\\n',\"README_CN.md\":'# CAIO\\r\\n\\r\\n> Clipboard all in one.\\r\\n> \\r\\n> A Clipboard tool based on JSBox.\\r\\n\\r\\n支持桌面小组件和通知中心小组件\\r\\n\\r\\n## 构建 Taio 动作\\r\\n\\r\\n构建脚本依赖 [Parcel](https://parceljs.org/)\\r\\n\\r\\n```shell\\r\\nnpm i -g parcel\\r\\nnpm run build\\r\\n```\\r\\n\\r\\n您也可以直接使用已打包好的文件 [dist/CAIO-zh-Hans.json](./dist/CAIO-zh-Hans.json)\\r\\n\\r\\n## Actions\\r\\n\\r\\n> 编写方式详见 `scripts/action/README.md` 或应用内 `Action` 编辑页面右上角图书按钮。\\r\\n\\r\\n### 不同环境中 `Action` 数据区别\\r\\n\\r\\n- 首页顶部 `Action` 按钮处理的数据为当前复制的内容\\r\\n- 长按列表弹出的 `Action` 菜单处理的数据为被选中的内容\\r\\n- 编辑器中顶部 `Action` 按钮（闪电图形按钮）处理的数据为正在编辑的所有内容\\r\\n\\r\\n\\r\\n## Today Widget\\r\\n\\r\\n> 点击复制，长按触发动作。\\r\\n\\r\\n请尽量避免在 JSBox 运行 CAIO 时使用 Today Widget\\r\\n\\r\\n## WebDAV\\r\\n\\r\\n> 通过 WebDAV 同步数据\\r\\n\\r\\n示例配置:  \\r\\nHost: https://example.com/dav  \\r\\nUser: guest  \\r\\nPassword: password123  \\r\\nBast Path: /path/to/save/appdata\\r\\n\\r\\n\\r\\n## 快捷指令\\r\\n\\r\\n添加一个名为 `运行 JSBox 脚本` 的动作，并将 `脚本名` 参数设置为 `CAIO`。\\r\\n\\r\\n然后将 `参数词典` 设置为一个 `字典`。\\r\\n\\r\\n| 参数  | 类型   |\\r\\n| ----- | ------ |\\r\\n| set   | Text   |\\r\\n| get   | Number |\\r\\n| table | Text   |\\r\\n\\r\\n`set`：将把内容保存到CAIO中，除非已存在相同名称的项。\\r\\n\\r\\n`get`：将返回指定索引（例如：0）处的项。\\r\\n\\r\\n`table`：将指定要设置或获取项的表格，可选项为 `[\"favorite\", \"clips\"]`。此项可省略，默认值为 `clips`。\\r\\n'},__ACTIONS__={clipboard:{B23Clean:{config:'{\\n    \"icon\": \"trash\",\\n    \"color\": \"#FF0000\",\\n    \"name\": \"b23 清除追踪\"\\n}',main:'/**\\n * @typedef {import(\"../../action\").Action} Action\\n */\\nclass MyAction extends Action {\\n    l10n() {\\n        return {\\n            \"zh-Hans\": {\\n                \"b23clean.converting\": \"正在转换...\",\\n                \"b23clean.noUrl\": \"未检测到链接\",\\n                \"b23clean.noBiliUrl\": \"未检测到 bilibili 链接\",\\n                \"b23clean.success\": \"已转换为 BV 视频链接\",\\n                \"b23clean.noChange\": \"无变化\",\\n                \"b23clean.multipleLinks\": \"多条链接仅在编辑模式下可用。\"\\n            },\\n            en: {\\n                \"b23clean.converting\": \"Converting...\",\\n                \"b23clean.noUrl\": \"No link detected\",\\n                \"b23clean.noBiliUrl\": \"bilibili link not detected\",\\n                \"b23clean.success\": \"Converted to BV video link\",\\n                \"b23clean.noChange\": \"No change\",\\n                \"b23clean.multipleLinks\": \"Multiple links are only available in edit mode.\"\\n            }\\n        }\\n    }\\n\\n    async cleanUrl(b23url) {\\n        if (b23url.indexOf(\"bilibili.com\") === -1 && b23url.indexOf(\"b23.tv\") === -1) {\\n            throw new Error($l10n(\"b23clean.noBiliUrl\"))\\n        }\\n\\n        let url = b23url\\n        if (b23url.indexOf(\"b23.tv\") >= 0) {\\n            const resp = await $http.get(b23url)\\n            url = resp.response.url\\n        }\\n\\n        const queryStart = url.indexOf(\"?\")\\n        if (queryStart > -1) {\\n            url = url.substring(0, queryStart - 1)\\n        }\\n\\n        return url\\n    }\\n\\n    /**\\n     * 系统会调用 do() 方法\\n     */\\n    async do() {\\n        $ui.toast($l10n(\"b23clean.converting\"), 1000)\\n\\n        try {\\n            const b23url = this.getUrls()\\n            if (b23url.length === 0) {\\n                throw new Error($l10n(\"b23clean.noUrl\"))\\n            }\\n\\n            if (b23url.length === 1) {\\n                let url = await this.cleanUrl(b23url[0])\\n                $ui.clearToast()\\n                $ui.alert({\\n                    title: $l10n(\"b23clean.success\"),\\n                    message: url,\\n                    actions: [\\n                        { title: $l10n(\"OK\") },\\n                        {\\n                            title: $l10n(\"COPY\"),\\n                            handler: () => {\\n                                $clipboard.text = url\\n                                $ui.success($l10n(\"COPIED\"))\\n                            }\\n                        }\\n                    ]\\n                })\\n            } else {\\n                if (this.env !== ActionEnv.editor) {\\n                    $ui.toast($l10n(\"b23clean.multipleLinks\"))\\n                    return\\n                }\\n                let flag = false\\n                for (let i = 0; i < b23url.length; i++) {\\n                    try {\\n                        const url = b23url[i].trim()\\n                        const replacedUrl = await this.cleanUrl(url)\\n                        flag = true\\n\\n                        if (url !== replacedUrl) {\\n                            const newText = this.text.replace(url, replacedUrl)\\n                            this.setContent(newText)\\n                        }\\n                    } catch {}\\n                }\\n                if (!flag) {\\n                    throw new Error($l10n(\"b23clean.noBiliUrl\"))\\n                } else {\\n                    $ui.toast($l10n(\"b23clean.noChange\"))\\n                }\\n            }\\n        } catch (error) {\\n            $ui.clearToast()\\n            $delay(0.5, () => $ui.error(error))\\n        }\\n    }\\n}\\n',readme:\"## B23Clean\\r\\n\\r\\n清除 b23.tv 分享链接中的追踪参数，转换为 BV 视频链接。\"},CleanClipboard:{config:'{\\r\\n    \"icon\": \"trash\",\\r\\n    \"color\": \"#FF0000\",\\r\\n    \"name\": \"清除剪切板\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    l10n() {\\r\\n        return {\\r\\n            \"zh-Hans\": {\\r\\n                \"clipboard.clean.success\": \"剪切板已清空\"\\r\\n            },\\r\\n            en: {\\r\\n                \"clipboard.clean.success\": \"Clipboard is cleaned\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * 系统会调用 do() 方法\\r\\n     */\\r\\n    do() {\\r\\n        $clipboard.clear()\\r\\n        $ui.success($l10n(\"clipboard.clean.success\"))\\r\\n    }\\r\\n}\\r\\n',readme:\"## CleanClipboard\\r\\n\\r\\n清空当前剪切板内容。\"},DownloadFromUrl:{config:'{\\r\\n    \"icon\": \"square.and.arrow.down\",\\r\\n    \"color\": \"#FF0099\",\\r\\n    \"name\": \"从链接下载\"\\r\\n}',main:'class MyAction extends Action {\\r\\n    async downloadContent(url) {\\r\\n        const response = await $http.get({\\r\\n            url,\\r\\n            showsProgress: true\\r\\n        })\\r\\n        if (response.error) {\\r\\n            $ui.alert(response.error.localizedDescription)\\r\\n        } else {\\r\\n            return response\\r\\n        }\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        const url = this.getUrls()\\r\\n        let response = undefined\\r\\n        if (url.length > 1) {\\r\\n            $ui.menu({\\r\\n                items: url,\\r\\n                handler: async (title, index) => {\\r\\n                    response = await this.downloadContent(url[index])\\r\\n                }\\r\\n            })\\r\\n        } else if (url.length === 1) {\\r\\n            response = await this.downloadContent(url[0])\\r\\n        } else {\\r\\n            $ui.warning(\"未检测到链接\")\\r\\n            return\\r\\n        }\\r\\n        $share.sheet([\\r\\n            {\\r\\n                name: response.response.suggestedFilename,\\r\\n                data: response.data\\r\\n            }\\r\\n        ])\\r\\n        return response\\r\\n    }\\r\\n}\\r\\n',readme:\"## DownloadFromUrl\\r\\n\\r\\n从链接下载内容，如 js 文件内容等。\"},GetFromWin:{config:'{\\n    \"icon\": \"square.and.arrow.down\",\\n    \"color\": \"#33CC33\",\\n    \"name\": \"读取 clipsync\"\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    async getIp(refresh = false) {\\r\\n        let address = $cache.get(\"caio.action.clipsync.address\")\\r\\n        if (refresh || !address) {\\r\\n            address = await $input.text({\\r\\n                placeholder: \"Address\",\\r\\n                text: $cache.get(\"caio.action.clipsync.address\")\\r\\n            })\\r\\n        }\\r\\n\\r\\n        $cache.set(\"caio.action.clipsync.address\", address)\\r\\n\\r\\n        if (!address.startsWith(\"http\")) {\\r\\n            address = \"http://\" + address\\r\\n        }\\r\\n\\r\\n        return address\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        let address = await this.getIp()\\r\\n\\r\\n        $ui.toast(\"Loading...\", 5)\\r\\n        try {\\r\\n            const resp = await this.request(address + \"/api/clip\", \"GET\")\\r\\n            if (resp.data.status) {\\r\\n                $ui.success(\"success\")\\r\\n                $clipboard.text = resp.data.data\\r\\n                if ($app.env === $env.keyboard) {\\r\\n                    $keyboard.insert(resp.data.data)\\r\\n                }\\r\\n            }\\r\\n        } catch (error) {\\r\\n            $ui.clearToast()\\r\\n            $ui.alert({\\r\\n                title: \"Error\",\\r\\n                message: String(error),\\r\\n                actions: [\\r\\n                    { title: \"OK\" },\\r\\n                    {\\r\\n                        title: \"Reset Adress\",\\r\\n                        handler: () => this.getIp(true)\\r\\n                    }\\r\\n                ]\\r\\n            })\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## GetFromWin\\r\\n\\r\\n通 clipsync 读取 PC 剪切板。\\r\\n\\r\\n服务端：[clipsync](https://github.com/ipuppet/clipsync)\\r\\n\"},OpenUrl:{config:'{\\r\\n    \"icon\": \"link\",\\r\\n    \"color\": \"#FF0099\",\\r\\n    \"name\": \"打开链接\"\\r\\n}',main:'class MyAction extends Action {\\r\\n    l10n() {\\r\\n        return {\\r\\n            \"zh-Hans\": {\\r\\n                \"openLink.nourl\": \"未检测到链接\"\\r\\n            },\\r\\n            en: {\\r\\n                \"openLink.nourl\": \"No link detected\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    openUrl(url) {\\r\\n        $app.openURL(url.trim())\\r\\n    }\\r\\n\\r\\n    do() {\\r\\n        const url = this.getUrls()\\r\\n        if (url.length > 1) {\\r\\n            $ui.menu({\\r\\n                items: url,\\r\\n                handler: (title, index) => {\\r\\n                    this.openUrl(url[index])\\r\\n                }\\r\\n            })\\r\\n        } else if (url.length === 1) {\\r\\n            this.openUrl(url[0])\\r\\n        } else {\\r\\n            $ui.warning($l10n(\"openLink.nourl\"))\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## OpenUrl\\r\\n\\r\\n提取文本中的URL并打开。\"},RawRepoConverter:{config:'{\\r\\n    \"icon\": \"link\",\\r\\n    \"color\": \"#FF0099\",\\r\\n    \"name\": \"RawRepoConverter\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    #component\\r\\n\\r\\n    get component() {\\r\\n        if (!this.#component) {\\r\\n            const url = String(this.text)\\r\\n            const path = url.substring(url.indexOf(\"/\", \"https://\".length) + 1)\\r\\n            this.#component = path.split(\"/\")\\r\\n        }\\r\\n        return this.#component\\r\\n    }\\r\\n\\r\\n    l10n() {\\r\\n        return {\\r\\n            \"zh-Hans\": {\\r\\n                \"openLink.nourl\": \"未检测到链接\"\\r\\n            },\\r\\n            en: {\\r\\n                \"openLink.nourl\": \"No link detected\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    githubusercontent() {\\r\\n        const user = this.component[0],\\r\\n            repository = this.component[1],\\r\\n            branch = this.component[2],\\r\\n            file = this.component.slice(3).join(\"/\")\\r\\n        return `https://github.com/${user}/${repository}/blob/${branch}/${file}`\\r\\n    }\\r\\n\\r\\n    github() {\\r\\n        const user = this.component[0],\\r\\n            repository = this.component[1],\\r\\n            blob = this.component[2],\\r\\n            branch = this.component[3],\\r\\n            file = this.component.slice(4).join(\"/\")\\r\\n        return `https://raw.githubusercontent.com/${user}/${repository}/${branch}/${file}`\\r\\n    }\\r\\n\\r\\n    do() {\\r\\n        let result\\r\\n        const url = String(this.text)\\r\\n        if (url.includes(\"raw.githubusercontent.com\")) {\\r\\n            result = this.githubusercontent(url)\\r\\n        } else if (url.includes(\"github.com\")) {\\r\\n            if (url.includes(\"?raw=true\")) {\\r\\n                result = url.replace(\"?raw=true\", \"\")\\r\\n            } else {\\r\\n                result = this.github()\\r\\n            }\\r\\n        } else {\\r\\n            $ui.warning($l10n(\"openLink.nourl\"))\\r\\n            return\\r\\n        }\\r\\n\\r\\n        $ui.success($l10n(\"COPIED\"))\\r\\n        $clipboard.text = result\\r\\n    }\\r\\n}\\r\\n',readme:\"## RawRepoConverter\\r\\n\\r\\nGithub Raw 链接和 Repository 链接转换器\\r\\n\"},SendToWin:{config:'{\\r\\n    \"icon\": \"square.and.arrow.up\",\\r\\n    \"color\": \"#33CC33\",\\r\\n    \"name\": \"推送 clipsync\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    async getIp(refresh = false) {\\r\\n        let address = $cache.get(\"caio.action.clipsync.address\")\\r\\n        if (refresh || !address) {\\r\\n            address = await $input.text({\\r\\n                placeholder: \"Address\",\\r\\n                text: $cache.get(\"caio.action.clipsync.address\")\\r\\n            })\\r\\n        }\\r\\n\\r\\n        $cache.set(\"caio.action.clipsync.address\", address)\\r\\n\\r\\n        if (!address.startsWith(\"http\")) {\\r\\n            address = \"http://\" + address\\r\\n        }\\r\\n\\r\\n        return address\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        let address = await this.getIp()\\r\\n\\r\\n        $ui.toast(\"Loading...\", 5)\\r\\n        try {\\r\\n            const resp = await this.request(address + \"/api/clip\", \"POST\", {\\r\\n                data: this.text\\r\\n            })\\r\\n            if (resp.data.status) {\\r\\n                $ui.success(\"success\")\\r\\n            }\\r\\n        } catch (error) {\\r\\n            $ui.clearToast()\\r\\n            $ui.alert({\\r\\n                title: \"Error\",\\r\\n                message: String(error),\\r\\n                actions: [\\r\\n                    { title: \"OK\" },\\r\\n                    {\\r\\n                        title: \"Reset Adress\",\\r\\n                        handler: () => this.getIp(true)\\r\\n                    }\\r\\n                ]\\r\\n            })\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## SendToWin\\r\\n\\r\\n通 clipsync 推送剪切板至 PC。\\r\\n\\r\\n服务端：[clipsync](https://github.com/ipuppet/clipsync)\\r\\n\"},Tokenize:{config:'{\\r\\n    \"icon\": \"pencil.and.ellipsis.rectangle\",\\r\\n    \"color\": \"#0099FF\",\\r\\n    \"name\": \"分词复制\"\\r\\n}',main:'class MyAction extends Action {\\r\\n    getView() {\\r\\n        const color = {\\r\\n            background: {\\r\\n                normal: $color(\"#E7F2FF\", \"#E7F2FF\"),\\r\\n                highlight: $color(\"##074FF\", \"#BBDAFF\")\\r\\n            },\\r\\n            text: {\\r\\n                normal: $color(\"##074FF\", \"##074FF\"),\\r\\n                highlight: $color(\"#FFFFFF\", \"#ADADAD\")\\r\\n            }\\r\\n        }\\r\\n        const fontSize = 16\\r\\n        const edges = 10\\r\\n        return {\\r\\n            type: \"matrix\",\\r\\n            layout: $layout.fill,\\r\\n            props: {\\r\\n                spacing: edges,\\r\\n                data: this.results.map(item => ({ label: { text: item } })),\\r\\n                template: {\\r\\n                    views: [{\\r\\n                        type: \"label\",\\r\\n                        props: {\\r\\n                            id: \"label\",\\r\\n                            align: $align.center,\\r\\n                            cornerRadius: edges,\\r\\n                            bgcolor: color.background.normal,\\r\\n                            font: $font(fontSize),\\r\\n                            textColor: color.text.normal\\r\\n                        },\\r\\n                        layout: $layout.fill\\r\\n                    }]\\r\\n                }\\r\\n            },\\r\\n            events: {\\r\\n                highlighted: () => { },\\r\\n                itemSize: (sender, indexPath) => {\\r\\n                    const width = fontSize * this.results[indexPath.item].length + 1\\r\\n                    if (this.maxtrixItemHeight === undefined)\\r\\n                        this.maxtrixItemHeight = fontSize + edges * 2\\r\\n                    return $size(width + edges * 2, this.maxtrixItemHeight)\\r\\n                },\\r\\n                didSelect: (sender, indexPath) => {\\r\\n                    const index = this.selected.indexOf(indexPath.item)\\r\\n                    const label = sender.cell(indexPath).get(\"label\")\\r\\n                    if (index === -1) {\\r\\n                        this.selected.push(indexPath.item)\\r\\n                        label.bgcolor = color.background.highlight\\r\\n                        label.textColor = color.text.highlight\\r\\n                    } else {\\r\\n                        this.selected.splice(index, 1)\\r\\n                        label.bgcolor = color.background.normal\\r\\n                        label.textColor = color.text.normal\\r\\n                    }\\r\\n                }\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n    /**\\r\\n     * 系统会调用 do() 方法\\r\\n     */\\r\\n    do() {\\r\\n        this.selected = []\\r\\n        this.results = []\\r\\n        $text.tokenize({\\r\\n            text: this.text,\\r\\n            handler: results => {\\r\\n                this.results = results\\r\\n                this.pageSheet({\\r\\n                    view: this.getView(),\\r\\n                    done: () => {\\r\\n                        const result = []\\r\\n                        this.selected.sort().forEach(i => {\\r\\n                            result.push(this.results[i])\\r\\n                        })\\r\\n                        if (result.length > 0) {\\r\\n                            const text = result.join(\"\")\\r\\n                            $clipboard.text = text\\r\\n                            $ui.alert({\\r\\n                                title: \"完成\",\\r\\n                                message: `已复制内容：${text}`\\r\\n                            })\\r\\n                        }\\r\\n                    }\\r\\n                })\\r\\n            }\\r\\n        })\\r\\n    }\\r\\n}\\r\\n',readme:\"## Tokenize\\r\\n\\r\\n将文本分词处理后复制。\"}},editor:{PreviewMarkdown:{config:'{\\r\\n    \"icon\": \"book\",\\r\\n    \"color\": \"#9900CC\",\\r\\n    \"name\": \"预览Markdown\"\\r\\n}',main:'class MyAction extends Action {\\r\\n    do() {\\r\\n        this.pageSheet({\\r\\n            view: {\\r\\n                type: \"markdown\",\\r\\n                props: { content: this.text },\\r\\n                layout: $layout.fill\\r\\n            }\\r\\n        })\\r\\n    }\\r\\n}\\r\\n',readme:\"## PreviewMarkdown\\r\\n\\r\\n预览Markdown。\"},SelectedText:{config:'{\\r\\n    \"icon\": \"crop\",\\r\\n    \"color\": \"#6699CC\",\\r\\n    \"name\": \"选中的文本\"\\r\\n}',main:\"class MyAction extends Action {\\r\\n    do() {\\r\\n        if (this.selectedRange.length > 0) {\\r\\n            const selectedText = this.text\\r\\n            $ui.alert(selectedText)\\r\\n        }\\r\\n    }\\r\\n}\\r\\n\",readme:\"## SelectedText\\r\\n\\r\\n显示选中的文本。\"}},uncategorized:{ActionEditPreview:{config:'{\\r\\n    \"icon\": \"play\",\\r\\n    \"color\": \"#FF0000\",\\r\\n    \"name\": \"编辑动作即时预览示例\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n * @typedef {import(\"../../action\").ActionData} ActionData\\r\\n * @typedef {import(\"../../action\").ActionEnv} ActionEnv\\r\\n */\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    preview() {\\r\\n        return new ActionData({\\r\\n            text: \"hello word\"\\r\\n        })\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        try {\\r\\n            if (this.env !== ActionEnv.build) {\\r\\n                $ui.toast(\"action editor only\")\\r\\n                return\\r\\n            }\\r\\n            return this.text\\r\\n        } catch (error) {\\r\\n            $ui.alert(error)\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## ActionEditPreview\\r\\n\\r\\n编辑动作即时预览示例。\"},DeleteClips:{config:'{\\r\\n    \"icon\": \"trash\",\\r\\n    \"color\": \"#FF0000\",\\r\\n    \"name\": \"删除所有剪切板\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    async do() {\\r\\n        try {\\r\\n            const action = await this.clearAllClips()\\r\\n            if (action) {\\r\\n                $ui.success($l10n(\"DONE\"))\\r\\n            }\\r\\n        } catch (error) {\\r\\n            $ui.error(error)\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## DeleteClips\\r\\n\\r\\n删除所有已保存的剪切板（不包括收藏）。\"},DisplayClipboard:{config:'{\\r\\n    \"icon\": \"option\",\\r\\n    \"color\": \"#FF6633\",\\r\\n    \"name\": \"显示剪切板\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    do() {\\r\\n        const image = $clipboard.image\\r\\n        if (image) {\\r\\n            this.quickLookImage(image)\\r\\n        } else {\\r\\n            this.pageSheet({\\r\\n                view: {\\r\\n                    type: \"label\",\\r\\n                    props: {\\r\\n                        lines: 0,\\r\\n                        text: $clipboard.text,\\r\\n                        align: $align.center\\r\\n                    },\\r\\n                    layout: $layout.fill\\r\\n                }\\r\\n            })\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## DisplayClipboard\\r\\n\\r\\n显示当前剪切板内的内容。\"},ExportAllContent:{config:'{\\r\\n    \"icon\": \"square.and.arrow.up\",\\r\\n    \"color\": \"#FF3300\",\\r\\n    \"name\": \"导出数据\"\\r\\n}',main:'class MyAction extends Action {\\r\\n    do() {\\r\\n        const data = this.getAllClips()\\r\\n        if (data.clips.length > 0 || data.favorite.length > 0) {\\r\\n            $share.sheet(JSON.stringify(data, null, 2))\\r\\n        } else {\\r\\n            $ui.alert(\"无数据\")\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## ExportAllContent\\r\\n\\r\\n导出所有保存的数据。\"},Replace:{config:'{\\r\\n    \"icon\": \"square.and.arrow.up\",\\r\\n    \"color\": \"#FF3300\",\\r\\n    \"name\": \"查找替换\"\\r\\n}',main:'function HtmlTemplate(html) {\\r\\n    return `\\r\\n<html>\\r\\n<head>\\r\\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\\r\\n</head>\\r\\n<body>\\r\\n${html}\\r\\n</body>\\r\\n</html>\\r\\n`\\r\\n}\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    do() {\\r\\n        $ui.menu({\\r\\n            items: [\"忽略大小写\", \"大小写敏感\", \"正则表达式\"],\\r\\n            handler: async (title, idx) => {\\r\\n                const patternText = await $input.text({\\r\\n                    placeholder: \"查找内容\"\\r\\n                })\\r\\n                const replaceString = await $input.text({\\r\\n                    placeholder: \"替换内容\"\\r\\n                })\\r\\n                let pattern = undefined\\r\\n                if (idx === 0) {\\r\\n                    pattern = new RegExp(`(${patternText})+`, \"gi\")\\r\\n                } else if (idx === 1) {\\r\\n                    pattern = new RegExp(`(${patternText})+`, \"g\")\\r\\n                } else if (idx === 2) {\\r\\n                    pattern = new RegExp(patternText, \"g\")\\r\\n                }\\r\\n\\r\\n                const matchResultPreview = this.text.replaceAll(pattern, `<font color=red>${replaceString}</font>`)\\r\\n                const matchResult = this.text.replaceAll(pattern, replaceString)\\r\\n                this.pageSheet({\\r\\n                    title: \"替换预览\",\\r\\n                    doneText: \"替换\",\\r\\n                    view: {\\r\\n                        type: \"web\",\\r\\n                        props: {\\r\\n                            html: HtmlTemplate(matchResultPreview)\\r\\n                        },\\r\\n                        layout: $layout.fill\\r\\n                    },\\r\\n                    done: () => {\\r\\n                        this.setContent(matchResult)\\r\\n                    }\\r\\n                })\\r\\n            }\\r\\n        })\\r\\n        // this.setContent(\"Hello world!\")\\r\\n    }\\r\\n}\\r\\n',readme:\"## Replace\\r\\n\\r\\n查找替换\"}}},__ACTION_README__={content:'# Action\\r\\n\\r\\n所有 Action 保存在 `storage/user_action` 目录下，按照文件夹分类\\r\\n\\r\\n`Action` 结构如下：\\r\\n\\r\\n- `ActionName`\\r\\n  - `config.json` 配置文件\\r\\n  - `main.js` 入口文件\\r\\n  - `README.md` 说明文件\\r\\n\\r\\n### `config.json` 配置项\\r\\n\\r\\n- `icon` 图标 可以是 [JSBox 内置图标](https://github.com/cyanzhong/xTeko/tree/master/extension-icons)、SF Symbols图标、base64图片数据和来自 url 的图片\\r\\n- `color` 颜色\\r\\n- `name` 名称\\r\\n- `description` 描述信息\\r\\n\\r\\n### `main.js` 入口文件\\r\\n\\r\\n创建名为 `MyAction` 的类并继承 `Action` 类\\r\\n\\r\\n```js\\r\\n/**\\r\\n * @typedef {import(\"scripts/action/action.js\").Action} Action\\r\\n */\\r\\n/**\\r\\n * 必须为 MyAction\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    /**\\r\\n     * 系统会调用 do() 方法\\r\\n     * 在编辑模式如果提供了返回值，则可弹窗预览返回值\\r\\n     */\\r\\n    do() {\\r\\n        console.log(this.text)\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n### 父类 `Action` 的属性：\\r\\n- `this.env`  \\r\\n  当前运行环境，参见 [ActionEnv](#ActionEnv)\\r\\n- `this.config`  \\r\\n  当前 Action 配置文件内容\\r\\n- `this.originalContent`  \\r\\n  原始数据\\r\\n- `this.text`  \\r\\n  优先为选中的文本，若无则：当处于键盘中运行时为输入框内文本，处于编辑器时为编辑器内文本，其他情况为剪切板内文本\\r\\n- `this.selectedRange`  \\r\\n  在编辑器中，当前选中的文本范围 `{location: Number, length: Number}`\\r\\n\\r\\n更多参见 [ActionData](#ActionData)\\r\\n\\r\\n### 父类的方法：\\r\\n```js\\r\\n/**\\r\\n * 编辑动作状态下提供预览数据\\r\\n * @returns {ActionData}\\r\\n */\\r\\npreview(): ActionData\\r\\n\\r\\n/**\\r\\n * 重写该方法返回 l10n 对象可注入 l10n\\r\\n * l10n() {\\r\\n        return {\\r\\n            \"zh-Hans\": {\\r\\n                \"clipboard.clean.success\": \"剪切板已清空\"\\r\\n            },\\r\\n            en: {\\r\\n                \"clipboard.clean.success\": \"Clipboard is cleaned\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n */\\r\\nl10n()\\r\\n\\r\\n/**\\r\\n * page sheet\\r\\n * @param {*} args \\r\\n *  {\\r\\n        view: args.view, // 视图对象\\r\\n        title: args.title ?? \"\", // 中间标题\\r\\n        done: args.done, // 点击左上角按钮后的回调函数\\r\\n        doneText: args.doneText ?? $l10n(\"DONE\") // 左上角文本\\r\\n        rightButtons: [{ title:string, symbol:string, tapped:function }] // 右上角按钮\\r\\n    }\\r\\n  */\\r\\npageSheet(args): void\\r\\n\\r\\n/**\\r\\n * 获取所有剪切板数据\\r\\n * @returns {object}\\r\\n */\\r\\ngetAllClips(): { favorite, clips }\\r\\n\\r\\n/**\\r\\n * 更新当前文本，当用户侧滑返回时才会触发保存操作\\r\\n */\\r\\nsetContent(text): void\\r\\n\\r\\n/**\\r\\n * 获取指定的 Action 类\\r\\n * @param {string} type\\r\\n * @param {string} name config.name\\r\\n * @param {ActionData} data new ActionData({ args: any })\\r\\n * @returns\\r\\n */\\r\\ngetAction(type, name, data): any\\r\\n\\r\\n/**\\r\\n * 运行指定的 Action 并返回该 Action do() 方法的返回值\\r\\n */\\r\\nasync runAction(type, name): any\\r\\n\\r\\n/**\\r\\n * 从 `this.text` 中匹配所有 url\\r\\n */\\r\\ngetUrls(): []\\r\\n```\\r\\n\\r\\n### <span id=\"ActionEnv\">ActionEnv</span>\\r\\n```js\\r\\nclass ActionEnv {\\r\\n    static build = -1 // 动作编辑器\\r\\n    static today = 0\\r\\n    static editor = 1\\r\\n    static clipboard = 2\\r\\n    static action = 3\\r\\n    static keyboard = 4\\r\\n}\\r\\n```\\r\\n\\r\\n### <span id=\"ActionData\">ActionData</span>\\r\\n```js\\r\\nclass ActionData {\\r\\n    env\\r\\n    args // 其他动作传递的参数\\r\\n    text // 自动获取文本，优先获取选中的文本\\r\\n    allText // 获取所有文本\\r\\n    section // 首页剪切板分类\\r\\n    uuid // 首页剪切板项目 uuid\\r\\n    selectedRange // 文本选中的范围\\r\\n    selectedText // 选中的文本\\r\\n    textBeforeInput // 键盘中输入光标之前的文本\\r\\n    textAfterInput // 键盘中输入光标之后的文本\\r\\n    editor // 编辑器\\r\\n}\\r\\n```\\r\\n\\r\\n其中 `editor` 如下：\\r\\n\\r\\n```js\\r\\nconst editor = {\\r\\n    originalContent,\\r\\n    setContent: text => {}\\r\\n}\\r\\n```\\r\\n'},$app.env){case $env.app:case $env.action:n=s(\"6olY1\");break;case $env.today:case $env.keyboard:case $env.siri:n=s(\"ljE8b\");break;case $env.widget:n=s(\"gD12U\");break;default:$intents.finish(\"不支持在此环境中运行\"),$ui.render({views:[{type:\"label\",props:{text:\"不支持在此环境中运行\",align:$align.center},layout:$layout.fill}]})}n&&n.run()})();"
                }
            }
        }
    ],
    "buildVersion": 1,
    "clientMinVersion": 1,
    "clientVersion": 592,
    "icon": {
        "glyph": "heart.text.square",
        "color": "#FF6633"
    },
    "summary": "A Clipboard tool based on JSBox.",
    "name": "CAIO"
}