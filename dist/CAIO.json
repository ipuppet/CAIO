{
    "actions": [
        {
            "type": "@comment",
            "parameters": {
                "text": {
                    "value": "GitHub: https://github.com/ipuppet/CAIO"
                }
            }
        },
        {
            "type": "@flow.javascript",
            "parameters": {
                "script": {
                    "value": "(()=>{let t;var e=globalThis,i={},s={},n=e.parcelRequire94c2;null==n&&((n=function(t){if(t in i)return i[t].exports;if(t in s){var e=s[t];delete s[t];var n={id:t,exports:{}};return i[t]=n,e.call(n.exports,n,n.exports),n.exports}var r=Error(\"Cannot find module '\"+t+\"'\");throw r.code=\"MODULE_NOT_FOUND\",r}).register=function(t,e){s[t]=e},e.parcelRequire94c2=n);var r=n.register;switch(r(\"6olY1\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.ViewController,a=i.TabBarController,o=i.FileManager,l=n(\"8Makm\").AppKernelBase,h=n(\"gYDdO\"),c=n(\"iuWEe\");/**\n * @typedef {AppKernel} AppKernel\n */class d extends l{constructor(){super(),this.query=$context.query,c(this),this.fileManager=new o}}class u{static kernel=new d;static renderMainUI(){let t={clips:{icon:\"doc.on.clipboard.fill\",title:$l10n(\"CLIPS\")},actions:{icon:\"command\",title:$l10n(\"ACTIONS\")},setting:{icon:\"gear\",title:$l10n(\"SETTING\")}};// this.kernel.useJsboxNav()\n// this.kernel.setting.useJsboxNav()\n// this.kernel.fileManager.setViewController(new ViewController())\n// this.kernel.tabBarController = new TabBarController()\n// const clipsdNavigationView = this.kernel.clips.getNavigationView()\n// this.kernel.tabBarController\n//     .setPages({\n//         clips: clipsdNavigationView.getPage(),\n//         actions: this.kernel.actions.getPage(),\n//         setting: this.kernel.setting.getPage()\n//     })\n//     .setCells({\n//         clips: buttons.clips,\n//         actions: buttons.actions,\n//         setting: buttons.setting\n//     })\n// $define({\n//     type: \"ViewController: UIViewController\",\n//     events: {\n//         viewDidLoad: () => {\n//             console.log(\"viewDidLoad\")\n//             self.$super().$viewDidLoad()\n//             //const view = this.kernel.tabBarController.generateView().definition\n//             const view = this.kernel.clips.getListView()\n//             self.$view().jsValue().add(view)\n//             const navigationItem = self.$navigationItem()\n//             navigationItem.$setTitle(\"CAIO\")\n//             navigationItem.$setLargeTitleDisplayMode(0)\n//             const leftButton = $objc(\"UIBarButtonItem\").$alloc()\n//             leftButton.$initWithTitle_style_target_action(\"Close\", 0, self, \"backButtonPressed\")\n//             navigationItem.$setLeftBarButtonItem(leftButton)\n//         },\n//         backButtonPressed: () => {\n//             self.$dismissViewControllerAnimated_completion(true, null)\n//         }\n//     }\n// })\n// const render = sender => {\n//     const myVC = $objc(\"ViewController\").$alloc().$init()\n//     const navigator = $objc(\"UINavigationController\").$alloc().$initWithRootViewController(myVC)\n//     navigator.$setModalPresentationStyle(0)\n//     this.kernel.navigator = navigator\n//     const navigationBar = navigator.$navigationBar()\n//     navigationBar.$setPrefersLargeTitles(true)\n//     const image = $objc(\"UIImage\").$imageWithColor($color(\"clear\").ocValue())\n//     navigationBar.$setBackgroundImage_forBarPosition_barMetrics(image, 0, 0)\n//     $ui.vc.ocValue().invoke(\"presentViewController:animated:completion:\", navigator, true, null)\n// }\n// render()\n// return\nif(s.isTaio||0===this.kernel.setting.get(\"mainUIDisplayMode\"))this.kernel.useJsboxNav(),this.kernel.setting.useJsboxNav(),this.kernel.setNavButtons([{symbol:t.setting.icon,title:t.setting.title,handler:()=>{s.push({title:t.setting.title,views:[this.kernel.setting.getListView()]})}},{symbol:t.actions.icon,title:t.actions.title,handler:()=>{this.kernel.actions.present()}}]),this.kernel.UIRender(this.kernel.clips.getNavigationView().getPage());else{this.kernel.fileManager.setViewController(new r),this.kernel.tabBarController=new a;let e=this.kernel.clips.getNavigationView();this.kernel.tabBarController.setPages({clips:e.getPage(),actions:this.kernel.actions.getPage(),setting:this.kernel.setting.getPage()}).setCells({clips:t.clips,actions:t.actions,setting:t.setting}),this.kernel.UIRender(this.kernel.tabBarController.generateView().definition)}}}t.exports={run:()=>{// 兼容性操作\nh(u.kernel),u.renderMainUI()}}}),r(\"gxpqj\",function(t,e){var i=class{title;handler;constructor({title:t=$l10n(\"OK\"),disabled:e=!1,style:i=$alertActionType.default,handler:s=()=>{}}={}){this.title=t,this.disabled=e,this.style=i,this.handler=s}},s=class t{id=$text.uuid;title;message;actions;titleFont=$font(\"bold\",20);messageFont=$font(14);actionButtonFontSize=16;actionButtonHighlight=$color($rgba(0,0,0,.2),$rgba(255,255,255,.2));actionButtonHeight=35;actionButtonBoderWidth=.5;actionButtonBorderColor=$color(\"#C9C9C9\",\"#383838\");boxWidth=250;textVerticalMargin=20;textHorizontalMargin=50;constructor({title:t=\"\",message:e=\"\",actions:s=[]}={}){this.title=t,this.message=e,this.actions=s,0===this.actions.length&&this.actions.push(new i),this.titleSize=m.getContentSize(this.titleFont,this.title,this.boxWidth-2*this.textHorizontalMargin),this.messageSize=m.getContentSize(this.messageFont,this.message,this.boxWidth-2*this.textHorizontalMargin)}textView(){return{type:\"view\",views:[{type:\"label\",props:{lines:0,font:this.titleFont,text:this.title,color:$color(\"tint\"),align:$align.center},layout:(t,e)=>{t.centerX.equalTo(e.super),t.width.equalTo(this.boxWidth-2*this.textHorizontalMargin),t.height.equalTo(this.titleSize.height),t.top.equalTo(this.textVerticalMargin)}},{type:\"label\",props:{lines:0,font:this.messageFont,text:this.message,align:$align.center},layout:(t,e)=>{t.centerX.equalTo(e.super),t.width.equalTo(this.boxWidth-2*this.textHorizontalMargin),t.height.equalTo(this.messageSize.height),t.top.equalTo(e.prev.bottom)}}],layout:(t,e)=>{t.top.width.equalTo(e.super),t.height.equalTo(this.titleSize.height+this.messageSize.height+2*this.textVerticalMargin)}}}actionView(){let t=(t,e)=>{let i=t=>2===this.actions.length?t.y>=0&&t.x>=0&&t.y<=this.actionButtonHeight&&t.x<=this.boxWidth/2:t.y>=0&&t.x>=0&&t.y<=this.actionButtonHeight&&t.x<=this.boxWidth,s=async(s,n,r)=>{t.disabled||(s.bgcolor=$color(\"clear\"),i(n)&&(\"function\"==typeof t.handler&&await t.handler({index:e,title:t.title}),this.dismiss()))},n=$color(\"tint\"),r=$font(this.actionButtonFontSize);return t.disabled?n=$color(\"gray\"):t.style===$alertActionType.destructive?n=$color(\"red\"):t.style===$alertActionType.cancel&&(r=$font(\"bold\",this.actionButtonFontSize)),{type:\"label\",props:{lines:1,text:t.title,align:$align.center,font:r,color:n,borderWidth:this.actionButtonBoderWidth,borderColor:this.actionButtonBorderColor,bgcolor:$color(\"clear\")},events:{tapped:()=>{},touchesBegan:e=>{t.disabled||(e.bgcolor=this.actionButtonHighlight)},touchesEnded:s,touchesCancelled:s,touchesMoved:(e,s,n)=>{t.disabled||(i(s)?e.bgcolor=this.actionButtonHighlight:e.bgcolor=$color(\"clear\"))}},layout:(t,e)=>{2===this.actions.length?e.prev?(t.left.equalTo(e.prev.right).offset(-this.actionButtonBoderWidth),t.width.equalTo(e.super).dividedBy(2).offset(this.actionButtonBoderWidth)):t.width.equalTo(e.super).dividedBy(2):(t.width.equalTo(e.super),e.prev&&t.top.equalTo(e.prev.bottom).offset(-this.actionButtonBoderWidth)),t.height.equalTo(this.actionButtonHeight)}}};return{type:\"view\",views:this.actions.map((e,i)=>t(e,i)),layout:(t,e)=>{t.left.equalTo(e.super).offset(-this.actionButtonBoderWidth),t.width.equalTo(e.super).offset(2*this.actionButtonBoderWidth),t.bottom.equalTo(e.super),t.top.equalTo(e.prev.bottom)}}}getView(){let t={type:\"view\",props:{id:this.id+\"-box\",smoothCorners:!0,cornerRadius:20,bgcolor:$color(\"#FFFFFF\",\"#000000\")},views:[this.textView(),this.actionView()],layout:(t,e)=>{t.center.equalTo(e.super.safeArea);let i=this.titleSize.height+this.messageSize.height+2*this.textVerticalMargin,s=this.actions.length>2?this.actions.length:1;i+=this.actionButtonHeight*s,i-=this.actionButtonBoderWidth*s;let n=this.boxWidth-2*this.actionButtonBoderWidth;t.size.equalTo($size(n,i))}};return{type:\"view\",props:{id:this.id,alpha:0,bgcolor:$rgba(0,0,0,.6)},views:[t],layout:$layout.fill}}present(){let t=$ui.create(this.getView());$ui.controller.view.hidden?$ui.controller.view.super.insertAtIndex(t,0):$ui.controller.view.insertAtIndex(t,0);let e=$(this.id);e.layout($layout.fill),e.moveToFront(),$ui.animate({duration:.3,animation:()=>{e.alpha=1}})}dismiss(){let t=$(this.id);$ui.animate({duration:.3,animation:()=>{t.alpha=0},completion:()=>{t.remove()}})}static fromJsbox(e){return new Promise((s,n)=>{new t({title:e.title,message:e.message,actions:e?.actions?.map(t=>(t.handler||(t.handler=t=>{s(t)}),new i(t)))}).present()})}},n=class{events={};setEvents(t){return Object.keys(t).forEach(e=>this.setEvent(e,t[e])),this}setEvent(t,e){return this.events[t]=e,this}appendEvent(t,e){let i=this.events[t];return\"function\"==typeof i?this.events[t]=(...t)=>{i(...t),e(...t)}:this.setEvent(t,e),this}callEvent(t,...e){\"function\"==typeof this.events[t]&&this.events[t](...e)}},r=class{viewController;constructor(){this.edges=10,this.iconSize=25}setViewController(t){this.viewController=t}get menu(){return{items:[{title:$l10n(\"SHARE\"),symbol:\"square.and.arrow.up\",handler:async(t,e)=>{let i=t.object(e).info.info;$share.sheet([$file.absolutePath(i.path)])}}]}}delete(t){$file.delete(t.path)}edit(t){let e=$file.read(t.path);if(e.info?.mimeType?.startsWith(\"image\"))g.quickLookImage(e,t.path.substring(t.path.lastIndexOf(\"/\")+1));else{let i=new g,s=$text.uuid;i.setView({type:\"code\",layout:$layout.fill,props:{id:s,lineNumbers:!0,theme:$device.isDarkMode?\"atom-one-dark\":\"atom-one-light\",text:e.string,insets:$insets(15,15,15,15)}}).addNavBar({title:t.file,popButton:{title:$l10n(\"CLOSE\")},rightButtons:[{title:$l10n(\"SAVE\"),tapped:()=>{$file.write({data:$data({string:$(s).text}),path:t.path}),$ui.success($l10n(\"SAVE_SUCCESS\"))}}]}),i.init().present()}}getFiles(t=\"\"){return $file.list(t).map(e=>{let i=t+\"/\"+e,s=$file.isDirectory(i);return{info:{info:{path:i,file:e,isDirectory:s}},icon:{symbol:s?\"folder.fill\":\"doc\"},name:{text:e},size:{text:s?\"\":\"--\"}}}).sort((t,e)=>t.info.info.isDirectory!==e.info.info.isDirectory?t.info.info.isDirectory?-1:1:t.info.info.isDirectory===e.info.info.isDirectory?t.info.info.file.localeCompare(e.info.info.file):void 0)}async loadFileSize(t){return t.map((e,i)=>{let s=e.info.info;if(!s.isDirectory)try{t[i].size.text=m.bytesToSize($file.read(s.path).info.size)}catch(e){t[i].size.text=e}}),t}get listTemplate(){return{props:{bgcolor:$color(\"clear\")},views:[{props:{id:\"info\"}},{type:\"image\",props:{id:\"icon\"},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(this.edges),t.size.equalTo(this.iconSize)}},{type:\"view\",views:[{type:\"label\",props:{id:\"size\",color:$color(\"secondaryText\"),lines:1},layout:(t,e)=>{t.height.equalTo(e.super),t.right.inset(this.edges)}},{type:\"label\",props:{id:\"name\",lines:1},layout:(t,e)=>{t.height.left.equalTo(e.super),t.right.equalTo(e.prev.left).offset(-this.edges)}}],layout:(t,e)=>{t.height.right.equalTo(e.super),t.left.equalTo(e.prev.right).offset(this.edges)}}]}}#t(t){let e=t.lastIndexOf(\"/\"),i=t.substring(e<0?0:e+1),s=this.getListView(t),n=async()=>{let e=$file.absolutePath(t);0===(await $ui.alert({title:\"Path\",message:e,actions:[{title:$l10n(\"COPY\")},{title:$l10n(\"OK\")}]})).index&&($clipboard.text=e,$ui.toast($l10n(\"COPIED\")))};if(this.viewController){let t=new R;t.setView(s).navigationBarTitle(i),t.navigationBar.setLargeTitleDisplayMode(_.largeTitleDisplayModeNever),t.navigationBarItems.addRightButton({symbol:\"info.circle\",tapped:n}),this.viewController.push(t)}else m.push({title:i,views:[s],navButtons:[{symbol:\"info.circle\",handler:n}]})}getListView(t=\"\"){return{type:\"list\",props:{menu:this.menu,bgcolor:m.primaryViewBackgroundColor,separatorInset:$insets(0,this.edges,0,0),data:[],template:this.listTemplate,actions:[{title:\" \"+$l10n(\"DELETE\")+\" \",color:$color(\"red\"),handler:(t,e)=>{let i=t.object(e).info.info;m.deleteConfirm($l10n(\"FILE_MANAGER_DELETE_CONFIRM_MSG\")+' \"'+i.file+'\" ?',()=>{this.delete(i),t.delete(e)})}}]},layout:$layout.fill,events:{ready:e=>{let i=this.getFiles(t);e.data=i,this.loadFileSize(i).then(t=>{e.data=t})},pulled:async e=>{let i=this.getFiles(t);e.data=i,e.data=await this.loadFileSize(i),$delay(.5,()=>{e.endRefreshing()})},didSelect:(t,e,i)=>{let s=i.info.info;s.isDirectory?this.#t(s.path):this.edit(s)}}}}push(t=\"\"){this.#t(t)}},a=class t{basePath;constructor({basePath:t=\"storage\"}={}){this.basePath=t,this.#t(this.basePath)}static join(...t){let e=t.length,i=t[0];if(e<2)return i;for(let s=0;s<e-1;++s){let e=t[s+1];e.startsWith(\"/\")&&(e=e.substring(1)),i=i.endsWith(\"/\")?i+e:i+\"/\"+e}return i}#t(t){$file.isDirectory(t)||$file.mkdir(t)}filePath(e=\"\",i=!0){e=t.join(this.basePath,e);let s=\"\";if(!e.endsWith(\"/\")){let t=e.lastIndexOf(\"/\");e.lastIndexOf(\".\")>t&&(s=e.substring(t+1),e=e.substring(0,t+1))}return i&&this.#t(e),e+s}exists(t=\"\"){return t=this.filePath(t,!1),!!$file.exists(t)}write(t=\"\",e){return new Promise((i,s)=>{try{let n=this.writeSync(t,e);n?i(n):s(n)}catch(t){s(t)}})}writeSync(t=\"\",e){if(!e)throw new b(\"data\");return $file.write({data:e,path:this.filePath(t)})}read(t=\"\"){return new Promise((e,i)=>{try{let s=this.readSync(t);s?e(s):i()}catch(t){i(t)}})}readSync(t=\"\"){if(t=this.filePath(t),!$file.exists(t))throw new A(t);return $file.isDirectory(t)?$file.list(t):$file.read(t)}readAsJSON(t=\"\",e=null){try{let e=this.readSync(t)?.string;return JSON.parse(e)}catch{return e}}static readFromRoot(e=\"\"){return new Promise((i,s)=>{try{let n=t.readFromRootSync(e);n?i(n):s()}catch(t){s(t)}})}static readFromRootSync(t=\"\"){if(!t)throw new b(\"path\");if(!$file.exists(t))throw new A(t);return $file.isDirectory(t)?$file.list(t):$file.read(t)}static readFromRootAsJSON(e=\"\",i=null){try{let i=t.readFromRootSync(e)?.string;return JSON.parse(i)}catch{return i}}delete(t=\"\"){return $file.delete(this.filePath(t,!1))}copy(t,e){t=this.filePath(t),e=this.filePath(e),$file.copy({src:t,dst:e})}move(t,e){t=this.filePath(t),e=this.filePath(e),$file.move({src:t,dst:e})}},o=class t{startTime=Date.now();isUseJsboxNav=!1;title=$addin?.current?.name;constructor(){$app.isDebugging&&(console.log(\"You are running EasyJsBox in debug mode.\"),$app.idleTimerDisabled=!0),l.init()}static isObject(t){return null!=t&&\"object\"==typeof t}static objectEqual(e,i){let s=Object.keys(e),n=Object.keys(i);if(s.length!==n.length)return!1;s.sort(),n.sort();for(let t=0;t<s.length;t++)if(s[t]!==n[t])return!1;for(let n of s){let s=e[n],r=i[n],a=t.isObject(s)&&t.isObject(r);if(a&&!t.objectEqual(s,r)||!a&&s!==r)return!1}return!0}static versionCompare(t=\"\",e=\"\"){let i=t.split(\".\"),s=e.split(\".\"),n=Math.max(i.length,s.length),r=0;for(let t=0;t<n;++t){let e=i.length>t?i[t]:0,n=isNaN(Number(e))?e.charCodeAt():Number(e),a=s.length>t?s[t]:0,o=isNaN(Number(a))?a.charCodeAt():Number(a);if(n<o){r=-1;break}if(n>o){r=1;break}}return r}useJsboxNav(){return this.isUseJsboxNav=!0,this}setTitle(t){this.isUseJsboxNav&&($ui.title=t),this.title=t}setNavButtons(t){this.navButtons=t}openInJsbox(){$app.openURL(`jsbox://run?name=${this.title}`)}UIRender(t={}){let e=$context.query;if(\"alertFromKeyboard\"===e.type){let t=JSON.parse($text.URLDecode(e.value));t.actions=[{title:$l10n(\"CANCEL\")}],$ui.alert(t);return}try{t.props=Object.assign({title:this.title,navBarHidden:!this.isUseJsboxNav,navButtons:this.navButtons??[],statusBarStyle:0},t.props),t.events||(t.events={});let e=t.events.layoutSubviews;t.events.layoutSubviews=()=>{$app.notify({name:\"interfaceOrientationEvent\",object:{statusBarOrientation:m.statusBarOrientation,isHorizontal:m.isHorizontal}}),\"function\"==typeof e&&e()},$ui.render(t)}catch(t){this.print(t)}}KeyboardRender(t={},e=267){t.id||(t.id=$text.uuid),$ui.render({events:{appeared:()=>{$keyboard.height=e,$ui.controller.view=$ui.create(t),$ui.controller.view.layout(t.layout)}}})}KeyboardRenderWithViewFunc(t,e=267){$ui.render({events:{appeared:async()=>{$keyboard.height=e;let i=await t();i.id||(i.id=$text.uuid),$ui.controller.view=$ui.create(i),$ui.controller.view.layout(i.layout)}}})}async checkUpdate(){let e=await $http.get(\"https://raw.githubusercontent.com/ipuppet/EasyJsBox/dev/src/version.js\");if(e.error)throw e.error;let i=e.data.match(/.*VERSION.+\\\"([0-9\\.]+)\\\"/)[1];if(this.print(`easy-jsbox latest version: ${i}`),t.versionCompare(i,\"1.4.5\")>0){let t=await $http.get(\"https://raw.githubusercontent.com/ipuppet/EasyJsBox/dev/dist/easy-jsbox.js\");if(t.error)throw t.error;return t.data}return!1}},l=class{static l10n(t,e,i){if(\"string\"==typeof e){let t={};e.split(\";\").forEach(e=>{if(\"\"!==(e=e.trim())){let i=e.split(\"=\");t[i[0].trim().slice(1,-1)]=i[1].trim().slice(1,-1)}}),e=t}let s=$app.strings;if(i)Object.assign(s[t],e);else for(let i in e)s[t][i]||(s[t][i]=e[i]);$app.strings=s}static set(t,e){this.l10n(t,e,!0)}static add(t,e){this.l10n(t,e,!1)}static init(){this.add(\"zh-Hans\",{OK:\"好\",DONE:\"完成\",CANCEL:\"取消\",CLEAR:\"清除\",BACK:\"返回\",ERROR:\"发生错误\",SUCCESS:\"成功\",INVALID_VALUE:\"非法参数\",CONFIRM_CHANGES:\"数据已变化，确认修改？\",SETTING:\"设置\",GENERAL:\"一般\",ADVANCED:\"高级\",TIPS:\"小贴士\",COLOR:\"颜色\",COPY:\"复制\",COPIED:\"复制成功\",JSBOX_ICON:\"JSBox 内置图标\",SF_SYMBOLS:\"SF Symbols\",IMAGE_BASE64:\"图片 / base64\",PREVIEW:\"预览\",SELECT_IMAGE_PHOTO:\"从相册选择图片\",SELECT_IMAGE_ICLOUD:\"从 iCloud 选择图片\",CLEAR_IMAGE:\"清除图片\",NO_IMAGE:\"无图片\",ABOUT:\"关于\",VERSION:\"Version\",AUTHOR:\"作者\",AT_BOTTOM:\"已经到底啦~\"}),this.add(\"en\",{OK:\"OK\",DONE:\"Done\",CANCEL:\"Cancel\",CLEAR:\"Clear\",BACK:\"Back\",ERROR:\"Error\",SUCCESS:\"Success\",INVALID_VALUE:\"Invalid value\",CONFIRM_CHANGES:\"The data has changed, confirm the modification?\",SETTING:\"Setting\",GENERAL:\"General\",ADVANCED:\"Advanced\",TIPS:\"Tips\",COLOR:\"Color\",COPY:\"Copy\",COPIED:\"Copide\",JSBOX_ICON:\"JSBox in app icon\",SF_SYMBOLS:\"SF Symbols\",IMAGE_BASE64:\"Image / base64\",PREVIEW:\"Preview\",SELECT_IMAGE_PHOTO:\"Select From Photo\",SELECT_IMAGE_ICLOUD:\"Select From iCloud\",CLEAR_IMAGE:\"Clear Image\",NO_IMAGE:\"No Image\",ABOUT:\"About\",VERSION:\"Version\",AUTHOR:\"Author\",AT_BOTTOM:\"It's the end~\"}),this.add(\"zh-Hans\",{DELETE_CONFIRM_TITLE:\"删除前确认\"}),this.add(\"en\",{DELETE_CONFIRM_TITLE:\"Delete Confirmation\"}),this.add(\"zh-Hans\",{FILE_MANAGER_DELETE_CONFIRM_MSG:\"确认要删除吗\",DELETE:\"删除\",CANCEL:\"取消\",CLOSE:\"关闭\",SHARE:\"分享\",SAVE:\"保存\",SAVE_SUCCESS:\"保存成功\"}),this.add(\"en\",{FILE_MANAGER_DELETE_CONFIRM_MSG:\"Are you sure you want to delete\",DELETE:\"Delete\",CANCEL:\"Cancel\",CLOSE:\"Close\",SHARE:\"Share\",SAVE:\"Save\",SAVE_SUCCESS:\"Save Success\"})}},h=class t{static level={info:\"info\",warn:\"warn\",error:\"error\"};writer;fsLevels=[t.level.error];printToFile(t){this.fsLevels=t}setWriter(t,e){this.writer=i=>{t.exists(e)&&(i=(t.readSync(e)?.string??\"\")+i),t.writeSync(e,$data({string:i}))}}format(t,e){return`${new Date().toUTCString()} [${e.toUpperCase()}] ${t}\n`}log(t,e){this.writer&&this.fsLevels.includes(e)&&this.writer(this.format(t,e)),$app.isDebugging&&console[e](t)}info(e){this.log(e,t.level.info)}warn(e){this.log(e,t.level.warn)}error(e){this.log(e,t.level.error)}},c=class{rightButtons=[];leftButtons=[];#t={};hasbutton=!1;isPinTitleView=!1;setTitleView(t){return this.titleView=t,this}pinTitleView(){return this.isPinTitleView=!0,this}setFixedFooterView(t){return this.fixedFooterView=t,this}setRightButtons(t){return t.forEach(t=>this.addRightButton(t)),this.hasbutton||(this.hasbutton=!0),this}setLeftButtons(t){return t.forEach(t=>this.addLeftButton(t)),this.hasbutton||(this.hasbutton=!0),this}addRightButton({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a}={}){let o=B.creat({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a,align:m.align.right});return this.rightButtons.push(o),this.#t[t??o.id]=o,this.hasbutton||(this.hasbutton=!0),this}addLeftButton({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a}={}){let o=B.creat({id:t,symbol:e,title:i,tapped:s,menu:n,events:r,color:a,align:m.align.left});return this.leftButtons.push(o),this.#t[t??o.id]=o,this.hasbutton||(this.hasbutton=!0),this}getButton(t){return this.#t[t]}getButtons(){return Object.values(this.#t)}addPopButton(t,e,i){return t||(t=$l10n(\"BACK\")),this.popButtonView=e??{type:\"button\",props:{bgcolor:$color(\"clear\"),symbol:\"chevron.left\",tintColor:m.linkColor,title:` ${t}`,titleColor:m.linkColor,font:$font(\"bold\",16)},layout:(t,e)=>{t.left.equalTo(e.super.safeArea).offset(B.style.edges),t.centerY.equalTo(e.super.safeArea)},events:{tapped:()=>{$ui.pop(),\"function\"==typeof i&&i()}}},this}removePopButton(){return this.popButtonView=void 0,this}},d=class{constructor(t){this.content=t}valueToJs(t){switch(t.tag){case\"dict\":return this.dictToJs(t);case\"true\":case\"false\":return\"true\"===t.tag;case\"integer\":return t.number;case\"key\":case\"string\":return t.string;case\"date\":return new Date(t.string);case\"array\":return this.arrayToJs(t);default:return t.node}}arrayToJs(t){let e=[];return t.children().forEach(t=>{e.push(this.valueToJs(t))}),e}dictToJs(t){let e=[],i=[];return t.children().forEach(t=>{\"key\"===t.tag?e.push(this.valueToJs(t)):i.push(this.valueToJs(t))}),Object.fromEntries(e.map((t,e)=>[t,i[e]]))}getObject(){if(!this.content)return!1;let t=$xml.parse({string:this.content,mode:\"xml\"});return this.valueToJs(t.rootElement.firstChild({xPath:\"//plist/dict\"}))}static get(t){return new this(t).getObject()}},u=class t{static method={get:\"GET\",post:\"POST\",put:\"PUT\",delete:\"DELETE\",patch:\"PATCH\",head:\"HEAD\",options:\"OPTIONS\"};static errorType={http:0,network:1};cacheContainerKey=$addin?.current?.name+\".request.cache\";#t;#e=!1;#i=!1;cacheLife=2592e6;#s=!1;timeout=5;logger;constructor(t){t instanceof h&&(this.logger=t)}get cache(){return $cache.get(this.cacheContainerKey)??{}}#n(t){this.#s&&this.logger instanceof h&&this.logger.info(t)}logRequest(){return this.#s=!0,this}disableLogRequest(){this.#s=!1}getCacheKey(t){return $text.MD5(t)}getCache(t,e=null){return this.cache[t]??e}setCache(t,e){if(!e)return;let i=this.cache;i[t]=e,$cache.set(this.cacheContainerKey,i)}removeCache(t){let e=this.cache;delete e[t],$cache.set(this.cacheContainerKey,e)}clearCache(){$cache.remove(this.cacheContainerKey)}clearNSURLCache(){this.#t||(this.#t=$objc(\"NSURLCache\").$sharedURLCache()),this.#t.$removeAllCachedResponses()}enableCache(){return this.#e=!0,this}disableCache(){return this.#e=!1,this}ignoreCacheExp(){this.#i=!0}async request(e,i,s={},n={},r=this.cacheLife,a){let o,l=this.#e&&i===t.method.get;if(l){o=this.getCacheKey(e);let t=this.getCache(o);if(t&&(this.#i||t.exp>Date.now()))return this.#n(\"get data from cache: \"+e),t.data}this.#n(`sending request [${i}]: ${e}`);let h=await $http.request(Object.assign({header:n,url:e,method:i,body:i===t.method.get?null:s,timeout:this.timeout},a));if(h.error)throw new T({type:t.errorType.network,message:h.error.localizedDescription,code:h.error.code});if(h?.response?.statusCode>=400){let e=h.data;throw\"object\"==typeof e&&(e=JSON.stringify(e)),new T({type:t.errorType.http,message:e,code:h.response.statusCode})}return l&&this.setCache(o,{exp:Date.now()+r,data:h}),h}},p=class t{static rowHeight=50;static edgeOffset=10;static iconSize=30;static iconDefaultColor=\"#00CC00\";setting;#t;#e;#i;title;#s={};#n;constructor({setting:t,key:e,title:i,icon:s,value:n=null}={}){this.setting=t,this.key=e,this.title=$l10n(i),this.icon=s,this.default=n}get method(){return this.setting.method}set key(t){return this.#e=t??$text.uuid,this.#t=void 0,this}get key(){return this.#e}get id(){return this.#t||(this.#t=`setting-${$text.uuid}-${this.key}`),this.#t}set icon(e){return e?Array.isArray(e)||(e=[e,t.iconDefaultColor]):e=[\"square.grid.2x2.fill\",t.iconDefaultColor],Array.isArray(e[0])||(e[0]=[e[0],e[0]]),e[1]?Array.isArray(e[1])||(e[1]=[e[1],e[1]]):e[1]=[t.iconDefaultColor,t.iconDefaultColor],this.#i=e,this}get icon(){return this.#i}get options(){return this.#s}set options(t){return this.#s=t??{},this}set(t){return\"function\"==typeof this.#n&&this.#n(t),this.setting.set(this.key,t)}onSet(t){return this.#n=t,this}get(t=this.default){return this.setting.getOriginal(this.key,t)}evalValues(t,e=[]){return\"string\"==typeof t?t.startsWith(\"this.method\")?Function(\"method\",`return ${t.replace(\"this.\",\"\")}()`)(this.method):Function(`return {${t}}`)():\"function\"==typeof t?t():t??e}createLineLabel(){return{type:\"view\",views:[{type:\"view\",props:{bgcolor:$color(this.icon[1][0],this.icon[1][1]),cornerRadius:5,smoothCorners:!0},views:[{type:\"image\",props:{tintColor:$color(\"white\"),image:this.icon[0][0].startsWith(\"icon_\")?$icon(this.icon[0][0].slice(5,this.icon[0][0].indexOf(\".\")>0?this.icon[0][0].indexOf(\".\"):this.icon[0][0].length),$color(\"#ffffff\")).ocValue().$image().jsValue():$image(this.icon[0][0],this.icon[0][1])},layout:(t,e)=>{t.center.equalTo(e.super),t.size.equalTo(20)}}],layout:(e,i)=>{e.centerY.equalTo(i.super),e.size.equalTo(t.iconSize),e.left.inset(t.edgeOffset)}},{type:\"label\",props:{text:this.title,lines:1,align:$align.left},layout:(e,i)=>{e.centerY.equalTo(i.super),e.height.equalTo(i.super),e.left.equalTo(i.prev.right).offset(t.edgeOffset),e.width.greaterThanOrEqualTo(10)}}],layout:(t,e)=>{t.height.centerY.equalTo(e.super),t.left.inset(0)}}}getView(){}create(){return this.getView(this.options)}},g=class t{#t=()=>{};#e=()=>{};style=t.UIModalPresentationStyle.PageSheet;#i=!1;#s;#n;#r;static UIModalPresentationStyle={Automatic:-2,FullScreen:0,PageSheet:1,FormSheet:2,CurrentContext:3,Custom:4,OverFullScreen:5,OverCurrentContext:6,Popover:7,BlurOverFullScreen:8};navigationView;init(){this.initNavBar(),$define({type:\"SheetViewController: UIViewController\",events:{\"viewWillDisappear:\":t=>{\"function\"==typeof this.#n&&this.#n(t)},\"viewDidDisappear:\":t=>{\"function\"==typeof this.#r&&this.#r(t)}}}),this.sheetVC=$objc(\"SheetViewController\").$new();let t=this.sheetVC.$view();return t.$addSubview($ui.create({type:\"view\"})),this.sheetVC.$setModalPresentationStyle(this.style),this.sheetVC.$setModalInPresentation(this.#i),this.#t=()=>{t.jsValue().add(this.navigationView?.getPage().definition??this.view),$ui.vc.ocValue().invoke(\"presentViewController:animated:completion:\",this.sheetVC,!0,null)},this.#e=()=>this.sheetVC.invoke(\"dismissViewControllerAnimated:completion:\",!0,null),this}initNavBar(){if(!this.#s)return;let{title:e=\"\",popButton:i={title:$l10n(\"CLOSE\")},rightButtons:s=[]}=this.#s;if(void 0===this.view)throw new I;this.navigationView=new R;let n=this.navigationView.navigationBar;n.setLargeTitleDisplayMode(_.largeTitleDisplayModeNever),n.navigationBarLargeTitleHeight-=n.navigationBarNormalHeight,n.navigationBarNormalHeight=m.PageSheetNavigationBarNormalHeight,n.navigationBarLargeTitleHeight+=n.navigationBarNormalHeight,this.style===t.UIModalPresentationStyle.FullScreen||this.style===t.UIModalPresentationStyle.OverFullScreen||this.style===t.UIModalPresentationStyle.BlurOverFullScreen?n.setTopSafeArea():n.removeTopSafeArea(),i.events=Object.assign({tapped:async()=>{\"function\"==typeof i.tapped&&await i.tapped(),this.dismiss()}},i.events??{}),this.navigationView.navigationBarItems.addLeftButton(i).setRightButtons(s),this.navigationView.setView(this.view).navigationBarTitle(e),this.view.props?.bgcolor&&this.navigationView?.getPage().setProp(\"bgcolor\",this.view.props?.bgcolor)}preventDismiss(){return this.#i=!0,this}setStyle(t){return this.style=t,this}setView(t={}){if(\"object\"!=typeof t)throw new tt(\"view\",\"object\");return this.view=t,this}addNavBar(t){return this.#s=t,this}present(){this.#t()}dismiss(){this.#e()}willDismiss(t){return this.#n=t,this}didDismiss(t){return this.#r=t,this}static quickLookImage(e,i=$l10n(\"PREVIEW\")){new t().setView({type:\"view\",views:[{type:\"scroll\",props:{zoomEnabled:!0,maxZoomScale:3},layout:$layout.fill,views:[{type:\"image\",props:{data:e},layout:$layout.fill}]}],layout:$layout.fill}).addNavBar({title:i,rightButtons:[{symbol:\"square.and.arrow.up\",tapped:()=>$share.sheet(e)}]}).init().present()}},f=class{#t={};addTask(t,e=0){let i=$text.uuid;return this.#t[i]=$delay(e,async()=>{await t(),delete this.#t[i]}),i}cancelTask(t){this.#t[t].cancel()}clearTasks(){Object.values(this.#t).forEach(t=>t.cancel())}},y=class t{static type={info:void 0,success:\"checkmark\",warning:\"exclamationmark.triangle\",error:\"xmark.circle\"};static edges=40;static iconSize=100;static labelTopMargin=10;static defaultFont=$font(\"default\",26);width=Math.min(.6*m.windowSize.width,260);labelWidth=this.width-2*t.edges;id=$text.uuid;#t=\"\";font=t.defaultFont;type=t.type.info;labelLines=2;constructor(e,i=t.type.info,s=2,n=t.defaultFont){this.type=i,this.message=e,this.labelLines=s,this.font=n}get message(){return this.#t}set message(e){this.#t=e,this.fontHeight=m.getContentSize(this.font,this.message,this.labelWidth,this.labelLines).height,this.height=(this.hasIcon?t.labelTopMargin+t.iconSize:0)+this.fontHeight+2*t.edges}get hasIcon(){return void 0!==this.type}get blurBox(){let e=m.blurBox({id:this.id,cornerRadius:15,alpha:0},[{type:\"image\",props:{symbol:this.type,hidden:!this.hasIcon,tintColor:$color(\"lightGray\")},layout:(e,i)=>{e.top.inset(t.edges),e.size.equalTo(t.iconSize),e.centerX.equalTo(i.super)}},{type:\"label\",props:{font:this.font,text:this.message,align:$align.center,lines:this.labelLines,color:$color(\"lightGray\")},layout:(e,i)=>{e.bottom.equalTo(i.supper).offset(-t.edges),e.width.equalTo(this.labelWidth),e.height.equalTo(this.fontHeight),e.centerX.equalTo(i.super)}}]);return e.events={tapped:()=>{this.remove()}},e}show(){let t=$ui.create(this.blurBox);$ui.controller.view.hidden?$ui.controller.view.super.insertAtIndex(t,0):$ui.controller.view.insertAtIndex(t,0);let e=$(this.id);e.layout((t,e)=>{t.center.equalTo(e.super),t.size.equalTo($size(this.width,this.height))}),e.moveToFront(),$ui.animate({duration:.2,animation:()=>{e.alpha=1}})}remove(){let t=$(this.id);t&&$ui.animate({duration:.2,animation:()=>{t.alpha=0},completion:()=>{t.remove()}})}static toast({message:e,type:i=t.type.info,show:s=!0,displayTime:n=2,labelLines:r=2,font:a=t.defaultFont}){let o=new t(e,i,r,a);return s&&(o.show(),$delay(n,()=>{o.remove()})),o}static info(e,i={}){return t.toast(Object.assign({message:e,type:t.type.info},i))}static success(e,i={}){return t.toast(Object.assign({message:e,type:t.type.success},i))}static warning(e,i={}){return t.toast(Object.assign({message:e,type:t.type.warning},i))}static error(e,i={}){return t.toast(Object.assign({message:e,type:t.type.error},i))}},m=class t{static #t=$objc(\"UIApplication\").$sharedApplication();static #e=$objc(\"UINotificationFeedbackGenerator\").$new();static feedbackSuccess(){t.#e.$notificationOccurred(0)}static feedbackError(){t.#e.$notificationOccurred(2)}static isTaio=$app.info.bundleID.includes(\"taio\");static align={left:0,right:1,top:2,bottom:3};static textColor=$color(\"primaryText\");static linkColor=$color(\"systemLink\");static primaryViewBackgroundColor=$color(\"primarySurface\");static scrollViewBackgroundColor=$color(\"insetGroupedBackground\");static scrollViewList=[\"list\",\"matrix\"];static isLargeScreen=$device.isIpad||$device.isIpadPro;static get windowSize(){return $objc(\"UIWindow\").$keyWindow().jsValue().size}static NavigationBarNormalHeight=$objc(\"UINavigationController\").invoke(\"alloc.init\").$navigationBar().jsValue().frame.height;static NavigationBarLargeTitleHeight=$objc(\"UITabBarController\").invoke(\"alloc.init\").$tabBar().jsValue().frame.height+t.NavigationBarNormalHeight;static PageSheetNavigationBarNormalHeight=56;static get isSplitScreenMode(){return t.isLargeScreen&&$device.info.screen.width!==t.windowSize.width}static get topSafeAreaInsets(){return t.isTaio?0:t.#t?.$keyWindow()?.$safeAreaInsets()?.top??0}static get bottomSafeAreaInsets(){return t.#t?.$keyWindow()?.$safeAreaInsets()?.bottom??0}static get statusBarOrientation(){return t.#t.$statusBarOrientation()}static get consoleBarHeight(){if($app.isDebugging){let e=t.#t.$statusBarFrame().height+26;return $device.isIphoneX&&(e+=30),e}return 0}static get isHorizontal(){return 3===t.statusBarOrientation||4===t.statusBarOrientation}static loading(){let e=$ui.create(t.blurBox({cornerRadius:15},[{type:\"spinner\",props:{loading:!0,style:0},layout:(t,e)=>{t.size.equalTo(e.prev),t.center.equalTo(e.super)}}]));return{start:()=>{$ui.controller.view.insertAtIndex(e,0),e.layout((e,i)=>{e.center.equalTo(i.super);let s=Math.min(.6*Math.min(t.windowSize.width,t.windowSize.height),260);e.size.equalTo($size(s,s))}),e.moveToFront()},end:()=>{e.remove()}}}static defaultBackgroundColor(e){return t.scrollViewList.indexOf(e)>-1?t.scrollViewBackgroundColor:t.primaryViewBackgroundColor}static separatorLine(e={},i=t.align.bottom){return{type:\"canvas\",props:e,layout:(e,s)=>{void 0===s.prev?e.top.equalTo(s.super):i===t.align.bottom?e.top.equalTo(s.prev.bottom):e.top.equalTo(s.prev.top),e.height.equalTo(1/$device.info.screen.scale),e.left.right.inset(0)},events:{draw:(t,i)=>{i.strokeColor=e.bgcolor??$color(\"separatorColor\"),i.setLineWidth(1),i.moveToPoint(0,0),i.addLineToPoint(t.frame.width,0),i.strokePath()}}}}static blurBox(t={},e=[],i=$layout.fill){return{type:\"blur\",props:Object.assign({style:$blurStyle.thinMaterial},t),views:e,layout:i}}static getContentSize(e,i=\"A\",s=t.windowSize.width,n){let r={text:i,width:s,font:e};return void 0!==n&&(r.lineSpacing=n),$text.sizeThatFits(r)}static getSymbolSize(t,e){let i=(t=\"string\"==typeof t?$image(t):t).size.width/t.size.height;return t.size.width>t.size.height?$size(e,e/i):$size(e*i,e)}static push({views:t,statusBarStyle:e=0,title:i=\"\",navButtons:s=[{title:\"\"}],bgcolor:n=t[0]?.props?.bgcolor??\"primarySurface\",titleView:r,disappeared:a}={}){let o={statusBarStyle:e,navButtons:s,title:i,bgcolor:\"string\"==typeof n?$color(n):n};r&&(o.titleView=r),$ui.push({props:o,events:{disappeared:()=>{void 0!==a&&a()}},views:[{type:\"view\",views:t,layout:(t,e)=>{t.top.equalTo(e.super.safeArea),t.bottom.equalTo(e.super),t.left.right.equalTo(e.super.safeArea)}}]})}static compressImage(t,e=921600){let i=$imagekit.info(t);if(i.height*i.width>e){let s=e/(i.height*i.width);t=$imagekit.scaleBy(t,s)}return t}static deleteConfirm(t,e){$ui.alert({title:$l10n(\"DELETE_CONFIRM_TITLE\"),message:t,actions:[{title:$l10n(\"DELETE\"),style:$alertActionType.destructive,handler:()=>{e()}},{title:$l10n(\"CANCEL\")}]})}static bytesToSize(t){if(0===t)return\"0 B\";let e=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,e)).toPrecision(3)+\" \"+[\"B\",\"KB\",\"MB\",\"GB\",\"TB\",\"PB\",\"EB\",\"ZB\",\"YB\"][e]}},w=class{#t;text=\"\";interval;fullScreen=!1;#e=()=>{};constructor(){this.#t=$text.uuid}updateText(t){$(this.#t).text=t}setLoop(t){if(\"function\"!=typeof t)throw\"loop must be a function\";this.#e=t}done(){clearInterval(this.interval)}load(){$ui.render({props:{navBarHidden:this.fullScreen},views:[{type:\"spinner\",props:{loading:!0},layout:(t,e)=>{t.centerY.equalTo(e.super).offset(-15),t.width.equalTo(e.super)}},{type:\"label\",props:{id:this.#t,align:$align.center,text:\"\"},layout:(t,e)=>{t.top.equalTo(e.prev.bottom).offset(10),t.left.right.equalTo(e.super)}}],layout:$layout.fill,events:{appeared:()=>{this.interval=setInterval(()=>{this.#e()},100)}}})}},v=class t{id=$text.uuid;type;props;views;events;layout;#t=void 0;#e=null;constructor({type:t=\"view\",props:e={},views:i=[],events:s={},layout:n=$layout.fill}={}){this.type=t,this.props=e,this.views=i,this.events=s,this.layout=n,this.props.id?this.id=this.props.id:this.props.id=this.id}static create(t){return new this(t)}static createFromViews(t){return new this({views:t})}get scrollableView(){return this.scrollable?this.#e:null}set scrollableView(t){this.#e=t}get scrollable(){if(void 0===this.#t){if(this.#t=!1,m.scrollViewList.indexOf(this.type)>-1)this.scrollableView=this,this.#t=!0;else if(this.views.length>0){let e=i=>{if(!this.#t&&i?.length>0)for(let s=0;s<i.length;s++)if(m.scrollViewList.indexOf(i[s].type)>-1){typeof i[s]!==t&&(i[s]=t.create(i[s])),this.scrollableView=i[s],this.#t=!0;return}else e(i[s].views)};e(this.views)}}return this.#t}set scrollable(t){throw Error(\"[scrollable] is readonly prop.\")}setProps(t){return Object.keys(t).forEach(e=>this.setProp(e,t[e])),this}setProp(t,e){return\"id\"===t&&(this.id=e),this.props[t]=e,this}setViews(t){return this.views=t,this.#t=void 0,this}setEvents(t){return Object.keys(t).forEach(e=>this.setEvent(e,t[e])),this}setEvent(t,e){return this.events[t]=e,this}eventMiddleware(t,e){let i=this.events[t];return this.events[t]=(...t)=>{\"function\"==typeof i&&e(i,...t)},this}assignEvent(t,e){let i=this.events[t];return this.events[t]=(...t)=>{\"function\"==typeof i&&i(...t),e(...t)},this}setLayout(t){return this.layout=t,this}getView(){return this}get definition(){return this.getView()}},b=class extends Error{constructor(t){super(`Parameter [${t}] is required.`),this.name=\"FileStorageParameterError\"}},A=class extends Error{constructor(t){super(`File not found: ${t}`),this.name=\"FileStorageFileNotFoundError\"}},T=class extends Error{constructor({message:t,code:e,type:i}={}){super(t),this.name=\"RequestError\",this.code=e,this.type=i}},S=class extends Error{constructor(){super(\"Call loadConfig() first.\"),this.name=\"SettingLoadConfigError\"}},E=class extends Error{constructor(){super(\"Attempted to assign to readonly property.\"),this.name=\"SettingReadonlyError\"}},I=class extends Error{constructor(){super(\"Please call setView(view) first.\"),this.name=\"SheetViewUndefinedError\"}},x=class extends Error{constructor(t,e){super(`The type of the parameter '${t}' must be '${e}'`),this.name=\"ValidationError\"}},C=class extends v{titleStyle={font:$font(\"bold\",21),height:30};#t;#e;templateIdByIndex(t){return this.props.template.views[t]?.props?.id===void 0&&(void 0===this.props.template.views[t].props&&(this.props.template.views[t].props={}),this.props.template.views[t].props.id=$text.uuid),this.props.template.views[t].props.id}get templateHiddenStatus(){if(!this.#e){this.#e={};for(let t=0;t<this.props.template.views.length;t++)void 0===this.props.template.views[t].props.id&&void 0===this.props.template.views[t].props.hidden&&(this.#e[this.templateIdByIndex(t)]=!1),void 0!==this.props.template.views[t].props.hidden&&(this.#e[this.templateIdByIndex(t)]=this.props.template.views[t].props.hidden)}return this.#e}get hiddenViews(){if(!this.#t){this.#t={};for(let t=0;t<this.props.template.views.length;t++)this.#t[this.templateIdByIndex(t)]={hidden:!0}}return this.#t}get data(){let t=$(this.id).data,e=[];return t.map(t=>{t.items=t.items.filter(t=>t?.__title?.hidden===!0),e.push(t)}),e}set data(t){this.props.data=this.rebuildData(t),$(this.id).data=this.props.data}#i(t){let e={...this.hiddenViews};return Object.assign(e,{__templateProps:{hidden:!0},__title:{hidden:!1,text:t,info:{title:!0}}}),e}rebuildData(t=[]){return t.map(t=>(t.items=t.items.map(t=>(Object.keys(t).forEach(e=>{t[e].hidden=this.templateHiddenStatus[e]??!1}),Object.keys(this.templateHiddenStatus).forEach(e=>{t[e]||(t[e]={}),t[e].hidden=this.templateHiddenStatus[e]}),t.__templateProps={hidden:!1},t.__title={hidden:!0},t)),t.title&&t.items.unshift(this.#i(t.title)),t))}rebuildTemplate(){let t={};void 0!==this.props.template.props&&(void 0!==this.props.template.props.cornerRadius&&(this.props.template.props.clipsToBounds=!1),t=Object.assign(this.props.template.props,{id:\"__templateProps\",hidden:!1}));let e=[{type:\"view\",props:t,layout:$layout.fill},{type:\"label\",props:{id:\"__title\",hidden:!0,font:this.titleStyle.font},layout:(t,e)=>{t.top.inset(-(3*(this.titleStyle.height/4))),t.height.equalTo(this.titleStyle.height),t.width.equalTo(e.super.safeArea)}}].concat(this.props.template.views);this.props.template.views=e}insert(t,e=!0){return t.indexPath=this.indexPath(t.indexPath,e),$(this.id).insert(t)}delete(t,e=!0){return t=this.indexPath(t,e),$(this.id).delete(t)}object(t,e=!0){return t=this.indexPath(t,e),$(this.id).object(t)}cell(t,e=!0){return t=this.indexPath(t,e),$(this.id).cell(t)}indexPath(t,e){let i=e?1:0;return t=\"number\"==typeof t?$indexPath(0,t+i):$indexPath(t.section,t.row+i)}getView(){return this.props.data=this.rebuildData(this.props.data),this.rebuildTemplate(),this.setEvent(\"itemSize\",(t,e)=>{if(t.object(e)?.__title?.info?.title)return $size(Math.max($device.info.screen.width,$device.info.screen.height),0);let i=this.props.columns??2,s=this.props.spacing??15,n=this.props.itemWidth??this.props.itemSize?.width??(t.super.frame.width-s*(i+1))/i,r=this.props.itemHeight??this.props.itemSize?.height??100;return $size(n,r)}),this}},k=class extends v{controller={};setController(t){return this.controller=t,this}},B=class t extends v{static #t;edges=15;buttonEdges=this.edges/2;iconSize=24;fontSize=17;color=m.textColor;title;#e;#i;align=m.align.right;get symbol(){return\"string\"==typeof this.#e?\"icon\"===this.#i?$icon(this.#e,this.color).ocValue().$image().jsValue():$image(this.#e):this.#e}set symbol(t){\"string\"==typeof this.#e?isNaN(t)?this.#i=\"image\":this.#i=\"icon\":\"[object BBFileIcon]\"===String(t)?this.#i=\"icon\":this.#i=\"image\",this.#e=t}get width(){return this.title?Math.ceil($text.sizeThatFits({text:this.title,width:m.windowSize.width,font:$font(this.fontSize)}).width)+this.edges:this.iconSize+this.edges}static get style(){return void 0===this.#t&&(this.#t=new t),this.#t}setEdges(t){return this.edges=t,this}setFontSize(t){return this.fontSize=t,$(this.id)&&($(this.id).font=$font(this.fontSize)),this}setColor(t=m.textColor){return this.color=t,$(this.id)&&($(this.id).titleColor=this.color,$(`icon-button-${this.id}`).titleColor=this.color,$(`icon-checkmark-${this.id}`).titleColor=this.color),this}setTitle(t){return this.title=t,$(this.id)&&($(this.id).title=this.title),this}setSymbol(t){return this.symbol=t,$(`icon-button-${this.id}`)&&($(`icon-button-${this.id}`).image=this.symbol),this}setMenu(t){return this.menu=t,this}setAlign(t){return this.align=t,this}setLoading(t){t?($(this.id).hidden=!0,$(\"spinner-\"+this.id).hidden=!1):($(this.id).hidden=!1,$(\"spinner-\"+this.id).hidden=!0)}#s(){let t=$(`icon-button-${this.id}`),e=$(`icon-checkmark-${this.id}`);t.alpha=0,$(this.id).hidden=!1,$(\"spinner-\"+this.id).hidden=!0,$ui.animate({duration:.6,animation:()=>{e.alpha=1},completion:()=>{$delay(.3,()=>$ui.animate({duration:.6,animation:()=>{e.alpha=0},completion:()=>{$ui.animate({duration:.4,animation:()=>{t.alpha=1},completion:()=>{t.alpha=1}})}}))}})}hide(){$(this.id+\"-container\").hidden=!0}show(){$(this.id+\"-container\").hidden=!1}getView(){let t=this.events.tapped;return this.events.tapped=e=>{t&&t({start:()=>this.setLoading(!0),done:()=>this.#s(),cancel:()=>this.setLoading(!1)},e)},{type:\"view\",props:{id:this.id+\"-container\",info:{align:this.align}},views:[{type:\"button\",props:Object.assign({id:this.id,bgcolor:$color(\"clear\"),font:$font(this.fontSize),titleColor:this.color,contentEdgeInsets:$insets(0,0,0,0),titleEdgeInsets:$insets(0,0,0,0),imageEdgeInsets:$insets(0,0,0,0)},this.menu?{menu:this.menu}:{},this.title?{title:this.title}:{},this.props),views:[{type:\"image\",props:Object.assign({id:`icon-button-${this.id}`,hidden:void 0===this.symbol,tintColor:this.color},this.symbol?{image:this.symbol}:{}),layout:(t,e)=>{this.symbol&&t.size.equalTo(m.getSymbolSize(this.symbol,this.iconSize)),t.center.equalTo(e.super)}},{type:\"image\",props:{id:`icon-checkmark-${this.id}`,alpha:0,tintColor:this.color,symbol:\"checkmark\"},layout:(t,e)=>{t.center.equalTo(e.super),t.size.equalTo(m.getSymbolSize(\"checkmark\",this.iconSize))}}],events:this.events,layout:$layout.fill},{type:\"spinner\",props:{id:\"spinner-\"+this.id,loading:!0,hidden:!0},layout:$layout.fill}],layout:(t,e)=>{if(t.size.equalTo($size(this.width,m.NavigationBarNormalHeight)),t.centerY.equalTo(e.super),e.prev&&e.prev?.info?.align===this.align)this.align===m.align.right?t.right.equalTo(e.prev.left).offset(-this.buttonEdges):t.left.equalTo(e.prev.right).offset(this.buttonEdges);else{let e=this.edges/2;this.align===m.align.right?t.right.inset(e):t.left.inset(e)}}}}static creat({id:e,symbol:i,title:s,tapped:n,menu:r,events:a,color:o,align:l=m.align.right}={}){let h=new t;return h.setEvents(Object.assign({tapped:n},a)).setAlign(l).setSymbol(i).setTitle(s).setColor(o).setMenu(r),e&&h.setProp(\"id\",e),h}},_=class t extends v{static largeTitleDisplayModeAutomatic=0;static largeTitleDisplayModeAlways=1;static largeTitleDisplayModeNever=2;navigationBarItems;title=\"\";prefersLargeTitles=!0;largeTitleDisplayMode=t.largeTitleDisplayModeAutomatic;fontFamily=\"bold\";largeTitleFontSize=34;largeTitleFontHeight=$text.sizeThatFits({text:\"A\",width:100,font:$font(this.fontFamily,this.largeTitleFontSize)}).height;navigationBarTitleFontSize=17;topSafeArea=!0;contentViewHeightOffset=0;navigationBarNormalHeight=m.NavigationBarNormalHeight;navigationBarLargeTitleHeight=m.NavigationBarLargeTitleHeight;setTopSafeArea(){return this.topSafeArea=!0,this}removeTopSafeArea(){return this.topSafeArea=!1,this}setLargeTitleDisplayMode(t){return this.largeTitleDisplayMode=t,this}setBackgroundColor(t){return this.backgroundColor=t,this}setTitle(t){return this.title=t,this}setPrefersLargeTitles(t){return this.prefersLargeTitles=t,this}setContentViewHeightOffset(t){return this.contentViewHeightOffset=t,this}getLargeTitleView(){return this.prefersLargeTitles&&this.largeTitleDisplayMode!==t.largeTitleDisplayModeNever?{type:\"label\",props:{id:this.id+\"-large-title\",text:this.title,textColor:m.textColor,align:$align.left,font:$font(this.fontFamily,this.largeTitleFontSize),line:1},layout:(t,e)=>{t.left.equalTo(e.super.safeArea).offset(15),t.height.equalTo(this.largeTitleFontHeight),t.top.equalTo(e.super.safeAreaTop).offset(this.navigationBarNormalHeight)}}:{props:{id:this.id+\"-large-title\"},layout:(t,e)=>{t.left.top.right.inset(0),t.bottom.equalTo(e.super.safeAreaTop).offset(this.navigationBarNormalHeight)}}}getNavigationBarView(){let e=(t,e)=>{let i=(t,i)=>{t.top.equalTo(i.super.safeAreaTop),t.bottom.equalTo(i.super.safeAreaTop).offset(this.navigationBarNormalHeight),e===m.align.left?t.left.equalTo(i.super.safeArea):t.right.equalTo(i.super.safeArea)};if(t&&!Array.isArray(t))return{type:\"view\",views:[t],layout:i};let s=0,n=[];t.forEach(t=>{s+=t.width,n.push(t.definition)});let r=t[0]?.edges??0;return s+=t.length>=2?2*r:r,t.length>0?{type:\"view\",views:n,info:{width:s},layout:(t,e)=>{i(t,e),t.width.equalTo(s)}}:{type:\"view\",layout:t=>t.size.equalTo(0)}},i=e(this.navigationBarItems.popButtonView??this.navigationBarItems.leftButtons,m.align.left),s=e(this.navigationBarItems.rightButtons,m.align.right),n=this.prefersLargeTitles,r=!this.prefersLargeTitles||this.largeTitleDisplayMode===t.largeTitleDisplayModeNever;return{type:\"view\",props:{id:this.id+\"-navigation\",bgcolor:$color(\"clear\")},layout:(t,e)=>{t.left.top.right.inset(0),t.bottom.equalTo(e.super.safeAreaTop).offset(this.navigationBarNormalHeight)},views:[this.backgroundColor?{type:\"view\",props:{hidden:n,bgcolor:this.backgroundColor,id:this.id+\"-background\"},layout:$layout.fill}:m.blurBox({hidden:n,id:this.id+\"-background\"}),m.separatorLine({id:this.id+\"-underline\",alpha:n?0:1}),{type:\"view\",props:{alpha:0,bgcolor:$color(\"clear\"),id:this.id+\"-large-title-mask\"},events:{ready:t=>{t.bgcolor=$(this.id+\"-large-title\")?.prev.bgcolor}},layout:$layout.fill},i,s,{type:\"view\",views:[{type:\"label\",props:{id:this.id+\"-small-title\",alpha:r?1:0,text:this.title,font:$font(this.fontFamily,this.navigationBarTitleFontSize),align:$align.center,bgcolor:$color(\"clear\"),textColor:m.textColor},layout:(t,e)=>{t.edges.equalTo(e.super.safeArea);let n=m.getContentSize($font(this.fontFamily,this.navigationBarTitleFontSize),e.text).width,r=Math.max(i.info?.width??0,s.info?.width??0);m.windowSize.width-2*r>n&&t.centerX.equalTo(e.super.super)}}],layout:(t,e)=>{t.top.bottom.equalTo(e.super.safeArea),t.left.equalTo(e.prev.prev.right),t.right.equalTo(e.prev.left)}}]}}},D=class t extends n{static largeTitleViewSmallMode=0;static largeTitleViewLargeMode=1;navigationBar;updateSelector(){this.selector={navigation:$(this.navigationBar.id+\"-navigation\"),largeTitleView:$(this.navigationBar.id+\"-large-title\"),smallTitleView:$(this.navigationBar.id+\"-small-title\"),underlineView:this.navigationBar.navigationBarItems.isPinTitleView?$(this.navigationBar.id+\"-title-view-underline\"):$(this.navigationBar.id+\"-underline\"),largeTitleMaskView:$(this.navigationBar.id+\"-large-title-mask\"),backgroundView:$(this.navigationBar.id+\"-background\"),titleViewBackgroundView:$(this.navigationBar.id+\"-title-view-background\")}}toNormal(t=!0){this.updateSelector(),this.selector.backgroundView.hidden=!1,$ui.animate({duration:.2,animation:()=>{this.selector.underlineView.alpha=1,this.selector.smallTitleView.alpha=1,this.selector.largeTitleView.alpha=0}}),t&&this.navigationBar.navigationBarItems&&(this.navigationBar.largeTitleDisplayMode=_.largeTitleDisplayModeNever)}toLargeTitle(t=!0){this.updateSelector(),this.selector.backgroundView.hidden=!0,$ui.animate({duration:.2,animation:()=>{this.selector.underlineView.alpha=0,this.selector.smallTitleView.alpha=0,this.selector.largeTitleView.alpha=1}}),t&&this.navigationBar.navigationBarItems&&(this.navigationBar.largeTitleDisplayMode=_.largeTitleDisplayModeAlways)}#t(e){let i=e===t.largeTitleViewSmallMode;this.selector.largeTitleView.alpha=i?0:1,$ui.animate({duration:.2,animation:()=>{this.selector.smallTitleView.alpha=i?1:0}})}#e(e){if(this.selector.largeTitleView.updateLayout((t,i)=>{this.navigationBar.navigationBarNormalHeight-e>0?t.top.equalTo(i.super.safeAreaTop).offset(this.navigationBar.navigationBarNormalHeight-e):t.top.equalTo(i.super.safeAreaTop).offset(0)}),e>0)e>=this.navigationBar.navigationBarNormalHeight?this.#t(t.largeTitleViewSmallMode):this.#t(t.largeTitleViewLargeMode);else{this.#t(t.largeTitleViewLargeMode);let i=this.navigationBar.largeTitleFontSize-.04*e;i>40&&(i=40),this.selector.largeTitleView.font=$font(this.navigationBar.fontFamily,i)}}#i(t){let e=this.navigationBar.largeTitleDisplayMode===_.largeTitleDisplayModeNever?5:this.navigationBar.navigationBarNormalHeight,i=void 0!==this.selector.titleViewBackgroundView;if(t>e){this.selector.backgroundView.hidden=!1;let s=()=>{i&&this.navigationBar.navigationBarItems.isPinTitleView&&(this.selector.titleViewBackgroundView.alpha=1),this.selector.largeTitleMaskView.alpha=0,this.selector.underlineView.alpha=1};(t-e)/3>=1?s():$ui.animate({duration:.2,animation:()=>{s()}})}else this.selector.largeTitleMaskView.alpha=t>0?1:0,this.selector.underlineView.alpha=0,i&&(this.selector.titleViewBackgroundView.alpha=0),this.selector.backgroundView.hidden=!0}didScroll(t){if(!this.navigationBar.prefersLargeTitles)return;let e=this.navigationBar.largeTitleDisplayMode;if(e!==_.largeTitleDisplayModeAlways){if(this.updateSelector(),e===_.largeTitleDisplayModeAutomatic){if(!this.navigationBar.navigationBarItems?.isPinTitleView&&(this.navigationBar.navigationBarItems?.titleView?.controller.didScroll(t),t>0)){let e=this.navigationBar.navigationBarItems?.titleView?.height??0;(t-=e)<0&&(t=0)}this.#e(t),this.#i(t)}else e===_.largeTitleDisplayModeNever&&this.#i(t)}}didEndDragging(t,e,i,s){if(!this.navigationBar.prefersLargeTitles)return;let n=this.navigationBar.largeTitleDisplayMode;if(n!==_.largeTitleDisplayModeAlways&&(this.updateSelector(),n===_.largeTitleDisplayModeAutomatic)){let n=0;this.navigationBar.navigationBarItems?.isPinTitleView||(this.navigationBar.navigationBarItems?.titleView?.controller.didEndDragging(t,e,i,s),n=this.navigationBar.navigationBarItems?.titleView?.height??0,t-=n),t>=0&&t<=this.navigationBar.largeTitleFontHeight&&i($point(0,t>=this.navigationBar.largeTitleFontHeight/2?this.navigationBar.navigationBarNormalHeight+n-s:n-s))}}},O=class extends x{constructor(t,e){super(t,e),this.name=\"NavigationViewTypeError\"}},R=class extends n{page;navigationController=new D;navigationBar=new _;navigationBarItems=new c;constructor(){super(),this.navigationBar.navigationBarItems=this.navigationBarItems,this.navigationController.navigationBar=this.navigationBar}navigationBarTitle(t){return this.navigationBar.setTitle(t),this}setView(t){if(\"object\"!=typeof t)throw new O(\"view\",\"object\");return this.view=v.create(t),this}getTopOffset(){if(!(this.view instanceof v))throw new O(\"view\",\"View\");let t=this.view.scrollableView,e=$app.isDebugging?0:m.topSafeAreaInsets,i=this.navigationBar.largeTitleDisplayMode===_.largeTitleDisplayModeNever?this.navigationBar.navigationBarNormalHeight:this.navigationBar.navigationBarLargeTitleHeight,s=this.navigationBar.contentViewHeightOffset+i;if(this.navigationBarItems.titleView&&(s+=this.navigationBarItems.titleView.topOffset+this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset),!this.view.scrollable||!1===t.props.associateWithNavigationBar){let t=s-this.navigationBar.contentViewHeightOffset;return(!m.isHorizontal||m.isLargeScreen)&&this.navigationBar.topSafeArea&&(t+=e),t}return t.props.stickyHeader&&(s-=i,s+=this.navigationBar.largeTitleFontHeight),s}getBottomOffset(){return this.navigationBarItems.fixedFooterView?.height??0}#t(){if(!(this.view instanceof v))throw new O(\"view\",\"View\");let t=this.view.scrollableView,e=$app.isDebugging?0:m.topSafeAreaInsets,i=this.getTopOffset();if(!this.view.scrollable||!1===t.props.associateWithNavigationBar){this.view.layout=(t,e)=>{t.left.right.equalTo(e.super.safeArea),t.bottom.equalTo(e.super),t.top.equalTo(i)};return}let s=this.navigationBarItems.isPinTitleView?this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset+this.navigationBar.contentViewHeightOffset:0;if(t.props.indicatorInsets){let e=t.props.indicatorInsets;t.props.indicatorInsets=$insets(e.top+this.navigationBar.navigationBarNormalHeight+s,e.left,e.bottom+this.getBottomOffset(),e.right)}else t.props.indicatorInsets=$insets(this.navigationBar.navigationBarNormalHeight+s,0,this.navigationBarItems.fixedFooterView?.height??0,0);if(t.props.contentInset){let e=t.props.contentInset;t.props.contentInset=$insets(e.top+i+s,e.left,e.bottom+this.getBottomOffset(),e.right)}else t.props.contentInset=$insets(i+s,0,this.navigationBarItems.fixedFooterView?.height??0,0);t.props.contentOffset=$point(0,-i),t.layout=(e,i)=>{t.props.stickyHeader?e.top.equalTo(i.super.safeArea).offset(this.navigationBar.navigationBarNormalHeight):e.top.equalTo(i.super),e.left.right.equalTo(i.super.safeArea),e.bottom.equalTo(i.super)},t.assignEvent(\"didScroll\",s=>{let n=s.contentOffset.y;(!m.isHorizontal||m.isLargeScreen)&&this.navigationBar.topSafeArea&&!t.props.stickyHeader&&(n+=e),n+=i,this.navigationController.didScroll(n)}).assignEvent(\"didEndDragging\",(s,n)=>{let r=s.contentOffset.y,a=0;(!m.isHorizontal||m.isLargeScreen)&&this.navigationBar.topSafeArea&&!t.props.stickyHeader&&(r+=e,a=e),r+=i,a+=i,this.navigationController.didEndDragging(r,n,(...t)=>s.scrollToOffset(...t),a)}).assignEvent(\"didEndDecelerating\",(...e)=>{e[0].tracking||t.events?.didEndDragging(...e)})}#e(){if(this.navigationBar.prefersLargeTitles){this.#t();let t={};if(this.navigationBarItems.titleView){let e=this.navigationBar.largeTitleDisplayMode===_.largeTitleDisplayModeNever?1:0;t=v.create({views:[this.navigationBar.backgroundColor?{type:\"view\",props:{alpha:e,bgcolor:this.navigationBar.backgroundColor,id:this.navigationBar.id+\"-title-view-background\"},layout:$layout.fill}:m.blurBox({alpha:e,id:this.navigationBar.id+\"-title-view-background\"}),m.separatorLine({id:this.navigationBar.id+\"-title-view-underline\",alpha:e}),this.navigationBarItems.titleView.definition],layout:(t,e)=>{t.top.equalTo(e.prev.bottom),t.width.equalTo(e.super),t.height.equalTo(this.navigationBarItems.titleView.topOffset+this.navigationBarItems.titleView.height+this.navigationBarItems.titleView.bottomOffset)}})}this.page=ts.createFromViews([this.view,this.navigationBar.getLargeTitleView(),t,this.navigationBar.getNavigationBarView(),this.navigationBarItems.fixedFooterView?.definition??{}])}else this.page=ts.createFromViews([this.view]);this.view.props?.bgcolor?this.page.setProp(\"bgcolor\",this.view.props.bgcolor):this.page.setProp(\"bgcolor\",m.defaultBackgroundColor(this.view.type))}getPage(){return this.page||this.#e(),this.page}},L=class extends k{height=35;topOffset=15;bottomOffset=10;horizontalOffset=15;kbType=$kbType.search;placeholder=$l10n(\"SEARCH\");inputEvents={};keyboardView;accessoryView;cancelButtonFont=$font(16);constructor(t){super(t),this.setController(new P),this.controller.setSearchBar(this)}get cancelButtonWidth(){return m.getContentSize(this.cancelButtonFont,$l10n(\"CANCEL\")).width}setEvent(t,e){return this.inputEvents[t]=e,this}setPlaceholder(t){return this.placeholder=t,this}setKbType(t){return this.kbType=t,this}setKeyboardView(t){return this.keyboardView=t,this}setAccessoryView(t){return this.accessoryView=t,this}onBeginEditingAnimate(){$ui.animate({duration:.3,animation:()=>{let t=this.cancelButtonWidth;$(this.id+\"-cancel-button\").updateLayout((e,i)=>{e.left.equalTo(i.super.right).offset(-t)}),$(this.id+\"-cancel-button\").alpha=1,$(this.id+\"-cancel-button\").relayout(),$(this.id+\"-input\").updateLayout(e=>{e.right.inset(t+this.horizontalOffset/2)}),$(this.id+\"-input\").relayout()}})}onEndEditingAnimate(){$ui.animate({duration:.3,animation:()=>{$(this.id+\"-cancel-button\").updateLayout((t,e)=>{t.left.equalTo(e.super.right)}),$(this.id+\"-cancel-button\").alpha=0,$(this.id+\"-cancel-button\").relayout(),$(this.id+\"-input\").updateLayout($layout.fill),$(this.id+\"-input\").relayout()}})}cancel(){$(this.id+\"-input\").blur(),$(this.id+\"-input\").text=\"\",this.onEndEditingAnimate(),this.controller.callEvent(\"onCancel\")}getView(){return this.props={id:this.id,smoothCorners:!0,cornerRadius:6},this.views=[{type:\"input\",props:{id:this.id+\"-input\",type:this.kbType,bgcolor:$color(\"#EEF1F1\",\"#212121\"),placeholder:this.placeholder,keyboardView:this.keyboardView,accessoryView:this.accessoryView},layout:$layout.fill,events:Object.assign({didBeginEditing:t=>{this.onBeginEditingAnimate(),this.controller.callEvent(\"onBeginEditing\",t.text)},didEndEditing:t=>{this.controller.callEvent(\"onEndEditing\",t.text)},changed:t=>this.controller.callEvent(\"onChange\",t.text),returned:t=>this.controller.callEvent(\"onReturn\",t.text)},this.inputEvents)},{type:\"button\",props:{id:this.id+\"-cancel-button\",title:$l10n(\"CANCEL\"),font:this.cancelButtonFont,titleColor:$color(\"tintColor\"),bgcolor:$color(\"clear\"),alpha:0,hidden:!1},events:{tapped:()=>this.cancel()},layout:(t,e)=>{t.height.equalTo(e.super),t.width.equalTo(this.cancelButtonWidth),t.left.equalTo(e.super.right)}}],this.layout=(t,e)=>{t.height.equalTo(this.height),t.top.equalTo(e.super.safeArea).offset(this.topOffset),t.left.equalTo(e.super.safeArea).offset(this.horizontalOffset),t.right.equalTo(e.super.safeArea).offset(-this.horizontalOffset)},this}},P=class extends n{setSearchBar(t){return this.searchBar=t,this}updateSelector(){this.selector={inputBox:$(this.searchBar.id),input:$(this.searchBar.id+\"-input\")}}hide(){this.updateSelector(),this.selector.inputBox.updateLayout(t=>{t.height.equalTo(0)})}show(){this.updateSelector(),this.selector.inputBox.updateLayout(t=>{t.height.equalTo(this.searchBar.height)})}didScroll(t){this.updateSelector();let e=this.searchBar.height-t;if(e=e>0?e>this.searchBar.height?this.searchBar.height:e:0,this.selector.inputBox.updateLayout(t=>{t.height.equalTo(e)}),t>0){let e=(this.searchBar.height/2-5-t)/10;this.selector.input.alpha=e}else this.selector.input.alpha=1}didEndDragging(t,e,i){this.updateSelector(),t>=0&&t<=this.searchBar.height&&i($point(0,t>=this.searchBar.height/2?this.searchBar.height:0))}},N=class extends n{#t=[];#e(t){t.callEvent(\"onPop\"),this.callEvent(\"onPop\",t),this.#t.pop()}push(t){let e=this.#t[this.#t.length-1];t.navigationBarItems.addPopButton(e?.navigationBar.title),this.#t.push(t),$ui.push({props:{statusBarStyle:0,navBarHidden:!0},events:{disappeared:()=>{this.#e(t)}},views:[t.getPage().definition],layout:$layout.fill})}},V=class extends p{get isArray(){return Array.isArray(this.default)}async tapped(){let t=this.isArray?this.default[1]:this.default;0===(await $ui.alert({title:this.title,message:t,actions:[{title:$l10n(\"COPY\")},{title:$l10n(\"OK\")}]})).index&&($clipboard.text=t,$ui.toast($l10n(\"COPIED\")))}getView(){return{type:\"view\",props:{selectable:!0,info:{key:this.key}},views:[this.createLineLabel(),{type:\"label\",props:{text:this.isArray?this.default[0]:this.default,align:$align.right,textColor:$color(\"darkGray\")},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(p.edgeOffset),t.width.equalTo(180)}}],layout:$layout.fill}}},M=class extends p{getView(){return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"switch\",props:{on:this.get(),onColor:$color(\"#00CC00\")},events:{changed:t=>{try{this.set(t.on)}catch(e){throw t.on=!t.on,e}}},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(p.edgeOffset)}}],layout:$layout.fill}}},F=class extends p{getView(){return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"button\",props:{symbol:\"square.and.pencil\",bgcolor:$color(\"clear\"),tintColor:$color(\"primaryText\")},events:{tapped:t=>{let e=$ui.popover({sourceView:t,sourceRect:t.bounds,directions:$popoverDirection.down,size:$size(320,150),views:[{type:\"text\",props:{id:`${this.id}-string`,align:$align.left,text:this.get()},layout:t=>{t.left.right.inset(10),t.top.inset(20),t.height.equalTo(90)}},{type:\"button\",props:{symbol:\"checkmark\",bgcolor:$color(\"clear\"),titleEdgeInsets:10,contentEdgeInsets:0},layout:t=>{t.right.inset(10),t.bottom.inset(25),t.size.equalTo(30)},events:{tapped:()=>{this.set($(`${this.id}-string`).text),e.dismiss()}}}]})}},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(0),t.size.equalTo(50)}}],layout:$layout.fill}}},q=class extends p{with({min:t,max:e}={}){return this.options={min:t,max:e},this}getView({min:t,max:e}={}){let i=`${this.id}-label`;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"label\",props:{id:i,text:this.get(),align:$align.left},layout:(t,e)=>{t.height.equalTo(e.super),t.right.inset(120)}},{type:\"stepper\",props:{min:t,max:e,value:this.get()},events:{changed:t=>{$(i).text=t.value;try{this.set(t.value)}catch(t){throw $(i).text=this.get(),t}}},layout:(t,e)=>{t.centerY.equalTo(e.prev),t.right.inset(p.edgeOffset)}}],layout:$layout.fill}}},U=class extends p{rightSymbol=\"chevron.right\";buttonId=`${this.id}-button`;start(){$(this.buttonId).alpha=0,$(`${this.buttonId}-spinner`).alpha=1}cancel(){$(this.buttonId).alpha=1,$(`${this.buttonId}-spinner`).alpha=0}done(){$(`${this.buttonId}-spinner`).alpha=0;let t=$(this.buttonId);t.symbol=\"checkmark\",$ui.animate({duration:.6,animation:()=>t.alpha=1,completion:()=>{$ui.animate({duration:.4,animation:()=>t.alpha=0,completion:()=>{t.symbol=this.rightSymbol,$ui.animate({duration:.4,animation:()=>t.alpha=1})}})}})}with({script:t}={}){return this.options={script:t},this}async tapped(){let t={start:()=>this.start(),cancel:()=>this.cancel(),done:()=>this.done()},{script:e}=this.options;\"function\"==typeof e?await e(t):e.startsWith(\"this.method\")?await Function(\"method\",\"animate\",`return async()=>{await ${e.replace(\"this.\",\"\")}(animate)}`)(this.method,t)():await Function(\"animate\",`return async()=>{${e}}`)(t)()}getView(){return{type:\"view\",props:{id:this.id,selectable:!0,info:{key:this.key}},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"button\",props:{id:this.buttonId,symbol:\"chevron.right\",bgcolor:$color(\"clear\"),tintColor:$color(\"secondaryText\")},events:{tapped:()=>this.tapped()},layout:(t,e)=>{t.centerY.equalTo(e.super),t.right.inset(0),t.height.equalTo(e.super)}},{type:\"spinner\",props:{id:`${this.buttonId}-spinner`,loading:!0,alpha:0},layout:(t,e)=>{t.size.equalTo(15),t.centerY.equalTo(e.super),t.right.equalTo(e.prev)}}],layout:(t,e)=>{t.right.inset(p.edgeOffset),t.height.equalTo(p.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},H=class extends p{with({items:t,values:e}={}){return Array.isArray(t)&&(t=t.map(t=>$l10n(t))),this.options={items:t,values:e},this}getView({items:t,values:e}={}){t=this.evalValues(t),e=this.evalValues(e);let i=t?.length>0&&e?.length===t?.length;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"tab\",props:{items:t??[],index:i?e.indexOf(this.get()):this.get(),dynamicWidth:!0},layout:(t,e)=>{t.right.inset(p.edgeOffset),t.centerY.equalTo(e.prev)},events:{changed:t=>{i?this.set(e[t.index]):this.set(t.index)}}}],layout:$layout.fill}}},z=class extends p{with({items:t,values:e,pullDown:i}={}){return Array.isArray(t)&&(t=t.map(t=>$l10n(t))),this.options={items:t,values:e,pullDown:i},this}getView({items:t,values:e,pullDown:i}={}){let s=`${this.id}-label`,n=this.evalValues(t),r=this.evalValues(e),a=n?.length>0&&r?.length===n?.length,o=(t,i)=>{if(a){let t=this.evalValues(e);this.set(t[i])}else this.set(i);$(s).title=t};return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"button\",props:{menu:i?{pullDown:!0,asPrimary:!0,items:n.map((t,e)=>({title:t,handler:()=>o(t,e)}))}:void 0,title:a?n[r.indexOf(this.get())]:n[this.get()],titleColor:$color(\"secondaryText\"),bgcolor:$color(\"clear\"),id:s},events:{tapped:()=>{i||$ui.menu({items:this.evalValues(t),handler:o})}},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(e.super)}}],layout:(t,e)=>{t.right.inset(p.edgeOffset),t.height.equalTo(p.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},j=class extends p{get(t=null){let e=super.get(t);return e?\"string\"==typeof e?$color(e):$rgba(e.red,e.green,e.blue,e.alpha):t}getView(){let t=`${this.id}-color`;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"view\",props:{id:t,bgcolor:this.get(),circular:!0,borderWidth:1,borderColor:$color(\"#e3e3e3\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.right.inset(p.edgeOffset),t.size.equalTo(20)}},{type:\"view\",events:{tapped:async()=>{let e=await $picker.color({color:this.get()});this.set(e.components),$(t).bgcolor=$rgba(e.components.red,e.components.green,e.components.blue,e.components.alpha)}},layout:(t,e)=>{t.right.inset(0),t.height.width.equalTo(e.super.height)}}],layout:(t,e)=>{t.height.equalTo(p.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},W=class extends p{with({mode:t=2}={}){return this.options={mode:t},this}getView({mode:t=2}={}){let e=e=>{let i=\"\";switch(\"number\"==typeof e&&(e=new Date(e)),t){case 0:i=e.toLocaleTimeString();break;case 1:i=e.toLocaleDateString();break;case 2:i=e.toLocaleString()}return i};return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"label\",props:{id:`${this.id}-label`,color:$color(\"secondaryText\"),text:this.get()?e(this.get()):\"None\"},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(e.super)}}],events:{tapped:async()=>{let i=this.get(),s=await $picker.date({props:{mode:t,date:i||Date.now()}});this.set(s.getTime()),$(`${this.id}-label`).text=e(s)}},layout:(t,e)=>{t.right.inset(p.edgeOffset),t.height.equalTo(p.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},K=class extends p{with({secure:t=!1,kbType:e=$kbType.default,saveFunc:i}={}){return this.options={secure:t,kbType:e,saveFunc:i},this}getView({secure:t=!1,kbType:e=$kbType.default,saveFunc:i}={}){void 0===i&&(i=t=>this.set(t));let s=this.id+\"-input\";return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"input\",props:{id:s,type:e,align:$align.right,bgcolor:$color(\"clear\"),textColor:$color(\"secondaryText\"),text:this.get(),font:$font(16),secure:t,accessoryView:m.blurBox({height:44},[m.separatorLine({},m.align.top),{type:\"button\",props:{title:$l10n(\"DONE\"),bgcolor:$color(\"clear\"),titleColor:$color(\"primaryText\")},layout:(t,e)=>{t.right.inset(p.edgeOffset),t.centerY.equalTo(e.super)},events:{tapped:()=>{$(s).blur()}}},{type:\"button\",props:{title:$l10n(\"CANCEL\"),bgcolor:$color(\"clear\"),titleColor:$color(\"primaryText\")},layout:(t,e)=>{t.left.inset(p.edgeOffset),t.centerY.equalTo(e.super)},events:{tapped:()=>{let t=$(s),e=this.get(\"\");t.text!==e&&(t.text=e),t.blur()}}}])},layout:(t,e)=>{t.left.equalTo(e.prev.get(\"label\").right).offset(p.edgeOffset),t.right.inset(p.edgeOffset),t.width.greaterThanOrEqualTo(50),t.height.equalTo(e.super),t.left.priority(10),t.width.priority(10)},events:{didBeginEditing:t=>{t.secure=!1,$app.autoKeyboardEnabled||($app.autoKeyboardEnabled=!0)},returned:t=>{t.blur()},didEndEditing:async e=>{let s=this.get(\"\");i(e.text)||(e.text=s),t&&(e.secure=t)}}}],layout:$layout.fill}}},G=class extends p{getView(){return new K(this).getView({secure:!1,kbType:$kbType.decimal,saveFunc:t=>\"\"!==t&&/^[0-9]+.?[0-9]*$/.test(t)?this.set(Number(t)):($ui.toast($l10n(\"INVALID_VALUE\")),!1)})}},J=class extends p{with({bgcolor:t=\"#000000\"}={}){return this.options={bgcolor:t},this}getView({bgcolor:t=\"#000000\"}={}){let e=`${this.id}-image`;return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"image\",props:{cornerRadius:8,bgcolor:\"string\"==typeof t?$color(t):t,smoothCorners:!0},layout:(t,e)=>{t.right.inset(p.edgeOffset),t.centerY.equalTo(e.super),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:e,image:$image(this.get()),icon:$icon(this.get()?.slice(5,this.get().indexOf(\".\")),$color(\"#ffffff\")),tintColor:$color(\"#ffffff\")},layout:(t,e)=>{t.right.equalTo(e.prev).offset(-5),t.centerY.equalTo(e.super),t.size.equalTo($size(20,20))}}],events:{tapped:()=>{$ui.menu({items:[$l10n(\"JSBOX_ICON\"),$l10n(\"SF_SYMBOLS\"),$l10n(\"IMAGE_BASE64\")],handler:async(t,i)=>{if(0===i){let t=await $ui.selectIcon();this.set(t),$(e).icon=$icon(t.slice(5,t.indexOf(\".\")),$color(\"#ffffff\"))}else(1===i||2===i)&&$input.text({text:\"\",placeholder:t,handler:t=>{if(\"\"===t){$ui.toast($l10n(\"INVALID_VALUE\"));return}this.set(t),1===i?$(e).symbol=t:$(e).image=$image(t)}})}})}},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(p.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},Y=class extends p{with({view:t,navButtons:e=[]}={}){return this.options={view:t,navButtons:e},this}tapped(){let{view:t,navButtons:e}=this.options;return t=this.evalValues(t,{}),(e=this.evalValues(e)).length>0&&e.map(t=>{if(\"string\"==typeof t.tapped){let e=t.tapped;t.tapped=()=>{this.evalValues(e)}}return t.handler=t.tapped,t}),new Promise((i,s)=>{if(this.setting.isUseJsboxNav){let s={title:this.title,props:t.props??{},views:[t],disappeared:()=>i()};e.length>0&&(s.navButtons=e),m.push(s)}else{let s=new R;s.setView(t).navigationBarTitle(this.title),s.navigationBarItems.addPopButton(),s.navigationBar.setLargeTitleDisplayMode(_.largeTitleDisplayModeNever),this.setting.hasSectionTitle(t)&&s.navigationBar.setContentViewHeightOffset(-10),e.length>0&&s.navigationBarItems.setRightButtons(e),this.setting.viewController.setEvent(\"onPop\",()=>i()),this.setting.viewController.push(s)}})}getView(){return{type:\"view\",props:{id:this.id,selectable:!0,info:{key:this.key}},views:[this.createLineLabel(),{type:\"button\",props:{symbol:\"chevron.right\",bgcolor:$color(\"clear\"),tintColor:$color(\"secondaryText\")},events:{tapped:()=>this.tapped()},layout:(t,e)=>{t.centerY.equalTo(e.super),t.right.inset(p.edgeOffset),t.height.equalTo(e.super)}}],layout:$layout.fill}}},X=class extends Y{with({children:t}={}){return super.with({view:()=>this.setting.getListView(t,{},this.id)}),this.options.children=t,this}},Z=class extends p{getImagePath(t=!1){let e=$text.MD5(this.key)+\".jpg\";return t&&(e=\"compress.\"+e),this.setting.imagePath+e}getImage(t=!1){try{return this.setting.fileStorage.readSync(this.getImagePath(t))}catch(t){if(t instanceof A)return null;throw t}}get(t=null){return this.getImage(!1)??null}getView(){let t=`${this.id}-image`,e=$image(\"questionmark.square.dashed\"),i=e=>async()=>{$(t).hidden=!0,$(`${t}-spinner`).hidden=!1,await $wait(.1);try{await e()}catch(t){$ui.alert({title:$l10n(\"ERROR\"),message:String(t)})}await $wait(.1),$(`${t}-spinner`).hidden=!0,$(t).hidden=!1},s=[{title:$l10n(\"PREVIEW\"),handler:i(()=>{let t=this.getImage(!1);t?g.quickLookImage(t):$ui.toast($l10n(\"NO_IMAGE\"))})},{inline:!0,items:[{title:$l10n(\"SELECT_IMAGE_PHOTO\"),handler:i(async()=>{let e=await $photo.pick({format:\"data\"});if(!e.status||!e.data){if(e?.error?.description!==\"canceled\")throw Error(e?.error?.description);return}let i=m.compressImage(e.data.image);this.setting.fileStorage.write(this.getImagePath(!0),i.jpg(.8)),this.setting.fileStorage.write(this.getImagePath(),e.data),$(t).image=i,$ui.success($l10n(\"SUCCESS\"))})},{title:$l10n(\"SELECT_IMAGE_ICLOUD\"),handler:i(async()=>{let e=await $drive.open();if(!e)return;let i=m.compressImage(e.image);this.setting.fileStorage.write(this.getImagePath(!0),i.jpg(.8)),this.setting.fileStorage.write(this.getImagePath(),e),$(t).image=i,$ui.success($l10n(\"SUCCESS\"))})}]},{title:$l10n(\"CLEAR_IMAGE\"),destructive:!0,handler:i(()=>{this.setting.fileStorage.delete(this.getImagePath(!0)),this.setting.fileStorage.delete(this.getImagePath()),$(t).image=e,$ui.success($l10n(\"SUCCESS\"))})}];return{type:\"view\",props:{id:this.id,selectable:!0},views:[this.createLineLabel(),{type:\"view\",views:[{type:\"image\",props:{id:t,image:this.getImage(!0)?.image??e},layout:(t,e)=>{t.right.inset(p.edgeOffset),t.centerY.equalTo(e.super),t.size.equalTo($size(30,30))}},{type:\"spinner\",props:{id:`${t}-spinner`,loading:!0,hidden:!0},layout:(t,e)=>{t.size.equalTo(e.prev),t.left.top.equalTo(e.prev)}},{type:\"button\",props:{menu:{pullDown:!0,asPrimary:!0,items:s},bgcolor:$color(\"clear\")},layout:(t,e)=>{t.right.inset(p.edgeOffset),t.centerY.equalTo(e.super),t.size.equalTo($size(30,30))}}],layout:(t,e)=>{t.right.inset(0),t.height.equalTo(p.rowHeight),t.width.equalTo(e.super)}}],layout:$layout.fill}}},Q=class extends n{name;setting={};settingItems={};userData;fileStorage;logger;imagePath;viewController=new N;method={readme:()=>{let t=(()=>{let t=$device.info?.language?.startsWith(\"zh\")?\"README_CN.md\":\"README.md\";try{return __README__[t]??__README__[\"README.md\"]}catch{return $file.read(t)?.string??$file.read(\"README.md\")?.string}})();new g().setView({type:\"markdown\",props:{content:t},layout:(t,e)=>{t.size.equalTo(e.super)}}).addNavBar({title:\"README\",popButton:{symbol:\"x.circle\"}}).init().present()}};#t=!1;#e=!1;#i;constructor(t={}){super(),\"function\"==typeof t.set&&\"function\"==typeof t.get?(this.set=t.set,this.getOriginal=t.get,this.setUserData(t.userData??{})):(this.fileStorage=t.fileStorage??new a,this.dataFile=t.dataFile??\"setting.json\"),t.structure?this.setStructure(t.structure):this.setStructurePath(t.structurePath??\"setting.json\"),this.logger=t.logger??new h,this.isUseJsboxNav=t.isUseJsboxNav??!1,this.imagePath=(t.name??\"default\")+\".image/\",this.setName(t.name??$text.uuid)}useJsboxNav(){return this.isUseJsboxNav=!0,this}#s(){if(!this.#e)throw new S}loader(t){let e=null;switch(t.type){case\"info\":e=new V(t);break;case\"switch\":e=new M(t);break;case\"string\":e=new F(t);break;case\"stepper\":e=new q(t).with({min:t.min??1,max:t.max??12});break;case\"script\":e=new U(t).with({script:t.script??t.value});break;case\"tab\":e=new H(t).with({items:t.items,values:t.values});break;case\"menu\":e=new z(t).with({items:t.items,values:t.values,pullDown:t.pullDown??!1});break;case\"color\":e=new j(t);break;case\"date\":e=new W(t).with({mode:t.mode});break;case\"input\":e=new K(t).with({secure:t.secure});break;case\"number\":e=new G(t);break;case\"icon\":e=new J(t).with({bgcolor:t.bgcolor});break;case\"push\":e=new Y(t).with({view:t.view,navButtons:t.navButtons});break;case\"child\":e=new X(t).with({children:t.children});break;case\"image\":e=new Z(t);break;default:(e=t).default=t.value,e.get=(...t)=>this.get(...t),e.set=(...t)=>this.set(...t)}return e}loadConfig(){this.#e=!1;let t=this.userData??this.fileStorage.readAsJSON(this.dataFile,{}),e=i=>{for(let s in i)for(let n in i[s].items){let r=i[s].items[n];r instanceof p||(i[s].items[n]=this.loader(r),r=i[s].items[n]),r.setting||(r.setting=this),this.settingItems[r.key]=r,r instanceof X?e(r.options.children):r instanceof U||r instanceof V||(r.key in t?this.setting[r.key]=t[r.key]:this.setting[r.key]=r.default)}};return e(this.structure),this.#e=!0,this}hasSectionTitle(t){return this.#s(),!!t[0]?.title}setUserData(t){return this.userData=t,this}setStructure(t){return this.structure=t,this.loadConfig()}setStructurePath(t){return this.structure||this.setStructure(a.readFromRootAsJSON(t)),this}setName(t){return this.name=t,this}set footer(t){this.#i=t}get footer(){if(void 0===this.#i){let t=a.readFromRootAsJSON(\"config.json\",{}).info??{};if(!t.version||!t.author)try{t=__INFO__}catch{}this.#i={},t.version&&t.author&&(this.#i={type:\"view\",props:{height:70},views:[{type:\"label\",props:{font:$font(14),text:`${$l10n(\"VERSION\")} ${t.version} \\u2665 ${t.author}`,textColor:$color({light:\"#C0C0C0\",dark:\"#545454\"}),align:$align.center},layout:t=>{t.left.right.inset(0),t.top.inset(10)}}]})}return this.#i}setFooter(t){return this.footer=t,this}setReadonly(){return this.#t=!0,this}set(t,e){if(this.#t)throw new E;return this.#s(),this.setting[t]=e,this.fileStorage.write(this.dataFile,$data({string:JSON.stringify(this.setting)})),this.callEvent(\"onSet\",t,e),!0}getOriginal(t,e=null){return this.#s(),Object.prototype.hasOwnProperty.call(this.setting,t)?this.setting[t]:e}getItem(t){return this.settingItems[t]}get(t,e=null){return this.#s(),this.getItem(t) instanceof p?this.getItem(t).get(e):this.getOriginal(t,e)}#n(t){let e=[];for(let i in t){let s=[];for(let e in t[i].items){let n=t[i].items[e];n instanceof p&&s.push(n.create())}e.push({title:$l10n(t[i].title??\"\"),rows:s})}return e}getListView(t=this.structure,e=this.footer,i=this.name){return{type:\"list\",props:{id:i,style:2,separatorInset:$insets(0,p.iconSize+2*p.edgeOffset,0,p.edgeOffset),footer:e,data:this.#n(t)},layout:$layout.fill,events:{rowHeight:(t,e)=>(t.object(e)?.props?.info??{}).rowHeight??p.rowHeight,didSelect:async(t,e,i)=>{t=t.ocValue();let s=this.getItem(i.props.info.key);if(\"function\"==typeof s?.tapped){t.$selectRowAtIndexPath_animated_scrollPosition(e.ocValue(),!1,0);try{await s.tapped()}catch(t){this.logger.error(t)}}t.$deselectRowAtIndexPath_animated(e,!0)}}}}getNavigationView(){let t=new R;return t.setView(this.getListView(this.structure)).navigationBarTitle($l10n(\"SETTING\")),this.hasSectionTitle(this.structure)&&t.navigationBar.setContentViewHeightOffset(-10),t}getPage(){return this.getNavigationView().getPage()}},tt=class extends x{constructor(t,e){super(t,e),this.name=\"SheetViewTypeError\"}},te=class extends v{constructor(t={}){super(t),this.setIcon(t.icon),this.setTitle(t.title),void 0!==t.activeStatus&&(this.activeStatus=t.activeStatus)}setIcon(t){return t instanceof Array?this.icon=t:this.icon=[t,t],this}setTitle(t){return this.title=t,this}active(){$(`${this.props.id}-icon`).image=$image(this.icon[1]),$(`${this.props.id}-icon`).tintColor=$color(\"systemLink\"),$(`${this.props.id}-title`).textColor=$color(\"systemLink\"),this.activeStatus=!0}inactive(){$(`${this.props.id}-icon`).image=$image(this.icon[0]),$(`${this.props.id}-icon`).tintColor=$color(\"lightGray\"),$(`${this.props.id}-title`).textColor=$color(\"lightGray\"),this.activeStatus=!1}getView(){return this.views=[{type:\"image\",props:{id:`${this.props.id}-icon`,image:$image(this.activeStatus?this.icon[1]:this.icon[0]),bgcolor:$color(\"clear\"),tintColor:$color(this.activeStatus?\"systemLink\":\"lightGray\")},layout:(t,e)=>{t.centerX.equalTo(e.super);let i=ti.tabBarHeight/2;t.size.equalTo(i),t.top.inset((ti.tabBarHeight-i-13)/2)}},{type:\"label\",props:{id:`${this.props.id}-title`,text:this.title,font:$font(10),textColor:$color(this.activeStatus?\"systemLink\":\"lightGray\")},layout:(t,e)=>{t.centerX.equalTo(e.prev),t.top.equalTo(e.prev.bottom).offset(3)}}],this}},ti=class t extends n{static tabBarHeight=50;#t={};#e={};#i;#s;#n=$text.uuid;#r=$text.uuid;bottomSafeAreaInsets=$app.isDebugging?0:m.bottomSafeAreaInsets;get selected(){return this.#s}set selected(t){this.switchPageTo(t)}get contentOffset(){return t.tabBarHeight+(this.#i?.height??0)}setPages(t={}){return Object.keys(t).forEach(e=>this.setPage(e,t[e])),this}setPage(t,e){return void 0===this.#s&&(this.#s=t),e instanceof ts?this.#t[t]=e:this.#t[t]=ts.create(e),this.#s!==t&&(this.#t[t].activeStatus=!1),this}switchPageTo(t){this.#t[t]&&this.#s!==t&&($ui.animate({duration:.4,animation:()=>{this.#e[t].active()}}),this.#e[this.#s].inactive(),this.#t[this.#s].hide(),this.#t[t].show(),this.callEvent(\"onChange\",this.#s,t),this.#s=t,this.initBackground())}hideBackground(t=!0){$(this.#r).hidden=!0,$ui.animate({duration:t?.2:1e-4,animation:()=>{$(this.#n).alpha=0}})}showBackground(t=!0){$(this.#r).hidden=!1,$ui.animate({duration:t?.2:1e-4,animation:()=>{$(this.#n).alpha=1}})}initBackground(){let t=this.#t[this.selected];t.scrollable&&$delay(0,()=>{let e=$(t.id).get(t.scrollableView.id),i=e.contentOffset.y;e.contentSize.height+this.bottomSafeAreaInsets-e.frame.height-i<=0?this.hideBackground(!1):this.showBackground(!1)})}setCells(t={}){return Object.keys(t).forEach(e=>this.setCell(e,t[e])),this}setCell(t,e){return void 0===this.#s&&(this.#s=t),e instanceof te||(e=new te({props:{info:{key:t}},icon:e.icon,title:e.title,activeStatus:this.#s===t})),this.#e[t]=e,this}setHeader(t){return this.#i=t,this}#a(){let t=[];return Object.values(this.#e).forEach(e=>{e.setEvent(\"tapped\",t=>{let e=t.info.key;this.switchPageTo(e)}),t.push(e.getView())}),t}#o(){return Object.values(this.#t).map(t=>{if(t.scrollable){let e=t.scrollableView;if(e.props.indicatorInsets){let t=e.props.indicatorInsets;e.props.indicatorInsets=$insets(t.top,t.left,t.bottom+this.contentOffset,t.right)}else e.props.indicatorInsets=$insets(0,0,this.contentOffset,0);if(e.props.contentInset){let t=e.props.contentInset;e.props.contentInset=$insets(t.top,t.left,t.bottom+this.contentOffset,t.right)}else e.props.contentInset=$insets(0,0,this.contentOffset,0);\"function\"==typeof e.assignEvent&&e.assignEvent(\"didScroll\",t=>{let e=t.contentOffset.y-this.contentOffset;t.contentSize.height+this.bottomSafeAreaInsets-t.frame.height-e<=1?this.hideBackground():this.showBackground()})}return t.definition})}generateView(){let e={type:\"view\",layout:(e,i)=>{e.centerX.equalTo(i.super),e.width.equalTo(i.super),e.top.equalTo(i.super.safeAreaBottom).offset(-t.tabBarHeight),e.bottom.equalTo(i.super)},views:[m.blurBox({id:this.#n}),{type:\"stack\",layout:$layout.fillSafeArea,props:{axis:$stackViewAxis.horizontal,distribution:$stackViewDistribution.fillEqually,spacing:0,stack:{views:this.#a()}}},m.separatorLine({id:this.#r},m.align.top)],events:{ready:()=>this.initBackground()}};return v.createFromViews(this.#o().concat(this.#i?.definition??[],e))}},ts=class extends v{constructor(t={}){super(t),this.activeStatus=!0}show(){$(this.props.id).hidden=!1,this.activeStatus=!0}hide(){$(this.props.id).hidden=!0,this.activeStatus=!1}setHorizontalSafeArea(t){return this.horizontalSafeArea=t,this}#t(t,e){t.top.bottom.equalTo(e.super),this.horizontalSafeArea?t.left.right.equalTo(e.super.safeArea):t.left.right.equalTo(e.super)}getView(){return this.layout=this.#t,this.props.clipsToBounds=!0,this.props.hidden=!this.activeStatus,super.getView()}},tn=class extends u{#t;user;password;#e;namespace=\"JSBox.WebDAV\";lockTokenCacheKey=this.namespace+\".lockToken\";get host(){return this.#t}set host(t){for(this.#t=t.trim();this.#t.endsWith(\"/\");)this.#t=this.#t.substring(0,this.#t.length-1);this.#t.startsWith(\"http\")||(this.#t=\"http://\"+this.#t)}get basepath(){return this.#e}set basepath(t){for(this.#e=t.trim();this.#e.endsWith(\"/\");)this.#e=this.#e.substring(0,this.#e.length-1);for(;this.#e.startsWith(\"/\");)this.#e=this.#e.substring(1);this.#e=\"/\"+this.#e}constructor({host:t,user:e,password:i,basepath:s=\"\"}={}){super(),this.host=t,this.user=e,this.password=i,this.basepath=s}#i(t){return t=(t=t.trim()).startsWith(\"/\")?t:\"/\"+t,this.basepath+t}async request(t,e,i=null,s={}){return s=Object.assign({\"Content-Type\":\"text/xml; charset=UTF-8\",Authorization:\"Basic \"+$text.base64Encode(`${this.user}:${this.password}`)},s),await super.request(this.host+this.#i(t),e,i,s)}async allow(t){let e=await this.request(t,u.method.options);return(e.response.headers?.allow??e.response.headers?.Allow)?.split(\",\").map(t=>t.trim().toUpperCase())??[]}async propfind(t,e=[],i=0){Array.isArray(e)||(e=[e]);let s=`<?xml version=\"1.0\" encoding=\"utf-8\" ?><D:propfind xmlns:D=\"DAV:\"><D:prop>${e.map(t=>`<D:${t}/>`).join()}</D:prop></D:propfind>`,n=await this.request(t,\"PROPFIND\",s,{Depth:i});return $xml.parse({string:n.data})}async propfindAll(t,e=0){let i=await this.request(t,\"PROPFIND\",'<?xml version=\"1.0\" encoding=\"utf-8\" ?><D:propfind xmlns:D=\"DAV:\"><D:allprop/></D:propfind>',{Depth:e});return $xml.parse({string:i.data})}async ls(t,e=1){let i=await this.request(t,\"PROPFIND\",null,{Depth:e});return $xml.parse({string:i.data})}async exists(t){try{return(await this.allow(t)).includes(u.method.get)?await this.request(t,u.method.head):await this.ls(t,0),!0}catch(t){if(t?.code===404)return!1;throw t}}async mkdir(t){return await this.request(t,\"MKCOL\")}async get(t){return await this.request(t,u.method.get,null)}async put(t,e,{withLock:i=!0,waitInterval:s=2,maxTry:n=3}={}){let r={};for(;await this.isLocked(t);){if(--n<=0)throw Error(\"Resource Locked\");await $wait(s)}if(i)try{await this.lock(t),r.If=`(${this.#n(t)})`}catch(t){if(404!==t.code)throw t;i=!1}await this.request(t,u.method.put,e,r),i&&await this.unlock(t)}async delete(t){if(!t)throw Error(\"path empty\");return await this.request(t,u.method.delete)}#s(t,e){let i=$cache.get(this.lockTokenCacheKey)??{};i[t]=e,$cache.set(this.lockTokenCacheKey,i)}#n(t){return($cache.get(this.lockTokenCacheKey)??{})[t]}async isSupportLock(t){try{return!!(await this.propfind(t,\"supportedlock\")).rootElement.firstChild({xPath:\"//D:response/D:propstat/D:prop/D:supportedlock/D:lockentry\"}).firstChild({xPath:\"//D:locktype/D:write\"})}catch(t){if(404!==t.code)return!1;throw t}}async lock(t,{infinity:e=!1,timeout:i=\"Second-10\"}={}){if(!await this.isSupportLock(t))throw Error(\"Your WebDAV service does not support the `LOCK` method.\");let s=`<?xml version=\"1.0\" encoding=\"utf-8\" ?><D:lockinfo xmlns:D='DAV:'><D:lockscope><D:exclusive/></D:lockscope><D:locktype><D:write/></D:locktype><D:owner><D:href>${this.namespace}</D:href></D:owner></D:lockinfo>`,n=await this.request(t,\"LOCK\",s,{Timeout:i,Depth:e?\"infinity\":0}),r=n.response.headers[\"lock-token\"]??n.response.headers[\"Lock-Token\"];return this.#s(t,r),$xml.parse({string:n.data})}async isLocked(t){try{let e=(await this.propfind(t,\"lockdiscovery\")).rootElement;if(e.firstChild({xPath:\"//D:response/D:propstat/D:status\"}).string.includes(\"404\"))await this.lock(t,{timeout:\"Second-0\"});else{let i=e.firstChild({xPath:\"//D:response/D:propstat/D:prop/D:lockdiscovery\"}).children()??[];for(let e=0;e<i.length;e++)if(i[e].firstChild({tag:\"lockroot\"}).string===this.host+this.#i(t))return!0}}catch(t){if(423===t.code)return!0}return!1}async refreshLock(t,{infinity:e=!1,timeout:i=\"Second-10\"}={}){let s=await this.request(t,\"LOCK\",null,{Timeout:i,If:this.#n(t),Depth:e?\"infinity\":0});return $xml.parse({string:s.data})}async unlock(t){await this.request(t,\"UNLOCK\",null,{\"Lock-Token\":this.#n(t)})}};t.exports={AlertAction:i,Alert:s,Controller:n,FileManager:r,FileStorageParameterError:b,FileStorageFileNotFoundError:A,FileStorage:a,FixedFooterView:class extends v{height=60;getView(){return this.type=\"view\",this.setProp(\"bgcolor\",m.primaryViewBackgroundColor),this.layout=(t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.height)},this.views=[v.create({props:this.props,views:this.views,layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.height.equalTo(this.height)}})],this}},Kernel:o,L10n:l,Logger:h,Matrix:C,BarTitleView:k,BarButtonItem:B,NavigationBarItems:c,NavigationBar:_,NavigationBarController:D,NavigationViewTypeError:O,NavigationView:R,SearchBar:L,SearchBarController:P,ViewController:N,Plist:d,RequestError:T,Request:u,SettingItem:p,SettingInfo:V,SettingSwitch:M,SettingString:F,SettingStepper:q,SettingScript:U,SettingTab:H,SettingMenu:z,SettingColor:j,SettingDate:W,SettingInput:K,SettingNumber:G,SettingIcon:J,SettingPush:Y,SettingChild:X,SettingImage:Z,SettingLoadConfigError:S,SettingReadonlyError:E,Setting:Q,SheetViewUndefinedError:I,SheetViewTypeError:tt,Sheet:g,TabBarCellView:te,TabBarHeaderView:class extends v{height=60;getView(){return this.type=\"view\",this.setProp(\"bgcolor\",this.props.bgcolor??m.primaryViewBackgroundColor),this.layout=(t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.height-ti.tabBarHeight)},this.views=[v.create({props:this.props,views:this.views,layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.height.equalTo(this.height)}})],this}},TabBarController:ti,Tasks:f,Toast:y,UIKit:m,UILoading:w,ValidationError:x,View:v,PageView:ts,WebDAV:tn}}),r(\"8Makm\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.Kernel,a=i.Logger,o=i.FileStorage,l=i.Setting,h=n(\"2EAPF\"),c=n(\"jEwwi\").Storage,d=n(\"4c0o0\"),u=n(\"gVMQa\"),p=n(\"eSp9Z\").ActionEnv;/**\n * @typedef {AppKernelBase} AppKernelBase\n */class g extends r{static fileStorage=new o({basePath:s.isTaio?o.join($file.rootPath,\"caio\"):\"shared://caio\"});#l;#h;#c;runActionFlag=!1;constructor(){super(),// $file.list($file.rootPath)\n$app.listen({exit:()=>$objc_clean()}),// FileStorage\nthis.fileStorage=g.fileStorage,// Logger\nthis.logger=new a,this.logger.printToFile([a.level.warn,a.level.error]),this.logger.setWriter(this.fileStorage,o.join(\"logs\",this.logFile)),// Setting\nthis.setting=new l({logger:this.logger,fileStorage:this.fileStorage,structure:h}),this.runAction($context.query)}getQueries(t){let e={};-1!==t.indexOf(\"?\")&&(t=t.split(\"?\")[1]);let i=t.split(\"&\");return i.forEach(t=>{let i=t.indexOf(\"=\");if(-1!==i){let s=t.slice(0,i),n=t.slice(i+1);e[s]=n}else e[t]=\"\"}),e}runAction(t){if(!t.runAction)return;this.runActionFlag=!0,t.runAction?.startsWith(\"jsbox://\")&&(t.runAction=this.getQueries(t.runAction).runAction);let e=JSON.parse($text.base64Decode(t.runAction)),i=$app.env===$env.siri?p.siri:p.widget;$delay(.1,async()=>{try{let s=this.actions.getAction(e.category,e.dir,{env:i,...t}),n=await s.do();i===p.siri&&($intents.finish(n),\"object\"==typeof n&&(n=JSON.stringify(n,null,2)),$(\"shortcuts-root-label\").text=n??\"CAIO\")}catch(t){i===p.siri&&$intents.finish(t),this.logger.error(t)}})}get logFile(){return\"caio.log\"}get isWebdavEnabled(){return this.setting.get(\"webdav.status\")}/**\n     * @type {Storage}\n     */get storage(){return this.#l||(this.#l=new c(this)),this.#l}/**\n     * @type {Clips}\n     */get clips(){return this.#h||(this.#h=new d(this)),this.#h}/**\n     * @type {Actions}\n     */get actions(){return this.#c||(this.#c=new u(this)),this.#c}}t.exports={AppKernelBase:g}}),r(\"2EAPF\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.SettingInfo,a=i.SettingScript,o=i.SettingTab,l=n(\"1tFrB\"),h=n(\"fEWdA\");let c={items:[new a({icon:[\"folder.fill\",\"#FF9900\"],title:\"FILE_MANAGEMENT\"}).with({script:\"this.method.fileManager\"})].concat(s.isTaio?[]:[new o({icon:[\"rectangle.topthird.inset.filled\",\"#A569BD\"],title:\"DISPLAY_MODE\",key:\"mainUIDisplayMode\",value:0}).with({items:[\"CLASSIC\",\"MODERN\"]}).onSet(()=>$delay(.3,()=>$addin.restart()))])},d={items:[new r({icon:[\"icon_177\",\"black\"],title:\"Github\",value:[\"ipuppet/CAIO\",\"https://github.com/ipuppet/CAIO\"]}),new r({icon:[\"icon_172\",\"#1888bf\"],title:\"Telegram\",value:[\"JSBoxTG\",\"https://t.me/JSBoxTG\"]}),new r({icon:[\"person.fill\",\"#FF9900\"],title:\"AUTHOR\",value:[\"ipuppet\",\"https://blog.ultagic.com\"]}),new a({icon:\"arrow.2.circlepath\",title:\"CHECK_UPDATE\"}).with({script:\"this.method.checkUpdate\"}),new a({icon:[\"book.fill\",\"#A569BD\"],title:\"README\"}).with({script:\"this.method.readme\"})]};t.exports=[l,c,h,d]}),r(\"1tFrB\",function(t,e){var i=n(\"gxpqj\").UIKit,s=n(\"3dE3D\"),r=n(\"2jPf3\"),a=n(\"iN4Y6\"),o=n(\"knZRr\"),l=n(\"aziQd\"),h=n(\"5xoIG\");t.exports={items:[s,r,a].concat(i.isTaio?[]:[o,l,h])}}),r(\"3dE3D\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingSwitch,r=i.SettingScript,a=i.SettingNumber,o=i.SettingPush,l=i.SettingChild;t.exports=new l({icon:[\"doc.on.clipboard.fill\",\"#FFCC66\"],title:\"CLIPS\"}).with({children:[{items:[new s({icon:[\"link\",\"#FF6633\"],title:\"UNIVERSAL_CLIPBOARD\",key:\"clipboard.universal\",value:!0}),new r({icon:[\"cursorarrow.rays\",\"#FF6633\"],title:\"Tips\"}).with({script:\"$ui.alert({title:$l10n('UNIVERSAL_CLIPBOARD'),message:$l10n('UNIVERSAL_CLIPBOARD_TIPS')})\"})]},{items:[new o({icon:[\"trash\",\"red\"],title:\"RECYCLE_BIN\",key:\"clipboard.recycleBin\"}).with({view:\"this.method.recycleBin\",navButtons:\"this.method.recycleBinNavButtons\"})]},{items:[new a({icon:[\"text.alignleft\",\"#FFCC66\"],title:\"MAX_ITEM_LENGTH\",key:\"clipboard.maxItemLength\",value:100}),new s({icon:[\"square.and.arrow.down.on.square\",\"#FF6633\"],title:\"AUTO_SAVE\",key:\"clipboard.autoSave\",value:!0})]},{items:[new r({icon:\"square.and.arrow.up\",title:\"EXPORT\"}).with({script:\"this.method.exportClipboard\"}),new r({icon:[\"square.and.arrow.down\",\"#FFCC33\"],title:\"IMPORT\"}).with({script:\"this.method.importClipboard\"})]},{items:[new r({icon:[\"arrow.2.circlepath\",\"red\"],title:\"REBUILD_DATABASE\"}).with({script:\"this.method.rebuildDatabase\"}),new r({icon:[\"trash\",\"red\"],title:\"DELETE_ALL_DATA\"}).with({script:\"this.method.deleteAllData\"})]}]})}),r(\"2jPf3\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingScript,r=i.SettingChild;t.exports=new r({icon:[\"bolt.circle\",\"#FF6633\"],title:\"ACTIONS\"}).with({children:[{items:[new s({icon:[\"bolt.circle\",\"#FF6633\"],title:\"IMPORT_EXAMPLE_ACTIONS\",value:\"this.method.importExampleAction\"}).with({script:\"this.method.importExampleAction\"})]},{items:[new s({icon:\"square.and.arrow.up\",title:\"EXPORT\"}).with({script:\"this.method.exportAction\"}),new s({icon:[\"square.and.arrow.down\",\"#FFCC33\"],title:\"IMPORT\"}).with({script:\"this.method.importAction\"})]},{items:[new s({icon:[\"square.and.pencil\",\"blue\"],title:\"DEIT_CATEGORY\"}).with({script:\"this.method.editCategory\"})]},{items:[new s({icon:[\"arrow.2.circlepath\",\"red\"],title:\"REBUILD_ACTION_DATABASE\"}).with({script:\"this.method.rebuildAction\"})]}]})}),r(\"iN4Y6\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingSwitch,r=i.SettingInput,a=i.SettingNumber,o=i.SettingChild;t.exports=new o({icon:[\"pencil.circle\",\"#CC0099\"],title:\"EDITOR\"}).with({children:[{title:\"CLIPS\",items:[new a({icon:[\"wand.and.stars\",\"#FF6633\"],title:\"TEXT_INSETS\",key:\"editor.text.insets\",value:300})]},{title:\"CODE\",items:[new s({icon:[\"list.number\",\"#6699CC\"],title:\"SHOW_LINE_NUMBER\",key:\"editor.code.lineNumbers\",value:!1}),new r({icon:[\"wand.and.stars\",\"#FF6633\"],title:\"LIGHT_MODE_THEME\",key:\"editor.code.lightTheme\",value:\"atom-one-light\"}),new r({icon:[\"wand.and.stars\",\"#FF6633\"],title:\"DARK_MODE_THEME\",key:\"editor.code.darkTheme\",value:\"atom-one-dark\"})]}]})}),r(\"knZRr\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingSwitch,r=i.SettingStepper,a=i.SettingScript,o=i.SettingTab,l=i.SettingNumber,h=i.SettingPush,c=i.SettingChild,d=i.SettingImage;t.exports=new c({icon:[\"keyboard\",\"#a2a5a6\"],title:\"KEYBOARD\"}).with({children:[{items:[new h({icon:\"rectangle.3.offgrid.fill\",title:\"PREVIEW\",key:\"keyboard.previewAndHeight\",value:267}).with({view:\"this.method.previewKeyboard\"})]},{items:[new o({icon:[\"rectangle.topthird.inset.filled\",\"#A569BD\"],title:\"DISPLAY_MODE\",key:\"keyboard.displayMode\",value:0}).with({items:[\"LIST\",\"MATRIX\"]}),new l({icon:[\"textformat.size\"],title:\"FONT_SIZE\",key:\"keyboard.fontSize\",value:16}),new s({icon:[\"checkerboard.rectangle\",\"#1899c4\"],title:\"USE_BLUR\",key:\"keyboard.blur\",value:!1}),new d({icon:[\"photo\",\"#FFCC66\"],title:\"BACKGROUND_IMAGE\",key:\"keyboard.background.image\"})]},{items:[new a({icon:[\"pin\",\"#FFCC33\"],title:\"PIN_ACTION\"}).with({script:\"this.method.keyboardPinAction\"}),new s({icon:[\"bolt.circle\",\"#FF6633\"],title:\"keyboard.excludePin\",key:\"keyboard.excludePin\",value:!1})]},{items:[new s({icon:[\"globe\",\"#1899c4\"],title:\"SWITCH_AFTER_INSERT\",key:\"keyboard.switchAfterInsert\",value:!1}),new s({icon:[\"cursor.rays\",\"#FF8C00\"],title:\"TAPTIC_ENGINE\",key:\"keyboard.tapticEngine\",value:!0}),new r({icon:[\"cursor.rays\",\"#FF8C00\"],title:\"TAPTIC_ENGINE_LEVEL\",key:\"keyboard.tapticEngineLevel\",value:1}).with({min:0,max:2}),new a({icon:\"paperplane\",title:\"QUICK_START_SCRIPTS\"}).with({script:\"this.method.setKeyboardQuickStart\"})]},{items:[new l({icon:[\"rays\",\"#FFCC33\"],title:\"DELETE_DELAY\",key:\"keyboard.deleteDelay\",value:.05})]}]})}),r(\"aziQd\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingScript,r=i.SettingMenu,a=i.SettingChild;t.exports=new a({icon:[\"rectangle.3.offgrid.fill\",\"#1899c4\"],title:\"WIDGET\"}).with({children:[{items:[new s({icon:\"rectangle.3.offgrid.fill\",title:\"PREVIEW\"}).with({script:\"this.method.previewWidget\"})]},{title:\"2x2\",items:[new r({icon:\"link\",title:\"CLICK_ACTION\",key:\"widget.2x2.widgetURL\",value:2}).with({pullDown:!0,items:[\"ADD\",\"ACTIONS\",\"CLIPS\"]})]}]})}),r(\"5xoIG\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingScript,r=i.SettingChild;t.exports=new r({icon:[\"filemenu.and.selection\",\"#ebcc34\"],title:\"TODAY_WIDGET\"}).with({children:[{items:[new s({icon:\"rectangle.3.offgrid.fill\",title:\"PREVIEW\"}).with({script:\"this.method.previewTodayWidget\"})]},{items:[new s({icon:\"bolt.circle\",title:\"ACTIONS\"}).with({script:\"this.method.setTodayWidgetActions\"})]}]})}),r(\"fEWdA\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.SettingChild,a=n(\"fiqsI\");let o=[{items:[a]}];if(!s.isTaio){let t=n(\"fOPZH\");o.push({items:[t]})}t.exports={items:[new r({icon:\"wrench.and.screwdriver\",title:\"EXPERIMENTAL\"}).with({children:o})]}}),r(\"fiqsI\",function(t,e){var i=n(\"gxpqj\"),s=i.SettingSwitch,r=i.SettingInput,a=i.SettingChild;t.exports=new a({icon:[\"cloud\",\"#FF9900\"],title:\"WebDAV\"}).with({children:[{items:[new s({icon:[\"cloud\",\"#FF9900\"],title:\"WebDAV\",key:\"webdav.status\",value:!1})]},{items:[new r({icon:\"link\",title:\"HOST\",key:\"webdav.host\",value:\"\"}),new r({icon:\"person\",title:\"USER\",type:\"input\",key:\"webdav.user\",value:\"\"}),new r({icon:\"person.badge.key\",title:\"PASSWORD\",type:\"input\",key:\"webdav.password\",value:\"\"}),new r({icon:\"link\",title:\"BASEPATH\",type:\"input\",key:\"webdav.basepath\",value:\"\"})]}]})}),r(\"fOPZH\",function(t,e){var i=n(\"gxpqj\").SettingScript;t.exports=new i({icon:[\"square.and.arrow.up\",\"#FF9900\"],title:\"ADD_TO_TAIO\"}).with({script:()=>{$ui.alert({title:$l10n(\"ADD_TO_TAIO\"),message:$l10n(\"SELECT_TAIO_APP\")}),$share.sheet([{name:\"CAIO.json\",data:$file.read(\"dist/CAIO.json\")}])}})}),r(\"jEwwi\",function(t,e){var i=n(\"gxpqj\").UIKit,s=n(\"7GYtH\");/**\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\n * @typedef {import(\"../libs/easy-jsbox\").FileStorage} FileStorage\n */class r{/**\n     * @type {FileStorage}\n     */fileStorage;fsPath;imagePath;#d;static isImage(t=\"\"){return t?.startsWith(\"@image=\")}static pathToKey(t){return t=JSON.stringify(t),`@image=${t}`}static keyToPath(t){if(r.isImage(t)){let e=JSON.parse(t.slice(7));return e}return!1}constructor({uuid:t,section:e,text:i=\"\",tag:s=null,prev:n=null,next:r=null}={}){if(!t)throw Error(\"Clip create faild: uuid undefined\");if(!e)throw Error(\"Clip create faild: section undefined\");this.uuid=t,this.section=e,this.text=i,this.tag=s,this.prev=n,this.next=r}get text(){return this.#d}set text(t){this.#d=t,r.isImage(t)&&this.#u(r.keyToPath(t))}get hasTag(){return null!==this.tag}/**\n     * @type {boolean}\n     */get image(){return r.isImage(this.text)}get imageOriginal(){return this.#p(\"original\")}get imagePreview(){return this.#p(\"preview\")}#p(t){if(this.image&&this.fileStorage.exists(this.fsPath[t]))return this.fileStorage.readSync(this.fsPath[t])}#u(t){this.fileStorage&&(this.fsPath=t,this.imagePath={original:this.fileStorage.filePath(t.original),preview:this.fileStorage.filePath(t.preview)})}}class a{sqlite;/**\n     *\n     * @param {AppKernel} kernel\n     */constructor(t){this.kernel=t,// 路径基于 this.kernel.fileStorage\nthis.dbName=\"CAIO.db\",this.localDb=`/${this.dbName}`;let e=\"/image\";this.imagePath={base:e,original:`${e}/original`,preview:`${e}/preview`},this.tempPath=\"/temp\",this.tempDbFile=`${this.tempPath}/${this.dbName}`,this.tempImagePath=`${this.tempPath}/image`,this.exportFileName=\"CAIO.zip\",this.initWebdavSync(),this.init()}async initWebdavSync(){if(this.kernel.isWebdavEnabled)try{this.webdavSync=new s({kernel:this.kernel,host:this.kernel.setting.get(\"webdav.host\"),user:this.kernel.setting.get(\"webdav.user\"),password:this.kernel.setting.get(\"webdav.password\"),basepath:this.kernel.setting.get(\"webdav.basepath\")}),await this.webdavSync.init()}catch(t){throw this.kernel.logger.error(t),t}}needUpload(){this.webdavSync&&this.webdavSync.needUpload()}sync(){this.webdavSync&&this.webdavSync.sync()}init(){this.sqlite&&this.sqlite.close();// 初始化表\nlet t=this.kernel.fileStorage.filePath(this.localDb);$file.exists(t)||$file.write({data:$data({string:\"\"}),path:this.kernel.fileStorage.filePath(this.localDb)}),this.sqlite=$sqlite.open(this.kernel.fileStorage.filePath(this.localDb)),this.sqlite.update(\"CREATE TABLE IF NOT EXISTS clips(uuid TEXT PRIMARY KEY NOT NULL, text TEXT, prev TEXT, next TEXT)\"),this.sqlite.update(\"CREATE TABLE IF NOT EXISTS favorite(uuid TEXT PRIMARY KEY NOT NULL, text TEXT, prev TEXT, next TEXT)\"),this.sqlite.update(\"CREATE TABLE IF NOT EXISTS tag(uuid TEXT PRIMARY KEY NOT NULL, tag TEXT)\"),// this.sqlite.update(\"CREATE TABLE IF NOT EXISTS dir(uuid TEXT PRIMARY KEY NOT NULL, name TEXT)\")\n// this.sqlite.update(\n//     \"CREATE TABLE IF NOT EXISTS dir_link(id INTEGER PRIMARY KEY AUTOINCREMENT, dir_uuid TEXT, clip_uuid TEXT)\"\n// )\nthis.kernel.logger.info(\"init database\")}rebuild(){let t=this.tempPath+\"/rebuild.db\";this.kernel.fileStorage.delete(t);let e=new a(this.kernel);e.localDb=t,e.init();let i=(t,i)=>{let s=[];t.forEach(t=>{let n=new r({uuid:t.uuid,text:t.text,section:t.section,tag:t.tag,prev:null,next:s[0]?.uuid??null});e.beginTransaction();try{e.insert(n),n.next&&(// 更改指针\ns[0].prev=n.uuid,s[0].section=i,e.update(s[0])),e.commit(),s.unshift(n)}catch(t){throw e.rollback(),this.kernel.logger.error(t),t}})};[\"clips\",\"favorite\"].map(t=>{let e=this.all(t);try{let t=this.sort(e);if(t.length>e.length)throw Error();e=t.reverse()}catch{}i(e,t)});// tag\nlet s=this.sqlite.query(\"SELECT * FROM tag\");this.parseTag(s).forEach(t=>{e.beginTransaction();try{e.setTag(t.uuid,t.tag),e.commit()}catch(t){throw e.rollback(),this.kernel.logger.error(t),t}}),this.kernel.fileStorage.copy(t,this.localDb),this.needUpload(),this.kernel.logger.info(\"database rebuild\")}deleteAllData(){this.kernel.fileStorage.delete(this.imagePath.base),this.kernel.fileStorage.delete(this.localDb),this.needUpload(),this.kernel.logger.info(\"delete all database\")}clearTemp(){this.kernel.fileStorage.delete(this.tempPath)}async export(t){this.clearTemp(),this.kernel.fileStorage.copy(this.localDb,this.tempDbFile),this.kernel.fileStorage.copy(this.imagePath.base,this.tempImagePath);let e=this.tempPath+\"/\"+this.exportFileName;await $archiver.zip({directory:this.kernel.fileStorage.filePath(this.tempPath),dest:this.kernel.fileStorage.filePath(e)}),$share.sheet({items:[{name:this.exportFileName,data:$data({path:this.kernel.fileStorage.filePath(e)})}],handler:i=>{this.kernel.fileStorage.delete(e),t(i)}})}async import(t){if(\"db\"===t.fileName.slice(-2)){if(!this.kernel.fileStorage.writeSync(this.localDb,t))throw Error($l10n(\"WRITE_DB_FILE_FAILED\"))}else if(\"zip\"===t.fileName.slice(-3)){if(!await $archiver.unzip({file:t,dest:this.kernel.fileStorage.filePath(this.tempPath)}))throw Error($l10n(\"UNZIP_FAILED\"));this.kernel.fileStorage.move(this.tempDbFile,this.localDb),// image\nthis.kernel.fileStorage.move(this.tempImagePath,this.imagePath.base)}this.webdavSync&&this.webdavSync.updateLocalTimestamp()}/**\n     *\n     * @param {Clip[]} data\n     * @param {number} maxLoop\n     * @returns {Clip[]}\n     */sort(t,e=9e3){let i={},s=0,n=null;t.forEach(t=>{// 构建结构\ni[t.uuid]=t,null===t.prev&&(n=t.uuid),// 统计长度\ns++});// 排序\nlet r=[];if(s>0)try{let t=i[n];for(;null!==t.next&&e>0;)e--,r.push(t),t=i[t.next];r.push(t)// 将最后一个元素推入\n}catch(t){throw\"Unable to sort: \"+t}return r}replaceString(t){return[\"\\\\\",'\"',\"'\",\"%\",\"-\",\"_\",\";\"].forEach(e=>{t=t.replaceAll(e,`\\\\${e}`)}),t}replaceQuotation(t){return[\"\\\\\",'\"',\"'\"].forEach(e=>{t=t.replaceAll(e,`\\\\${e}`)}),t}parse(t){let e=t.result,i=t.error,s=[];try{if(null!==i)throw Error(`Code [${i.code}] ${i.domain} ${i.localizedDescription}`);for(;e.next();){let t=e.get(\"text\"),i=new r({uuid:e.get(\"uuid\"),section:e.get(\"section\"),tag:e.get(\"tag\"),prev:e.get(\"prev\"),next:e.get(\"next\")});r.isImage(t)&&(i.fileStorage=this.kernel.fileStorage),i.text=t,s.push(i)}}catch(t){throw t}finally{e?.close()}return s}parseTag(t){if(null!==t.error)throw t.error;let e=[];for(;t.result.next();)e.push({uuid:t.result.get(\"uuid\"),tag:t.result.get(\"tag\")});return t.result.close(),e}beginTransaction(){this.sqlite.beginTransaction()}commit(){this.sqlite.commit()}rollback(){this.sqlite.rollback()}getByUUID(t=\"\"){t=this.replaceQuotation(t);let e=this.sqlite.query({sql:`\n                SELECT a.*, tag from\n                (SELECT *, 'clips' AS section FROM clips WHERE uuid = \"${t}\"\n                UNION\n                SELECT *, 'favorite' AS section FROM favorite WHERE uuid = \"${t}\") a\n                LEFT JOIN tag ON a.uuid = tag.uuid\n            `});return this.parse(e)[0]}getByText(t=\"\"){t=this.replaceQuotation(t);let e=this.sqlite.query({sql:`\n                SELECT a.*, tag from\n                (SELECT *, 'clips' AS section FROM clips WHERE text = \"${t}\"\n                UNION\n                SELECT *, 'favorite' AS section FROM favorite WHERE text = \"${t}\") a\n                LEFT JOIN tag ON a.uuid = tag.uuid\n            `});return this.parse(e)[0]}async search(t){let e=(await $text.tokenize({text:t})).map(t=>this.replaceString(t)),i=`%${e.join(\"%\")}%`,s=this.sqlite.query({sql:`\n                SELECT a.*, tag from\n                (SELECT *, 'clips' AS section FROM clips WHERE text like \"${i}\"\n                UNION\n                SELECT *, 'favorite' AS section FROM favorite WHERE text like \"${i}\") a\n                LEFT JOIN tag ON a.uuid = tag.uuid\n            `}),n={result:this.parse(s),keyword:e};return n}searchByTag(t){t.startsWith(\"#\")&&(t=t.substring(1));let e=this.sqlite.query({sql:`SELECT * FROM tag WHERE tag like \"%${this.replaceString(t)}%\"`}),i=this.parseTag(e),s=[];return i.forEach(t=>{s.push(this.getByUUID(t.uuid))}),{result:s,keyword:[t]}}deleteTable(t){let e=this.sqlite.update(`DELETE FROM ${t}`);if(!e.result)throw e.error;this.needUpload(),this.kernel.logger.info(`delete table ${t}`)}all(t){let e=this.sqlite.query(`SELECT ${t}.*, tag, '${t}' AS section FROM ${t} LEFT JOIN tag ON ${t}.uuid = tag.uuid`);return this.parse(e)}saveImage(t){if(\"object\"==typeof t){let e=$text.uuid,s={original:`${this.imagePath.original}/${e}.png`,preview:`${this.imagePath.preview}/${e}.jpg`};return this.kernel.fileStorage.write(s.original,t.png),this.kernel.fileStorage.write(s.preview,i.compressImage(t).jpg(.8)),r.pathToKey(s)}throw Error(\"saveImageError: image not an object\")}insert(t){let e=this.sqlite.update({sql:`INSERT INTO ${t.section} (uuid, text, prev, next) values (?, ?, ?, ?)`,args:[t.uuid,t.text,t.prev,t.next]});if(!e.result)throw e.error;this.needUpload()}update(t){if(Object.keys(t).length<4||\"string\"!=typeof t.uuid)return;let e=this.sqlite.update({sql:`UPDATE ${t.section} SET text = ?, prev = ?, next = ? WHERE uuid = ?`,args:[t.text,t.prev,t.next,t.uuid]});if(!e.result)throw e.error;this.needUpload()}updateText(t,e,i){if(\"string\"!=typeof e)return;let s=this.sqlite.update({sql:`UPDATE ${t} SET text = ? WHERE uuid = ?`,args:[i,e]});if(!s.result)throw s.error;this.needUpload()}delete(t,e){this.getByUUID(e);let i=this.sqlite.update({sql:`DELETE FROM ${t} WHERE uuid = ?`,args:[e]});if(!i.result)throw i.error;this.needUpload()}isEmpty(){let t=this.sqlite.query(\"SELECT * FROM clips limit 1\").result,e=this.sqlite.query(\"SELECT * FROM favorite limit 1\").result;return t.next(),e.next(),t.isNull(0)&&e.isNull(0)}allImageFromDb(t=!0){let e=this.sqlite.query(`\n            SELECT a.* from\n            (SELECT *, 'clips' AS section FROM clips WHERE text like \"@image=%\"\n            UNION\n            SELECT *, 'favorite' AS section FROM favorite WHERE text like \"@image=%\") a\n            LEFT JOIN tag ON a.uuid = tag.uuid\n        `),i=this.parse(e)?.map(t=>{if(t.image){let e=t.fsPath;return e.preview=e.preview.replaceAll(this.imagePath.preview,\"\"),e.preview.startsWith(\"/\")&&(e.preview=e.preview.substring(1)),e.original=e.original.replaceAll(this.imagePath.original,\"\"),e.original.startsWith(\"/\")&&(e.original=e.original.substring(1)),e}}),s=[],n=[];return t||i.forEach(t=>{s.push(t.original),n.push(t.preview)}),t?i:{original:s,preview:n}}localImagesFromFile(){let t=this.kernel.fileStorage.readSync(this.kernel.storage.imagePath.original),e=this.kernel.fileStorage.readSync(this.kernel.storage.imagePath.preview);return{original:t,preview:e}}/**\n     *\n     * @param {string} uuid Clip.uuid\n     * @param {string} tag\n     */setTag(t,e){let i=this.sqlite.update({sql:\"INSERT OR REPLACE INTO tag (uuid, tag) values (?, ?)\",args:[t,e]});if(!i.result)throw i.error;this.needUpload()}deleteTag(t){let e=this.sqlite.update({sql:\"DELETE FROM tag WHERE uuid = ?\",args:[t]});if(!e.result)throw e.error;this.needUpload()}addDir(t){let e=this.sqlite.update({sql:\"INSERT INTO dir (uuid, name) values (?, ?)\",args:[$text.uuid,t]});if(!e.result)throw e.error;this.needUpload()}deleteDir(t){this.beginTransaction();let e=this.sqlite.update({sql:\"DELETE FROM dir WHERE uuid = ?\",args:[t]});if(!e.result)throw this.rollback(),e.error;let i=this.sqlite.update({sql:\"DELETE FROM dir_link WHERE dir_uuid = ?\",args:[t]});if(!i.result)throw this.rollback(),i.error;this.commit(),this.needUpload()}}t.exports={Clip:r,Storage:a}}),r(\"7GYtH\",function(t,e){var i=n(\"gxpqj\").FileStorage,s=n(\"2VUvw\");/**\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\n */class r extends s{localSyncDataPath=\"/sync.json\";webdavSyncDataPath=\"/sync.json\";webdavDbPath=\"/CAIO.db\";webdavImagePath=\"/image\";get localDb(){return $data({path:this.kernel.fileStorage.filePath(this.kernel.storage.localDb)})}set localDb(t){this.kernel.fileStorage.writeSync(this.kernel.storage.localDb,t)}get localImagePath(){return this.kernel.fileStorage.filePath(\"/image\")}async init(){await super.init(),await this.initImagePath(),this.sync()}async initImagePath(){await this.webdav.exists(this.webdavImagePath)||(await this.webdav.mkdir(this.webdavImagePath),[\"/image/original\",\"/image/preview\"].map(async t=>{await this.webdav.exists(t)||await this.webdav.mkdir(t)}))}isNew(){return this.kernel.storage.isEmpty()}async webdavImages(){let t=await this.webdav.ls(this.webdavImagePath,\"infinity\"),e=t.rootElement,i=e.firstChild({xPath:\"//D:response/D:href\"}).string,s=[],n=[];return e.children().map(t=>{/**\n             * @type {string}\n             */let e=t.firstChild({tag:\"href\"})?.string?.replaceAll(i,\"\");!e.endsWith(\"/\")&&(e.startsWith(\"original\")?s.push(e.substring(9)):e.startsWith(\"preview\")&&n.push(e.substring(8)))}),{original:s,preview:n}}async syncImages(){let t=await this.webdavImages(),e=this.kernel.storage.allImageFromDb(!1),s=this.kernel.storage.localImagesFromFile();// 删除本地多余图片\nObject.keys(s).map(t=>{s[t].forEach(async s=>{if(!e[t].includes(s)){let e=i.join(this.kernel.storage.imagePath[t],s);this.kernel.fileStorage.delete(e),this.kernel.logger.info(`Local image deleted: ${e}`)}})}),// 从 webdav 下载本地缺失图片或上传 webdav 缺失图片\nObject.keys(e).map(s=>{e[s].forEach(async e=>{let n=i.join(this.webdavImagePath,s,e),r=i.join(this.kernel.storage.imagePath[s],e);if(t[s].includes(e)&&!this.kernel.fileStorage.exists(r)){let t=await this.webdav.get(n);this.kernel.fileStorage.writeSync(r,t.rawData),this.kernel.logger.info(`WebDAV image downloaded: ${r}`)}else if(!t[s].includes(e)){let t=this.kernel.fileStorage.readSync(r);await this.webdav.put(n,t),this.kernel.logger.info(`WebDAV image uploaded: ${n}`)}})}),// 遍历 webdavImages 删除 webdav 中本地没有的图片\nObject.keys(t).map(s=>{t[s].forEach(async t=>{if(!e[s].includes(t)){let e=i.join(this.webdavImagePath,s,t);await this.webdav.delete(e),this.kernel.logger.info(`WebDAV image deleted: ${e}`)}})})}async pull(){this.webdav.clearNSURLCache();let t=await this.webdav.get(this.webdavDbPath);this.localDb=t.rawData,await this.downloadSyncData(),this.kernel.storage.init(),await this.syncImages(),this.kernel.logger.info(\"clip webdav sync: pulled\")}async push(){await this.webdav.put(this.webdavDbPath,this.localDb),await this.uploadSyncData(),await this.syncImages(),this.kernel.logger.info(\"clip webdav sync: pushed\")}notify(t){$app.notify({name:\"clipSyncStatus\",object:t})}async #g(){let t=!1;try{let e=await this.nextSyncStep();if(this.kernel.logger.info(`clip nextSyncStep: ${s.stepName[e]}`),e===s.step.needPush||e===s.step.init)await this.push();else if(e===s.step.needPull)await this.pull(),t=!0;else if(e===s.step.conflict){let e=await this.conflict($l10n(\"CLIPS\"));if(e!==r.conflictKeep.webdav)return;t=!0}else{this.notify({status:s.status.nochange});return}this.notify({status:s.status.success,updateList:t})}catch(t){throw this.notify({status:s.status.fail,error:t}),this.kernel.logger.error(\"clip sync error\"),this.kernel.logger.error(t),t}}sync(){this.notify({status:s.status.syncing,animate:!0}),this.syncTimer&&this.syncTimer.cancel(),this.syncTimer=$delay(.5,()=>{this.#g()})}needUpload(){this.notify({status:s.status.syncing}),this.uploadTimer&&this.uploadTimer.cancel(),this.uploadTimer=$delay(.5,()=>{this.updateLocalTimestamp(),this.#g()})}}t.exports=r}),r(\"2VUvw\",function(t,e){var i=n(\"gxpqj\").WebDAV;/**\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\n */class s{static step={init:-1,stay:0,needPush:2,needPull:3,conflict:4};static stepName=(()=>{let t={};return Object.keys(s.step).map(e=>{let i=s.step[e];t[i]=String(e)}),t})();static status={syncing:0,success:1,nochange:2,fail:3};static conflictKeep={local:0,webdav:1,cancel:2};static initLocalTimestamp=0;/**\n     * @type {WebDAV}\n     */webdav;/**\n     * @type {AppKernel}\n     */kernel;localSyncDataPath;webdavSyncDataPath;constructor({host:t,user:e,password:s,basepath:n,kernel:r}={}){this.kernel=r,this.webdav=new i({host:t,user:e,password:s,basepath:n}),this.webdav.namespace=\"JSBox.CAIO\"}get mustLocalSyncDataPath(){if(!this.localSyncDataPath)throw Error(\"localSyncDataPath not set\");return this.localSyncDataPath}get mustWebdavSyncDataPath(){if(!this.webdavSyncDataPath)throw Error(\"webdavSyncDataPath not set\");return this.webdavSyncDataPath}get localSyncData(){return this.kernel.fileStorage.exists(this.mustLocalSyncDataPath)||(this.localSyncData={timestamp:s.initLocalTimestamp}),this.kernel.fileStorage.readSync(this.mustLocalSyncDataPath)}set localSyncData(t){this.kernel.fileStorage.writeSync(this.mustLocalSyncDataPath,$data({string:JSON.stringify(t)}))}get localTimestamp(){return Number(JSON.parse(this.localSyncData.string).timestamp)}set localTimestamp(t){this.localSyncData=Object.assign(this.localSyncData,{timestamp:t})}/**\n     *\n     * @param {string} path\n     */async init(t=this.webdav.basepath){let e=new i({host:this.webdav.host,user:this.webdav.user,password:this.webdav.password,basepath:t});if(!await e.exists(\"/\"))try{await e.mkdir(\"/\")}catch(e){if(409===e.code){// 递归创建目录\nawait this.init(t.substring(0,t.lastIndexOf(\"/\"))),await this.init(t);return}throw e}}/**\n     * 要同步的数据是否是刚刚初始化的（无内容）状态\n     * @returns {boolean}\n     */isNew(){return!1}async webdavSyncData(){this.webdav.clearNSURLCache();let t=(await this.webdav.get(this.mustWebdavSyncDataPath)).data;return\"string\"==typeof t&&(t=JSON.parse(t)),t}async webdavTimestamp(){try{let t=await this.webdavSyncData();return Number(t.timestamp)}catch(t){if(404===t.code)return s.step.init;throw t}}updateLocalTimestamp(){this.localTimestamp!==s.initLocalTimestamp&&(this.localTimestamp=Date.now())}async uploadSyncData(){this.localTimestamp===s.initLocalTimestamp&&(this.localTimestamp=Date.now()),await this.webdav.put(this.mustWebdavSyncDataPath,this.localSyncData)}async downloadSyncData(){this.localSyncData=await this.webdavSyncData()}async nextSyncStep(){let t=this.localTimestamp,e=await this.webdavTimestamp();return e===s.step.init?s.step.init:e===s.initLocalTimestamp?(// 重置 webdav 数据\nthis.localTimestamp=Date.now(),await this.push(),s.step.stay):t>e?s.step.needPush:t===e?s.step.stay:t<e?// WebDAV 有数据，本地 sync 时间戳为 0，发生数据冲突\nthis.isNew()||t!==s.initLocalTimestamp?s.step.needPull:s.step.conflict:void 0}async conflict(t=\"\"){let e=[];e[s.conflictKeep.local]=$l10n(\"LOCAL_DATA\"),e[s.conflictKeep.webdav]=$l10n(\"WEBDAV_DATA\"),e[s.conflictKeep.cancel]=$l10n(\"CANCEL\");let i=await $ui.alert({title:$l10n(\"DATA_CONFLICT\"),message:$l10n(\"DATA_CONFLICT_MESSAGE\")+` (${t})`,actions:e});return i.index!==s.conflictKeep.cancel&&(i.index===s.conflictKeep.local?(this.kernel.logger.info(\"conflict resolve: keep local database\"),await this.push()):(this.kernel.logger.info(\"conflict resolve: keep WebDAV database\"),await this.pull())),i.index}}t.exports=s}),r(\"4c0o0\",function(t,e){var i=n(\"gxpqj\"),s=i.View,r=i.UIKit,a=i.Sheet,o=i.NavigationView,l=i.NavigationBar,h=i.Toast,c=n(\"ZnuTV\"),d=n(\"5dzom\"),u=n(\"iGysH\"),p=n(\"a4uPv\"),g=n(\"2VUvw\");/**\n * @typedef {Clips} Clips\n * @typedef {import(\"../../dao/storage\").Clip} Clip\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n */class f extends c{copied=$cache.get(\"clips.copied\")??{};itemSize={};scrollToOffsetDirectionX=!1;/**\n     * @type {NavigationView}\n     */navigationView;/**\n     * @param {AppKernel} kernel\n     */constructor(t){super(t),this.views=new u(t),this.delegates=new p(t,this,this.views)}getByIndex(t){return\"object\"==typeof t&&(t=t.row),this.clips[t]}appListen(){r.isTaio||$app.listen({resume:()=>{// 重载小组件\n$widget.reloadTimeline(),!this.needReload&&$(this.views.listId).ocValue().$isEditing()||(this.updateList(!0),$delay(.5,()=>{this.readClipboard()}))},clipSyncStatus:t=>{let e=$(this.views.listId);t.status===g.status.success||t.status===g.status.nochange?(t.updateList&&this.updateList(!0),e&&e.endRefreshing()):t.status===g.status.syncing&&t.animate&&e&&e.beginRefreshing()}})}setDelegate(){this.delegates.setEditingCallback(t=>{this.navigationView.navigationBarItems.getButtons().forEach(e=>{e.id===this.views.listId+\"-navbtn-edit\"?e.setTitle(t?$l10n(\"DONE\"):$l10n(\"EDIT\")):t?e.hide():e.show()})}),this.delegates.setDelegate()}async checkUrlScheme(){// actions widget\n// checked in kernel constructor\nif(!this.kernel.runActionFlag){// clips widget\nif($context.query.copy){let t=$context.query.copy;this.setCopied(t),$ui.success($l10n(\"COPIED\"))}else $context.query.add?this.getAddTextView():$context.query.actions&&(this.kernel.isUseJsboxNav?this.kernel.actions.present():this.kernel.tabBarController.switchPageTo(\"actions\"))}}/**\n     * list view ready event\n     */listReady(){this.setDelegate(),this.updateList(),// readClipboard\n$delay(.5,()=>{this.readClipboard()}),r.isTaio||(// check url scheme\n$delay(0,()=>this.checkUrlScheme()),this.appListen())}updateList(t=!1){t&&this.setNeedReload(),$(this.views.listId).data=this.clips.map(t=>this.views.lineData(t,this.copied.uuid===t.uuid)),this.updateListBackground()}updateListBackground(){let t=$(this.views.listId);t&&(this.clips.length>0?t.ocValue().$setBackgroundView(void 0):t.ocValue().$setBackgroundView($ui.create(this.views.getEmptyBackground(this.clips.length>0))))}updateCopied(t=null){let e=this.copied?.uuid// 防止延迟执行导致的数据错误\n;$delay(0,()=>{let i=$(this.views.listId),s=i.cell($indexPath(0,this.getIndexByUUID(e)));if(s&&(s.get(\"copied\").hidden=!0),t){let e=this.getIndexByUUID(t.uuid);i.cell($indexPath(0,e))&&(i.cell($indexPath(0,e)).get(\"copied\").hidden=!1)}}),t?Object.assign(this.copied,t):this.copied={},this.kernel.logger.info(`this.copied: ${JSON.stringify(this.copied,null,2)}`),$cache.set(\"clips.copied\",this.copied)}focusAnimation(t){$delay(.3,()=>{let e=$(this.views.listId),i=this.getIndexByUUID(t),s=0;for(let t=0;t<i;t++)s+=this.itemSize[t];s-=5// 防止完全对其\n,this.views.scrollToOffsetDirectionX?e.scrollToOffset($point(s,0)):e.scrollToOffset($point(0,s))})}/**\n     * 将元素标记为 copied\n     * @param {string} uuid\n     * @param {boolean} isUpdateIndicator\n     * @returns\n     */setCopied(t,e=!0){let i={};this.copied.uuid!==t&&(i=this.getClip(t)??{},this.setClipboardText(i.text),this.isPasteboardChanged// 更新缓存\n),i.tabIndex=this.tabIndex,this.updateCopied(i),e&&this.focusAnimation(t)}clearCopied(){let t=$(this.views.listId),e=t.cell($indexPath(0,this.getIndexByUUID(this.copied.uuid)));e&&(e.get(\"copied\").hidden=!0),this.updateCopied()}async readClipboard(t=!1){if(t||this.kernel.setting.get(\"clipboard.autoSave\")){// 剪切板没有变化则直接退出\nif(this.kernel.logger.info(\"read clipboard\"),!t&&!this.isPasteboardChanged){this.kernel.logger.info(\"clipboard no change\");return}// 仅手动模式下保存图片\nif($clipboard.images?.length>0){t&&(await $wait(.1),$clipboard.images.forEach(t=>{this.add(t)}));return}let e=$clipboard.text;if(!e||\"\"===e){this.clearCopied();return}// 判断 copied 是否和剪切板一致\n// 开发模式下，清空数据后该值仍然存在，可能造成：无法保存相同的数据\nif(this.getClip(this.copied?.uuid)?.text===e){t&&$ui.toast($l10n(\"CLIPBOARD_NO_CHANGE\")),this.switchTab(this.tabItemsMap[this.copied.section],!0),this.focusAnimation(this.copied.uuid);return}if(this.exists(e)){let t=this.kernel.storage.getByText(e);this.switchTab(this.tabItemsMap[t.section],!0),this.setCopied(t.uuid)}else{this.switchTab(1,!0)// clips\n;let t=await this.add(e);this.setCopied(t.uuid)}}}async add(t,e=!0){try{let i=super.addItem(t);if(!e)return;return(// 先修改背景，让 list 显示出来\nthis.updateListBackground(),await $wait(.1)// 直接操作可能造成键盘 matrix 闪退\n,// 在列表中插入行\n$(this.views.listId).insert({indexPath:$indexPath(0,0),value:this.views.lineData(i)}),i)}catch(t){$ui.warning(t)}}delete(t){try{super.deleteItem(t),this.copied.uuid===t&&(this.updateCopied(),$clipboard.clear()),this.updateListBackground()}catch(t){throw $ui.alert(t),t}}update(t,e){try{return super.updateItem(t,e),// 更新列表\nthis.updateList(),e===this.copied.uuid&&this.setClipboardText(t),!0}catch(t){return $ui.alert(t),!1}}favorite(t){let e=this.getByIndex(t);if(e?.section===\"favorite\")return;let i=this.kernel.storage.getByUUID(e.uuid);if(i?.section===\"favorite\"){h.warning(\"Already exists\");return}try{super.favoriteItem(e.uuid),// UI 操作\n$(this.views.listId).delete(t)}catch(t){$ui.alert(t)}}/**\n     * 复制\n     * @param {string} uuid 被复制的 uuid\n     */copy(t){let e=this.getClip(t);// 将被复制的行移动到最前端\nif(e.image?$clipboard.image=e.imageOriginal:this.setCopied(t,!1),0!==this.tabIndex){let e=this.getIndexByUUID(t);try{super.moveItem(e,0);// 操作 UI\nlet t=$(this.views.listId).ocValue(),i=$indexPath(0,e).ocValue(),s=$indexPath(0,0).ocValue();t.$moveRowAtIndexPath_toIndexPath(i,s)}catch(t){$ui.alert(t)}}}getAddTextView(){this.views.edit(\"\",t=>{\"\"!==t&&this.add(t)})}switchTab(t,e=!1){this.tabIndex=t,this.updateList(),e&&($(this.views.listId+\"-tab\").index=this.tabIndex),this.delegates.setEditing(!1)}getTabView(){return this.views.tabView(this.tabItems,this.tabIndex,{changed:t=>this.switchTab(t.index)})}getListView(){return this.views.getListView(this.views.listId,[],{ready:()=>this.listReady(),pulled:t=>{this.updateList(!0),this.kernel.storage.sync(),this.kernel.setting.get(\"webdav.status\")||$delay(.5,()=>t.endRefreshing())}})}getNavigationView(){let t=new d(this.kernel);t.setCallback(e=>{let i=new a,s=(t=>{let{keyword:e,result:s,isTagKeyword:n}=t,r=this.views.getListView(this.views.listId+\"-search-result\",s.map(t=>{let i=n?t.tag:t.text,s=[];return e.forEach(t=>{let e=i.indexOf(t);for(;e>-1;)s.push({range:$range(e,t.length),color:$color(\"red\")}),e=i.indexOf(t,e+1)}),t.styledText={},n?t.tagStyledText={color:this.views.tagColor,text:i,styles:s}:t.textStyledText={text:i,styles:s},this.views.lineData(t,!1)}),{ready:()=>this.updateList(),didSelect:(t,e)=>{let n=s[e.row];n.image?a.quickLookImage(n.imageOriginal):(i.dismiss(),this.views.edit(n.text,t=>{n.text!==t&&this.update(t,n.uuid)}))},rowHeight:(t,e)=>{let i=s[e.row],n=i?.hasTag?this.views.tagHeight:this.views.verticalMargin,r=i.image?this.views.imageContentHeight:this.views.getContentHeight(i.text);return this.views.verticalMargin+r+n}});return r})(e);s.props.bgcolor=r.primaryViewBackgroundColor,i.setView(s).addNavBar({title:$l10n(\"SEARCH_RESULT\"),popButton:{title:$l10n(\"DONE\"),tapped:()=>t.dismiss()}}).init().present()});let e=this.getTabView();e.type=\"menu\",e.layout=(t,e)=>{t.left.right.equalTo(e.super),t.height.equalTo(this.views.tabHeight),this.kernel.isUseJsboxNav&&r.isTaio?t.top.equalTo(e.super).offset(r.PageSheetNavigationBarNormalHeight):t.top.equalTo(e.super)};let i=s.createFromViews([e,this.getListView(),t.getSearchHistoryView()]);return this.navigationView=new o().navigationBarTitle($l10n(\"CLIPS\")).setView(i),this.navigationView.navigationBarItems.setTitleView(t.getSearchBarView()).pinTitleView().setRightButtons([{symbol:\"plus.circle\",tapped:()=>this.getAddTextView()}]).setLeftButtons([{id:this.views.listId+\"-navbtn-edit\",title:$l10n(\"EDIT\"),tapped:()=>this.delegates.setEditing()},{symbol:\"square.and.arrow.down.on.square\",tapped:async t=>{t.start();try{await this.readClipboard(!0),t.done()}catch(e){t.cancel(),this.kernel.logger.error(e)}}}]),this.navigationView.navigationBar.setBackgroundColor(r.primaryViewBackgroundColor).setLargeTitleDisplayMode(l.largeTitleDisplayModeNever),this.kernel.isUseJsboxNav&&this.navigationView.navigationBar.removeTopSafeArea(),this.navigationView}}t.exports=f}),r(\"ZnuTV\",function(t,e){var i=n(\"gxpqj\").UIKit,s=n(\"jEwwi\").Clip;class r{/**\n     * @type {AppKernel|AppKernelLite}\n     */kernel;pasteboard=$objc(\"UIPasteboard\").$generalPasteboard();#f=[];clipsUUIDMap={};rememberTabIndex=!0;#y=0// use when rememberTabIndex = false\n;tabItems=[$l10n(\"FAVORITE\"),$l10n(\"CLIPS\")];tabItemsIndex=[\"favorite\",\"clips\"]// 获取索引对应的表名\n;tabItemsMap=/**\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\n * @typedef {import(\"../app-lite\").AppKernel} AppKernelLite\n * @typedef {import(\"./storage\").Clip} Clip\n */(function(t){let e={};return t.forEach((t,i)=>{e[t]=i}),e})(this.tabItemsIndex)// 获取表名对应的索引\n;/**\n     * @param {AppKernel} kernel\n     */constructor(t){this.kernel=t}get tabIndex(){return this.rememberTabIndex?$cache.get(\"caio.main.tab.index\")??0:this.#y}set tabIndex(t){this.rememberTabIndex?$cache.set(\"caio.main.tab.index\",t):this.#y=t}get table(){return this.tabItemsIndex[this.tabIndex]}get tableL10n(){return this.tabItems[this.tabIndex]}get allClips(){return this.tabItemsIndex.forEach((t,e)=>{this.#f[e]||(this.#f[e]=this.#m(t))}),this.#f}/**\n     * @type {Clip[]}\n     */get clips(){return this.#f[this.tabIndex]||(this.#f[this.tabIndex]=this.#m(this.table)),this.#f[this.tabIndex]}get isPasteboardChanged(){let t=this.pasteboard.$changeCount(),e=$cache.get(\"clipboard.changeCount\");return e!==t&&($cache.set(\"clipboard.changeCount\",t),!0)}get needReload(){return $cache.get(\"caio.needReload\")??!1}set needReload(t){$cache.get(\"caio.needReload\",t)}/**\n     *\n     * @param {string} table\n     * @returns {Clip[]}\n     */#m(t){try{let e=this.kernel.storage.all(t),i=this.kernel.storage.sort(e,this.kernel.setting.get(\"clipboard.maxItemLength\"));return i.forEach((e,i)=>{this.clipsUUIDMap[e.uuid]={tab:t,index:i}}),this.kernel.logger.info(`init clip-data: ${this.table}`),this.#w(i)}catch(t){this.kernel.logger.error(t),this.rebuildDatabase()}}/**\n     *\n     * @param {Clip[]} clips\n     * @returns\n     */#w(t){return new Proxy(t??[],{set:(t,e,i)=>Reflect.set(t,e,i),get:(t,e)=>Reflect.get(t,e)})}rebuildDatabase(){$ui.alert({title:$l10n(\"REBUILD_DATABASE\"),message:$l10n(\"CLIPS_STRUCTURE_ERROR\"),actions:[{title:$l10n(\"OK\"),handler:()=>{let t=i.loading();t.start(),this.kernel.storage.rebuild(),t.end(),$delay(.8,()=>$addin.restart())}},{title:$l10n(\"CANCEL\")}]})}setNeedReload(t){t?this.#f[this.tabItemsMap[t]]=null:this.#f=[],this.needReload=!0,this.kernel.logger.info(`set need reload: ${t??\"all\"}`)}getClipCopy(t,e={}){if(!t.uuid)return t;let i=new s(t);return i.fileStorage=t.fileStorage,Object.assign(i,e),i}/**\n     * @param {string} uuid\n     * @returns {number}\n     */getIndexByUUID(t){return this.clipsUUIDMap[t]?.index??-1}/**\n     *\n     * @param {string} uuid\n     * @returns\n     */getClip(t){let e=this.clips[this.getIndexByUUID(t)];return e||this.kernel.storage.getByUUID(t)}exists(t){try{let e=this.kernel.storage.getByText(t);return void 0!==e}catch{return!1}}setClipboardText(t){this.kernel.setting.get(\"clipboard.universal\")?$clipboard.text=t:$clipboard.setTextLocalOnly(t)}addItem(t){if(this.exists(t))throw Error(\"Item already exists\");// 元数据\nlet e=new s({uuid:$text.uuid,section:this.table,prev:null,next:this.clips[0]?this.clips[0].uuid:null});if(\"string\"==typeof t){if(\"\"===t.trim())return;e.text=t}else{if(\"object\"!=typeof t)return;e.fileStorage=this.kernel.fileStorage,e.text=this.kernel.storage.saveImage(t)}try{return(// 写入数据库\nthis.kernel.storage.beginTransaction(),this.kernel.storage.insert(e),e.next&&(// 更改指针\nthis.clips[0].prev=e.uuid,this.kernel.storage.update(this.clips[0])),this.kernel.storage.commit(),// 保存到内存中\nthis.setNeedReload(this.table),e)}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}getRecycleBin(){return $cache.get(\"caio.recycleBin\")??[]}moveToRecycleBin(t){let e=this.getRecycleBin();e.push({text:t.text,tag:t.tag}),$cache.set(\"caio.recycleBin\",e)}removeFromRecycleBin(t){let e=this.getRecycleBin();e.splice(t,1),$cache.set(\"caio.recycleBin\",e)}clearRecycleBin(){$cache.set(\"caio.recycleBin\",[])}deleteItem(t,e=!0){let i=this.getIndexByUUID(t),s=this.clips[i],n=this.clips[i-1],r=this.clips[i+1];try{// 删除数据库中的值\nthis.kernel.storage.beginTransaction(),this.kernel.storage.delete(this.table,t),n&&(// prev 的 next 指向被删除元素的 next\nn.next=s.next,this.kernel.storage.update(n)),r&&(// next 的 prev 指向被删除元素的 prev\nr.prev=s.prev,this.kernel.storage.update(r)),this.kernel.storage.commit(),e&&(this.kernel.storage.deleteTag(t),s?.image?(// delete image file\n// 图片不送入回收站\nthis.kernel.fileStorage.delete(s.fsPath.original),this.kernel.fileStorage.delete(s.fsPath.preview)):this.moveToRecycleBin(s)),this.setNeedReload(this.table)}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}updateItem(t,e){let i=this.getClip(e),s=i.text;Object.assign(i,{text:t});try{this.kernel.storage.updateText(this.table,i.uuid,t),this.kernel.logger.info(`data changed at index [${this.getIndexByUUID(e)}]\n${s}\n\\u{2193}\n${t}`)}catch(t){throw this.kernel.logger.error(t),t}}/**\n     * 将from位置的元素移动到to位置\n     * @param {number} from\n     * @param {number} to\n     */moveItem(t,e){if(t!==e&&1!==this.clips.length){t<e&&e++// 若向下移动则 to 增加 1，因为代码为移动到 to 位置的上面\n,this.clips[e]||(this.clips[e]={uuid:null,text:\"\",hasTag:!1,image:null,next:null,prev:this.clips[e-1].uuid});try{this.kernel.storage.beginTransaction()// 开启事务\n;// 保存上下文环境，from 上下的元素可能是 to\nlet i=this.getClipCopy(this.clips[t]),s=this.getClipCopy(this.clips[e]);/**\n             * 修改将被删除元素前后元素指针\n             */if(this.clips[t-1]){// from 位置的上一个元素\nlet e=this.getClipCopy(this.clips[t-1],{next:this.clips[t].next});this.kernel.storage.update(e),this.clips[t-1]=e}if(this.clips[t+1]){// from 位置的下一个元素\nlet e=this.getClipCopy(this.clips[t+1],{prev:this.clips[t].prev});this.kernel.storage.update(e),this.clips[t+1]=e}/**\n             * 在 to 上方插入元素\n             */if(this.clips[e-1]){let i=this.getClipCopy(this.clips[e-1],{next:this.clips[t].uuid}// 指向即将被移动元素的 uuid\n);this.kernel.storage.update(i),this.clips[e-1]=i}let n=this.getClipCopy(s,{prev:i.uuid,next:this.clips[e].next// 前面的代码可能更改此值，因为 from 上下的元素可能就是 to\n});this.kernel.storage.update(n);let r=this.getClipCopy(i,{prev:this.clips[e].prev,next:s.uuid});this.kernel.storage.update(r),// 提交事务\nthis.kernel.storage.commit()}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}finally{this.setNeedReload(this.table)}}}favoriteItem(t){let e=this.getClipCopy(this.getClip(t),{next:this.allClips[0][0]?.uuid??null,prev:null,section:\"favorite\"});try{// 写入数据库\nthis.kernel.storage.beginTransaction(),this.kernel.storage.insert(e),e.next&&(// 更改指针\nthis.allClips[0][0].prev=e.uuid,this.allClips[0][0].section=\"favorite\",this.kernel.storage.update(this.allClips[0][0])),this.kernel.storage.commit(),// 删除原表数据，此处不删除标签和图片\nthis.deleteItem(e.uuid,!1),this.setNeedReload()}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}}t.exports=r}),r(\"5dzom\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.SearchBar;/**\r\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\r\n */class a{listId=$text.uuid;/**\r\n     * @type {AppKernel}\r\n     */kernel;callback=()=>{};onBegin=()=>{};onDismiss=()=>{};/**\r\n     * @param {AppKernel} kernel\r\n     */constructor(t){this.kernel=t,this.searchBar=new r,this.searchBarId=this.searchBar.id+\"-input\"}get searchHistoryView(){return{hide:()=>$(this.listId+\"-history\").hidden=!0,show:()=>$(this.listId+\"-history\").hidden=!1}}get searchHistory(){return[{title:$l10n(\"SEARCH_HISTORY\"),rows:$cache.get(\"caio.search.history\")?.reverse()??[]}]}getAccessoryView(){return s.blurBox({height:50},[{type:\"button\",props:{bgcolor:$color(\"clear\"),tintColor:$color(\"primaryText\"),symbol:\"xmark.circle\"},layout:(t,e)=>{t.right.inset(0),t.height.equalTo(e.super),t.width.equalTo(e.super.height)},events:{tapped:()=>this.dismiss()}},{type:\"button\",props:{bgcolor:$color(\"clear\"),tintColor:$color(\"primaryText\"),symbol:\"keyboard.chevron.compact.down\"},layout:(t,e)=>{t.right.equalTo(e.prev.left),t.height.equalTo(e.super),t.width.equalTo(e.super.height)},events:{tapped:()=>$(this.searchBarId).blur()}}])}getSearchHistoryView(){return{type:\"list\",props:{id:this.listId+\"-history\",hidden:!0,stickyHeader:!0,data:this.searchHistory,separatorInset:$insets(0,13,0,0),actions:[{title:$l10n(\"DELETE\"),handler:(t,e)=>{let i=t.data;this.updateSearchHistory(i[0].rows.reverse())}}]},events:{didSelect:(t,e,i)=>{this.searchAction(i),$(this.searchBarId).text=i}},layout:$layout.fill}}setCallback(t){this.callback=t}setOnBegin(t){this.onBegin=t}setOnDismiss(t){this.onDismiss=t}begin(){this.searchHistoryView.show(),this.onBegin()}dismiss(){this.searchBar.cancel()}async searchAction(t){try{if(\"\"!==t){let e,i=t.startsWith(\"#\");e=i?this.kernel.storage.searchByTag(t.substring(1)):await this.kernel.storage.search(t);let{result:s,keyword:n}=e;s&&s.length>0?($(this.searchBarId).blur(),this.callback({keyword:n,result:s,isTagKeyword:i})):$ui.toast($l10n(\"NO_SEARCH_RESULT\")),// history\nthis.pushSearchHistory(t)}}catch(t){throw t}}pushSearchHistory(t){let e=$cache.get(\"caio.search.history\")??[];-1===e.indexOf(t)&&(e.push(t),e.length>20&&(e=e.slice(-20)),$cache.set(\"caio.search.history\",e),$(this.listId+\"-history\").data=this.searchHistory)}updateSearchHistory(t=[]){$cache.set(\"caio.search.history\",t)}getSearchBarView(){return(// 初始化搜索功能\nthis.searchBar.controller.setEvent(\"onReturn\",t=>{\"\"!==t?this.searchAction(t):this.searchHistoryView.show()}),this.searchBar.controller.setEvent(\"onChange\",t=>{\"\"===t&&this.searchHistoryView.show()}),this.searchBar.controller.setEvent(\"onBeginEditing\",t=>{\"\"===t&&this.begin()}),this.searchBar.controller.setEvent(\"onCancel\",()=>{this.searchHistoryView.hide(),this.onDismiss()}),this.searchBar.setAccessoryView(this.getAccessoryView()),this.searchBar)}}t.exports=a}),r(\"iGysH\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.ViewController,a=n(\"f0nX9\");/**\n * @typedef {ClipsViews} ClipsViews\n * @typedef {import(\"../../dao/storage\").Clip} Clip\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n */class o{listId=$text.uuid;editingToolBarId=this.listId+\"-edit-mode-tool-bar\";// 剪贴板个性化设置\n#v=!1;#$=0;scrollToOffsetDirectionX=!1;tabLeftMargin=20// tab 左边距\n;horizontalMargin=20// 列表边距\n;verticalMargin=14// 列表边距\n;containerMargin=0// list 单边边距。如果 list 未贴合屏幕左右边缘，则需要此值辅助计算文字高度\n;fontSize=16// 字体大小\n;copiedIndicatorSize=6// 已复制指示器（小绿点）大小\n;imageContentHeight=50;tagHeight=this.verticalMargin+5;tagColor=$color(\"lightGray\");tabHeight=44;editModeToolBarHeight=44;#b={};viewController;/**\n     * @param {AppKernel} kernel\n     */constructor(t){this.kernel=t,this.viewController=new r}get singleLineContentHeight(){return 0===this.#$&&(this.#$=this.getTextHeight($font(this.fontSize))),this.#$}setSingleLine(){this.#v=!0,// 图片高度与文字一致\nthis.imageContentHeight=this.singleLineContentHeight,this.#$=0}getTextHeight(t,e=\"a\"){return $text.sizeThatFits({text:e,font:t,width:s.windowSize.width-(this.horizontalMargin+this.containerMargin)*2}).height}getContentHeight(t){return this.#b[t]||(this.#b[t]=this.#v?this.singleLineContentHeight:Math.min(this.getTextHeight($font(this.fontSize),t),2*this.singleLineContentHeight)),this.#b[t]}edit(t,e){let i=new a(this.kernel),s=[{symbol:\"square.and.arrow.up\",tapped:()=>{i.text?$share.sheet(i.text):$ui.warning($l10n(\"NONE\"))}}];if(this.kernel.isUseJsboxNav)i.uikitPush(t,t=>e(t),s);else{let n=i.getNavigationView(t,t=>e(t),s);this.viewController.push(n)}}tabView(t,e,i){return{type:\"tab\",props:{id:this.listId+\"-tab\",items:t,index:e,dynamicWidth:!0},events:i,layout:(t,e)=>{t.centerY.equalTo(e.super),e.prev?t.left.equalTo(e.prev.right).offset(this.tabLeftMargin):t.left.inset(this.tabLeftMargin)}}}/**\n     * @param {Clip} clip\n     * @param {boolean} indicator\n     * @returns\n     */lineData(t,e=!1){let i={hidden:!0},s={text:\"\"},n={hidden:!t?.hasTag};return t.image?(//image.src = clip.imagePath.preview\ni.data=t.imagePreview,i.hidden=!1):(t.textStyledText?s.styledText=t.textStyledText:s.text=t.text,t.tagStyledText?n.styledText=t.tagStyledText:n.text=t.tag),{copied:{hidden:!e},image:i,tag:n,content:s}}listTemplate(){return{props:{bgcolor:$color(\"clear\")},views:[{type:\"view\",views:[{type:\"view\",props:{id:\"copied\",circular:this.copiedIndicatorSize,hidden:!0,bgcolor:$color(\"green\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.size.equalTo(this.copiedIndicatorSize),// 放在前面小缝隙的中间 `this.copyedIndicatorSize / 2` 指大小的一半\nt.left.equalTo(e.super).inset(this.horizontalMargin/2-this.copiedIndicatorSize/2)}},{type:\"label\",props:{id:\"content\",lines:this.#v?1:2,font:$font(this.fontSize)},layout:(t,e)=>{t.left.right.equalTo(e.super).inset(this.horizontalMargin),t.top.equalTo(this.verticalMargin)}},{type:\"label\",props:{id:\"tag\",lines:1,color:this.tagColor,autoFontSize:!0,align:$align.leading},layout:(t,e)=>{t.bottom.equalTo(e.super),t.left.right.equalTo(e.prev),t.height.equalTo(this.tagHeight)}}],layout:$layout.fill},{type:\"image\",props:{id:\"image\",hidden:!0},layout:$layout.fill}]}}getEmptyBackground(t=!1){return{type:\"label\",props:{color:$color(\"secondaryText\"),hidden:t,text:$l10n(\"NONE\"),align:$align.center},events:{ready:t=>{t.layout((t,e)=>{t.top.equalTo(this.tabHeight),t.left.right.bottom.equalTo(e.super)})}}}}getListEditModeToolBarView({selectButtonEvents:t,deleteButtonEvents:e}={}){let i=s.blurBox({id:this.editingToolBarId},[s.separatorLine(),{type:\"view\",views:[{type:\"button\",props:{id:this.editingToolBarId+\"-select-button\",title:$l10n(\"SELECT_ALL\"),titleColor:$color(\"tint\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.left.inset(this.horizontalMargin),t.centerY.equalTo(e.super)},events:t},{type:\"button\",props:{id:this.editingToolBarId+\"-delete-button\",symbol:\"trash\",hidden:!0,tintColor:$color(\"red\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.height.equalTo(e.super),t.width.equalTo(2*this.horizontalMargin),t.right.inset(this.horizontalMargin/2),t.centerY.equalTo(e.super)},events:e}],layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom)}}]);return i}getListView(t=this.listId,e=[],i){let s={// 剪切板列表\ntype:\"list\",props:{id:t,associateWithNavigationBar:!1,bgcolor:$color(\"clear\"),separatorInset:$insets(0,this.horizontalMargin,0,0),data:e,allowsMultipleSelectionDuringEditing:!0,template:this.listTemplate(),backgroundView:$ui.create(this.getEmptyBackground())},events:i,layout:(t,e)=>{e.prev?t.top.equalTo(e.prev.bottom):t.top.equalTo(e.super),t.left.right.bottom.equalTo(e.super)}};return s}}t.exports=o}),r(\"f0nX9\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.NavigationBar,a=i.NavigationView,o=i.Sheet,l=n(\"eSp9Z\").ActionEnv;t.exports=/**\r\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\r\n */class{#d;originalContent;/**\r\n     * @param {AppKernel} kernel\r\n     */constructor(t){this.kernel=t,this.id=\"editor\"}/**\r\n     * 编辑器内容\r\n     * @param {string} text\r\n     */set text(t=\"\"){void 0===this.originalContent&&(this.originalContent=t),this.#d=t}get text(){return this.#d??\"\"}getActionButton(){return{symbol:\"bolt.circle\",tapped:(t,e)=>{// senderMaybe 处理 Sheet addNavBar 中的按钮\ne&&(t=e);let i={env:l.editor,editor:{originalContent:this.originalContent,setContent:t=>this.setContent(t)},text:()=>this.text,selectedText:()=>{let t=$(this.id).selectedRange;this.text.slice(t.location,t.location+t.length)},selectedRange:()=>$(this.id).selectedRange};$ui.popover({sourceView:t,directions:$popoverDirection.up,size:$size(200,300),views:[this.kernel.actions.views.getActionListView(t=>{//popover.dismiss()\n$delay(.5,()=>t(i))})]})}}}setContent(t){this.text=t,$(this.id).text=t}getView(t=\"text\"){return{type:t,layout:$layout.fill,props:{id:this.id,lineNumbers:this.kernel.setting.get(\"editor.code.lineNumbers\"),theme:this.kernel.setting.get($device.isDarkMode?\"editor.code.darkTheme\":\"editor.code.lightTheme\"),text:this.text,insets:$insets(15,15,\"text\"===t?this.kernel.setting.get(\"editor.text.insets\"):15,15)},events:{ready:t=>{\"\"===this.text&&$delay(.5,()=>t.focus())},didChange:t=>{this.text=t.text}}}}pageSheet(t=\"\",e,i,s=[],n=\"text\"){this.text=t,s.unshift(this.getActionButton());let r=new o;r.setView(this.getView(n)).addNavBar({title:i,popButton:{title:$l10n(\"DONE\"),tapped:()=>e(this.text)},rightButtons:s}).init(),r.navigationView.navigationBar.contentViewHeightOffset=0,r.present()}// getViewController(type, callback) {\n//     $define({\n//         type: \"EditorViewController: UIViewController\",\n//         events: {\n//             viewDidLoad: () => {\n//                 self.$super().$viewDidLoad()\n//                 self.$view().jsValue().add(this.getView(type))\n//                 const navigationItem = self.$navigationItem()\n//                 navigationItem.$setLargeTitleDisplayMode(2)\n//             },\n//             \"viewDidDisappear:\": animated => {\n//                 callback()\n//             }\n//         }\n//     })\n//     return $objc(\"EditorViewController\").$new()\n// }\n/**\r\n     *\r\n     * @param {*} text\r\n     * @param {*} callback\r\n     * @param {Array} navButtons 可通过 Editor.text 属性访问内容，如 editor.text\r\n     * @param {*} type\r\n     */uikitPush(t=\"\",e,i=[],n=\"text\"){this.text=t,i.unshift(this.getActionButton()),// this.kernel.navigator.$pushViewController_animated(\n//     this.getViewController(type, () => callback(this.text)),\n//     true\n// )\n// return\ns.push({title:\"\",navButtons:i.map(t=>(t.handler=t.tapped,t.tapped=void 0,t)),views:[this.getView(n)],// dealloc: () => callback(this.text),\ndisappeared:()=>e(this.text)})}/**\r\n     *\r\n     * @param {*} text\r\n     * @param {*} callback\r\n     * @param {Array} navButtons 可通过 Editor.text 属性访问内容，如 editor.text\r\n     * @param {*} type\r\n     */getNavigationView(t=\"\",e,i=[],s=\"text\"){this.text=t,i.unshift(this.getActionButton());let n=new a;return n.navigationBar.contentViewHeightOffset=0,n.navigationBar.setLargeTitleDisplayMode(r.largeTitleDisplayModeNever),n.navigationBarItems.setRightButtons(i),n.setView(this.getView(s)).navigationBarTitle(\"\"),n.setEvent(\"onPop\",()=>e(this.text)),n}}}),r(\"eSp9Z\",function(t,e){var i=n(\"gxpqj\"),s=i.L10n,r=i.Sheet,a=n(\"jVlss\"),o=a.SecureFunction,l=a.SecureScript,h=n(\"7vLpB\");/**\r\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\r\n * @typedef {Action} Action\r\n * @typedef {ActionEnv} ActionEnv\r\n * @typedef {ActionData} ActionData\r\n */class c{static build=-1;static today=0;static editor=1;static clipboard=2;static action=3// 主动作页面\n;static keyboard=4;static recursion=5;static widget=6;static siri=7}class d{#d;#A;#T;#S;#E;#I;env;args;section;uuid;editor;constructor(t={}){if(t.env===c.build){let e=this.preview();e&&((t=e).env=c.build// 忽略 preview 返回的 env\n)}this.init(t)}init({env:t,args:e=null,text:i=null,section:s=null,uuid:n=null,selectedRange:r=null,textBeforeInput:a=null,selectedText:o=null,textAfterInput:l=null,editor:h=null}={}){this.env=t,this.args=e,this.section=s,this.uuid=n,this.#d=i,this.#A=i,this.#T=a,this.#S=o,this.#E=r,this.#I=l,this.editor=h}get text(){return\"function\"==typeof this.#d?this.#d():this.#d??$clipboard.text}get originalContent(){return this.#A}get textBeforeInput(){return\"function\"==typeof this.#T?this.#T():this.#T}get selectedText(){return\"function\"==typeof this.#S?this.#S():this.#S}get selectedRange(){return\"function\"==typeof this.#E?this.#E():this.#E}get textAfterInput(){return\"function\"==typeof this.#I?this.#I():this.#I}preview(){return null}}t.exports={ActionEnv:c,ActionData:d,Action:class extends d{/**\r\n     * @type {AppKernel}\r\n     */#x;secureFunction;/**\r\n     *\r\n     * @param {AppKernel} kernel\r\n     * @param {object} config\r\n     * @param {ActionData} data\r\n     */constructor(t,e,i){super(i),this.#x=t,this.config=e,this.secureFunction=new o(this.#x,this);let n=this.l10n();Object.keys(n).forEach(t=>{s.add(t,n[t])})}/**\r\n     * 编辑动作状态下提供预览数据\r\n     * @returns {ActionData}\r\n     */preview(){return{env:c.build}}l10n(){return{}}/**\r\n     * page sheet\r\n     * @param {*} args \r\n     *  {\r\n            view: 视图对象\r\n            title: 中间标题\r\n            done: 点击左上角按钮后的回调函数\r\n            doneText: 左上角文本\r\n            rightButtons: 右上角按钮\r\n        }\r\n     * @returns {Sheet}\r\n     */pageSheet({view:t,title:e=\"\",done:i,doneText:s=$l10n(\"DONE\"),rightButtons:n=[]}){let a=new r;return a.setView(t).addNavBar({title:e,popButton:{title:s,tapped:()=>{i&&i()}},rightButtons:n}),a.init().present(),a}/**\r\n     *\r\n     * @param {Object} items\r\n     * item: {\r\n     * key: string,\r\n     * value: string,\r\n     * placeholder: string\r\n     * }\r\n     * @returns\r\n     */input(t){let e=$text.uuid,i=[];for(let s of t)i.push({type:\"label\",props:{color:$color(\"secondaryText\"),text:s.placeholder},layout:(t,e)=>{t.centerY.equalTo(e.super).offset(5),t.left.inset(15)}},{type:\"view\",props:{bgcolor:$color(\"clear\")},views:[{type:\"input\",props:{id:s.key+e,text:s.value,placeholder:s.placeholder},layout:$layout.fill}],layout:(t,e)=>{t.centerY.height.equalTo(e.super),t.left.right.inset(15)}});return new Promise((s,n)=>{this.pageSheet({view:{type:\"list\",props:{separatorHidden:!0,data:[{rows:i}]}},done:()=>{let i={};for(let s of t)i[s.key]=$(s.key+e).text;s(i)}})})}showTextContent(t,e=\"\"){return this.pageSheet({view:{type:\"text\",props:{text:t},layout:$layout.fill},title:e,rightButtons:[{title:$l10n(\"COPY\"),tapped:()=>$clipboard.text=t}]})}showMarkdownContent(t,e=\"\"){return this.pageSheet({view:{type:\"markdown\",props:{content:t},layout:$layout.fill},title:e})}quickLookImage(t){r.quickLookImage(t)}/**\r\n     * 获取所有剪切板数据\r\n     * @returns {object}\r\n     */getAllClips(){return{favorite:this.#x.storage.all(\"favorite\").map(t=>t.text),clips:this.#x.storage.all(\"clips\").map(t=>t.text)}}async clearAllClips(){let t=await $ui.alert({title:$l10n(\"DELETE_DATA\"),message:$l10n(\"DELETE_TABLE\").replaceAll(\"${table}\",$l10n(\"CLIPS\")),actions:[{title:$l10n(\"DELETE\"),style:$alertActionType.destructive},{title:$l10n(\"CANCEL\")}]});if(0!==t.index)return!1;try{return this.#x.storage.deleteTable(\"clips\"),!0}catch(t){throw this.#x.logger.error(t),t}}setContent(t){this.env===c.editor?this.editor.setContent(t):this.env===c.clipboard&&(this.#x.storage.updateText(this.section,this.uuid,t),this.#x.clips.updateList(!0))}replaceKeyboardText(t,e){if(this.env!==c.keyboard||!this.text)return;if(this.selectedText){$keyboard.insert(e);return}let i=this.text.replace(t,e),s=this.textAfterInput;for(s&&s.length>0&&$keyboard.moveCursor(s.length);$keyboard.hasText;)$keyboard.delete();$keyboard.insert(i)}/**\r\n     * 获取动作对象\r\n     * @param {string} category\r\n     * @param {string} name\r\n     * @param {ActionData|Object} data\r\n     * @returns\r\n     */getAction(t,e,i){let s=this.#x.actions.getActionDir(t,e);return this.#x.actions.getAction(t,s,i)}async runAction(t,e,i={}){let s=this.getAction(t,e,{env:c.recursion,...i});return await s.do()}async request(t,e,i,s){return this.secureFunction.http.request({url:t,method:e,body:i,header:s,timeout:3})}getUrls(){let t=this.selectedText??this.text??\"\",e=t.match(/https?:\\/\\/[\\w-]+(\\.[\\w-]+)*([\\p{Script=Han}\\w.,@?^=%&:/~+#()\\-]*[\\w@?^=%&/~+#()\\-])?/giu)||[],i=t.match(/\\b\\w+:\\/\\/[\\w-]+(\\.[\\w-]+)*([\\p{Script=Han}\\w.,@?^=%&:/~+#()\\-]*[\\w@?^=%&/~+#()\\-])?/giu)||[],s=[...new Set([...e,...i])];return s}aes(t,e){return new h(t,e)}addinRun(t){$addin.run(t)}runJSBoxScript(t){let e=$addin.list,i=null;for(let s of e)if(s.name===t||s.displayName===t){i=s;break}let s=\"_\"+$text.uuid.replace(/-/g,\"\"),n=new l(i.data.string,s);Function(\"CAIO_ACTION\",s,`${n.secure()}`)(this.config.name,this)}}}}),r(\"jVlss\",function(t,e){/**\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\n * @typedef {SecureFunction} SecureFunction\n * @typedef {SecureScript} SecureScript\n */class i{/**\n     * @type {AppKernel}\n     */#x;#C;action;notAllowed='\"The parameter or method is not allowed in Action.\"';constructor(t,e){if(this.#x=t,this.#C=JSON.parse(JSON.stringify(e.config)),!this.#C?.name||this.#C?.name===\"undefined\")throw Error(\"Cannot get Action name.\");this.action=e}get name(){return this.#C.name}set name(t){let e=$l10n(\"ACTION_RESET_NAME_WARNING\").replaceAll(\"${name}\",this.name).replaceAll(\"${to_name}\",t);throw $ui.alert({title:$l10n(\"ACTION_SAFETY_WARNING\"),message:e}),Error(e)}info(t){this.#x.logger.info(t)}error(t){this.#x.logger.error(t)}}class s extends i{rootPath=this.notAllowed;extensions=this.notAllowed;read(){throw Error(this.notAllowed)}async download(){throw Error(this.notAllowed)}write(){throw Error(this.notAllowed)}delete(){throw Error(this.notAllowed)}list(){throw Error(this.notAllowed)}copy(){throw Error(this.notAllowed)}move(){throw Error(this.notAllowed)}mkdir(){throw Error(this.notAllowed)}exists(){throw Error(this.notAllowed)}isDirectory(){throw Error(this.notAllowed)}merge(){throw Error(this.notAllowed)}absolutePath(){throw Error(this.notAllowed)}}class n extends i{#k=\"ActionHttpPermission\";get #B(){let t=$cache.get(this.#k);return t||(this.#B={},{})}set #B(t={}){return $cache.set(this.#k,t)}async #_(){let t=await $ui.alert({title:$l10n(\"ACTION_PERMISSION_REQUEST\"),message:$l10n(\"ACTION_NETWORK_PERMISSION_MESSAGE\").replaceAll(\"${name}\",this.name),actions:[{title:$l10n(\"OK\"),style:$alertActionType.destructive},{title:$l10n(\"CANCEL\")}]});if(0===t.index){let t=this.#B;return t[this.name]=!0,this.#B=t,!0}return!1}async #D(){let t=this.#B;return\"boolean\"==typeof t[this.name]?t[this.name]:!!await this.#_()}async request(t={}){try{if(!await this.#D())throw Error(\"No network permission.\");this.info(`sending request [${t.method}]: ${t.url}`);let e=await $http.request(Object.assign({timeout:3},t));if(\"function\"==typeof t?.handler&&t?.handler(e),e.error)throw e.error;if(e?.response?.statusCode>=400){let t=e.data;throw\"object\"==typeof t&&(t=JSON.stringify(t)),Error(\"Http error: [\"+e.response.statusCode+\"] \"+t)}return e}catch(t){throw t.code&&(t=Error(\"Network error: [\"+t.code+\"] \"+t.localizedDescription)),this.error(`Action request error: ${this.name}`),this.error(t),t}}async get(t){return\"string\"==typeof t&&(t={url:t}),t.method=\"GET\",await this.request(t)}async post(t){return\"string\"==typeof t&&(t={url:t}),t.method=\"POST\",await this.request(t)}async download(){throw Error(this.notAllowed)}async upload(){throw Error(this.notAllowed)}async startServer(){throw Error(this.notAllowed)}async stopServer(){throw Error(this.notAllowed)}async shorten(t){return await $http.shorten(t)}async lengthen(t){return await $http.lengthen(t)}}class r extends i{#O=\"ActionCache\";#R(){let t=$cache.get(this.#O)??{};return t[this.name]||(t[this.name]={}),t}get(t){return this.#R()[this.name][t]}async getAsync({key:t,handler:e}={}){e(this.get(t))}set(t,e){let i=this.#R();return i[this.name][t]=e,$cache.set(this.#O,i)}async setAsync({key:t,value:e,handler:i}={}){i(this.set(t,e))}remove(t){let e=this.#R();delete e[this.name][t],$cache.set(this.#O,e)}async removeAsync({key:t,handler:e}={}){this.remove(t),e()}clear(){let t=this.#R();delete t[this.name],$cache.set(this.#O,t)}async clearAsync({handler:t}={}){this.clear(),t()}}t.exports={SecureFunction:class extends i{#L;constructor(...t){super(...t),this.file=new s(...t),this.http=new n(...t),this.cache=new r(...t)}get controller(){return this.#L.sheetVC.jsValue()}render(t){this.#L=this.action.pageSheet({view:t})}addin(){throw Error(this.notAllowed)}sheetDismiss(){this.#L.dismiss()}},SecureScript:class{/**\n     * @typedef {string}\n     */script;sfPrefix=\"this\";sf;/**\n     * @param {string} script\n     */constructor(t,e=\"this\"){this.sfPrefix=e,this.sf=`${this.sfPrefix}.secureFunction`,this.script=t}/**\n     * Replaces text in a string, using a regular expression or search string.\n     * @param {string | RegExp} searchValue A string or regular expression to search for.\n     * @param {string} replaceValue A string containing the text to replace. When the searchValue is a RegExp, all matches are replaced if the g flag is set (or only those matches at the beginning, if the y flag is also present). Otherwise, only the first match of searchValue is replaced.\n     */#P(t,e){this.script=this.script.replaceAll(t,e)}replaceFunction(){this.#P(/\\$ui\\.render/gi,`${this.sf}.render`),this.#P(/\\$ui\\.controller/gi,`${this.sf}.controller`),this.#P(/\\$app\\.close/gi,`${this.sf}.sheetDismiss`),this.#P(/\\$keyboard\\.dismiss/gi,`${this.sf}.sheetDismiss`),this.#P(/\\$addin\\.*[a-zA-Z0-9\\[\\]'\"`]+/gi,`${this.sf}.addin()`),this.#P(\"eval\",`${this.sf}.addin()`)}replaceFile(){this.#P(\"$file\",`${this.sf}.file`)}replaceHttp(){this.#P(\"$http\",`${this.sf}.http`)}replaceCache(){this.#P(\"$cache\",`${this.sf}.cache`)}secure(){return this.replaceFunction(),this.replaceFile(),this.replaceHttp(),this.replaceCache(),this.script}}}}),r(\"7vLpB\",function(t,e){// @parcel/packager-js: External modules are not supported when building for browser\nvar i=n(\"hoadx\");t.exports=class{key;iv;constructor(t,e){this.key=i.enc.Utf8.parse(t)//16位\n,this.iv=i.enc.Utf8.parse(e)}encrypt(t){let e=i.enc.Utf8.parse(t),s=i.AES.encrypt(e,this.key,{iv:this.iv,mode:i.mode.CBC,padding:i.pad.Pkcs7});return i.enc.Base64.stringify(s.ciphertext)}decrypt(t){let e=i.enc.Base64.parse(t),s=i.lib.CipherParams.create({ciphertext:e}),n=i.AES.decrypt(s,this.key,{iv:this.iv,mode:i.mode.CBC,padding:i.pad.Pkcs7}),r=n.toString(i.enc.Utf8);return r}}}),r(\"hoadx\",function(t,e){var i,s,n,r,a,o,l,h,c,d,u,p,g,f,y,m,w,v,b,A,T,S,E,I,x,C,k,B,_,D,O,R,L,P,N,V,M,F,q,U,H,z,j,W,K,G,J,Y,X,Z,Q,tt,te,ti,ts,tn,tr,ta,to,tl,th,tc,td,tu,tp,tg,tf,ty,tm,tw,tv,t$,tb,tA,tT,tS,tE,tI,tx,tC,tk,tB,t_,tD,tO,tR,tL,tP,tN,tV,tM,tF,tq,tU,tH,tz,tj,tW,tK,tG,tJ,tY,tX,tZ,tQ,t0;t.exports=(g=(t0=t0||(i=Math,s=Object.create||function(){function t(){}return function(e){var i;return t.prototype=e,i=new t,t.prototype=null,i}}(),a=(r=(n={}).lib={}).Base={extend:function(t){var e=s(this);return t&&e.mixIn(t),e.hasOwnProperty(\"init\")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty(\"toString\")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,i=t.words,s=this.sigBytes,n=t.sigBytes;if(this.clamp(),s%4)for(a=0;a<n;a++){var r=i[a>>>2]>>>24-a%4*8&255;e[s+a>>>2]|=r<<24-(s+a)%4*8}else for(var a=0;a<n;a+=4)e[s+a>>>2]=i[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=i.ceil(e/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e,s=[],n=0;n<t;n+=4){var r=function(t){var t=t,e=987654321;return function(){var s=((e=36969*(65535&e)+(e>>16)&4294967295)<<16)+(t=18e3*(65535&t)+(t>>16)&4294967295)&4294967295;return s/=4294967296,(s+=.5)*(i.random()>.5?1:-1)}}(4294967296*(e||i.random()));e=987654071*r(),s.push(4294967296*r()|0)}return new o.init(s,t)}}),h=(l=n.enc={}).Hex={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],n=0;n<i;n++){var r=e[n>>>2]>>>24-n%4*8&255;s.push((r>>>4).toString(16)),s.push((15&r).toString(16))}return s.join(\"\")},parse:function(t){for(var e=t.length,i=[],s=0;s<e;s+=2)i[s>>>3]|=parseInt(t.substr(s,2),16)<<24-s%8*4;return new o.init(i,e/2)}},c=l.Latin1={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],n=0;n<i;n++){var r=e[n>>>2]>>>24-n%4*8&255;s.push(String.fromCharCode(r))}return s.join(\"\")},parse:function(t){for(var e=t.length,i=[],s=0;s<e;s++)i[s>>>2]|=(255&t.charCodeAt(s))<<24-s%4*8;return new o.init(i,e)}},d=l.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error(\"Malformed UTF-8 data\")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},u=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){\"string\"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var e=this._data,s=e.words,n=e.sigBytes,r=this.blockSize,a=n/(4*r),l=(a=t?i.ceil(a):i.max((0|a)-this._minBufferSize,0))*r,h=i.min(4*l,n);if(l){for(var c=0;c<l;c+=r)this._doProcessBlock(s,c);var d=s.splice(0,l);e.sigBytes-=h}return new o.init(d,h)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),r.Hasher=u.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new p.HMAC.init(t,i).finalize(e)}}}),p=n.algo={},n)).lib.WordArray,t0.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,s=this._map;t.clamp();for(var n=[],r=0;r<i;r+=3)for(var a=(e[r>>>2]>>>24-r%4*8&255)<<16|(e[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|e[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;o<4&&r+.75*o<i;o++)n.push(s.charAt(a>>>6*(3-o)&63));var l=s.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join(\"\")},parse:function(t){var e=t.length,i=this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var n=0;n<i.length;n++)s[i.charCodeAt(n)]=n}var r=i.charAt(64);if(r){var a=t.indexOf(r);-1!==a&&(e=a)}return function(t,e,i){for(var s=[],n=0,r=0;r<e;r++)if(r%4){var a=i[t.charCodeAt(r-1)]<<r%4*2,o=i[t.charCodeAt(r)]>>>6-r%4*2;s[n>>>2]|=(a|o)<<24-n%4*8,n++}return g.create(s,n)}(t,e,s)},_map:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"},function(t){function e(t,e,i,s,n,r,a){var o=t+(e&i|~e&s)+n+a;return(o<<r|o>>>32-r)+e}function i(t,e,i,s,n,r,a){var o=t+(e&s|i&~s)+n+a;return(o<<r|o>>>32-r)+e}function s(t,e,i,s,n,r,a){var o=t+(e^i^s)+n+a;return(o<<r|o>>>32-r)+e}function n(t,e,i,s,n,r,a){var o=t+(i^(e|~s))+n+a;return(o<<r|o>>>32-r)+e}var r=t0.lib,a=r.WordArray,o=r.Hasher,l=t0.algo,h=[];!function(){for(var e=0;e<64;e++)h[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=l.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,r){for(var a=0;a<16;a++){var o=r+a,l=t[o];t[o]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var c=this._hash.words,d=t[r+0],u=t[r+1],p=t[r+2],g=t[r+3],f=t[r+4],y=t[r+5],m=t[r+6],w=t[r+7],v=t[r+8],b=t[r+9],A=t[r+10],T=t[r+11],S=t[r+12],E=t[r+13],I=t[r+14],x=t[r+15],C=c[0],k=c[1],B=c[2],_=c[3];k=n(k=n(k=n(k=n(k=s(k=s(k=s(k=s(k=i(k=i(k=i(k=i(k=e(k=e(k=e(k=e(k,B=e(B,_=e(_,C=e(C,k,B,_,d,7,h[0]),k,B,u,12,h[1]),C,k,p,17,h[2]),_,C,g,22,h[3]),B=e(B,_=e(_,C=e(C,k,B,_,f,7,h[4]),k,B,y,12,h[5]),C,k,m,17,h[6]),_,C,w,22,h[7]),B=e(B,_=e(_,C=e(C,k,B,_,v,7,h[8]),k,B,b,12,h[9]),C,k,A,17,h[10]),_,C,T,22,h[11]),B=e(B,_=e(_,C=e(C,k,B,_,S,7,h[12]),k,B,E,12,h[13]),C,k,I,17,h[14]),_,C,x,22,h[15]),B=i(B,_=i(_,C=i(C,k,B,_,u,5,h[16]),k,B,m,9,h[17]),C,k,T,14,h[18]),_,C,d,20,h[19]),B=i(B,_=i(_,C=i(C,k,B,_,y,5,h[20]),k,B,A,9,h[21]),C,k,x,14,h[22]),_,C,f,20,h[23]),B=i(B,_=i(_,C=i(C,k,B,_,b,5,h[24]),k,B,I,9,h[25]),C,k,g,14,h[26]),_,C,v,20,h[27]),B=i(B,_=i(_,C=i(C,k,B,_,E,5,h[28]),k,B,p,9,h[29]),C,k,w,14,h[30]),_,C,S,20,h[31]),B=s(B,_=s(_,C=s(C,k,B,_,y,4,h[32]),k,B,v,11,h[33]),C,k,T,16,h[34]),_,C,I,23,h[35]),B=s(B,_=s(_,C=s(C,k,B,_,u,4,h[36]),k,B,f,11,h[37]),C,k,w,16,h[38]),_,C,A,23,h[39]),B=s(B,_=s(_,C=s(C,k,B,_,E,4,h[40]),k,B,d,11,h[41]),C,k,g,16,h[42]),_,C,m,23,h[43]),B=s(B,_=s(_,C=s(C,k,B,_,b,4,h[44]),k,B,S,11,h[45]),C,k,x,16,h[46]),_,C,p,23,h[47]),B=n(B,_=n(_,C=n(C,k,B,_,d,6,h[48]),k,B,w,10,h[49]),C,k,I,15,h[50]),_,C,y,21,h[51]),B=n(B,_=n(_,C=n(C,k,B,_,S,6,h[52]),k,B,g,10,h[53]),C,k,A,15,h[54]),_,C,u,21,h[55]),B=n(B,_=n(_,C=n(C,k,B,_,v,6,h[56]),k,B,x,10,h[57]),C,k,m,15,h[58]),_,C,E,21,h[59]),B=n(B,_=n(_,C=n(C,k,B,_,f,6,h[60]),k,B,T,10,h[61]),C,k,p,15,h[62]),_,C,b,21,h[63]),c[0]=c[0]+C|0,c[1]=c[1]+k|0,c[2]=c[2]+B|0,c[3]=c[3]+_|0},_doFinalize:function(){var e=this._data,i=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;i[n>>>5]|=128<<24-n%32;var r=t.floor(s/4294967296);i[15+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),i[14+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(i.length+1),this._process();for(var a=this._hash,o=a.words,l=0;l<4;l++){var h=o[l];o[l]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});t0.MD5=o._createHelper(c),t0.HmacMD5=o._createHmacHelper(c)}(Math),y=(f=t0.lib).WordArray,m=f.Hasher,w=[],v=t0.algo.SHA1=m.extend({_doReset:function(){this._hash=new y.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],n=i[1],r=i[2],a=i[3],o=i[4],l=0;l<80;l++){if(l<16)w[l]=0|t[e+l];else{var h=w[l-3]^w[l-8]^w[l-14]^w[l-16];w[l]=h<<1|h>>>31}var c=(s<<5|s>>>27)+o+w[l];c+=l<20?1518500249+(n&r|~n&a):l<40?1859775393+(n^r^a):l<60?(n&r|n&a|r&a)-1894007588:(n^r^a)-899497514,o=a,a=r,r=n<<30|n>>>2,n=s,s=c}i[0]=i[0]+s|0,i[1]=i[1]+n|0,i[2]=i[2]+r|0,i[3]=i[3]+a|0,i[4]=i[4]+o|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[14+(s+64>>>9<<4)]=Math.floor(i/4294967296),e[15+(s+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=m.clone.call(this);return t._hash=this._hash.clone(),t}}),t0.SHA1=m._createHelper(v),t0.HmacSHA1=m._createHmacHelper(v),b=Math,T=(A=t0.lib).WordArray,S=A.Hasher,E=t0.algo,I=[],x=[],function(){function t(t){return 4294967296*(t-(0|t))|0}for(var e=2,i=0;i<64;)(function(t){for(var e=b.sqrt(t),i=2;i<=e;i++)if(!(t%i))return!1;return!0})(e)&&(i<8&&(I[i]=t(b.pow(e,.5))),x[i]=t(b.pow(e,1/3)),i++),e++}(),C=[],k=E.SHA256=S.extend({_doReset:function(){this._hash=new T.init(I.slice(0))},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],n=i[1],r=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],d=0;d<64;d++){if(d<16)C[d]=0|t[e+d];else{var u=C[d-15],p=(u<<25|u>>>7)^(u<<14|u>>>18)^u>>>3,g=C[d-2],f=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;C[d]=p+C[d-7]+f+C[d-16]}var y=s&n^s&r^n&r,m=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),w=c+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&l^~o&h)+x[d]+C[d];c=h,h=l,l=o,o=a+w|0,a=r,r=n,n=s,s=w+(m+y)|0}i[0]=i[0]+s|0,i[1]=i[1]+n|0,i[2]=i[2]+r|0,i[3]=i[3]+a|0,i[4]=i[4]+o|0,i[5]=i[5]+l|0,i[6]=i[6]+h|0,i[7]=i[7]+c|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[14+(s+64>>>9<<4)]=b.floor(i/4294967296),e[15+(s+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=S.clone.call(this);return t._hash=this._hash.clone(),t}}),t0.SHA256=S._createHelper(k),t0.HmacSHA256=S._createHmacHelper(k),function(){function t(t){return t<<8&4278255360|t>>>8&16711935}var e=t0.lib.WordArray,i=t0.enc;i.Utf16=i.Utf16BE={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],n=0;n<i;n+=2){var r=e[n>>>2]>>>16-n%4*8&65535;s.push(String.fromCharCode(r))}return s.join(\"\")},parse:function(t){for(var i=t.length,s=[],n=0;n<i;n++)s[n>>>1]|=t.charCodeAt(n)<<16-n%2*16;return e.create(s,2*i)}},i.Utf16LE={stringify:function(e){for(var i=e.words,s=e.sigBytes,n=[],r=0;r<s;r+=2){var a=t(i[r>>>2]>>>16-r%4*8&65535);n.push(String.fromCharCode(a))}return n.join(\"\")},parse:function(i){for(var s=i.length,n=[],r=0;r<s;r++)n[r>>>1]|=t(i.charCodeAt(r)<<16-r%2*16);return e.create(n,2*s)}}}(),function(){if(\"function\"==typeof ArrayBuffer){var t=t0.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||\"undefined\"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var i=t.byteLength,s=[],n=0;n<i;n++)s[n>>>2]|=t[n]<<24-n%4*8;e.call(this,s,i)}else e.apply(this,arguments)}).prototype=t}}(),function(t){function e(t,e){return t<<e|t>>>32-e}var i=t0.lib,s=i.WordArray,n=i.Hasher,r=t0.algo,a=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=s.create([0,1518500249,1859775393,2400959708,2840853838]),d=s.create([1352829926,1548603684,1836072691,2053994217,0]),u=r.RIPEMD160=n.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,i){for(V=0;V<16;V++){var s,n,r,u,p,g,f,y,m=i+V,w=t[m];t[m]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}var v,b,A,T,S,E,I,x,C,k,B=this._hash.words,_=c.words,D=d.words,O=a.words,R=o.words,L=l.words,P=h.words;E=v=B[0],I=b=B[1],x=A=B[2],C=T=B[3],k=S=B[4];for(var N,V=0;V<80;V+=1)N=(N=e(N=(v+t[i+O[V]]|0)+(V<16?(b^A^T)+_[0]:V<32?((s=b)&A|~s&T)+_[1]:V<48?((b|~A)^T)+_[2]:V<64?(n=b,r=A,(n&(u=T)|r&~u)+_[3]):(b^(A|~T))+_[4])|0,L[V]))+S|0,v=S,S=T,T=e(A,10),A=b,b=N,N=(N=e(N=(E+t[i+R[V]]|0)+(V<16?(I^(x|~C))+D[0]:V<32?(p=I,g=x,(p&(f=C)|g&~f)+D[1]):V<48?((I|~x)^C)+D[2]:V<64?((y=I)&x|~y&C)+D[3]:(I^x^C)+D[4])|0,P[V]))+k|0,E=k,k=C,C=e(x,10),x=I,I=N;N=B[1]+A+C|0,B[1]=B[2]+T+k|0,B[2]=B[3]+S+E|0,B[3]=B[4]+v+I|0,B[4]=B[0]+b+x|0,B[0]=N},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;e[s>>>5]|=128<<24-s%32,e[14+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(e.length+1),this._process();for(var n=this._hash,r=n.words,a=0;a<5;a++){var o=r[a];r[a]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return n},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t}});t0.RIPEMD160=n._createHelper(u),t0.HmacRIPEMD160=n._createHmacHelper(u)}(Math),B=t0.lib.Base,_=t0.enc.Utf8,t0.algo.HMAC=B.extend({init:function(t,e){t=this._hasher=new t.init,\"string\"==typeof e&&(e=_.parse(e));var i=t.blockSize,s=4*i;e.sigBytes>s&&(e=t.finalize(e)),e.clamp();for(var n=this._oKey=e.clone(),r=this._iKey=e.clone(),a=n.words,o=r.words,l=0;l<i;l++)a[l]^=1549556828,o[l]^=909522486;n.sigBytes=r.sigBytes=s,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,i=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(i))}}),O=(D=t0.lib).Base,R=D.WordArray,P=(L=t0.algo).SHA1,N=L.HMAC,V=L.PBKDF2=O.extend({cfg:O.extend({keySize:4,hasher:P,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,s=N.create(i.hasher,t),n=R.create(),r=R.create([1]),a=n.words,o=r.words,l=i.keySize,h=i.iterations;a.length<l;){var c=s.update(e).finalize(r);s.reset();for(var d=c.words,u=d.length,p=c,g=1;g<h;g++){p=s.finalize(p),s.reset();for(var f=p.words,y=0;y<u;y++)d[y]^=f[y]}n.concat(c),o[0]++}return n.sigBytes=4*l,n}}),t0.PBKDF2=function(t,e,i){return V.create(i).compute(t,e)},F=(M=t0.lib).Base,q=M.WordArray,H=(U=t0.algo).MD5,z=U.EvpKDF=F.extend({cfg:F.extend({keySize:4,hasher:H,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,s=i.hasher.create(),n=q.create(),r=n.words,a=i.keySize,o=i.iterations;r.length<a;){l&&s.update(l);var l=s.update(t).finalize(e);s.reset();for(var h=1;h<o;h++)l=s.finalize(l),s.reset();n.concat(l)}return n.sigBytes=4*a,n}}),t0.EvpKDF=function(t,e,i){return z.create(i).compute(t,e)},j=t0.lib.WordArray,K=(W=t0.algo).SHA256,G=W.SHA224=K.extend({_doReset:function(){this._hash=new j.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=K._doFinalize.call(this);return t.sigBytes-=4,t}}),t0.SHA224=K._createHelper(G),t0.HmacSHA224=K._createHmacHelper(G),Y=(J=t0.lib).Base,X=J.WordArray,(Z=t0.x64={}).Word=Y.extend({init:function(t,e){this.high=t,this.low=e}}),Z.WordArray=Y.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,i=[],s=0;s<e;s++){var n=t[s];i.push(n.high),i.push(n.low)}return X.create(i,this.sigBytes)},clone:function(){for(var t=Y.clone.call(this),e=t.words=this.words.slice(0),i=e.length,s=0;s<i;s++)e[s]=e[s].clone();return t}}),Q=Math,te=(tt=t0.lib).WordArray,ti=tt.Hasher,ts=t0.x64.Word,tn=t0.algo,tr=[],ta=[],to=[],function(){for(var t=1,e=0,i=0;i<24;i++){tr[t+5*e]=(i+1)*(i+2)/2%64;var s=(2*t+3*e)%5;t=e%5,e=s}for(t=0;t<5;t++)for(e=0;e<5;e++)ta[t+5*e]=e+(2*t+3*e)%5*5;for(var n=1,r=0;r<24;r++){for(var a=0,o=0,l=0;l<7;l++){if(1&n){var h=(1<<l)-1;h<32?o^=1<<h:a^=1<<h-32}128&n?n=n<<1^113:n<<=1}to[r]=ts.create(a,o)}}(),tl=[],function(){for(var t=0;t<25;t++)tl[t]=ts.create()}(),th=tn.SHA3=ti.extend({cfg:ti.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new ts.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var i=this._state,s=this.blockSize/2,n=0;n<s;n++){var r=t[e+2*n],a=t[e+2*n+1];r=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(E=i[n]).high^=a,E.low^=r}for(var o=0;o<24;o++){for(S=0;S<5;S++){for(var l=0,h=0,c=0;c<5;c++)l^=(E=i[S+5*c]).high,h^=E.low;var d=tl[S];d.high=l,d.low=h}for(S=0;S<5;S++)for(var u=tl[(S+4)%5],p=tl[(S+1)%5],g=p.high,f=p.low,l=u.high^(g<<1|f>>>31),h=u.low^(f<<1|g>>>31),c=0;c<5;c++)(E=i[S+5*c]).high^=l,E.low^=h;for(var y=1;y<25;y++){var m=(E=i[y]).high,w=E.low,v=tr[y];if(v<32)var l=m<<v|w>>>32-v,h=w<<v|m>>>32-v;else var l=w<<v-32|m>>>64-v,h=m<<v-32|w>>>64-v;var b=tl[ta[y]];b.high=l,b.low=h}var A=tl[0],T=i[0];A.high=T.high,A.low=T.low;for(var S=0;S<5;S++)for(c=0;c<5;c++){var E=i[y=S+5*c],I=tl[y],x=tl[(S+1)%5+5*c],C=tl[(S+2)%5+5*c];E.high=I.high^~x.high&C.high,E.low=I.low^~x.low&C.low}var E=i[0],k=to[o];E.high^=k.high,E.low^=k.low}},_doFinalize:function(){var t=this._data,e=t.words,i=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;e[i>>>5]|=1<<24-i%32,e[(Q.ceil((i+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*e.length,this._process();for(var n=this._state,r=this.cfg.outputLength/8,a=r/8,o=[],l=0;l<a;l++){var h=n[l],c=h.high,d=h.low;c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),o.push(d),o.push(c)}return new te.init(o,r)},clone:function(){for(var t=ti.clone.call(this),e=t._state=this._state.slice(0),i=0;i<25;i++)e[i]=e[i].clone();return t}}),t0.SHA3=ti._createHelper(th),t0.HmacSHA3=ti._createHmacHelper(th),function(){function t(){return s.create.apply(s,arguments)}var e=t0.lib.Hasher,i=t0.x64,s=i.Word,n=i.WordArray,r=t0.algo,a=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],o=[];!function(){for(var e=0;e<80;e++)o[e]=t()}();var l=r.SHA512=e.extend({_doReset:function(){this._hash=new n.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],n=i[1],r=i[2],l=i[3],h=i[4],c=i[5],d=i[6],u=i[7],p=s.high,g=s.low,f=n.high,y=n.low,m=r.high,w=r.low,v=l.high,b=l.low,A=h.high,T=h.low,S=c.high,E=c.low,I=d.high,x=d.low,C=u.high,k=u.low,B=p,_=g,D=f,O=y,R=m,L=w,P=v,N=b,V=A,M=T,F=S,q=E,U=I,H=x,z=C,j=k,W=0;W<80;W++){var K=o[W];if(W<16)var G=K.high=0|t[e+2*W],J=K.low=0|t[e+2*W+1];else{var Y=o[W-15],X=Y.high,Z=Y.low,Q=(X>>>1|Z<<31)^(X>>>8|Z<<24)^X>>>7,tt=(Z>>>1|X<<31)^(Z>>>8|X<<24)^(Z>>>7|X<<25),te=o[W-2],ti=te.high,ts=te.low,tn=(ti>>>19|ts<<13)^(ti<<3|ts>>>29)^ti>>>6,tr=(ts>>>19|ti<<13)^(ts<<3|ti>>>29)^(ts>>>6|ti<<26),ta=o[W-7],to=ta.high,tl=ta.low,th=o[W-16],tc=th.high,td=th.low,G=(G=(G=Q+to+((J=tt+tl)>>>0<tt>>>0?1:0))+tn+((J+=tr)>>>0<tr>>>0?1:0))+tc+((J+=td)>>>0<td>>>0?1:0);K.high=G,K.low=J}var tu=V&F^~V&U,tp=M&q^~M&H,tg=B&D^B&R^D&R,tf=_&O^_&L^O&L,ty=(B>>>28|_<<4)^(B<<30|_>>>2)^(B<<25|_>>>7),tm=(_>>>28|B<<4)^(_<<30|B>>>2)^(_<<25|B>>>7),tw=(V>>>14|M<<18)^(V>>>18|M<<14)^(V<<23|M>>>9),tv=(M>>>14|V<<18)^(M>>>18|V<<14)^(M<<23|V>>>9),t$=a[W],tb=t$.high,tA=t$.low,tT=j+tv,tS=(tS=(tS=(tS=z+tw+(tT>>>0<j>>>0?1:0))+tu+((tT+=tp)>>>0<tp>>>0?1:0))+tb+((tT+=tA)>>>0<tA>>>0?1:0))+G+((tT+=J)>>>0<J>>>0?1:0),tE=tm+tf,tI=ty+tg+(tE>>>0<tm>>>0?1:0);z=U,j=H,U=F,H=q,F=V,q=M,V=P+tS+((M=N+tT|0)>>>0<N>>>0?1:0)|0,P=R,N=L,R=D,L=O,D=B,O=_,B=tS+tI+((_=tT+tE|0)>>>0<tT>>>0?1:0)|0}g=s.low=g+_,s.high=p+B+(g>>>0<_>>>0?1:0),y=n.low=y+O,n.high=f+D+(y>>>0<O>>>0?1:0),w=r.low=w+L,r.high=m+R+(w>>>0<L>>>0?1:0),b=l.low=b+N,l.high=v+P+(b>>>0<N>>>0?1:0),T=h.low=T+M,h.high=A+V+(T>>>0<M>>>0?1:0),E=c.low=E+q,c.high=S+F+(E>>>0<q>>>0?1:0),x=d.low=x+H,d.high=I+U+(x>>>0<H>>>0?1:0),k=u.low=k+j,u.high=C+z+(k>>>0<j>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[30+(s+128>>>10<<5)]=Math.floor(i/4294967296),e[31+(s+128>>>10<<5)]=i,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t0.SHA512=e._createHelper(l),t0.HmacSHA512=e._createHmacHelper(l)}(),td=(tc=t0.x64).Word,tu=tc.WordArray,tg=(tp=t0.algo).SHA512,tf=tp.SHA384=tg.extend({_doReset:function(){this._hash=new tu.init([new td.init(3418070365,3238371032),new td.init(1654270250,914150663),new td.init(2438529370,812702999),new td.init(355462360,4144912697),new td.init(1731405415,4290775857),new td.init(2394180231,1750603025),new td.init(3675008525,1694076839),new td.init(1203062813,3204075428)])},_doFinalize:function(){var t=tg._doFinalize.call(this);return t.sigBytes-=16,t}}),t0.SHA384=tg._createHelper(tf),t0.HmacSHA384=tg._createHmacHelper(tf),t0.lib.Cipher||(tm=(ty=t0.lib).Base,tw=ty.WordArray,tv=ty.BufferedBlockAlgorithm,(t$=t0.enc).Utf8,tb=t$.Base64,tA=t0.algo.EvpKDF,tT=ty.Cipher=tv.extend({cfg:tm.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){tv.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return\"string\"==typeof t?tD:tB}return function(e){return{encrypt:function(i,s,n){return t(s).encrypt(e,i,s,n)},decrypt:function(i,s,n){return t(s).decrypt(e,i,s,n)}}}}()}),ty.StreamCipher=tT.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),tS=t0.mode={},tE=ty.BlockCipherMode=tm.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),tI=tS.CBC=function(){function t(t,e,i){var s=this._iv;if(s)n=s,this._iv=void 0;else var n=this._prevBlock;for(var r=0;r<i;r++)t[e+r]^=n[r]}var e=tE.extend();return e.Encryptor=e.extend({processBlock:function(e,i){var s=this._cipher,n=s.blockSize;t.call(this,e,i,n),s.encryptBlock(e,i),this._prevBlock=e.slice(i,i+n)}}),e.Decryptor=e.extend({processBlock:function(e,i){var s=this._cipher,n=s.blockSize,r=e.slice(i,i+n);s.decryptBlock(e,i),t.call(this,e,i,n),this._prevBlock=r}}),e}(),tx=(t0.pad={}).Pkcs7={pad:function(t,e){for(var i=4*e,s=i-t.sigBytes%i,n=s<<24|s<<16|s<<8|s,r=[],a=0;a<s;a+=4)r.push(n);var o=tw.create(r,s);t.concat(o)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},ty.BlockCipher=tT.extend({cfg:tT.cfg.extend({mode:tI,padding:tx}),reset:function(){tT.reset.call(this);var t=this.cfg,e=t.iv,i=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)s=i.createEncryptor;else{var s=i.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==s?this._mode.init(this,e&&e.words):(this._mode=s.call(i,this,e&&e.words),this._mode.__creator=s)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE)t.pad(this._data,this.blockSize),e=this._process(!0);else{var e=this._process(!0);t.unpad(e)}return e},blockSize:4}),tC=ty.CipherParams=tm.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),tk=(t0.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,i=t.salt;if(i)s=tw.create([1398893684,1701076831]).concat(i).concat(e);else var s=e;return s.toString(tb)},parse:function(t){var e=tb.parse(t),i=e.words;if(1398893684==i[0]&&1701076831==i[1]){var s=tw.create(i.slice(2,4));i.splice(0,4),e.sigBytes-=16}return tC.create({ciphertext:e,salt:s})}},tB=ty.SerializableCipher=tm.extend({cfg:tm.extend({format:tk}),encrypt:function(t,e,i,s){s=this.cfg.extend(s);var n=t.createEncryptor(i,s),r=n.finalize(e),a=n.cfg;return tC.create({ciphertext:r,key:i,iv:a.iv,algorithm:t,mode:a.mode,padding:a.padding,blockSize:t.blockSize,formatter:s.format})},decrypt:function(t,e,i,s){return s=this.cfg.extend(s),e=this._parse(e,s.format),t.createDecryptor(i,s).finalize(e.ciphertext)},_parse:function(t,e){return\"string\"==typeof t?e.parse(t,this):t}}),t_=(t0.kdf={}).OpenSSL={execute:function(t,e,i,s){s||(s=tw.random(8));var n=tA.create({keySize:e+i}).compute(t,s),r=tw.create(n.words.slice(e),4*i);return n.sigBytes=4*e,tC.create({key:n,iv:r,salt:s})}},tD=ty.PasswordBasedCipher=tB.extend({cfg:tB.cfg.extend({kdf:t_}),encrypt:function(t,e,i,s){var n=(s=this.cfg.extend(s)).kdf.execute(i,t.keySize,t.ivSize);s.iv=n.iv;var r=tB.encrypt.call(this,t,e,n.key,s);return r.mixIn(n),r},decrypt:function(t,e,i,s){s=this.cfg.extend(s),e=this._parse(e,s.format);var n=s.kdf.execute(i,t.keySize,t.ivSize,e.salt);return s.iv=n.iv,tB.decrypt.call(this,t,e,n.key,s)}})),t0.mode.CFB=function(){function t(t,e,i,s){var n=this._iv;if(n)r=n.slice(0),this._iv=void 0;else var r=this._prevBlock;s.encryptBlock(r,0);for(var a=0;a<i;a++)t[e+a]^=r[a]}var e=t0.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,i){var s=this._cipher,n=s.blockSize;t.call(this,e,i,n,s),this._prevBlock=e.slice(i,i+n)}}),e.Decryptor=e.extend({processBlock:function(e,i){var s=this._cipher,n=s.blockSize,r=e.slice(i,i+n);t.call(this,e,i,n,s),this._prevBlock=r}}),e}(),t0.mode.ECB=((tO=t0.lib.BlockCipherMode.extend()).Encryptor=tO.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),tO.Decryptor=tO.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),tO),t0.pad.AnsiX923={pad:function(t,e){var i=t.sigBytes,s=4*e,n=s-i%s,r=i+n-1;t.clamp(),t.words[r>>>2]|=n<<24-r%4*8,t.sigBytes+=n},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},t0.pad.Iso10126={pad:function(t,e){var i=4*e,s=i-t.sigBytes%i;t.concat(t0.lib.WordArray.random(s-1)).concat(t0.lib.WordArray.create([s<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},t0.pad.Iso97971={pad:function(t,e){t.concat(t0.lib.WordArray.create([2147483648],1)),t0.pad.ZeroPadding.pad(t,e)},unpad:function(t){t0.pad.ZeroPadding.unpad(t),t.sigBytes--}},t0.mode.OFB=(tL=(tR=t0.lib.BlockCipherMode.extend()).Encryptor=tR.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,n=this._iv,r=this._keystream;n&&(r=this._keystream=n.slice(0),this._iv=void 0),i.encryptBlock(r,0);for(var a=0;a<s;a++)t[e+a]^=r[a]}}),tR.Decryptor=tL,tR),t0.pad.NoPadding={pad:function(){},unpad:function(){}},tP=t0.lib.CipherParams,tN=t0.enc.Hex,t0.format.Hex={stringify:function(t){return t.ciphertext.toString(tN)},parse:function(t){var e=tN.parse(t);return tP.create({ciphertext:e})}},tV=t0.lib.BlockCipher,tM=t0.algo,tF=[],tq=[],tU=[],tH=[],tz=[],tj=[],tW=[],tK=[],tG=[],tJ=[],function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;for(var i=0,s=0,e=0;e<256;e++){var n=s^s<<1^s<<2^s<<3^s<<4;n=n>>>8^255&n^99,tF[i]=n,tq[n]=i;var r=t[i],a=t[r],o=t[a],l=257*t[n]^16843008*n;tU[i]=l<<24|l>>>8,tH[i]=l<<16|l>>>16,tz[i]=l<<8|l>>>24,tj[i]=l,l=16843009*o^65537*a^257*r^16843008*i,tW[n]=l<<24|l>>>8,tK[n]=l<<16|l>>>16,tG[n]=l<<8|l>>>24,tJ[n]=l,i?(i=r^t[t[t[o^r]]],s^=t[t[s]]):i=s=1}}(),tY=[0,1,2,4,8,16,32,64,128,27,54],tX=tM.AES=tV.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,i=t.sigBytes/4,s=4*((this._nRounds=i+6)+1),n=this._keySchedule=[],r=0;r<s;r++)r<i?n[r]=e[r]:(l=n[r-1],r%i?i>6&&r%i==4&&(l=tF[l>>>24]<<24|tF[l>>>16&255]<<16|tF[l>>>8&255]<<8|tF[255&l]):l=(tF[(l=l<<8|l>>>24)>>>24]<<24|tF[l>>>16&255]<<16|tF[l>>>8&255]<<8|tF[255&l])^tY[r/i|0]<<24,n[r]=n[r-i]^l);for(var a=this._invKeySchedule=[],o=0;o<s;o++){if(r=s-o,o%4)l=n[r];else var l=n[r-4];a[o]=o<4||r<=4?l:tW[tF[l>>>24]]^tK[tF[l>>>16&255]]^tG[tF[l>>>8&255]]^tJ[tF[255&l]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,tU,tH,tz,tj,tF)},decryptBlock:function(t,e){i=t[e+1],t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,tW,tK,tG,tJ,tq);var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,s,n,r,a,o){for(var l=this._nRounds,h=t[e]^i[0],c=t[e+1]^i[1],d=t[e+2]^i[2],u=t[e+3]^i[3],p=4,g=1;g<l;g++){var f=s[h>>>24]^n[c>>>16&255]^r[d>>>8&255]^a[255&u]^i[p++],y=s[c>>>24]^n[d>>>16&255]^r[u>>>8&255]^a[255&h]^i[p++],m=s[d>>>24]^n[u>>>16&255]^r[h>>>8&255]^a[255&c]^i[p++],w=s[u>>>24]^n[h>>>16&255]^r[c>>>8&255]^a[255&d]^i[p++];h=f,c=y,d=m,u=w}var f=(o[h>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^i[p++],y=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&h])^i[p++],m=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[h>>>8&255]<<8|o[255&c])^i[p++],w=(o[u>>>24]<<24|o[h>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^i[p++];t[e]=f,t[e+1]=y,t[e+2]=m,t[e+3]=w},keySize:8}),t0.AES=tV._createHelper(tX),function(){function t(t,e){var i=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=i,this._lBlock^=i<<t}function e(t,e){var i=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=i,this._rBlock^=i<<t}var i=t0.lib,s=i.WordArray,n=i.BlockCipher,r=t0.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],c=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=r.DES=n.extend({_doReset:function(){for(var t=this._key.words,e=[],i=0;i<56;i++){var s=a[i]-1;e[i]=t[s>>>5]>>>31-s%32&1}for(var n=this._subKeys=[],r=0;r<16;r++){for(var h=n[r]=[],c=l[r],i=0;i<24;i++)h[i/6|0]|=e[(o[i]-1+c)%28]<<31-i%6,h[4+(i/6|0)]|=e[28+(o[i+24]-1+c)%28]<<31-i%6;for(i=1,h[0]=h[0]<<1|h[0]>>>31;i<7;i++)h[i]=h[i]>>>4*(i-1)+3;h[7]=h[7]<<5|h[7]>>>27}for(var d=this._invSubKeys=[],i=0;i<16;i++)d[i]=n[15-i]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(i,s,n){this._lBlock=i[s],this._rBlock=i[s+1],t.call(this,4,252645135),t.call(this,16,65535),e.call(this,2,858993459),e.call(this,8,16711935),t.call(this,1,1431655765);for(var r=0;r<16;r++){for(var a=n[r],o=this._lBlock,l=this._rBlock,d=0,u=0;u<8;u++)d|=h[u][((l^a[u])&c[u])>>>0];this._lBlock=l,this._rBlock=o^d}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,t.call(this,1,1431655765),e.call(this,8,16711935),e.call(this,2,858993459),t.call(this,16,65535),t.call(this,4,252645135),i[s]=this._lBlock,i[s+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});t0.DES=n._createHelper(d);var u=r.TripleDES=n.extend({_doReset:function(){var t=this._key.words;this._des1=d.createEncryptor(s.create(t.slice(0,2))),this._des2=d.createEncryptor(s.create(t.slice(2,4))),this._des3=d.createEncryptor(s.create(t.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t0.TripleDES=n._createHelper(u)}(),function(){function t(){for(var t=this._S,e=this._i,i=this._j,s=0,n=0;n<4;n++){i=(i+t[e=(e+1)%256])%256;var r=t[e];t[e]=t[i],t[i]=r,s|=t[(t[e]+t[i])%256]<<24-8*n}return this._i=e,this._j=i,s}var e=t0.lib.StreamCipher,i=t0.algo,s=i.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,i=t.sigBytes,s=this._S=[],n=0;n<256;n++)s[n]=n;for(var n=0,r=0;n<256;n++){var a=n%i,o=e[a>>>2]>>>24-a%4*8&255;r=(r+s[n]+o)%256;var l=s[n];s[n]=s[r],s[r]=l}this._i=this._j=0},_doProcessBlock:function(e,i){e[i]^=t.call(this)},keySize:8,ivSize:0});t0.RC4=e._createHelper(s);var n=i.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)t.call(this)}});t0.RC4Drop=e._createHelper(n)}(),t0.mode.CTRGladman=function(){function t(t){if(255==(t>>24&255)){var e=t>>16&255,i=t>>8&255,s=255&t;255===e?(e=0,255===i?(i=0,255===s?s=0:++s):++i):++e,t=0+(e<<16)+(i<<8)+s}else t+=16777216;return t}var e=t0.lib.BlockCipherMode.extend(),i=e.Encryptor=e.extend({processBlock:function(e,i){var s,n=this._cipher,r=n.blockSize,a=this._iv,o=this._counter;a&&(o=this._counter=a.slice(0),this._iv=void 0),0===((s=o)[0]=t(s[0]))&&(s[1]=t(s[1]));var l=o.slice(0);n.encryptBlock(l,0);for(var h=0;h<r;h++)e[i+h]^=l[h]}});return e.Decryptor=i,e}(),function(){function t(){for(var t=this._X,e=this._C,i=0;i<8;i++)s[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<s[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<s[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<s[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<s[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<s[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<s[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<s[6]>>>0?1:0)|0,this._b=e[7]>>>0<s[7]>>>0?1:0,i=0;i<8;i++){var r=t[i]+e[i],a=65535&r,o=r>>>16,l=((a*a>>>17)+a*o>>>15)+o*o,h=((4294901760&r)*r|0)+((65535&r)*r|0);n[i]=l^h}t[0]=n[0]+(n[7]<<16|n[7]>>>16)+(n[6]<<16|n[6]>>>16)|0,t[1]=n[1]+(n[0]<<8|n[0]>>>24)+n[7]|0,t[2]=n[2]+(n[1]<<16|n[1]>>>16)+(n[0]<<16|n[0]>>>16)|0,t[3]=n[3]+(n[2]<<8|n[2]>>>24)+n[1]|0,t[4]=n[4]+(n[3]<<16|n[3]>>>16)+(n[2]<<16|n[2]>>>16)|0,t[5]=n[5]+(n[4]<<8|n[4]>>>24)+n[3]|0,t[6]=n[6]+(n[5]<<16|n[5]>>>16)+(n[4]<<16|n[4]>>>16)|0,t[7]=n[7]+(n[6]<<8|n[6]>>>24)+n[5]|0}var e=t0.lib.StreamCipher,i=[],s=[],n=[],r=t0.algo.Rabbit=e.extend({_doReset:function(){for(var e=this._key.words,i=this.cfg.iv,s=0;s<4;s++)e[s]=16711935&(e[s]<<8|e[s]>>>24)|4278255360&(e[s]<<24|e[s]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(s=0,this._b=0;s<4;s++)t.call(this);for(s=0;s<8;s++)r[s]^=n[s+4&7];if(i){var a=i.words,o=a[0],l=a[1],h=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),c=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),d=h>>>16|4294901760&c,u=c<<16|65535&h;for(r[0]^=h,r[1]^=d,r[2]^=c,r[3]^=u,r[4]^=h,r[5]^=d,r[6]^=c,r[7]^=u,s=0;s<4;s++)t.call(this)}},_doProcessBlock:function(e,s){var n=this._X;t.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[s+r]^=i[r]},blockSize:4,ivSize:2});t0.Rabbit=e._createHelper(r)}(),t0.mode.CTR=(tQ=(tZ=t0.lib.BlockCipherMode.extend()).Encryptor=tZ.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,n=this._iv,r=this._counter;n&&(r=this._counter=n.slice(0),this._iv=void 0);var a=r.slice(0);i.encryptBlock(a,0),r[s-1]=r[s-1]+1|0;for(var o=0;o<s;o++)t[e+o]^=a[o]}}),tZ.Decryptor=tQ,tZ),function(){function t(){for(var t=this._X,e=this._C,i=0;i<8;i++)s[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<s[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<s[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<s[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<s[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<s[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<s[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<s[6]>>>0?1:0)|0,this._b=e[7]>>>0<s[7]>>>0?1:0,i=0;i<8;i++){var r=t[i]+e[i],a=65535&r,o=r>>>16,l=((a*a>>>17)+a*o>>>15)+o*o,h=((4294901760&r)*r|0)+((65535&r)*r|0);n[i]=l^h}t[0]=n[0]+(n[7]<<16|n[7]>>>16)+(n[6]<<16|n[6]>>>16)|0,t[1]=n[1]+(n[0]<<8|n[0]>>>24)+n[7]|0,t[2]=n[2]+(n[1]<<16|n[1]>>>16)+(n[0]<<16|n[0]>>>16)|0,t[3]=n[3]+(n[2]<<8|n[2]>>>24)+n[1]|0,t[4]=n[4]+(n[3]<<16|n[3]>>>16)+(n[2]<<16|n[2]>>>16)|0,t[5]=n[5]+(n[4]<<8|n[4]>>>24)+n[3]|0,t[6]=n[6]+(n[5]<<16|n[5]>>>16)+(n[4]<<16|n[4]>>>16)|0,t[7]=n[7]+(n[6]<<8|n[6]>>>24)+n[5]|0}var e=t0.lib.StreamCipher,i=[],s=[],n=[],r=t0.algo.RabbitLegacy=e.extend({_doReset:function(){var e=this._key.words,i=this.cfg.iv,s=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(u=0,this._b=0;u<4;u++)t.call(this);for(u=0;u<8;u++)n[u]^=s[u+4&7];if(i){var r=i.words,a=r[0],o=r[1],l=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),h=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),c=l>>>16|4294901760&h,d=h<<16|65535&l;n[0]^=l,n[1]^=c,n[2]^=h,n[3]^=d,n[4]^=l,n[5]^=c,n[6]^=h,n[7]^=d;for(var u=0;u<4;u++)t.call(this)}},_doProcessBlock:function(e,s){var n=this._X;t.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[s+r]^=i[r]},blockSize:4,ivSize:2});t0.RabbitLegacy=e._createHelper(r)}(),t0.pad.ZeroPadding={pad:function(t,e){var i=4*e;t.clamp(),t.sigBytes+=i-(t.sigBytes%i||i)},unpad:function(t){for(var e=t.words,i=t.sigBytes-1;!(e[i>>>2]>>>24-i%4*8&255);)i--;t.sigBytes=i+1}},t0)}),r(\"a4uPv\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.Sheet,a=n(\"eSp9Z\");a.ActionData;var o=a.ActionEnv;t.exports=/**\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n * @typedef {import(\"./clips\").Clips} Clips\n * @typedef {import(\"./views\").ClipsViews} ClipsViews\n */class{#N;menuItemActionMaxCount=5;placeholderReuseIdentifier=\"UITableViewPlaceholderReuseIdentifier\";/**\n     * @param {AppKernel} kernel\n     * @param {Clips} data\n     * @param {ClipsViews} views\n     */constructor(t,e,i){this.kernel=t,this.data=e,this.views=i}initReuseIdentifier(t){if(!t.$dequeueReusableCellWithIdentifier(this.placeholderReuseIdentifier)){let e=$objc(\"UITableViewCell\").$class();t.$registerClass_forCellReuseIdentifier(e,this.placeholderReuseIdentifier)}}get listSelected(){let t=$(this.views.listId)?.ocValue()?.$indexPathsForSelectedRows()?.jsValue();return Array.isArray(t)?t:[]}get defaultMenuItems(){return[{inline:!0,items:[{title:$l10n(\"TAG\"),symbol:\"tag\",handler:(t,e)=>{let i=this.data.getByIndex(e);$input.text({placeholder:$l10n(\"ADD_TAG\"),text:i.tag,handler:t=>{(t=t.trim()).length>0?this.kernel.storage.setTag(i.uuid,t):this.kernel.storage.deleteTag(i.uuid),this.data.updateList(!0)}})}}]},{inline:!0,items:[{title:$l10n(\"SHARE\"),symbol:\"square.and.arrow.up\",handler:(t,e)=>{let i=this.data.getByIndex(e);$share.sheet(i.image?i.imageOriginal:i.text)}},{title:$l10n(\"COPY\"),symbol:\"square.on.square\",handler:(t,e)=>this.data.copy(this.data.getByIndex(e).uuid)},{title:$l10n(\"DELETE\"),symbol:\"trash\",destructive:!0,items:[{title:$l10n(\"CONFIRM\"),destructive:!0,handler:(t,e)=>{t.delete(e),this.data.delete(this.data.getByIndex(e).uuid),// 重新计算列表项高度\n$delay(.25,()=>t.reload())}}]}]}]}get menu(){let t=t=>{let e=this.kernel.actions.getActionHandler(t.category,t.dir);return t.handler=(t,i)=>{let s=this.data.getByIndex(i);e({env:o.clipboard,text:s.text,section:s.section,uuid:s.uuid})},t.title=t.name,t.symbol=t.icon,t},e=this.kernel.actions.getActions(\"clipboard\"),i={inline:!0,items:e.slice(0,this.menuItemActionMaxCount).map(t)};return e.length>this.menuItemActionMaxCount&&i.items.push({title:$l10n(\"MORE_ACTIONS\"),symbol:\"square.grid.2x2\",items:e.slice(this.menuItemActionMaxCount).map(t)}),{items:[i,...this.defaultMenuItems]}}setEditingCallback(t){this.#N=t}createUIMenu=({title:t,image:e,actions:i,inline:s=!1,destructive:n=!1}={})=>{let r;return s&&(r|=1),n&&(r|=2),$objc(\"UIMenu\").$menuWithTitle_image_identifier_options_children(t??\"\",e,null,r??0,i)};createUIAction=({title:t,image:e,handler:i,destructive:s=!1}={})=>{let n=$objc(\"UIAction\").$actionWithTitle_image_identifier_handler(t,e,null,$block(\"void, UIAction *\",t=>{i(t)}));return s&&n.$setAttributes(2),n};createUIContextualAction=({title:t,handler:e,color:i,image:s,destructive:n=!1}={})=>{let r=$objc(\"UIContextualAction\").$contextualActionWithStyle_title_handler(n?1:0,t,$block(\"void, UIContextualAction *, UIView *, block\",async(t,i,s)=>{// completionHandler 只有第一次触发时生效，原因未知\ns=t=>{t&&$(this.views.listId).ocValue().$setEditing_animated(!1,!0)},await e(t,i,s)}));return i&&r.$setBackgroundColor(i),s&&r.$setImage(s),r};createUITableViewDropPlaceholder(t){let e=$objc(\"UITableViewDropPlaceholder\").$alloc(),i=2*this.views.verticalMargin+this.views.getContentHeight(\"A\");return e.$initWithInsertionIndexPath_reuseIdentifier_rowHeight(t,this.placeholderReuseIdentifier,i),e}updateEditingToolBar(){let t=0===this.listSelected.length,e=$(this.views.editingToolBarId+\"-select-button\"),i=$(this.views.editingToolBarId+\"-delete-button\");e.title=t?$l10n(\"SELECT_ALL\"):$l10n(\"DESELECT_ALL\"),i.hidden=t}toggleAllSelected(t=!1,e=!0){let i=this.data.clips.length,s=$(this.views.listId).ocValue();if(t||0!==this.listSelected.length)for(let t=0;t<i;t++){let e=$indexPath(0,t).ocValue();s.$deselectRowAtIndexPath_animated(e,!1)}else if(0===this.listSelected.length)for(let t=0;t<i;t++){let e=$indexPath(0,t).ocValue();s.$selectRowAtIndexPath_animated_scrollPosition(e,!1,0)}e&&s.$isEditing()&&this.updateEditingToolBar()}deleteSelected(){s.deleteConfirm($l10n(\"DELETE_CONFIRM_MSG\"),()=>{// 倒序排序\nlet t=this.listSelected.sort((t,e)=>t.row<e.row),e=t.map(t=>this.data.getByIndex(t).uuid);// 关闭编辑模式\nthis.setEditing(!1),e.forEach(t=>this.data.delete(t)),t.forEach(t=>{$(this.views.listId).delete(t)})})}/**\n     * @param {boolean} mode\n     */setEditing(t){let e=$(this.views.listId).ocValue(),i=void 0!==t?t:!e.$isEditing();if(i!==e.$isEditing()){if(e.$setEditing(i),\"function\"==typeof this.#N&&this.#N(i),i){let t=$ui.create(this.views.getListEditModeToolBarView({selectButtonEvents:{tapped:()=>this.toggleAllSelected()},deleteButtonEvents:{tapped:()=>this.deleteSelected()}}));$ui.window.add(t),// 进入编辑模式\n$(this.views.editingToolBarId).layout((t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.views.editModeToolBarHeight)})}else $(this.views.editingToolBarId).remove()}}shouldBeginMultipleSelectionInteractionAtIndexPath(){return this.setEditing(!0),!0}didSelectRowAtIndexPath(t,e){if(t.$isEditing()){this.updateEditingToolBar();return}if(t.$hasActiveDrag())return;let i=this.data.getByIndex(e.jsValue());i.image?(r.quickLookImage(i.imageOriginal),t.$deselectRowAtIndexPath_animated(e,!0)):this.views.edit(i.text,s=>{t.$deselectRowAtIndexPath_animated(e,!0),i.text!==s&&this.data.update(s,i.uuid)})}didDeselectRowAtIndexPath(t,e){t.$isEditing()&&this.updateEditingToolBar()}contextMenuConfigurationForRowAtIndexPath(t,e,i){// 编辑模式不显示菜单\nif(t.$isEditing())return;let s=i=>{let n=[];return i.items.forEach(i=>{i.items?n.push(s(i)):n.push(this.createUIAction({title:i.title,image:i.symbol,handler:()=>{i.handler(t.jsValue(),e.jsValue())},destructive:i.destructive}))}),this.createUIMenu({title:i.title,image:i.symbol,actions:n,inline:i.inline,destructive:i.destructive})};return $objc(\"UIContextMenuConfiguration\").$configurationWithIdentifier_previewProvider_actionProvider(null,null,$block(\"UIMenu *, NSArray *\",()=>s(this.menu)))}leadingSwipeActionsConfigurationForRowAtIndexPath(t,e){return $objc(\"UISwipeActionsConfiguration\").$configurationWithActions([this.createUIContextualAction({title:$l10n(\"COPY\"),color:$color(\"systemLink\"),handler:async(t,i,s)=>{this.data.copy(this.data.getByIndex(e.jsValue()).uuid),s(!0)}})])}trailingSwipeActionsConfigurationForRowAtIndexPath(t,e){t=t.jsValue(),e=e.jsValue();let i=[this.createUIContextualAction({destructive:!0,title:$l10n(\"DELETE\"),handler:(i,s,n)=>{this.data.delete(this.data.getByIndex(e).uuid),t.delete(e),// 重新计算列表项高度\n$delay(.25,()=>t.reload())}})];return 1===this.data.tabIndex&&i.push(this.createUIContextualAction({title:$l10n(\"FAVORITE\"),color:$color(\"orange\"),handler:(t,i,s)=>{this.data.favorite(e.row)}})),$objc(\"UISwipeActionsConfiguration\").$configurationWithActions(i)}heightForRowAtIndexPath(t,e){t=t.jsValue(),e=e.jsValue();let i=this.data.getByIndex(e),s=i?.hasTag?this.views.tagHeight:this.views.verticalMargin,n=i?.image?this.views.imageContentHeight:this.views.getContentHeight(i?.text??\"a\");return this.data.itemSize[e.row]=this.views.verticalMargin+n+s,this.data.itemSize[e.row]}delegate(){return $delegate({type:\"UITableViewDelegate\",events:{\"tableView:shouldBeginMultipleSelectionInteractionAtIndexPath:\":()=>this.shouldBeginMultipleSelectionInteractionAtIndexPath(),\"tableView:didBeginMultipleSelectionInteractionAtIndexPath:\":(t,e)=>{this.setEditing(!0)},\"tableView:didSelectRowAtIndexPath:\":(t,e)=>{this.didSelectRowAtIndexPath(t,e)},\"tableView:didDeselectRowAtIndexPath:\":(t,e)=>{this.didDeselectRowAtIndexPath(t,e)},\"tableView:contextMenuConfigurationForRowAtIndexPath:point:\":(t,e,i)=>this.contextMenuConfigurationForRowAtIndexPath(t,e,i),\"tableView:leadingSwipeActionsConfigurationForRowAtIndexPath:\":(t,e)=>this.leadingSwipeActionsConfigurationForRowAtIndexPath(t,e),\"tableView:trailingSwipeActionsConfigurationForRowAtIndexPath:\":(t,e)=>this.trailingSwipeActionsConfigurationForRowAtIndexPath(t,e),\"tableView:heightForRowAtIndexPath:\":(t,e)=>this.heightForRowAtIndexPath(t,e)}})}itemsForBeginningDragSession(t,e){let i=this.data.getByIndex(e.jsValue()),s=$objc(\"NSItemProvider\").$alloc();if(i.image){let t=$file.absolutePath(i.imagePath.original),e=NSURL.$fileURLWithPath(t);s.$initWithContentsOfURL(e)}else s.$initWithObject(i.text);let n=$objc(\"UIDragItem\").$alloc().$initWithItemProvider(s),r=t.$localContext();if(r)r.$addObject(n);else{let e=NSMutableArray.$new();e.$addObject(n),t.$setLocalContext(e)}return[n]}dragDelegate(){return $delegate({type:\"UITableViewDragDelegate\",events:{\"tableView:itemsForBeginningDragSession:atIndexPath:\":(t,e,i)=>this.itemsForBeginningDragSession(e,i)}})}reorder(t){// 排序只有一个可以拖拽\nlet e=t.$items().$firstObject(),i=e.$sourceIndexPath().jsValue().row,s=t.$destinationIndexPath(),n=s.jsValue().row;this.data.moveItem(i,n),this.data.updateList(),t.$dropItem_toRowAtIndexPath(e.$dragItem(),s)}dropItems(t){let e=t.$destinationIndexPath();e||(e=$indexPath(0,0));let i=t.$items(),s=i.$count();for(let n=0;n<s;n++){let s=i.$objectAtIndex(n),r=this.createUITableViewDropPlaceholder(e),a=t.$dropItem_toPlaceholder(s.$dragItem(),r),o=a.$dragItem().$itemProvider(),l=o.$registeredTypeIdentifiers().jsValue(),h=o.$hasItemConformingToTypeIdentifier(\"public.text\"),c=o.$hasItemConformingToTypeIdentifier(\"public.image\");if(!h&&!c)return;let d=(t,e)=>{e&&($ui.alert(e.jsValue()),this.kernel.logger.error(e.jsValue()));try{h?this.data.addItem(t.jsValue().string,!1):c&&this.data.addItem(t.jsValue().image,!1),a.$commitInsertionWithDataSourceUpdates($block(\"void, NSIndexPath *\",t=>{this.data.moveItem(0,t.jsValue().row),this.data.updateList()}))}catch(t){return a.$deletePlaceholder(),$ui.warning(t),!1}};o.$loadDataRepresentationForTypeIdentifier_completionHandler(l[0],$block(\"void, NSData *, NSError *\",(t,e)=>{$delay(0,()=>d(t,e))}))}}dropDelegate(){return $delegate({type:\"UITableViewDropDelegate\",events:{\"tableView:canHandleDropSession:\":(t,e)=>!t.$isEditing(),\"tableView:dropSessionDidUpdate:withDestinationIndexPath:\":(t,e,i)=>{let s=$objc(\"UITableViewDropProposal\").$alloc();return e.$localDragSession()?s.$initWithDropOperation_intent(3,1):s.$initWithDropOperation_intent(2,1),s},\"tableView:performDropWithCoordinator:\":(t,e)=>{let i=e.$session();i.$localDragSession()?this.reorder(e):this.dropItems(e)}}})}setDelegate(){let t=$(this.views.listId).ocValue();this.initReuseIdentifier(t),t.$setDelegate(this.delegate()),t.$setDragDelegate(this.dragDelegate()),t.$setDropDelegate(this.dropDelegate())}}}),r(\"gVMQa\",function(t,e){var i=n(\"gxpqj\"),s=i.NavigationView,r=i.Sheet,a=n(\"7TSVv\"),o=n(\"2VUvw\"),l=n(\"42nBp\"),h=n(\"kgD3J\"),c=n(\"r5Q7t\");t.exports=/**\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n * @typedef {Actions} Actions\n */class extends a{collectionView;placeholderReuseIdentifier=\"UICollectionViewPlaceholderReuseIdentifier\";cellReuseIdentifier=\"ActionCollectionViewCellReuseIdentifier\";headerReuseIdentifier=\"ActionViewCustomHeaderReuseIdentifier\";footerReuseIdentifier=\"ActionViewCustomFooterReuseIdentifier\";constructor(...t){super(...t),this.views=new h(this.kernel,this),this.delegates=new c(this.kernel,this,this.views)}get actionList(){return super.actions.map(t=>{let e=[];// 返回新对象\nreturn t.items.forEach(t=>{e.push(this.views.actionToData(t))}),{title:t.title,items:e}})}/**\n     * 监听同步信息\n     */actionSyncStatus(){$app.listen({actionSyncStatus:t=>{if(t.status===o.status.syncing&&t.animate)this.updateNavButton(!0),this.updateSyncLabel($l10n(\"SYNCING\"));else if(t.status===o.status.success||t.status===o.status.nochange)try{this.setNeedReload(!0)}catch(t){this.kernel.logger.error(t),this.updateSyncLabel(t)}finally{this.updateSyncLabel(),this.updateNavButton(!1),this.collectionView.jsValue().endRefreshing()}}})}editActionInfoPageSheet(t,e){let i=new l(this,t);i.editActionInfoPageSheet(e)}editActionMainJs(t=\"\",e){let i=new l(this,e);i.editActionMainJs(t)}getNavButtons(){let t=[{title:$l10n(\"IMPORT_FROM_FILE\"),handler:async()=>{let t=await $drive.open();try{if(!t)return;this.importAction(JSON.parse(t.string)),this.applySnapshotAnimatingDifferences()}catch(t){this.kernel.logger.error(t)}}}],e=[{title:$l10n(\"CREATE_NEW_ACTION\"),handler:()=>{this.editActionInfoPageSheet(null,async t=>{let e=$file.read(`${this.actionPath}/template.js`).string;this.saveMainJs(t,e);let i=this.getActionCategorySection(t.category);this.applySnapshotToSectionAnimatingDifferences(i),await $wait(.3),this.editActionMainJs(e,t)})}},{title:$l10n(\"CREATE_NEW_TYPE\"),handler:()=>this.addActionCategory()},{inline:!0,items:t}];return[{symbol:\"plus.circle\",id:this.views.addActionButtonId,menu:{pullDown:!0,asPrimary:!0,items:e}}]}getActionURLScheme(t){let e={dir:t.dir,category:t.category},i=$text.base64Encode(JSON.stringify(e));return`jsbox://run?name=${$addin.current.name}&runAction=${i}`}updateSyncLabel(t){t||(t=$l10n(\"MODIFIED\")+this.getLocalSyncDate().toLocaleString());let e=this.collectionView?.$refreshControl();if(!e)return;let i=t,s=$objc(\"NSAttributedString\").$alloc().$initWithString(i);e.$setAttributedTitle(s)}updateNavButton(t){let e=this.navigationView?.navigationBarItems?.getButton(this.views.addActionButtonId);e&&e.setLoading(t);let i=this.navigationView?.navigationBarItems?.getButton(this.views.sortActionButtonId);i&&i.setLoading(t);let s=this.navigationView?.navigationBarItems?.getButton(this.views.syncButtonId);s&&s.setLoading(t)}initReuseIdentifier(){this.collectionView.$registerClass_forCellWithReuseIdentifier($objc(\"UICollectionViewCell\").$class(),this.placeholderReuseIdentifier),this.collectionView.$registerClass_forCellWithReuseIdentifier($objc(\"UICollectionViewCell\").$class(),this.cellReuseIdentifier),this.views.actionViewCustomHeader(),this.collectionView.$registerClass_forSupplementaryViewOfKind_withReuseIdentifier($objc(\"ActionViewCustomHeader\").$class(),\"UICollectionElementKindSectionHeader\",this.headerReuseIdentifier),this.views.actionViewCustomFooter(),this.collectionView.$registerClass_forSupplementaryViewOfKind_withReuseIdentifier($objc(\"ActionViewCustomFooter\").$class(),\"UICollectionElementKindSectionFooter\",this.footerReuseIdentifier)}initDataSource(){let t=$block(\"UICollectionViewCell *, UICollectionView *, NSIndexPath *, id\",(t,e,i)=>{let s=t.$dequeueReusableCellWithReuseIdentifier_forIndexPath(this.cellReuseIdentifier,e);s.$contentView().$setClipsToBounds(!0),s.$contentView().$layer().$setCornerRadius(10);let{section:n,item:r}=e.jsValue(),a=this.views.matrixCell(this.actions[n].items[r]);return s.$contentView().jsValue().add(a),s}),e=$block(\"UICollectionReusableView *, UICollectionView *, NSString *, NSIndexPath *\",(t,e,i)=>{let{section:s}=i.jsValue();if(\"UICollectionElementKindSectionHeader\"===e.jsValue()){let n=t.$dequeueReusableSupplementaryViewOfKind_withReuseIdentifier_forIndexPath(e,this.headerReuseIdentifier,i);return n.$titleLabel().$setText(this.actions[s].title),n}{let s=t.$dequeueReusableSupplementaryViewOfKind_withReuseIdentifier_forIndexPath(e,this.footerReuseIdentifier,i);return s}}),i=$objc(\"UICollectionViewDiffableDataSource\").$alloc();i.$initWithCollectionView_cellProvider(this.collectionView,t),i.$setSupplementaryViewProvider(e),$objc_retain(i)}applySnapshotUsingReloadData(){let t=$objc(\"NSDiffableDataSourceSnapshot\").$alloc().$init(),e=this.actions;for(let i in t.$appendSectionsWithIdentifiers(e.map(t=>t.dir)),e)t.$appendItemsWithIdentifiers_intoSectionWithIdentifier(e[i].items.map(t=>t.dir),e[i].dir);this.collectionView.$dataSource().$applySnapshotUsingReloadData(t)}applySnapshotAnimatingDifferences(t=!0){let e=$objc(\"NSDiffableDataSourceSnapshot\").$alloc().$init(),i=this.actions;for(let t in e.$appendSectionsWithIdentifiers(i.map(t=>t.dir+t.items.length)),i)e.$appendItemsWithIdentifiers_intoSectionWithIdentifier(i[t].items.map(t=>t.category+t.dir+t.name+t.icon),i[t].dir+i[t].items.length);this.collectionView.$dataSource().$applySnapshot_animatingDifferences(e,t)}applySnapshotToSectionAnimatingDifferences(t,e=!0){let i=$objc(\"NSDiffableDataSourceSectionSnapshot\").$alloc().$init(),{items:s,dir:n}=this.actions[t];n+=s.length,i.$appendItems(s.map(t=>t.category+t.dir+t.name+t.icon)),this.collectionView.$dataSource().$applySnapshot_toSection_animatingDifferences(i,n,e)}getMatrixView(){let t=this.views.getMatrixView({ready:t=>{this.collectionView=t.ocValue(),this.initReuseIdentifier(),this.delegates.setDelegate(),this.delegates.setRefreshControl(),this.initDataSource(),this.applySnapshotUsingReloadData()}});return this.actionSyncStatus(),t}getPage(){return this.navigationView=new s,this.navigationView.navigationBarItems.setRightButtons(this.getNavButtons()),this.navigationView.setView(this.getMatrixView()).navigationBarTitle($l10n(\"ACTIONS\")),this.navigationView.getPage()}present(){let t=new r,e=this.getNavButtons();t.setView(this.getMatrixView()).addNavBar({title:$l10n(\"ACTIONS\"),popButton:{symbol:\"xmark.circle\"},rightButtons:e}).init(),this.navigationView=t.navigationView,t.present()}}}),r(\"7TSVv\",function(t,e){var i=n(\"gxpqj\"),s=i.FileStorage,r=i.UIKit,a=i.Sheet,o=n(\"eSp9Z\"),l=o.ActionEnv,h=o.ActionData,c=o.Action,d=n(\"jVlss\").SecureScript,u=n(\"7pN8M\"),p=n(\"2aNLD\").KeyboardPinActions,g=n(\"ilpYs\").TodayPinActions;t.exports=/**\r\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\r\n * @typedef {ActionsData} ActionsData\r\n */class{allActionsCacheKey=\"allActions\";#c;/**\r\n     * @param {AppKernel} kernel\r\n     */constructor(t){this.kernel=t,// path\nthis.actionPath=\"scripts/action\",this.actionOrderFile=\"order.json\",this.userActionPath=`${this.kernel.fileStorage.basePath}/user_action`,this.localSyncFile=this.userActionPath+\"/sync.json\",// checkUserAction\nthis.checkUserAction(),// sync\nthis.initWebdavSync()}get actions(){return this.#c||this.#V(),this.#c}get allActions(){if(this.isNew)return{};let t=$cache.get(this.allActionsCacheKey);return t&&\"object\"==typeof t||this.#V(),t}get isNew(){return $cache.get(\"caio.action.isNew\")??!1}set isNew(t){$cache.set(\"caio.action.isNew\",t)}#V(){this.#c=this.getActionCategories().map(t=>({category:t,dir:t,title:this.getCategoryTitle(t),items:this.getActions(t)// 过程中可能调用 saveOrder 导致 this.#allActions 被置为 undefined\n    }));let t={};this.#c.map(e=>e.items.forEach(i=>{t[e.category+i.dir]=i})),$cache.set(this.allActionsCacheKey,t),this.kernel.logger.info(\"init action-data\")}importExampleAction(){if(this.isNew){try{Object.keys(__ACTIONS__).forEach(t=>{Object.keys(__ACTIONS__[t]).forEach(e=>{let i=__ACTIONS__[t][e];this.exists(t,e)||this.importAction(i,t,!1)})})}catch{$file.list(this.actionPath).forEach(t=>{let e=`${this.actionPath}/${t}`;if($file.isDirectory(e)){let i=`${this.userActionPath}/${t}`;$file.list(e).forEach(s=>{this.exists(t,s)||($file.mkdir(i),$file.copy({src:`${e}/${s}`,dst:`${i}/${s}`}))})}})}this.needUpload();return}let t={},e=(()=>{let e=[];try{Object.keys(__ACTIONS__).forEach(i=>{let s=[];Object.keys(__ACTIONS__[i]).forEach(e=>{let n=__ACTIONS__[i][e],r=JSON.parse(n.config);Object.assign(r,{category:i,dir:e}),s.push(this.kernel.actions.views.actionToData(r)),t[i+e]=[n,i]}),e.push({title:this.getCategoryTitle(i),rows:s})})}catch{$file.list(this.actionPath).forEach(i=>{let s=`${this.actionPath}/${i}`;if($file.isDirectory(s)){let n=[];$file.list(s).forEach(e=>{try{let r={config:$file.read(`${s}/${e}/config.json`).string,main:$file.read(`${s}/${e}/main.js`).string,readme:$file.read(`${s}/${e}/README.md`).string},a=JSON.parse(r.config);Object.assign(a,{category:i,dir:e}),n.push(this.kernel.actions.views.actionToData(a)),t[i+e]=[r,i]}catch(t){this.kernel.logger.error(`Error during importExampleAction: ${i}/${e}`)}}),e.push({title:this.getCategoryTitle(i),rows:n})}})}return e})(),i=this.kernel.actions.views.getActionListView((e,i)=>{$ui.alert({title:$l10n(\"IMPORT_EXAMPLE_ACTIONS\"),message:`Category: ${i.category}\n${i.name}`,actions:[{title:$l10n(\"CANCEL\")},{title:$l10n(\"OK\"),handler:()=>{try{let e=t[i.category+i.dir];this.importAction(e[0],e[1],!1),$ui.success($l10n(\"SUCCESS\"))}catch(t){$ui.alert({title:$l10n(\"ERROR\"),message:t.message})}}}]})},{id:\"importExampleAction\",bgcolor:$color(\"primarySurface\"),data:e,stickyHeader:!1}),s=new a;s.setView(i).addNavBar({title:$l10n(\"IMPORT_EXAMPLE_ACTIONS\")}).init().present()}exportAction(t){let e=r.loading();e.start();let{category:i,dir:s,name:n}=t,a=this.actionToString(i,s);e.end(),$share.sheet([{name:n+\".json\",data:$data({string:a})}])}importAction(t,e=\"uncategorized\",i=!0){let n=i?r.loading():null;n?.start();try{let{config:i,main:n,readme:r}=t;if(!i||!n||!r)throw Error(\"Not an action\");let a=JSON.parse(i)?.name?.trim();if(!a||\"\"===a)throw Error(\"Not an action\");let o=this.initActionDirByName(a),l=this.getActionPath(e,o);return $file.mkdir(l),$file.write({data:$data({string:i}),path:s.join(l,\"config.json\")}),$file.write({data:$data({string:n}),path:s.join(l,\"main.js\")}),$file.write({data:$data({string:r}),path:s.join(l,\"README.md\")}),this.needUpload(!0),o}catch(t){throw t}finally{n?.end()}}checkUserAction(){$file.exists(this.userActionPath)||$file.mkdir(this.userActionPath),0!==$file.list(this.userActionPath).length||this.webdavSync||(this.isNew=!0,this.importExampleAction(),this.isNew=!1)}getLocalSyncDate(){let t=JSON.parse($file.read(this.localSyncFile)?.string??\"{}\");return new Date(t.timestamp)}async initWebdavSync(){if(this.kernel.isWebdavEnabled)try{this.webdavSync=new u({kernel:this.kernel,host:this.kernel.setting.get(\"webdav.host\"),user:this.kernel.setting.get(\"webdav.user\"),password:this.kernel.setting.get(\"webdav.password\"),basepath:this.kernel.setting.get(\"webdav.basepath\")}),await this.webdavSync.init()}catch(t){throw this.kernel.logger.error(`${t}\n${t.stack}`),t}}setNeedReload(t){this.#c=void 0,$cache.remove(this.allActionsCacheKey);// 通知更新 UI\ntry{this.applySnapshotAnimatingDifferences(t)}catch{}}needUpload(){this.setNeedReload(),this.webdavSync&&this.webdavSync.needUpload()}async sync(){this.webdavSync&&this.webdavSync.sync()}updatePinActions(t,e){p.shared.setKernel(this.kernel).updateAction(t,e),g.shared.setKernel(this.kernel).updateAction(t,e)}actionToString(t,e){return JSON.stringify({config:this.getActionConfigString(t,e),main:this.getActionMainJs(t,e),readme:this.getActionReadme(t,e)})}defaultCategories(){return[\"uncategorized\",\"clipboard\",\"editor\"]}getActionCategories(){let t=this.defaultCategories()// 保证 \"uncategorized\", \"clipboard\", \"editor\" 排在前面\n;return t.concat($file.list(this.userActionPath).filter(e=>$file.isDirectory(`${this.userActionPath}/${e}`)&&0>t.indexOf(e)))}async deleteActionCategory(t){let e=`${this.userActionPath}/${t}`,i=await $ui.alert({title:$l10n(\"delete.category\").replace(\"${category}\",t),message:$l10n(\"delete.category.keep.actions\"),actions:[{title:$l10n(\"OK\")},{title:$l10n(\"DELETE\"),style:$alertActionType.destructive},{title:$l10n(\"CANCEL\")}]});if(2===i.index)return!1;if(0===i.index)for(let t of $file.list(e))$file.move({src:`${e}/${t}`,dst:`${this.userActionPath}/uncategorized/${t}`});return $file.delete(e),this.needUpload(),!0}addActionCategory(){$input.text({text:\"\",placeholder:$l10n(\"CREATE_NEW_TYPE\"),handler:t=>{if(\"\"===(t=t.trim())){$ui.toast($l10n(\"INVALID_VALUE\"));return}let e=`${this.userActionPath}/${t}`;$file.isDirectory(e)&&$ui.warning($l10n(\"TYPE_ALREADY_EXISTS\")),$file.mkdir(e),$ui.success($l10n(\"SUCCESS\")),this.needUpload()}})}async renameActionCategory(t){let e=await $input.text({text:t});if(\"\"===(e=e.trim()))return $ui.toast($l10n(\"INVALID_VALUE\")),!1;let i=`${this.userActionPath}/${t}`,s=`${this.userActionPath}/${e}`;return $file.isDirectory(s)?($ui.warning($l10n(\"TYPE_ALREADY_EXISTS\")),!1):($file.move({src:i,dst:s}),$ui.success($l10n(\"SUCCESS\")),this.needUpload(),!0)}getActionCategorySection(t){for(let e in this.actions)if(this.actions[e].dir===t)return e;return null}getActionOrder(t,e=!1){let i=`${this.userActionPath}/${t}`,s=`${i}/${this.actionOrderFile}`;if($file.exists(s)){let e=$file.read(s)?.string;if(!e)return this.kernel.logger.error(`File read error: ${s}`),this.kernel.logger.error(`File content: ${$file.read(s)}`),this.kernel.logger.error(`File content: ${e}`),[];let n=JSON.parse(e),r=n.filter(t=>!!$file.exists(`${i}/${t}`));return r.length!==n.length&&this.saveOrder(t,r),r}if(!e)return[];{let t=[];return $file.list(i).forEach(e=>{t.push(e)}),t}}getActionPath(t,e){return`${this.userActionPath}/${t}/${e}`}getActionConfigString(t,e){return $file.read(`${this.getActionPath(t,e)}/config.json`).string}getActionConfig(t,e){return JSON.parse(this.getActionConfigString(t,e))}getActionMainJs(t,e){return $file.read(`${this.getActionPath(t,e)}/main.js`).string}getActionReadme(t,e){return $file.read(`${this.getActionPath(t,e)}/README.md`).string}initActionDirByName(t){return $text.MD5(t)}getActionDir(t,e){let i=this.initActionDirByName(e);if($file.isDirectory(this.getActionPath(t,i)))return i;for(let i of this.actions[t].items)if(i.name===e)return i.dir;return null}getAction(t,e,i){$file.exists(this.getActionPath(t,e))||(e=this.initActionDirByName(e));try{let s=this.getActionMainJs(t,e),n=new d(s),r=Function(\"Action\",\"ActionEnv\",\"ActionData\",`${n.secure()}\n return MyAction`)(c,l,h),a=new r(this.kernel,this.getActionConfig(t,e),i);return a}catch(i){throw this.kernel.logger.error(`Error during getAction: ${t}/${e}`),this.kernel.logger.error(i),i}}getActionHandler(t,e){return async i=>{try{let s=this.getAction(t,e,i);return await s.do()}catch(t){throw this.kernel.logger.error(t),t}}}getActions(t){let e=[],i=`${this.userActionPath}/${t}`;if(!$file.exists(i))return[];let s=s=>{let n=`${i}/${s}/`;if($file.isDirectory(n)){let i=this.getActionConfig(t,s);e.push(Object.assign(i,{category:t,dir:s}))}},n=this.getActionOrder(t);return n.forEach(t=>s(t)),// push 剩下的 Action\n$file.list(i).forEach(t=>{-1===n.indexOf(t)&&s(t)}),e}getCategoryTitle(t){let e=t.toUpperCase(),i=$l10n(e),s=i===e?t:i;return s}#M(t,...e){let i;\"string\"!=typeof t&&(t=JSON.stringify(t));let n=s.join(this.userActionPath,...e),r=n.substring(0,n.lastIndexOf(\"/\"));$file.exists(r)||$file.mkdir(r);let a=$file.read(n)?.string;try{i=JSON.stringify(JSON.parse(a))}catch{i=a}t!==i&&$file.write({data:$data({string:t}),path:n})}changeCategory(t,e){$file.move({src:`${this.userActionPath}/${t.category}/${t.dir}`,dst:`${this.userActionPath}/${e.category}/${e.dir}`})}saveActionInfo(t,e){t&&(t.category!==e.category&&this.changeCategory(t,e),this.updatePinActions(t,e)),this.#M({icon:e.icon,color:e.color,name:e.name},e.category,e.dir,\"config.json\"),this.#M(e.readme,e.category,e.dir,\"README.md\"),this.needUpload(!0)}saveMainJs(t,e){this.#M(e,t.category,t.dir,\"main.js\"),this.needUpload()}saveOrder(t,e){this.#M(JSON.stringify(e),t,this.actionOrderFile),this.needUpload()}move(t,e){if(t.section===e.section&&t.item===e.item)return;let i=this.actions[t.section],s=i.items,n=i.dir,r=t=>t.map(t=>t.dir);// 判断是否跨 section\nif(t.section===e.section){let i=t.item<e.item?e.item+1:e.item,a=t.item>e.item?t.item+1:t.item;s.splice(i,0,s[t.item])// 在 to 位置插入元素\n,s=s.filter((t,e)=>e!==a),this.saveOrder(n,r(s))}else{let i=this.actions[e.section],a=i.items,o=i.dir;a.splice(e.item,0,s[t.item])// 在 to 位置插入元素\n,s=s.filter((e,i)=>i!==t.item)// 删除 from 位置元素\n;// 跨 section 则同时移动 Action 目录\nlet l=a[e.item],h=Object.assign(JSON.parse(JSON.stringify(a[e.item])),{category:o});this.changeCategory(l,h),this.updatePinActions(l,h),// 代码顺序不能错\nthis.saveOrder(o,r(a)),this.saveOrder(n,r(s))}this.needUpload()}delete(t){$file.delete(`${this.userActionPath}/${t.category}/${t.dir}`),this.needUpload(!0)}exists(t,e){return void 0!==this.allActions[t+e]}}}),r(\"7pN8M\",function(t,e){var i=n(\"gxpqj\").FileStorage,s=n(\"2VUvw\");/**\n * @typedef {import(\"../app-main\").AppKernel} AppKernel\n */class r extends s{localSyncDataPath=\"/user_action/sync.json\";webdavSyncDataPath=\"/sync.json\";tempPath=\"/temp\";webdavActionsPath=\"/actions.zip\";localActionsPath=\"/user_action\";constructor({host:t,user:e,password:s,basepath:n,kernel:r}={}){super({host:t,user:e,password:s,basepath:n=i.join(n,\"user_action\"),kernel:r})}async init(){await super.init(),this.sync()}isNew(){return this.kernel.actions.isNew}async pull(){let t=i.join(this.tempPath,\"user_action\"),e=this.kernel.fileStorage.filePath(t),s=await this.webdav.get(this.webdavActionsPath),n=await $archiver.unzip({file:s.rawData,dest:e});if(!n)throw Error($l10n(\"UNZIP_FAILED\"));await this.downloadSyncData(),this.kernel.fileStorage.move(t,this.localActionsPath),this.kernel.logger.info(\"action webdav sync: pulled\")}async push(){let t=i.join(this.tempPath,\"actions.zip\"),e=$archiver.zip({directory:this.kernel.fileStorage.filePath(this.localActionsPath),dest:this.kernel.fileStorage.filePath(t)});if(!e)throw Error($l10n(\"ZIP_FAILED\"));await $wait(.5),await this.webdav.put(this.webdavActionsPath,this.kernel.fileStorage.readSync(t)),await this.uploadSyncData(),this.kernel.fileStorage.delete(t),this.kernel.logger.info(\"action webdav sync: pushed\")}notify(t){$app.notify({name:\"actionSyncStatus\",object:t})}async #g(){let t=!1;try{let e=await this.nextSyncStep();if(this.kernel.logger.info(`action nextSyncStep: ${s.stepName[e]}`),e===s.step.needPush||e===s.step.init)await this.push();else if(e===s.step.needPull)await this.pull(),t=!0;else if(e===s.step.conflict){let e=await this.conflict($l10n(\"ACTIONS\"));if(e!==r.conflictKeep.webdav)return;t=!0}else{this.notify({status:s.status.nochange});return}this.notify({status:s.status.success,updateList:t})}catch(t){throw this.notify({status:s.status.fail,error:t}),t}}sync(){this.notify({status:s.status.syncing,animate:!0}),this.syncTimer&&this.syncTimer.cancel(),this.syncTimer=$delay(.5,()=>{this.#g(!0)})}needUpload(){this.notify({status:s.status.syncing}),this.uploadTimer&&this.uploadTimer.cancel(),this.uploadTimer=$delay(.5,()=>{this.updateLocalTimestamp(),this.#g()})}}t.exports=r}),r(\"2aNLD\",function(t,e){var i=n(\"gxpqj\").Sheet,s=n(\"3VDld\").SelectActions;/**\r\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\r\n */class r{constructor(){this.listId=\"keyboard-script-list\"}static getAddins(){let t=$cache.get(\"keyboard.addins\");if(!t)return[];if($cache.get(\"keyboard.addins.all\")){let t=$addin.current.name;return $addin.list?.filter(e=>t!==e.displayName).map(t=>t.displayName)}try{return JSON.parse(t)}catch(t){return[]}}static setAddins(t=[]){t.map((e,i)=>{null===e&&t.splice(i,1)});try{$cache.set(\"keyboard.addins\",JSON.stringify(t))}catch(t){$cache.set(\"keyboard.addins\",void 0)}}static setAllAddins(t){$cache.set(\"keyboard.addins.all\",t)}getUnsetAddins(){let t=$addin.current.name,e=r.getAddins();return $addin.list?.filter(i=>e.indexOf(i.displayName)===-1&&t!==i.displayName).map(t=>t.displayName)}add(){let t={type:\"list\",props:{data:this.getUnsetAddins()},events:{didSelect:(t,e,i)=>{let s=r.getAddins();s.unshift(i),r.setAddins(s),$(this.listId).insert({indexPath:$indexPath(0,0),value:i}),t.delete(e)}},layout:$layout.fill},e=new i;e.setView(t).addNavBar({title:$l10n(\"ADD\")}).init().present()}getNavButtons(){return[{symbol:\"plus\",tapped:()=>this.add()}]}getListView(){return{type:\"list\",props:{id:this.listId,reorder:!0,data:r.getAddins(),actions:[{title:\"delete\",handler:(t,e)=>{r.setAddins(t.data)}}]},events:{reorderFinished:t=>{r.setAddins(t)}},layout:$layout.fill}}async sheet(){let t=await $ui.menu({items:[$l10n(\"ALL_SCRIPTS\"),$l10n(\"SELECT_SCRIPTS\")]});if(0===t.index)r.setAllAddins(!0);else{r.setAllAddins(!1);let t=new i;t.setView(this.getListView()).addNavBar({title:$l10n(\"QUICK_START_SCRIPTS\"),popButton:{title:$l10n(\"DONE\")},rightButtons:this.getNavButtons()}),t.init().present()}}}class a extends s{static shared=new a;cacheKey=\"keyboard.pinAction\";/**\r\n     * @param {AppKernel} kernel\r\n     */constructor(t){super(t),this.listId=\"keyboard-pin-action-list\"}async sheet(){let t=new i;t.setView(this.getListView()).addNavBar({title:$l10n(\"PIN_ACTION\"),popButton:{title:$l10n(\"DONE\")},rightButtons:this.getNavButtons()}),t.init().present()}}t.exports={KeyboardAddins:r,KeyboardPinActions:a}}),r(\"3VDld\",function(t,e){var i=n(\"gxpqj\").Sheet;t.exports={SelectActions:/**\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n */class{cacheKey;/**\n     * @param {AppKernel} kernel\n     */constructor(t){this.kernel=t}setKernel(t){return this.kernel=t,this}getActions(){let t=$cache.get(this.cacheKey);return Array.isArray(t)?t.filter(t=>this.kernel.actions.exists(t.category,t.dir)):[]}addAction(t){let e=this.getActions();e.push(t),$cache.set(this.cacheKey,e)}setActions(t=[]){$cache.set(this.cacheKey,t)}updateAction(t,e){this.setActions(this.getActions().map(i=>i.category===t.category&&i.dir===t.dir?e:i))}add(){let t=\"keyboard.add.sheet\",e=()=>{let t=this.getActions().map(t=>t.name),e=this.kernel.actions.actionList;for(let i=0;i<e.length;i++)e[i].items=e[i].items.filter(e=>-1===t.indexOf(e.name.text));return e.map(t=>(t.rows=t.items,t)),e},s=this.kernel.actions.views.getActionListView((i,s)=>{this.addAction(s),$(this.listId).data=this.getListData(),$(t).data=e()},{id:t,bgcolor:$color(\"primarySurface\"),stickyHeader:!1,data:e()},{},$layout.fill),n=new i;n.setView(s).addNavBar({title:$l10n(\"ADD\")}).init().present()}getNavButtons(){return[{symbol:\"plus\",tapped:()=>this.add()}]}getListData(t=this.getActions()){return t.map(t=>this.kernel.actions.views.actionToData(t))}getListView(){return this.kernel.actions.views.getActionListView(void 0,{id:this.listId,bgcolor:$color(\"primarySurface\"),stickyHeader:!1,reorder:!0,data:this.getListData(),actions:[{title:\"delete\",handler:(t,e)=>{let i=t.data;this.setActions(i.map(t=>t.info.info))}}]},{reorderFinished:t=>{this.setActions(t.map(t=>t.info.info))}},$layout.fill)}async sheet(){let t=new i;t.setView(this.getListView()).addNavBar({title:$l10n(\"PIN_ACTION\"),popButton:{title:$l10n(\"DONE\")},rightButtons:this.getNavButtons()}),t.init().present()}}}}),r(\"ilpYs\",function(t,e){var i=n(\"gxpqj\").Sheet,s=n(\"3VDld\").SelectActions;/**\r\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\r\n */class r extends s{static shared=new r;cacheKey=\"today.actions\";/**\r\n     * @param {AppKernel} kernel\r\n     */constructor(t){super(t),this.listId=\"today-action-list\"}sheet(){let t=new i;t.setView(this.getListView()).addNavBar({title:$l10n(\"ACTIONS\"),popButton:{title:$l10n(\"CLOSE\")},rightButtons:this.getNavButtons()}),t.init().present()}}t.exports={TodayPinActions:r}}),r(\"42nBp\",function(t,e){var i=n(\"gxpqj\"),s=i.Setting,r=i.Sheet,a=n(\"f0nX9\"),o=n(\"eSp9Z\").ActionEnv;t.exports=/**\n * @typedef {import(\"./actions\").Actions} Actions\n */class{editingActionInfo;/**\n     *\n     * @param {Actions} data\n     * @param {object} info\n     */constructor(t,e){this.data=t,this.info=e,this.raw=JSON.parse(JSON.stringify(e)),this.actionCategories=this.data.getActionCategories(),this.initEditingActionInfo(),this.initSettingInstance()}initEditingActionInfo(){this.isNew=!this.info,this.isNew?this.editingActionInfo={category:this.actionCategories[0],name:\"MyAction\",color:\"#CC00CC\",icon:\"icon_062.png\",readme:\"\"}:(this.editingActionInfo=this.info,this.editingActionInfo.readme=this.data.getActionReadme(this.info.category,this.info.dir))}initSettingInstance(){this.settingInstance=new s({structure:[],set:(t,e)=>(this.editingActionInfo[t]=e,!0),get:(t,e=null)=>Object.prototype.hasOwnProperty.call(this.editingActionInfo,t)?this.editingActionInfo[t]:e})}informationView(){let t=this.settingInstance.loader({setting:this.settingInstance,type:\"input\",key:\"name\",icon:[\"pencil.circle\",\"#FF3366\"],title:$l10n(\"NAME\")}).create(),e=this.settingInstance.loader({setting:this.settingInstance,type:\"color\",key:\"color\",icon:[\"pencil.tip.crop.circle\",\"#0066CC\"],title:$l10n(\"COLOR\")}).create(),i=this.settingInstance.loader({setting:this.settingInstance,type:\"icon\",key:\"icon\",icon:[\"star.circle\",\"#FF9933\"],title:$l10n(\"ICON\"),bgcolor:this.data.views.getColor(this.editingActionInfo.color)}).create(),s=this.settingInstance.loader({setting:this.settingInstance,type:\"menu\",key:\"category\",icon:[\"tag.circle\",\"#33CC33\"],title:$l10n(\"CATEGORY\"),items:this.actionCategories,values:this.actionCategories,pullDown:!0}).create();return[t,e,i,s]}actionInfoView(){let t={type:\"view\",views:[{type:\"text\",props:{id:\"action-text\",textColor:$color(\"#000000\",\"secondaryText\"),bgcolor:$color(\"systemBackground\"),text:this.editingActionInfo.readme,insets:$insets(10,10,10,10)},layout:$layout.fill,events:{tapped:t=>{$(\"actionInfoPageSheetList\").scrollToOffset($point(0,220)),$delay(.2,()=>t.focus())},didChange:t=>{this.editingActionInfo.readme=t.text}}}],layout:$layout.fill},e=[{title:$l10n(\"INFORMATION\"),rows:this.informationView()},{title:$l10n(\"DESCRIPTION\"),rows:[t]}];return{type:\"list\",props:{id:\"actionInfoPageSheetList\",bgcolor:$color(\"insetGroupedBackground\"),style:2,separatorInset:$insets(0,50,0,10),data:e},layout:$layout.fill,events:{rowHeight:(t,e)=>1===e.section?150:50}}}editActionInfoPageSheet(t){let e=new r,i=async()=>{if(this.isNew&&(this.editingActionInfo.dir=this.data.initActionDirByName(this.editingActionInfo.name),this.data.exists(this.editingActionInfo.category,this.editingActionInfo.dir))){let t=await $ui.alert({title:$l10n(\"UNABLE_CREATE_ACTION\"),message:$l10n(\"ACTION_NAME_ALREADY_EXISTS\").replaceAll(\"${name}\",this.editingActionInfo.name)});if(1===t.index)return}e.dismiss(),this.data.saveActionInfo(this.raw,this.editingActionInfo),await $wait(.3)// 等待 sheet 关闭\n,t&&t(this.editingActionInfo)};e.setView(this.actionInfoView()).addNavBar({title:\"\",popButton:{title:$l10n(\"CANCEL\")},rightButtons:[{title:$l10n(\"DONE\"),tapped:()=>i()}]}).init().present()}editorNavButtons(t){return[{symbol:\"book.circle\",tapped:()=>{let t=$file.read(\"scripts/action/README.md\")?.string;if(!t)try{t=__ACTION_README__.content}catch{}let e=new r;e.setView({type:\"markdown\",props:{content:t},layout:(t,e)=>{t.size.equalTo(e.super)}}).addNavBar({title:\"Document\",popButton:{symbol:\"x.circle\"}}).init().present()}},{symbol:\"play.circle\",tapped:async()=>{try{this.data.saveMainJs(this.info,t.text);let e=await this.data.getActionHandler(this.info.category,this.info.dir)({env:o.build});if(void 0!==e){e=\"object\"==typeof e?JSON.stringify(e,null,2):String(e);let t=new r;t.setView({type:\"code\",props:{lineNumbers:!0,editable:!1,text:e},layout:$layout.fill}).addNavBar({title:\"\",popButton:{title:$l10n(\"DONE\")}}).init().present()}}catch(t){this.data.kernel.logger.error(t)}}}]}editActionMainJs(t=\"\"){let e=new a(this.data.kernel);e.pageSheet(t,t=>{this.data.saveMainJs(this.info,t)},this.info.name,this.editorNavButtons(e),\"code\")}}}),r(\"kgD3J\",function(t,e){var i=n(\"gxpqj\"),s=i.BarButtonItem,r=i.UIKit;t.exports=/**\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n * @typedef {import(\"./actions\").Actions} Actions\n * @typedef {ActionViews} ActionViews\n */class{addActionButtonId=\"action-manager-button-add\";sortActionButtonId=\"action-manager-button-sort\";syncButtonId=\"action-manager-button-sync\";syncLabelId=\"action-manager-sync-label\";editingToolBarId=\"action-editingToolBarId\";horizontalMargin=20;verticalMargin=14;editModeToolBarHeight=44;columns=2;spacing=15;itemHeight=100;headerHeight=35;/**\n     * @param {AppKernel} kernel\n     * @param {Actions} data\n     */constructor(t,e){this.kernel=t,this.data=e}getActionListView(t,e={},i={},s){return t&&(i.didSelect=(e,i,s)=>{let n=s.info.info,r=this.data.getActionHandler(n.category,n.dir);t(r,n)}),{type:\"list\",layout:(t,e)=>{\"function\"==typeof s?s(t,e):(t.top.width.equalTo(e.super.safeArea),t.bottom.inset(0))},events:i,props:Object.assign({reorder:!1,bgcolor:$color(\"clear\"),rowHeight:60,sectionTitleHeight:30,stickyHeader:!0,data:(()=>{let t=this.data.actionList;return t.map(t=>(t.rows=t.items,t))})(),template:{props:{bgcolor:$color(\"clear\")},views:[{type:\"image\",props:{id:\"color\",cornerRadius:8,smoothCorners:!0},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(15),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:\"icon\",tintColor:$color(\"#ffffff\")},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(20),t.size.equalTo($size(20,20))}},{type:\"label\",props:{id:\"name\",lines:1,font:$font(16)},layout:(t,e)=>{t.height.equalTo(30),t.centerY.equalTo(e.super),t.left.equalTo(e.prev.right).offset(15)}},{type:\"label\",props:{id:\"info\"}}]}},e)}}getActionMiniView(t,e){return e||(e=[],this.data.actions.forEach(t=>{e=e.concat(t.items)})),{type:\"matrix\",props:{bgcolor:$color(\"clear\"),columns:2,itemHeight:50,spacing:8,data:e.map(t=>this.actionToData(t)),template:{props:{smoothCorners:!0,cornerRadius:10,bgcolor:$color($rgba(255,255,255,.3),$rgba(0,0,0,.3))},views:[{type:\"image\",props:{id:\"color\",cornerRadius:8,smoothCorners:!0},layout:t=>{t.top.left.inset(10),t.size.equalTo($size(30,30))}},{type:\"image\",props:{id:\"icon\",tintColor:$color(\"#ffffff\")},layout:(t,e)=>{t.edges.equalTo(e.prev).insets(5)}},{type:\"label\",props:{id:\"name\",font:$font(14)},layout:(t,e)=>{t.bottom.top.inset(10),t.left.equalTo(e.prev.prev.right).offset(10),t.right.inset(10)}},{// 用来保存信息\ntype:\"view\",props:{id:\"info\",hidden:!0}}]}},layout:$layout.fill,events:{didSelect:async(e,i,s)=>{let n=s.info.info,r=await t();this.data.getActionHandler(n.category,n.dir)(r)}}}}getMatrixEditModeToolBarView({selectButtonEvents:t,deleteButtonEvents:e}={}){let i=r.blurBox({id:this.editingToolBarId},[r.separatorLine(),{type:\"view\",views:[{type:\"button\",props:{id:this.editingToolBarId+\"-select-button\",title:$l10n(\"SELECT_ALL\"),titleColor:$color(\"tint\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.left.inset(this.horizontalMargin),t.centerY.equalTo(e.super)},events:t},{type:\"button\",props:{id:this.editingToolBarId+\"-delete-button\",symbol:\"trash\",hidden:!0,tintColor:$color(\"red\"),bgcolor:$color(\"clear\")},layout:(t,e)=>{t.height.equalTo(e.super),t.width.equalTo(2*this.horizontalMargin),t.right.inset(this.horizontalMargin/2),t.centerY.equalTo(e.super)},events:e}],layout:(t,e)=>{t.left.right.top.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom)}}]);return i}getColor(t,e=null){return t?\"string\"==typeof t?$color(t):$rgba(t.red,t.green,t.blue,t.alpha):e}actionToData(t){return{name:{text:t.name},icon:t?.icon?.slice(0,5)===\"icon_\"?{icon:$icon(t.icon.slice(5,t.icon.indexOf(\".\")),$color(\"#ffffff\"))}:{image:$image(t?.icon)},color:{bgcolor:this.getColor(t.color)},info:{info:t}// 此处实际上是 info 模板的 props，所以需要 { info: action }\n}}matrixCell(t){return{props:{bgcolor:$color(\"#ffffff\",\"#242424\")},views:[{type:\"image\",props:{bgcolor:this.getColor(t.color),cornerRadius:8,smoothCorners:!0},layout:t=>{t.top.left.inset(10),t.size.equalTo($size(30,30))}},{type:\"image\",props:Object.assign({tintColor:$color(\"#ffffff\")},t?.icon?.slice(0,5)===\"icon_\"?{icon:$icon(t.icon.slice(5,t.icon.indexOf(\".\")),$color(\"#ffffff\"))}:{image:$image(t?.icon)}),layout:t=>{t.top.left.inset(15),t.size.equalTo($size(20,20))}},{// button\ntype:\"button\",props:{bgcolor:$color(\"clear\"),tintColor:r.textColor,titleColor:r.textColor,contentEdgeInsets:$insets(0,0,0,0),titleEdgeInsets:$insets(0,0,0,0),imageEdgeInsets:$insets(0,0,0,0)},views:[{type:\"image\",props:{symbol:\"ellipsis.circle\"},layout:(t,e)=>{t.center.equalTo(e.super),t.size.equalTo(s.style.iconSize)}}],events:{tapped:e=>{let i=this.data.getActionMainJs(t.category,t.dir);this.data.editActionMainJs(i,t)}},layout:t=>{t.top.right.inset(0),t.size.equalTo(s.style.width)}},{type:\"label\",props:{text:t.name,font:$font(16)},layout:(t,e)=>{t.bottom.left.inset(10),t.width.equalTo(e.super)}}],layout:$layout.fill}}actionViewCustomHeader(){$define({type:\"ActionViewCustomHeader: UICollectionReusableView\",props:[\"titleLabel\"],events:{\"initWithFrame:\":t=>{self=self.$super().$initWithFrame(t);let e=self.$bounds();e.x=this.spacing,e.y=this.headerHeight-21;let i=$objc(\"UILabel\").$alloc().$initWithFrame(e);return i.$setFont($font(\"bold\",21).ocValue()),i.$setTextAlignment($align.left),i.$setNumberOfLines(1),self.$setTitleLabel(i),self.$addSubview(self.$titleLabel()),self}}})}actionViewCustomFooter(){$define({type:\"ActionViewCustomFooter: UICollectionReusableView\",props:[\"titleLabel\"],events:{\"initWithFrame:\":t=>{self=self.$super().$initWithFrame(t);let e=self.$bounds();e.x=this.spacing;let i=$objc(\"UILabel\").$alloc().$initWithFrame(e);return i.$setFont($font(16).ocValue()),i.$setTextAlignment($align.left),self.$setTitleLabel(i),self.$addSubview(self.$titleLabel()),self}}})}collectionViewFlowLayout(){let t=$objc(\"UICollectionViewFlowLayout\").$alloc().$init();t.$setScrollDirection($scrollDirection.vertical),t.$setMinimumLineSpacing(this.spacing),t.$setMinimumInteritemSpacing(this.spacing);let e=$insets(this.spacing,this.spacing,0,this.spacing).ocValue();// layout.$setSectionHeadersPinToVisibleBounds(true)\nreturn t.$setSectionInset(e.$UIEdgeInsetsValue()),t}getMatrixView(t){let e={type:\"matrix\",props:{bgcolor:r.scrollViewBackgroundColor},layout:$layout.fill,events:t};return e}}}),r(\"r5Q7t\",function(t,e){var i=n(\"gxpqj\"),s=i.UIKit,r=i.Sheet,a=n(\"eSp9Z\"),o=a.ActionEnv;a.ActionData,t.exports=/**\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\n * @typedef {import(\"./actions\").Actions} Actions\n * @typedef {import(\"./views\").ActionViews} ActionViews\n */class{collectionView;#N;/**\n     * @param {AppKernel} kernel\n     * @param {Actions} data\n     * @param {ActionViews} views\n     */constructor(t,e,i){this.kernel=t,this.data=e,this.views=i}getActionByIndexPath(t){let e=t.$section(),i=t.$item(),s=this.data.actions[e].items[i];return s}get matrixSelected(){let t=this.collectionView?.$indexPathsForSelectedItems()?.jsValue();return Array.isArray(t)?t:[]}get menu(){let t=[{// 编辑信息\ntitle:$l10n(\"EDIT_DETAILS\"),symbol:\"slider.horizontal.3\",handler:(t,e,i)=>{this.data.editActionInfoPageSheet(i,t=>{this.data.applySnapshotToSectionAnimatingDifferences(e.$section())})}},{// 编辑脚本\ntitle:$l10n(\"EDIT_SCRIPT\"),symbol:\"square.and.pencil\",handler:(t,e,i)=>{let s=this.data.getActionMainJs(i.category,i.dir);this.data.editActionMainJs(s,i)}},{inline:!0,items:[{// README\ntitle:\"README\",symbol:\"book\",handler:(t,e,i)=>{let s;try{s=__ACTIONS__[i.category][i.dir][\"README.md\"]}catch{s=this.data.getActionReadme(i.category,i.dir)}let n=new r;n.setView({type:\"markdown\",props:{content:s},layout:(t,e)=>{t.size.equalTo(e.super)}}).init().present()}}]},{inline:!0,items:[{// share\ntitle:$l10n(\"SHARE\"),symbol:\"square.and.arrow.up\",handler:(t,e,i)=>{this.data.exportAction(i)}},{// share\ntitle:\"URL Scheme\",symbol:\"link\",handler:(t,e,i)=>{$clipboard.text=this.data.getActionURLScheme(i),$ui.success($l10n(\"COPIED\"))}},{// 删除\ntitle:$l10n(\"DELETE\"),symbol:\"trash\",destructive:!0,handler:(t,e,i)=>{s.deleteConfirm($l10n(\"DELETE_CONFIRM_MSG\"),()=>{this.data.delete(i),this.data.applySnapshotToSectionAnimatingDifferences(e.$section())})}}]}];return{items:t}}setEditingCallback(t){this.#N=t}createUIMenu=({title:t,image:e,actions:i,inline:s=!1,destructive:n=!1}={})=>{let r;return s&&(r|=1),n&&(r|=2),$objc(\"UIMenu\").$menuWithTitle_image_identifier_options_children(t??\"\",e,null,r??0,i)};createUIAction=({title:t,image:e,handler:i,destructive:s=!1}={})=>{let n=$objc(\"UIAction\").$actionWithTitle_image_identifier_handler(t,e,null,$block(\"void, UIAction *\",t=>{i(t)}));return s&&n.$setAttributes(2),n};createUICollectionViewDropPlaceholder(t){let e=$objc(\"UICollectionViewDropPlaceholder\").$alloc();return e.$initWithInsertionIndexPath_reuseIdentifier(t,this.data.placeholderReuseIdentifier),e}updateEditingToolBar(){let t=0===this.matrixSelected.length,e=$(this.views.editingToolBarId+\"-select-button\"),i=$(this.views.editingToolBarId+\"-delete-button\");e.title=t?$l10n(\"SELECT_ALL\"):$l10n(\"DESELECT_ALL\"),i.hidden=t}toggleAllSelected(t=!1,e=!0){let i=this.data.clips.length;if(t||0!==this.matrixSelected.length)for(let t=0;t<i;t++){let e=$indexPath(0,t).ocValue();this.collectionView.$deselectItemAtIndexPath_animated(e,!1)}else if(0===this.matrixSelected.length)for(let t=0;t<i;t++){let e=$indexPath(0,t).ocValue();this.collectionView.$selectItemAtIndexPath_animated_scrollPosition(e,!1,0)}e&&this.collectionView.$isEditing()&&this.updateEditingToolBar()}deleteSelected(){s.deleteConfirm($l10n(\"DELETE_CONFIRM_MSG\"),()=>{this.matrixSelected.sort((t,e)=>t.item<e.item),// 关闭编辑模式\nthis.setEditing(!1);//this.data.applySnapshotAnimatingDifferences()\n})}/**\n     * @param {boolean} mode\n     */setEditing(t){let e=void 0!==t?t:!this.collectionView.$isEditing();if(e!==this.collectionView.$isEditing()){if(this.collectionView.$setEditing(e),\"function\"==typeof this.#N&&this.#N(e),e){let t=$ui.create(this.views.getMatrixEditModeToolBarView({selectButtonEvents:{tapped:()=>this.toggleAllSelected()},deleteButtonEvents:{tapped:()=>this.deleteSelected()}}));$ui.window.add(t),// 进入编辑模式\n$(this.views.editingToolBarId).layout((t,e)=>{t.left.right.bottom.equalTo(e.super),t.top.equalTo(e.super.safeAreaBottom).offset(-this.views.editModeToolBarHeight)})}else $(this.views.editingToolBarId).remove()}}didSelectItemAtIndexPath(t,e){if(t.$isEditing()){this.updateEditingToolBar();return}if(t.$hasActiveDrag())return;let i=this.getActionByIndexPath(e);this.data.getActionHandler(i.category,i.dir)({env:o.action})}didDeselectItemAtIndexPath(t,e){t.$isEditing()&&this.updateEditingToolBar()}contextMenuConfigurationForItemAtIndexPath(t,e,i){// 编辑模式不显示菜单\nif(t.$isEditing())return;let s=i=>{let n=[];return i.items.forEach(i=>{i.items?n.push(s(i)):n.push(this.createUIAction({title:i.title,image:i.symbol,handler:()=>{i.handler(t,e,this.getActionByIndexPath(e))},destructive:i.destructive}))}),this.createUIMenu({title:i.title,image:i.symbol,actions:n,inline:i.inline,destructive:i.destructive})};return $objc(\"UIContextMenuConfiguration\").$configurationWithIdentifier_previewProvider_actionProvider(null,null,$block(\"UIMenu *, NSArray *\",()=>s(this.menu)))}/**\n     * 配合 easy-jsbox 大标题\n     * @returns\n     */scrollViewDelegate(){let t=this.data.navigationView.view.scrollableView.events;return{\"scrollViewDidScroll:\":e=>{t.didScroll(e.jsValue())},\"scrollViewDidEndDragging:willDecelerate:\":(e,i)=>{t.didEndDragging(e.jsValue(),i)},\"scrollViewDidEndDecelerating:\":e=>{t.didEndDecelerating(e.jsValue())},\"handleRefresh:\":async t=>{this.kernel.setting.get(\"webdav.status\")?this.data.sync():(this.data.applySnapshotAnimatingDifferences(),t.$endRefreshing())}}}setRefreshControl(){let t=$objc(\"UIRefreshControl\").$alloc().$init();if(t.$addTarget_action_forControlEvents(this.collectionView.$delegate(),\"handleRefresh:\",4096),this.kernel.setting.get(\"webdav.status\")){let e=$l10n(\"MODIFIED\")+this.data.getLocalSyncDate().toLocaleString(),i=$objc(\"NSAttributedString\").$alloc().$initWithString(e);t.$setAttributedTitle(i)}this.collectionView.$setRefreshControl(t)}delegate(){let t={...this.scrollViewDelegate(),\"collectionView:shouldBeginMultipleSelectionInteractionAtIndexPath:\":(t,e)=>!1,\"collectionView:didSelectItemAtIndexPath:\":(t,e)=>{this.didSelectItemAtIndexPath(t,e)},\"collectionView:didDeselectItemAtIndexPath:\":(t,e)=>{this.didDeselectItemAtIndexPath(t,e)},\"collectionView:contextMenuConfigurationForItemsAtIndexPaths:point:\":(t,e,i)=>this.contextMenuConfigurationForItemAtIndexPath(t,e.$firstObject(),i),\"collectionView:contextMenuConfigurationForItemAtIndexPath:point:\":(t,e,i)=>this.contextMenuConfigurationForItemAtIndexPath(t,e,i),\"collectionView:layout:sizeForItemAtIndexPath:\":(t,e,i)=>{let s=this.views.spacing*(this.views.columns+1),n=(t.$frame().width-s)/this.views.columns;return $size(n,this.views.itemHeight)},\"collectionView:layout:referenceSizeForHeaderInSection:\":(t,e,i)=>{let s=t.$frame().width-2*this.views.spacing;return $size(s,this.views.headerHeight)}};return $delegate({type:\"UICollectionViewDelegate, UICollectionViewDelegateFlowLayout\",events:t})}itemsForBeginningDragSession(t,e){let i=this.getActionByIndexPath(e),s=$objc(\"NSItemProvider\").$alloc().$init();s.$setSuggestedName(i.name+\".json\"),s.$registerDataRepresentationForTypeIdentifier_visibility_loadHandler(\"public.text\",0,$block(\"NSProgress *, block\",t=>{let e=this.data.actionToString(i.category,i.dir),s=$data({string:e}).ocValue();return t(s,null),null}));let n=$objc(\"UIDragItem\").$alloc().$initWithItemProvider(s),r=t.$localContext();if(r)r.$addObject(n);else{let e=NSMutableArray.$new();e.$addObject(n),t.$setLocalContext(e)}return[n]}dragDelegate(){return $delegate({type:\"UICollectionViewDragDelegate\",events:{\"collectionView:itemsForBeginningDragSession:atIndexPath:\":(t,e,i)=>this.itemsForBeginningDragSession(e,i)}})}reorder(t){// 排序只有一个可以拖拽\nlet e=t.$items().$firstObject(),i=e.$sourceIndexPath().jsValue(),s=t.$destinationIndexPath(),n=s.jsValue();this.data.move(i,n),this.data.applySnapshotAnimatingDifferences(!1),this.data.applySnapshotToSectionAnimatingDifferences(i.section),i.section!==n.section&&this.data.applySnapshotToSectionAnimatingDifferences(n.section),t.$dropItem_toItemAtIndexPath(e.$dragItem(),s)}dropItems(t){let e=t.$destinationIndexPath();if(!e)return;let i=t.$items(),s=i.$count();for(let n=0;n<s;n++){let s=i.$objectAtIndex(n),r=this.createUICollectionViewDropPlaceholder(e),a=t.$dropItem_toPlaceholder(s.$dragItem(),r),o=a.$dragItem().$itemProvider(),l=o.$registeredTypeIdentifiers().jsValue(),h=o.$hasItemConformingToTypeIdentifier(\"public.text\");if(!h&&!hasImage)return;let c=(t,e)=>{e&&($ui.alert(e.jsValue()),this.kernel.logger.error(e.jsValue())),a.$commitInsertionWithDataSourceUpdates($block(\"void, NSIndexPath *\",e=>{let i;e=e.jsValue();let s=e.section,n=this.data.getActionCategories(),r=JSON.parse(t.jsValue().string),a=this.data.importAction(r,n[s]),o=this.data.actions[s].items;for(let t in o)if(o[t].dir===a){i=t;break}void 0!==i&&this.data.move($indexPath(s,i),e),this.data.applySnapshotToSectionAnimatingDifferences(s)}))};o.$loadDataRepresentationForTypeIdentifier_completionHandler(l[0],$block(\"void, NSData *, NSError *\",(t,e)=>{$delay(0,()=>c(t,e))}))}}dropDelegate(){return $delegate({type:\"UICollectionViewDropDelegate\",events:{\"collectionView:canHandleDropSession:\":(t,e)=>!t.$isEditing(),\"collectionView:dropSessionDidUpdate:withDestinationIndexPath:\":(t,e,i)=>{let s=$objc(\"UICollectionViewDropProposal\").$alloc();return e.$localDragSession()?s.$initWithDropOperation_intent(3,1):s.$initWithDropOperation_intent(2,1),s},\"collectionView:performDropWithCoordinator:\":(t,e)=>{let i=e.$session();i.$localDragSession()?this.reorder(e):this.dropItems(e)}}})}setDelegate(){this.collectionView=this.data.collectionView,this.collectionView.$setDelegate(this.delegate()),this.collectionView.$setCollectionViewLayout(this.views.collectionViewFlowLayout()),this.collectionView.$setDragDelegate(this.dragDelegate()),this.collectionView.$setDropDelegate(this.dropDelegate())}}}),r(\"gYDdO\",function(t,e){/**\n * @typedef {import(\"./app-main\").AppKernel} AppKernel\n */let i=$app.info.bundleID.includes(\"taio\");class s{files=[];databases=[];actions={};/**\n     * @param {AppKernel} kernel\n     */constructor(t){this.kernel=t}deleteFiles(t){t.forEach(t=>{this.files.includes(t)||this.files.push(t)})}#F(){this.files.forEach(t=>{$file.exists(t)&&(this.kernel.logger.info(`delete file: ${t}`),$file.delete(t))})}rebuildDatabase(t,e){this.databases.push([t,e])}#q(){let t=(t,e)=>{let i=this.kernel.storage.sqlite.query(`SELECT count(*), name FROM sqlite_master WHERE type = \"table\" AND name = \"${t}\"`);if(null!==i.error)throw Error(`Code [${i.error.code}] ${i.error.domain} ${i.error.localizedDescription}`);i.result.next();let s=i.result.get(0);i.result.close(),s>0&&(this.kernel.logger.info(`copy data from old table: ${t}`),this.kernel.storage.sqlite.update(`INSERT INTO ${e} SELECT * FROM ${t}`),this.kernel.logger.info(`drop table: ${t}`),this.kernel.storage.sqlite.update(`DROP TABLE ${t}`))};this.databases.forEach(e=>{t(e[0],e[1])})}rebuildUserActions(t={}){for(let e of Object.keys(t))t[e].forEach(t=>{this.actions[e]||(this.actions[e]=[]),this.actions[e].includes(t)||this.actions[e].push(t)})}async #U(){if(0===Object.keys(this.actions).length)return;let t=\"scripts/action\",e=`${this.kernel.fileStorage.basePath}/user_action`,i=[];for(let e of Object.keys(this.actions))this.actions[e].forEach(s=>{let n;let r=`${t}/${e}/${s}/config.json`;n=$file.exists(r)?JSON.parse($file.read(`${t}/${e}/${s}/config.json`).string):__INFO__,i.push(n.name)});let s=await $ui.alert({title:$l10n(\"compatibility.rebuildUserAction.alert.title\"),message:$l10n(\"compatibility.rebuildUserAction.alert.message\")+\"\\n\"+JSON.stringify(i,null,2)+\"\\n\"+$l10n(\"compatibility.rebuildUserAction.alert.message2\"),actions:[{title:$l10n(\"OK\")},{title:$l10n(\"CANCEL\")}]});if(1!==s.index){// 重建用户动作\nfor(let i of Object.keys(this.actions))this.actions[i].forEach(s=>{$file.exists(`${e}/${i}/${s}`)&&(this.kernel.logger.info(`rebuild user action: ${i}/${s}`),$file.copy({src:`${t}/${i}/${s}/main.js`,dst:`${e}/${i}/${s}/main.js`}))});this.kernel.actions.needUpload()}}async do(){this.#F(),this.#q(),await this.#U()}}class n{version=15;userVersion=$cache.get(\"compatibility.version\")??0;/**\n     * @param {AppKernel} kernel\n     */constructor(t){this.kernel=t,this.compatibility=new s(this.kernel)}do(){// this.userVersion === 0 视为新用户\nif(this.userVersion>0&&this.userVersion<this.version){this.kernel.logger.info(`compatibility: userVersion [${this.userVersion}] lower than [${this.version}]`);for(let t=this.userVersion+1;t<=this.version;t++)this.call(t);this.compatibility.do().catch(t=>this.kernel.logger.error(t)),this.kernel.logger.info(`compatibility: userVersion [${this.userVersion}] updated to [${this.version}]`)}// 修改版本\n$cache.set(\"compatibility.version\",this.version)}call(t){if(\"function\"==typeof this[`ver${t}`])this[`ver${t}`]();else throw ReferenceError(`Version ${t} undefined`)}ver1(){this.compatibility.deleteFiles([\"scripts/action/clipboard/ClearClipboard\",\"scripts/ui/clipboard.js\",\"scripts/ui/clipboard-data.js\",\"scripts/ui/clipboard-search.js\"]),this.compatibility.rebuildDatabase(\"clipboard\",\"clips\"),this.compatibility.rebuildUserActions({uncategorized:[\"ExportAllContent\",\"DisplayClipboard\"],clipboard:[\"B23Clean\"]}),$cache.get(\"caio.keyboard.height\")&&(this.kernel.setting.set(\"keyboard.previewAndHeight\",$cache.get(\"caio.keyboard.height\")),$cache.remove(\"caio.keyboard.height\"))}ver2(){this.compatibility.deleteFiles([\"scripts/storage.js\",\"scripts/ui/clips-data.js\",\"scripts/ui/components/action-manager-data.js\"]),this.compatibility.rebuildDatabase(\"pin\",\"favorite\"),this.compatibility.rebuildUserActions({uncategorized:[\"ExportAllContent\"]})}ver3(){this.compatibility.rebuildUserActions({clipboard:[\"SendToWin\"]})}ver4(){let t=\"/storage/user_action/data.json\";if($file.exists(t)){let e=JSON.parse($file.read(t).string).date;$file.write({data:$data({string:JSON.stringify({timestamp:e})}),path:\"/storage/user_action/sync.json\"}),$file.delete(t)}}ver5(){this.compatibility.rebuildUserActions({uncategorized:[\"DisplayClipboard\"]})}ver6(){this.compatibility.rebuildUserActions({clipboard:[\"GetFromWin\"]})}ver7(){this.compatibility.rebuildUserActions({uncategorized:[\"Replace\"]})}ver8(){}ver9(){this.compatibility.rebuildUserActions({clipboard:[\"SendToWin\"]})}ver10(){let t=this.kernel.fileStorage.basePath;$file.mkdir(t),$file.exists(\"storage\")&&$file.move({src:\"storage\",dst:t}),this.compatibility.deleteFiles([\"storage\"])}ver11(){this.kernel.storage.beginTransaction();try{[\"create table temp as select uuid, text, prev, next from clips where 1=1;\",\"drop table clips;\",\"alter table temp rename to clips;\",\"create table temp as select uuid, text, prev, next from favorite where 1=1;\",\"drop table favorite;\",\"alter table temp rename to favorite;\"].forEach(t=>this.kernel.storage.sqlite.update(t)),this.kernel.storage.commit()}catch(t){throw this.kernel.storage.rollback(),this.kernel.logger.error(t),t}}ver12(){i&&this.compatibility.deleteFiles([\"shared://caio\",\"storage\"])}ver13(){this.compatibility.deleteFiles([\"setting.json\",\"dist/CAIO-en.json\",\"dist/CAIO-zh-Hans.json\",\"dist/CAIO.js\",\"assets/icon\"])}ver14(){$cache.remove(this.kernel.actions.allActionsCacheKey)}ver15(){this.compatibility.rebuildUserActions({clipboard:[\"SendToWin\",\"Tokenize\"]})}}/**\n * @param {AppKernel} kernel\n */async function r(t){if(t)try{let e=new n(t);e.do()}catch(e){throw t.logger.error(e),e}}t.exports=r}),r(\"iuWEe\",function(t,e){let i;var s=n(\"gxpqj\"),r=s.Kernel,a=s.UIKit,o=n(\"2aNLD\"),l=o.KeyboardAddins,h=o.KeyboardPinActions,c=n(\"23NnO\"),d=n(\"ilpYs\").TodayPinActions;t.exports=/**\r\n * 注入设置中的脚本类型方法\r\n * @param {AppKernel} kernel\r\n */function(t){(i=t).setting.method.checkUpdate=async t=>{let e;t.start();let s=\"scripts/libs/easy-jsbox.js\";if($file.exists(s))try{let t=await i.checkUpdate();t&&($file.write({data:$data({string:t}),path:s}),$ui.toast(\"The framework has been updated.\"))}catch{}let n=await $http.get({url:\"https://raw.githubusercontent.com/ipuppet/CAIO/master/config.json\"}),a=n.data?.info.version;try{e=__INFO__}catch{e=JSON.parse($file.read(\"config.json\").string).info}r.versionCompare(a,e.version)>0?$ui.alert({title:\"New Version\",message:`New version found: ${a}\nUpdate via Github or click the button to open Erots.`,actions:[{title:$l10n(\"CANCEL\")},{title:\"Erots\",handler:()=>{$addin.run({name:\"Erots\",query:{q:\"show\",objectId:\"603e6eaaca0dd64fcef93e2d\"}})}}]}):$ui.toast(\"No need to update\"),t.done()},i.setting.method.previewWidget=()=>{let t={};try{JSON.parse($file.read(\"widget-options.json\").string).forEach(e=>{t[e.name]=e.value})}catch(t){$ui.error(t);return}$ui.menu({items:Object.keys(t),handler:e=>{let{Widget:i}=n(\"gD12U\");i.render(t[e])}})},i.setting.method.fileManager=()=>{i.fileManager.push(i.fileStorage.basePath)},function(){i.setting.method.exportClipboard=t=>{t.start(),i.storage.export(e=>{e?t.done():t.cancel()})},i.setting.method.importClipboard=t=>{t.start(),$ui.alert({title:$l10n(\"ALERT_INFO\"),message:$l10n(\"OVERWRITE_ALERT\"),actions:[{title:$l10n(\"OK\"),handler:()=>{$drive.open({handler:e=>{if(void 0===e){t.cancel();return}\"db\"===e.fileName.slice(-2)||\"zip\"===e.fileName.slice(-3)?i.storage.import(e).then(()=>{t.done(),$delay(.3,()=>{$addin.restart()})}).catch(e=>{$ui.error(e),i.logger.error(e),t.cancel()}):($ui.warning($l10n(\"FILE_TYPE_ERROR\")),t.cancel())}})}},{title:$l10n(\"CANCEL\"),handler:()=>t.cancel()}]})},i.setting.method.rebuildDatabase=t=>{t.start();let e=()=>{try{i.storage.rebuild(),t.done(),$delay(.8,()=>$addin.restart())}catch(e){t.cancel(),$ui.alert(e)}};$ui.alert({title:$l10n(\"REBUILD_DATABASE_ALERT\"),actions:[{title:$l10n(\"REBUILD\"),style:$alertActionType.destructive,handler:()=>{e()}},{title:$l10n(\"CANCEL\"),handler:()=>{t.cancel()}}]})},i.setting.method.deleteAllData=t=>{t.start(),$ui.alert({title:$l10n(\"DELETE_ALL_DATA_ALERT\"),actions:[{title:$l10n(\"DELETE\"),style:$alertActionType.destructive,handler:()=>{i.storage.deleteAllData(),t.done(),$delay(.5,()=>$addin.restart())}},{title:$l10n(\"CANCEL\"),handler:()=>{t.cancel()}}]})};let t=$text.uuid,e=()=>i.clips.getRecycleBin().map(t=>t?.text??\"None\");i.setting.method.recycleBin=()=>{let s={type:\"list\",props:{id:t,data:e(),actions:[{title:\"delete\",handler:(t,e)=>{i.clips.removeFromRecycleBin(e.row)}}]},events:{didSelect:(t,e)=>{let s=i.clips.getRecycleBin(),n=s[e.row]??{};if(n.text){let s=i.clips.addItem(n.text);n.tag&&i.storage.setTag(s.uuid,n.tag),i.clips.removeFromRecycleBin(e.row),i.clips.updateList(!0),t.delete(e)}}},layout:$layout.fill};return s},i.setting.method.recycleBinNavButtons=()=>[{symbol:\"trash\",tapped:()=>{a.deleteConfirm($l10n(\"DELETE_TABLE\").replace(\"${table}\",$l10n(\"RECYCLE_BIN\")),()=>{i.clips.clearRecycleBin(),$(t).data=e()})}}]}(),i.setting.method.exportAction=t=>{t.start();// 备份动作\nlet e=\"actions.zip\",s=`/${e}`,n=i.fileStorage.filePath(s);$archiver.zip({directory:i.actions.userActionPath,dest:n,handler:()=>{$share.sheet({items:[{name:e,data:$data({path:n})}],handler:e=>{e?t.done():t.cancel(),i.fileStorage.delete(s)}})}})},i.setting.method.importAction=t=>{t.start(),$drive.open({handler:e=>{if(void 0===e){t.cancel();return}if(\"zip\"===e.fileName.slice(-3)){let s=`${i.fileStorage.basePath}/action_import`;$archiver.unzip({file:e,dest:s,handler:()=>{$file.list(s).forEach(t=>{$file.isDirectory(`${s}/${t}`)&&$file.copy({src:`${s}/${t}`,dst:`${i.actions.userActionPath}/${t}`})}),$file.delete(s),t.done()}})}else $ui.warning($l10n(\"FILE_TYPE_ERROR\")),t.cancel()}})},i.setting.method.importExampleAction=t=>{t.start(),i.actions.importExampleAction(),t.done()},i.setting.method.rebuildAction=t=>{t.start(),$ui.alert({title:$l10n(\"REBUILD_ACTION_DATABASE_ALERT_TITLE\"),message:$l10n(\"REBUILD_ACTION_DATABASE_ALERT_MESSAGE\"),actions:[{title:$l10n(\"REBUILD\"),style:$alertActionType.destructive,handler:()=>{$file.delete(i.actions.userActionPath),i.actions.needUpload(),t.done(),$delay(.8,()=>$addin.restart())}},{title:$l10n(\"CANCEL\"),handler:()=>t.cancel()}]})},i.setting.method.editCategory=()=>c.sheet(i),function(){let t=n(\"7eNYp\");i.setting.method.previewKeyboard=()=>{let e=new t(i),s=t=>{e.setKeyboardHeight(t),$(e.keyboardId).updateLayout(t=>{t.height.equalTo(e.keyboardHeight)}),1===e.keyboardDisplayMode&&$(e.keyboardId).get(e.views.listId).reload()},n=t=>(t-200)/200;return{views:[{type:\"label\",layout:(t,e)=>{t.top.inset(20),t.centerX.equalTo(e.super)},events:{ready:t=>t.text=e.keyboardHeight,tapped:t=>{$input.text({type:$kbType.number,text:e.keyboardHeight,handler:e=>{if(/^[0-9]+$/.test(e)){let i=Number(e);i=Math.max(i=Math.min(i,400),200),t.text=i,t.next.value=n(i),s(i)}else $ui.toast(\"Only integers can be entered.\")}})}}},{type:\"slider\",props:{max:1,min:0},layout:(t,e)=>{t.top.equalTo(e.prev.bottom),t.right.inset(20),t.width.equalTo(e.super).offset(-40)},events:{ready:t=>t.value=n(e.keyboardHeight),changed:t=>{let e=Math.floor(200*t.value+200);t.prev.text=e,s(e)}}},e.getView()],layout:(t,e)=>{t.left.right.bottom.equalTo(e.super.safeArea);let s=0;1===i.setting.get(\"mainUIDisplayMode\")&&(s=a.NavigationBarNormalHeight),t.top.equalTo(e.super.safeArea).inset(s)}}},i.setting.method.setKeyboardQuickStart=()=>{let t=new l;t.sheet()},i.setting.method.keyboardPinAction=()=>{h.shared.setKernel(i).sheet()}}(),i.setting.method.previewTodayWidget=t=>{let e=n(\"49je6\"),s=new e(i).getView();a.push({views:[s]})},i.setting.method.setTodayWidgetActions=t=>{d.shared.setKernel(i).sheet()}}}),r(\"23NnO\",function(t,e){var i=n(\"gxpqj\").Sheet;/**\r\n * @typedef {import(\"../../app-main\").AppKernel} AppKernel\r\n */class s{/**\r\n     * @param {AppKernel} kernel\r\n     */constructor(t){this.kernel=t,this.listId=\"action-category-list\"}getNavButtons(){return[{symbol:\"plus\",tapped:()=>this.kernel.actions.addActionCategory()}]}getActionCategories(){let t=this.kernel.actions.defaultCategories();return this.kernel.actions.getActionCategories().filter(e=>0>t.indexOf(e))}getListView(){return{type:\"list\",props:{id:this.listId,reorder:!1,data:this.getActionCategories(),actions:[{title:\" \"+$l10n(\"DELETE\")+\" \",color:$color(\"red\"),handler:async(t,e)=>{let i=await this.kernel.actions.deleteActionCategory(t.object(e));i&&t.delete(e)}}]},events:{didSelect:async(t,e,i)=>{let s=await this.kernel.actions.renameActionCategory(i);s&&(t.data=this.getActionCategories())}},layout:$layout.fill}}static async sheet(t){let e=new i,n=new s(t);e.setView(n.getListView()).addNavBar({title:$l10n(\"EDIT_CATEGORY\"),popButton:{title:$l10n(\"DONE\")},rightButtons:n.getNavButtons()}),e.init().present()}}t.exports=s}),r(\"7eNYp\",function(t,e){var i=n(\"eSp9Z\");i.ActionData;var s=i.ActionEnv,r=n(\"gxpqj\"),a=r.UIKit,o=r.Sheet,l=r.BarButtonItem,h=n(\"4c0o0\"),c=n(\"2aNLD\"),d=c.KeyboardAddins,u=c.KeyboardPinActions;/**\n * @typedef {import(\"../app-lite\").AppKernel} AppKernel\n */class p extends h{static ReturnKeyType={UIReturnKeyDefault:0,UIReturnKeyGo:1,UIReturnKeyGoogle:2,UIReturnKeyJoin:3,UIReturnKeyNext:4,UIReturnKeyRoute:5,UIReturnKeySearch:6,UIReturnKeySend:7,UIReturnKeyYahoo:8,UIReturnKeyDone:9,UIReturnKeyEmergencyCall:10,UIReturnKeyContinue:11,UIReturnKeyJoining:12,UIReturnKeyRouteContinue:13};#H;keyboardId=\"keyboard.main\";actionsId=\"keyboard-list-actions\";keyboardSwitchLockId=\"keyboard-switch-lock\";keyboardSwitchLockKey=\"caio.keyboard.switch.lock\";keyboardReturnButton=\"keyboard-return-button\";deleteTimer=void 0;continuousDeleteTimer=void 0;continuousDeleteTapticTimer=void 0;continuousDeleteDelay=.5;navHeight=50;keyboardFrameHeight=this.keyboardHeight;get isFullScreenIpad(){return!!$device.isIpad&&(this.isFullScreenIpadCacheTimer?.cancel(),this.isFullScreenIpadCacheTimer=$delay(.1,()=>{$cache.get(\"keyboard.isFullScreenIpad\")!==!a.isSplitScreenMode&&this.kernel.KeyboardRenderWithViewFunc(()=>this.getView()),$cache.set(\"keyboard.isFullScreenIpad\",!a.isSplitScreenMode)}),$cache.get(\"keyboard.isFullScreenIpad\")??!a.isSplitScreenMode)}get bottomBarHeight(){return this.isFullScreenIpad?90:50}get bottomButtonSize(){return $device.isIpad?this.isFullScreenIpad?{width:69,height:66}:{width:32,height:40}:{width:46,height:40}}get bottomButtonFontSize(){return this.isFullScreenIpad?20:16}get bottomButtonIconSize(){return this.isFullScreenIpad?26:16}get bottomButtonEdges(){return this.isFullScreenIpad?8:4}itemBackground=$color(\"#FFFFFF\",$rgba(151,151,151,.4));buttonBackground=$color($rgba(0,0,0,.15),$rgba(117,117,117,.4))// 系统键盘按钮配色\n;/**\n     * @param {AppKernel} kernel\n     */constructor(t){super(t),this.keyboardDisplayMode=this.kernel.setting.get(\"keyboard.displayMode\"),this.backgroundImage=this.kernel.setting.get(\"keyboard.background.image\")?.image,// 仅在有背景图时使用\nthis.useBlur=this.backgroundImage&&this.kernel.setting.get(\"keyboard.blur\"),this.deleteDelay=this.kernel.setting.get(\"keyboard.deleteDelay\"),\"boolean\"!=typeof $cache.get(this.keyboardSwitchLockKey)&&$cache.set(this.keyboardSwitchLockKey,!1),this.views.listId+=\"keyboard\",this.views.scrollToOffsetDirectionX=this.keyboardDisplayMode,this.views.tabLeftMargin=10,this.views.horizontalMargin=15// 列表边距\n,this.views.verticalMargin=12// 列表边距\n,this.views.copiedIndicatorSize=5// 已复制指示器（小绿点）大小\n,this.views.containerMargin=this.isFullScreenIpad?12:4,this.views.fontSize=this.kernel.setting.get(\"keyboard.fontSize\")// 字体大小\n,this.views.tagHeight=this.views.verticalMargin+3,this.delegates.menuItemActionMaxCount=3,this.matrixBoxMargin=this.isFullScreenIpad?12:8,this.cornerRadius=this.isFullScreenIpad?8:5}get returnKeyLabel(){let t;let e=$ui.controller.ocValue().$textDocumentProxy().$returnKeyType();switch(e){case p.ReturnKeyType.UIReturnKeyDefault:t=\"Return\";break;case p.ReturnKeyType.UIReturnKeyGo:t=\"Go\";break;case p.ReturnKeyType.UIReturnKeyGoogle:t=\"Google\";break;case p.ReturnKeyType.UIReturnKeyJoin:t=\"Join\";break;case p.ReturnKeyType.UIReturnKeyNext:t=\"Next\";break;case p.ReturnKeyType.UIReturnKeyRoute:t=\"Route\";break;case p.ReturnKeyType.UIReturnKeySearch:t=\"Search\";break;case p.ReturnKeyType.UIReturnKeySend:t=\"Send\";break;case p.ReturnKeyType.UIReturnKeyYahoo:t=\"Yahoo\";break;case p.ReturnKeyType.UIReturnKeyDone:t=\"Done\";break;case p.ReturnKeyType.UIReturnKeyEmergencyCall:t=\"Emergency Call\";break;case p.ReturnKeyType.UIReturnKeyContinue:t=\"Continue\";break;case p.ReturnKeyType.UIReturnKeyJoining:t=\"Joining\";break;case p.ReturnKeyType.UIReturnKeyRouteContinue:t=\"Route Continue\";break;default:t=\"Return\"}return $cache.set(\"keyboard.returnKeyLabel\",$l10n(t)),$l10n(t)}get returnKeyLabelCache(){return $cache.get(\"keyboard.returnKeyLabel\")??this.returnKeyLabel}get keyboardHeight(){return this.kernel.setting.get(\"keyboard.previewAndHeight\")}get menu(){let t=this.delegates.menu.items;return{items:[t[0],t[2]]}}setKeyboardHeight(t){this.kernel.setting.set(\"keyboard.previewAndHeight\",t)}/**\n     *\n     * @returns {boolean} true: lock, false: unlock\n     */getKeyboardSwitchLock(){let t=$cache.get(this.keyboardSwitchLockKey);return\"boolean\"!=typeof t&&$cache.set(this.keyboardSwitchLockKey,!0),t}switchKeyboardSwitchLock(){let t=$cache.get(this.keyboardSwitchLockKey);$cache.set(this.keyboardSwitchLockKey,!t),$(this.keyboardSwitchLockId).get(\"image\").symbol=t?\"lock.open\":\"lock\"}listReady(){if(0===this.keyboardDisplayMode)this.setDelegate();else{let t=$delegate({type:\"UICollectionViewDragDelegate\",events:{\"collectionView:itemsForBeginningDragSession:atIndexPath:\":(t,e,i)=>this.delegates.itemsForBeginningDragSession(e,i)}}),e=$(this.views.listId).ocValue();e.$setDragDelegate(t)}this.updateList(),this.kernel.setting.get(\"clipboard.autoSave\")&&$app.env===$env.keyboard&&(this.readClipboard()// 防止延时\n,this.#H=$timer.schedule({interval:1,handler:()=>{if(!this.kernel.setting.get(\"clipboard.autoSave\")){this.#H.invalidate();return}this.readClipboard()}}))}keyboardTapped(t,e=!0){return async(...i)=>{if(e&&this.kernel.setting.get(\"keyboard.tapticEngine\")&&$device.taptic(this.kernel.setting.get(\"keyboard.tapticEngineLevel\")),\"function\"==typeof t)try{await t(...i)}catch(t){throw this.kernel.logger.error(t),t}}}getKeyboardActionData(){return{env:s.keyboard,text:()=>($keyboard.textBeforeInput??\"\")+(($keyboard.selectedText??\"\")+($keyboard.textAfterInput??\"\")),textBeforeInput:()=>$keyboard.textBeforeInput,selectedText:()=>$keyboard.selectedText,textAfterInput:()=>$keyboard.textAfterInput}}getTopButtonsView(){let t=[{// 关闭键盘\nsymbol:\"keyboard.chevron.compact.down\",tapped:this.keyboardTapped(()=>$keyboard.dismiss())},{// 手动读取剪切板\nsymbol:\"square.and.arrow.down.on.square\",tapped:this.keyboardTapped(async t=>{t.start();try{await this.readClipboard(!0),t.done()}catch(e){throw t.cancel(),e}})}];return t.push({// Action\nsymbol:\"bolt.circle\",tapped:this.keyboardTapped(()=>{let t=!0===$(this.actionsId).hidden;$(this.views.listId).hidden=t,$(this.actionsId).hidden=!t})}),u.shared.setKernel(this.kernel).getActions().forEach(e=>{let i=e?.icon?.slice(0,5)===\"icon_\"?$icon(e.icon.slice(5,e.icon.indexOf(\".\")),a.textColor).ocValue().$image().jsValue():$image(e?.icon);t.push({symbol:i,tapped:this.keyboardTapped(async()=>{let t=this.kernel.actions.getActionHandler(e.category,e.dir);t(this.getKeyboardActionData())})})}),{type:\"view\",views:t.map(t=>{let e=new l;return e.buttonEdges=0,e.setAlign(a.align.right).setSymbol(t.symbol).setEvent(\"tapped\",t.tapped).definition}),layout:(e,i)=>{let s=new l;e.height.equalTo(i.super),e.right.inset(-s.edges),e.width.equalTo(s.width*t.length+s.edges)}}}getTopBarView(){return{// 顶部按钮栏\ntype:\"view\",views:[{type:\"view\",layout:$layout.fill,views:[{type:\"image\",props:{image:$image(\"assets/icon.png\",\"assets/icon.white.png\")},events:{tapped:()=>this.kernel.openInJsbox(),ready:t=>{let e=$cache.get(\"tips.keyboard.title\");e||($cache.set(\"tips.keyboard.title\",!0),$ui.popover({sourceView:t,size:$size(200,60),directions:$popoverDirection.up,views:[{type:\"label\",props:{lines:0,text:$l10n(\"CLICK_TO_OPEN_JSBOX\"),align:$align.center},layout:$layout.fillSafeArea}]}))}},layout:(t,e)=>{t.centerY.equalTo(e.super),t.left.inset(-2)// 图片自身的白边\n,t.size.equalTo($size(28,28))}}].concat(super.getTabView(),this.getTopButtonsView())}],layout:(t,e)=>{t.top.equalTo(e.super),t.left.equalTo(e.super.safeArea).offset(this.views.containerMargin),t.right.equalTo(e.super.safeArea).offset(-this.views.containerMargin),t.height.equalTo(this.navHeight)}}}/**\n     * 底部按钮\n     * @param {*} button\n     * @param {*} align\n     * @returns\n     */#z(t,e){let i=this.bottomButtonSize,s=this.bottomButtonEdges,n=this.isFullScreenIpad?8:5// 按钮图标边距\n,r=(n,r)=>{if(t.title){let e=$text.sizeThatFits({text:t.title,width:a.windowSize.width,font:$font(this.bottomButtonFontSize)}),r=Math.ceil(e.width)+(s+12)*2// 文本按钮增加内边距\n;this.isFullScreenIpad&&(r=Math.max(1.5*i.height,r)),n.size.equalTo($size(r,i.height))}else n.size.equalTo(i);n.centerY.equalTo(r.super),r.prev&&r.prev.info.align===e?e===a.align.right?n.right.equalTo(r.prev.left).offset(-(1.5*s)):n.left.equalTo(r.prev.right).offset(1.5*s):e===a.align.right?n.right.inset(0):n.left.inset(0)},o={type:\"button\",props:Object.assign({smoothCorners:!1,cornerRadius:this.cornerRadius,id:t.id??$text.uuid,bgcolor:this.useBlur?$color(\"clear\"):this.buttonBackground,info:{align:e}},t.menu?{menu:t.menu}:{}),views:[{type:\"image\",props:{symbol:t.symbol,tintColor:a.textColor},layout:(t,i)=>{t.size.greaterThanOrEqualTo(this.bottomButtonIconSize),this.isFullScreenIpad?(t.bottom.inset(n),e===a.align.right?t.right.inset(n):t.left.inset(n)):t.center.equalTo(i.super)}},{type:\"label\",props:{text:t.title,font:$font(this.bottomButtonFontSize),color:a.textColor},layout:(t,i)=>{this.isFullScreenIpad?(t.bottom.inset(n),e===a.align.right?t.right.inset(n):t.left.inset(n)):t.center.equalTo(i.super)}}],events:Object.assign({},t.tapped?{tapped:t.tapped}:{},t.events),layout:$layout.fill};return this.useBlur?a.blurBox({info:{align:e},style:$blurStyle.ultraThinMaterial,smoothCorners:!1,cornerRadius:this.cornerRadius},[o],r):{type:\"view\",props:{info:{align:e}},views:[o],layout:r}}getBottomButtonsView(){let t=[],e=[],i=$cache.get(\"keyboard.needsInputModeSwitchKey\");void 0===i&&(i=$ui.controller.ocValue().$needsInputModeSwitchKey(),$cache.set(\"keyboard.needsInputModeSwitchKey\",i)),i&&t.push({symbol:\"globe\",events:{ready:t=>{let e=t.ocValue();e.$addTarget_action_forControlEvents($ui.controller.ocValue(),\"handleInputModeListFromView:withEvent:\",$UIEvent.allTouchEvents)}}}),this.kernel.setting.get(\"keyboard.switchAfterInsert\")&&t.push({symbol:this.getKeyboardSwitchLock()?\"lock\":\"lock.open\",id:this.keyboardSwitchLockId,tapped:this.keyboardTapped(()=>this.switchKeyboardSwitchLock())}),t.push({symbol:\"paperplane\",menu:{pullDown:!0,asPrimary:!0,items:d.getAddins().reverse().map(t=>({title:t,handler:this.keyboardTapped(()=>$addin.run(t))}))}}),e.push({title:this.returnKeyLabelCache,id:this.keyboardReturnButton,tapped:this.keyboardTapped(()=>$keyboard.send()),events:{ready:async()=>{await $wait(.2);let t=this.returnKeyLabel,e=this.#z({title:t},a.align.right).layout;$ui.animate({duration:.2,animation:()=>{$(this.keyboardReturnButton).super.updateLayout(e),$(this.keyboardReturnButton).super.relayout()},completion:()=>{$(this.keyboardReturnButton).get(\"label\").text=t}})}}},{symbol:\"delete.left\",events:{touchesBegan:this.keyboardTapped(async()=>{$keyboard.delete(),this.continuousDeleteTapticTimer=$delay(this.continuousDeleteDelay,()=>this.keyboardTapped()()),this.continuousDeleteTimer=$delay(this.continuousDeleteDelay,()=>{this.deleteTimer=$timer.schedule({interval:this.deleteDelay,handler:()=>$keyboard.delete()})})}),touchesEnded:()=>{this.deleteTimer?.invalidate(),this.continuousDeleteTimer?.cancel(),this.continuousDeleteTapticTimer?.cancel(),this.deleteTimer=void 0,this.continuousDeleteTimer=void 0}}});let s={type:\"button\",props:{smoothCorners:!1,cornerRadius:5,title:$l10n(\"SPACE\"),font:$font(16),bgcolor:this.itemBackground,titleColor:a.textColor},events:{tapped:this.keyboardTapped(()=>{$keyboard.insert(\" \")})},layout:(t,i)=>{let s=i.prev;for(let t=0;t<e.length;t++)s=s.prev;t.height.top.equalTo(i.prev),t.left.equalTo(s.right).offset(1.5*this.bottomButtonEdges),t.right.equalTo(i.prev.left).offset(-(1.5*this.bottomButtonEdges))// 右侧按钮是倒序的\n}};return[...t.map(t=>this.#z(t,a.align.left)),...e.map(t=>this.#z(t,a.align.right)),s]}getBottomBarView(){return{type:\"view\",views:this.getBottomButtonsView(),layout:(t,e)=>{t.bottom.equalTo(e.super.safeArea),t.left.equalTo(e.super.safeArea).offset(this.views.containerMargin),t.right.equalTo(e.super.safeArea).offset(-this.views.containerMargin),t.height.equalTo(this.bottomBarHeight)}}}itemContainer(t){return this.useBlur?a.blurBox({style:$blurStyle.ultraThinMaterial},t,$layout.fill):{type:\"view\",props:{bgcolor:this.itemBackground},views:t,layout:$layout.fill}}get matrixTemplate(){return{props:{smoothCorners:!0,cornerRadius:10},views:[this.itemContainer([{type:\"view\",props:{id:\"copied\",circular:this.views.copiedIndicatorSize,hidden:!0,bgcolor:$color(\"green\")},layout:(t,e)=>{t.size.equalTo(this.views.copiedIndicatorSize),// 放在前面小缝隙的中间 `this.copyedIndicatorSize / 2` 指大小的一半\nt.left.top.inset(this.matrixBoxMargin/2)}},{type:\"label\",props:{id:\"content\",lines:0,font:$font(this.views.fontSize)},layout:(t,e)=>{t.top.left.right.equalTo(e.super).inset(this.matrixBoxMargin),t.height.lessThanOrEqualTo(e.super).offset(-(2*this.matrixBoxMargin)-this.views.tagHeight)}},{type:\"label\",props:{id:\"tag\",lines:1,color:this.tagColor,autoFontSize:!0,align:$align.leading},layout:(t,e)=>{t.left.right.equalTo(e.prev),t.height.equalTo(this.views.tagHeight),t.bottom.equalTo(e.super).inset(this.matrixBoxMargin)}}]),{type:\"image\",props:{id:\"image\",hidden:!0},layout:$layout.fill}]}}get itemSelect(){return(t,e)=>{let i=this.clips[e.row];i.image?o.quickLookImage(i.imageOriginal):($keyboard.insert(i.text),this.kernel.setting.get(\"keyboard.switchAfterInsert\")&&!this.getKeyboardSwitchLock()&&$keyboard.next())}}getMatrixView(){let t={type:\"matrix\",props:{id:this.views.listId,bgcolor:$color(\"clear\"),menu:this.delegates.menu,direction:$scrollDirection.horizontal,alwaysBounceVertical:!1,alwaysBounceHorizontal:!0,showsHorizontalIndicator:!1,columns:1,spacing:this.matrixBoxMargin,template:this.matrixTemplate,backgroundView:$ui.create(this.views.getEmptyBackground())},layout:(t,e)=>{t.top.inset(0),t.width.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom).offset(-1*(this.bottomBarHeight-this.navHeight))},events:{ready:()=>this.listReady(),didSelect:this.itemSelect,itemSize:(t,e)=>{let i=this.keyboardFrameHeight-this.navHeight-this.bottomBarHeight;return i-=2*this.matrixBoxMargin,this.itemSize[e.item]=i,$size(i,i)},layoutSubviews:t=>{let e=this.navHeight+this.bottomBarHeight+this.matrixBoxMargin,i=2*e-this.matrixBoxMargin+1,s=Math.max(t.frame.height,i);this.keyboardFrameHeight!==s&&(this.keyboardFrameHeight=s,t.reload())}}};return t}getListView(){let t=super.getListView();t.layout=(t,e)=>{t.top.equalTo(this.navHeight-1)// list height 高度为 1\n,t.width.equalTo(e.super),t.bottom.equalTo(e.super.safeAreaBottom).offset(-this.bottomBarHeight-this.views.containerMargin)},this.delegates.didSelectRowAtIndexPath=(t,e)=>{t=t.jsValue(),e=e.jsValue(),this.itemSelect(t,e)},this.delegates.shouldBeginMultipleSelectionInteractionAtIndexPath=()=>!1,t.props.separatorColor=$color(\"lightGray\"),t.props.separatorInset=$insets(0,this.views.horizontalMargin,0,this.views.horizontalMargin),delete t.events.pulled,t.props.header={props:{height:1}},t.props.style=2;let e=t.props.template.views[0].views;return t.props.template.views[0]=this.itemContainer(e),t}getDataView(){return 0===this.keyboardDisplayMode?this.getListView():this.getMatrixView()}getActionView(){return{type:\"view\",props:{id:this.actionsId,hidden:!0},views:[this.kernel.actions.views.getActionMiniView(()=>this.getKeyboardActionData(),(()=>{let t=u.shared.getActions().map(t=>t.dir+t.category),e=[];return this.kernel.actions.actions.forEach(i=>{e=this.kernel.setting.get(\"keyboard.excludePin\")?e.concat(i.items.filter(e=>!t.includes(e.dir+e.category))):e.concat(i.items)}),e})())],layout:(t,e)=>{t.top.equalTo(this.navHeight),t.left.equalTo(this.views.containerMargin),t.right.equalTo(-this.views.containerMargin),t.bottom.equalTo(-this.bottomBarHeight)}}}getView(){let t={type:\"view\",views:[{type:\"image\",props:{image:this.backgroundImage},layout:$layout.fill},{// 深色模式降低亮度\ntype:\"view\",props:{bgcolor:$color(\"clear\",$rgba(0,0,0,.3))},layout:$layout.fill}],layout:$layout.fill};return{type:\"view\",props:{id:this.keyboardId},views:[this.backgroundImage?t:{},this.getDataView(),this.getTopBarView(),this.getBottomBarView(),this.getActionView()],layout:(t,e)=>{t.width.bottom.equalTo(e.super),t.height.equalTo(this.keyboardHeight)}}}}t.exports=p}),r(\"49je6\",function(t,e){var i=n(\"eSp9Z\");i.ActionData;var s=i.ActionEnv,r=n(\"gxpqj\"),a=r.View,o=r.UIKit,l=r.BarButtonItem,h=n(\"4c0o0\"),c=n(\"ilpYs\").TodayPinActions;/**\n * @typedef {import(\"../app-lite\").AppKernel} AppKernel\n */class d extends h{actionsId=\"today-list-actions\";listContainerId=\"today-list-container\";readClipboardButtonId=\"today-nav-readClipboard\";pageIndexId=\"today-list-page-index\";// 剪贴板列个性化设置\nnavHeight=34;taptic=1;inLauncher=$app.env===$env.today&&-1===$app.widgetIndex;launcherNavHeight=44;/**\n     * @param {AppKernel} kernel\n     */constructor(t){super(t),this.tabItems.push($l10n(\"ACTIONS\")),this.todayPinActions=new c(this.kernel),// 剪切板分页显示\nthis.setClipboarPageSize($widget.mode),this.listPageNow=[0,0]// 剪切板当前页，索引为 Section\n,this.listSection=Math.min(this.tabIndex,1)// 当前选中列表，只取 0 或 1，默认 1\n,this.views.listId+=\"today\",this.views.tabLeftMargin=8,this.views.horizontalMargin=15// 列表边距\n,this.views.verticalMargin=5// 列表边距\n,this.views.copiedIndicatorSize=5// 已复制指示器（小绿点）大小\n,this.views.fontSize=14// 字体大小\n,this.views.tagHeight=12,this.views.tagColor=$color(\"gray\",\"lightGray\"),this.views.setSingleLine()}get isActionPage(){return 2===this.tabIndex}set tabIndex(t){$cache.set(\"caio.today.tab.index\",t)}get tabIndex(){return $cache.get(\"caio.today.tab.index\")??0}get menu(){let t=this.delegates.defaultMenuItems.reverse();return t[0].items=t[0].items.reverse(),{items:t}}getByIndex(t){\"object\"==typeof t&&(t=t.row);let e=this.listPageSize*this.listPageNow[this.listSection];return t+=e,this.clips[t]}listReady(){// 监听展开状态\n$widget.modeChanged=t=>{this.setClipboarPageSize(t),this.isActionPage||this.updateList()},this.setClipboarPageSize($widget.mode),this.isActionPage||this.updateList(),this.appListen(),$delay(.5,()=>this.readClipboard())}async readClipboard(t=!1){this.isActionPage||$app.env!==$env.today||await super.readClipboard(t)}setClipboarPageSize(t){if(0===t)this.listPageSize=1;else{let t=$app.env===$env.app?o.windowSize.height:$widget.height,e=t-2*this.navHeight-(this.inLauncher?this.launcherNavHeight:0),i=e/(this.views.singleLineContentHeight+this.views.verticalMargin+Math.max(this.views.tagHeight,this.views.verticalMargin)),s=Math.floor(i);this.listPageSize=s,i-s>=.6&&this.listPageSize++}}buttonTapped(t,e=!0){return async(...i)=>{e&&this.kernel.setting.get(\"keyboard.tapticEngine\")&&$device.taptic(this.taptic),await t(...i)}}switchTab(t){this.tabIndex=t,this.isActionPage?($(this.listContainerId).hidden=!0,$(this.actionsId).hidden=!1,$(this.readClipboardButtonId).hidden=!0):(this.listSection=t,$(this.actionsId).hidden=!0,$(this.listContainerId).hidden=!1,$(this.readClipboardButtonId).hidden=!1,this.updateList())}getNavBarView(){let t=[{// 手动读取剪切板\nsymbol:\"square.and.arrow.down.on.square\",props:{id:this.readClipboardButtonId,hidden:this.isActionPage},tapped:this.buttonTapped(async t=>{t.start();try{await this.readClipboard(!0),t.done()}catch(e){throw t.cancel(),e}})}].map(t=>{let e=new l;return e.setAlign(o.align.right).setSymbol(t.symbol).setEvent(\"tapped\",t.tapped).setProps(t.props??{}),e.definition});return{// 顶部按钮栏\ntype:\"view\",views:[{type:\"view\",layout:$layout.fill,views:[this.getTabView(),...t]}],layout:(t,e)=>{t.top.width.equalTo(e.super),t.height.equalTo(this.navHeight)}}}getBottomBarView(){let t=t=>{let i=t===o.align.left?\"chevron.backward.circle\":\"chevron.forward.circle\";return{type:\"button\",props:{symbol:i,bgcolor:$color(\"clear\"),tintColor:o.textColor},layout:i=>{t===o.align.left?i.left.inset(this.views.horizontalMargin):i.right.inset(this.views.horizontalMargin),i.centerY.equalTo(e.super)},events:{tapped:this.buttonTapped(()=>{t===o.align.left?this.clipboardPrevPage():this.clipboardNextPage()})}}},e={type:\"view\",views:[t(o.align.left),t(o.align.right),{type:\"label\",props:{id:this.pageIndexId,align:$align.center,text:this.listPageNow[this.listSection]+1},layout:(t,e)=>{t.bottom.left.right.equalTo(e.super.safeArea),t.center.equalTo(e.super)}}],layout:(t,e)=>{t.bottom.left.right.equalTo(e.super.safeArea),t.height.equalTo(this.navHeight)}};return e}delete(...t){super.delete(...t),this.updateList()}updateList(t=!1){t&&this.setNeedReload();let e=this.listPageNow[this.listSection]*this.listPageSize,i=e+this.listPageSize,s=this.clips;$(this.views.listId).data=s.slice(e,i).map(t=>this.views.lineData(t,this.copied.uuid===t.uuid));// page index\nlet n=this.listPageNow[this.listSection]+1,r=Math.ceil(s.length/this.listPageSize);$(this.pageIndexId).text=`${n}/${r}`}clipboardPrevPage(){this.listPageNow[this.listSection]>0&&(this.listPageNow[this.listSection]--,this.updateList())}clipboardNextPage(){let t=Math.ceil(this.clips.length/this.listPageSize);this.listPageNow[this.listSection]<t-1&&(this.listPageNow[this.listSection]++,this.updateList())}getListView(){return{type:\"view\",props:{id:this.listContainerId,hidden:this.isActionPage},views:[{// 剪切板列表\ntype:\"list\",props:{id:this.views.listId,scrollEnabled:!1,bgcolor:$color(\"clear\"),menu:this.menu,separatorInset:$insets(0,this.views.horizontalMargin,0,this.views.horizontalMargin),data:[],template:this.views.listTemplate()},events:{ready:()=>this.listReady(),rowHeight:(t,e)=>{let i=this.getByIndex(e),s=i.hasTag?this.views.tagHeight:this.views.verticalMargin,n=i.image?this.views.imageContentHeight:this.views.getContentHeight(i.text);return this.views.verticalMargin+n+s},didSelect:this.buttonTapped((t,e)=>{let i=this.getByIndex(e);i.image?$clipboard.image=i.imageOriginal:(this.setClipboardText(i.text),this.setCopied(i.uuid)),$ui.toast($l10n(\"COPIED\"))})},layout:(t,e)=>{t.top.width.equalTo(e.super),t.bottom.equalTo(e.super).offset(-this.navHeight)}},this.getBottomBarView()],layout:(t,e)=>{t.top.equalTo(this.navHeight),t.bottom.left.right.equalTo(e.super.safeArea)}}}getActionView(){let t=this.todayPinActions.getActions();return 0===t.length&&(t=Object.values(this.kernel.actions.allActions)),{type:\"view\",props:{id:this.actionsId,hidden:!this.isActionPage},views:[this.kernel.actions.views.getActionMiniView(()=>({env:s.today}),t)],layout:(t,e)=>{t.top.equalTo(this.navHeight),t.left.right.bottom.equalTo(e.super.safeArea)}}}getView(){return a.create({props:{titleColor:o.textColor,barColor:o.primaryViewBackgroundColor},views:[{type:\"view\",views:[this.getNavBarView(),this.getActionView(),this.getListView()],layout:$layout.fill}],events:{appeared:async()=>{if($app.env!==$env.today)return;let t=$timer.schedule({interval:0,handler:()=>{$ui.animate({duration:.3,animation:()=>{$ui.vc.ocValue().$view().$setBackgroundColor($color(\"clear\"))},completion:()=>{t.invalidate()}})}})}}})}}t.exports=d}),r(\"gD12U\",function(t,e){var i=n(\"8Makm\").AppKernelBase;/**\n * @typedef {AppKernel} AppKernel\n */class s extends i{constructor(){super(),this.setting.setReadonly()}get logFile(){return\"widget.log\"}get isWebdavEnabled(){// 在小组件中不启用 WebDAV\nreturn!1}}class r{static kernel=new s;static widgetInstance(t,...e){if(!$file.exists(`/scripts/widget/${t}.js`))return this.kernel.logger.error(`Widget not found: ${t}`),!1;try{let{Widget:i}=require(`./widget/${t}.js`);return this.kernel.logger.info(`Loading widget: ${t}`),new i(...e)}catch(e){this.kernel.logger.error(`Error loading widget: ${t}`),this.kernel.logger.error(e)}}static renderError(){$widget.setTimeline({render:()=>({type:\"text\",props:{text:\"Invalid argument\"}})})}static renderClips(){let t=r.widgetInstance(\"Clips\",r.kernel);t.render()}static renderFavorite(){let t=r.widgetInstance(\"Favorite\",r.kernel);t.render()}static renderActions(){let t=r.widgetInstance(\"Actions\",r.kernel);t.render()}static render(t=$widget.inputValue??\"Actions\"){switch(t){case\"Clips\":r.renderClips();break;case\"Favorite\":r.renderFavorite();break;case\"Actions\":r.renderActions();break;default:r.renderError()}}}t.exports={Widget:r,run:()=>{r.render()}}}),r(\"ljE8b\",function(t,e){var i=n(\"8Makm\").AppKernelBase;/**\n * @typedef {AppKernel} AppKernel\n */class s extends i{constructor(){super(),this.setting.setReadonly()}addOpenInJsboxButton(){this.useJsboxNav(),this.setNavButtons([{image:$image(\"assets/icon.png\"),handler:()=>this.openInJsbox()}])}}class r{/** @type {AppKernel} */kernel;constructor(t){this.kernel=t,// to display action running result\n$ui.render({views:[{type:\"label\",props:{id:\"shortcuts-root-label\",lines:0,text:\"CAIO\"},layout:$layout.center}]}),this.kernel.runActionFlag||this.checkQuery()}setClips(t){if(\"\"===t.trim())throw Error(\"cannot set empty content\");this.kernel.clips.addItem(t)}getClips(t){if(\"number\"!=typeof t)throw Error(\"`get` must be a number index\");let e=this.kernel.clips.getByIndex(t);return e.text}deleteClips(t){if(\"number\"!=typeof t)throw Error(\"`delete` must be a number index\");let e=this.kernel.clips.getByIndex(t),i=e.text;return this.kernel.clips.delete(e.uuid),i}checkQuery(){let t=$context.query.table?.trim()??\"\";if(\"\"!==t){this.kernel.clips.rememberTabIndex=!1// 不记住标签页\n;let e=this.kernel.clips.tabItemsMap;this.kernel.clips.tabIndex=e[t]??e.clips}try{void 0!==$context.query.set?(this.setClips($context.query.set),$intents.finish()):void 0!==$context.query.get?(this.getClips($context.query.get),$intents.finish(clip.text)):void 0!==$context.query.delete?(this.deleteClips($context.query.delete),$intents.finish(text)):$intents.finish(\"`get`, `set` or `delete` is required\")}catch(t){$intents.finish(t.message)}finally{$intents.finish()// 防止卡住\n}}}class a{static kernel=new s;static renderKeyboardUI(){this.kernel.addOpenInJsboxButton();let t=n(\"7eNYp\"),e=new t(this.kernel);this.kernel.KeyboardRenderWithViewFunc(()=>e.getView(),e.keyboardHeight)}static renderTodayUI(){this.kernel.addOpenInJsboxButton();let t=n(\"49je6\"),e=new t(this.kernel);this.kernel.UIRender(e.getView())}static shortcuts(){new r(this.kernel)}}t.exports={run:()=>{//AppUI.renderKeyboardUI();return\n//AppUI.renderTodayUI();return\n$app.env===$env.today||$app.env===$env.notification?a.renderTodayUI():$app.env===$env.keyboard?a.renderKeyboardUI():$app.env===$env.siri&&a.shortcuts()}}}),$app.strings={en:{AUTHOR:\"Author\",ALERT_INFO:\"Alert\",NONE:\"Nothing\",DONE:\"Done\",CLOSE:\"Close\",FAILED_TO_LOAD_VIEW:\"Faild to load view\",VIEW_NOT_PROVIDED:\"The view is not provided\",UNCATEGORIZED:\"Uncategorized\",SHARE:\"Share\",CLICK_TO_OPEN_JSBOX:\"Click the title to open the main app.\",CLIPS:\"Clips\",CLIPBOARD:\"Clipboard\",UNIVERSAL_CLIPBOARD:\"Universal Clipboard\",UNIVERSAL_CLIPBOARD_TIPS:\"Universal Clipboard allows you to copy something on your iPhone, and paste it on your Mac–or vice-versa–using iCloud.\",CLIPS_STRUCTURE_ERROR:\"Clips data structure is abnormal\",CLIPBOARD_NO_CHANGE:\"Clipboard no change\",RECYCLE_BIN:\"Recycle Bin\",ADD:\"Add\",TAG:\"Tag\",ADD_TAG:\"Add Tag\",EDIT:\"Edit\",SEARCH:\"Search\",SEARCH_HISTORY:\"Search History\",SEARCH_RESULT:\"Search Result\",NO_SEARCH_RESULT:\"No item found.\",FAVORITE:\"Favorite\",COPY:\"Copy\",COPIED:\"Copied\",SORT:\"Sort\",ACTIONS:\"Actions\",MORE_ACTIONS:\"More Actions\",PREVIEW:\"Preview\",MAX_ITEM_LENGTH:\"Line Limit\",TEXT_MAX_LENGTH:\"Display Character Length\",AUTO_SAVE:\"Auto Save\",AUTO_SYNC:\"Auto Sync\",SYNC_NOW:\"Sync Now\",UNZIP_FAILED:\"Unzip file failed\",REBUILD:\"Rebuild\",REBUILD_DATABASE:\"Rebuild Database\",REBUILD_DATABASE_ALERT:\"Rebuilding the database will lose the order information, do you want to confirm the rebuild?\",DELETE_ALL_DATA:\"Delete All Data\",DELETE_ALL_DATA_ALERT:\"Are you sure you want to delete all your data?\",DELETE_DATA:\"Delete Data\",DELETE_TABLE:\"Delete all data from `${table}`?\",SELECT_ALL:\"Select All\",DESELECT_ALL:\"Deselect All\",EDITOR:\"Editor\",CREATE_NEW:\"Create New\",CREATE_NEW_ACTION:\"New Action\",CREATE_NEW_TYPE:\"New Category\",TYPE_ALREADY_EXISTS:\"This category already exists\",EDIT_DETAILS:\"Edit Details\",EDIT_SCRIPT:\"Edit Script\",INFORMATION:\"Information\",NAME:\"Name\",ICON:\"Icon\",CATEGORY:\"Category\",EDIT_CATEGORY:\"Edit Category\",\"delete.category\":\"Delete Category ${category}\",\"delete.category.keep.actions\":\"Do you keep the actions in this category?\",DESCRIPTION:\"Description\",CODE:\"Code\",TEXT_INSETS:\"Text bottom margin\",SHOW_LINE_NUMBER:\"Show line number\",LIGHT_MODE_THEME:\"Light Mode Theme\",DARK_MODE_THEME:\"Dark Mode Theme\",SAVE:\"Save\",SAVE_SUCCESS:\"Save success\",SAVE_ERROR:\"Save failed\",DELETE:\"Delete\",CONFIRM:\"Confirm\",DELETE_CONFIRM_MSG:\"Are you sure you want to delete?\",DELETE_SUCCESS:\"Delete success\",DELETE_ERROR:\"Delete failed\",IMPORT_EXAMPLE_ACTIONS:\"Import example actions\",REBUILD_ACTION_DATABASE:\"Rebuild Action Database\",REBUILD_ACTION_DATABASE_ALERT_TITLE:\"Are you sure you want to rebuild?\",REBUILD_ACTION_DATABASE_ALERT_MESSAGE:\"Rebuild also deletes the data saved in WebDAV Drive! (If enabled)\",EXPORT:\"Export\",IMPORT:\"Import\",FILE_TYPE_ERROR:\"File type does not match\",OVERWRITE_ALERT:\"This operation will overwrite the current data. Do you want to continue?\",UNABLE_CREATE_ACTION:\"Unable to create action\",ACTION_NAME_ALREADY_EXISTS:\"Action `${name}` already exists\",IMPORT_FROM_FILE:\"Import from Files\",DEIT_CATEGORY:\"Edit Category\",KEYBOARD:\"Keyboard\",KEYBOARD_HEIGHT:\"Keyboard Height\",USE_BLUR:\"Use Blur\",BACKGROUND_IMAGE:\"Background Image\",DELETE_DELAY:\"Delete Delay\",SWITCH_AFTER_INSERT:\"Switch After Insert\",JSBOX_TOOLBAR:\"JSBox Toolbar\",QUICK_START_SCRIPTS:\"Quick Start Scripts\",SEND:\"Send\",OPEN_IN_JSBOX:\"Open in JSBox\",SWITCH_KEYBOARD:\"Switch Keyboard\",TAPTIC_ENGINE:\"Taptic Engine\",TAPTIC_ENGINE_LEVEL:\"Taptic Engine Level\",TAPTIC_ENGINE_FOR_DELETE:\"Taptic Engine For Delete\",SPACE:\"Space\",ALL_SCRIPTS:\"All Scripts\",SELECT_SCRIPTS:\"Select Scripts\",FONT_SIZE:\"Font Size\",LIST:\"List\",MATRIX:\"Matrix\",PIN_ACTION:\"Pin Action\",\"keyboard.excludePin\":\"Exclude Pinned from List\",CHECK_UPDATE:\"Check Update\",UPDATE:\"Update\",WIDGET:\"Widget\",RECENT:\"Recent\",CLICK_ACTION:\"Click Action\",TODAY_WIDGET:\"Today Widget\",PREV_PAGE:\"Prev\",NEXT_PAGE:\"Next\",DISPLAY_MODE:\"Display Mode\",CLASSIC:\"Classic\",MODERN:\"Modern\",FILE_MANAGEMENT:\"File Management\",\"compatibility.rebuildUserAction.alert.title\":\"We need to rebuild some of the action!\",\"compatibility.rebuildUserAction.alert.message\":\"If you tap the OK button, the following actions will be rebuilt:\",\"compatibility.rebuildUserAction.alert.message2\":\"Only the action logic will be changed, and the name and icon will remain as it is.\",EXPERIMENTAL:\"Experimental\",SYNC_ACTIONS:\"Sync Actions\",SYNCING:\"Syncing...\",LAST_SYNC_AT:\"Last sync at: \",MODIFIED:\"Modified: \",WEBDAV_ERROR_CLOSED:\"WebDAV sync has an error and is temporarily closed.\",HOST:\"Host\",USER:\"User\",PASSWORD:\"Password\",BASEPATH:\"Base Path\",DATA_CONFLICT:\"A data synchronization conflict occurred\",DATA_CONFLICT_MESSAGE:\"Select the data you want to keep\",WEBDAV_DATA:\"WebDAV data\",LOCAL_DATA:\"Local data\",ADD_TO_TAIO:\"Add to Taio\",SELECT_TAIO_APP:\"Please select Taio App from the Share menu.\",ACTION_SAFETY_WARNING:\"Action safety warning\",ACTION_PERMISSION_REQUEST:\"Action permission request\",ACTION_RESET_NAME_WARNING:\"Action `${name}` is attempting to change its name to `${to_name}`, which may result in it gaining all permissions associated with `${to_name}`.\",ACTION_NETWORK_PERMISSION_MESSAGE:\"Would you like to grant Action `${name}` network permissions?\",Return:\"Return\",Go:\"Go\",Google:\"Google\",Join:\"Join\",Next:\"Next\",Route:\"Route\",Search:\"Search\",Send:\"Send\",Yahoo:\"Yahoo\",Done:\"Done\",\"Emergency Call\":\"Emergency Call\",Continue:\"Continue\",Joining:\"Joining\",\"Route Continue\":\"Route Continue\"},\"zh-Hans\":{AUTHOR:\"作者\",ALERT_INFO:\"提示\",NONE:\"什么都没有\",DONE:\"完成\",CLOSE:\"关闭\",FAILED_TO_LOAD_VIEW:\"加载视图失败\",VIEW_NOT_PROVIDED:\"未提供该视图\",UNCATEGORIZED:\"未分类\",SHARE:\"分享\",CLICK_TO_OPEN_JSBOX:\"点击标题打开主应用。\",CLIPS:\"剪切板\",CLIPBOARD:\"剪切板\",UNIVERSAL_CLIPBOARD:\"通用剪贴板\",UNIVERSAL_CLIPBOARD_TIPS:\"用剪贴板允许您在 iPhone 上复制某些内容，然后使用 iCloud 将其粘贴到 Mac 上(反之亦然)。\",CLIPS_STRUCTURE_ERROR:\"剪切板数据结构异常\",CLIPBOARD_NO_CHANGE:\"剪切板无变化\",RECYCLE_BIN:\"回收站\",ADD:\"添加\",TAG:\"标签\",ADD_TAG:\"添加标签\",EDIT:\"编辑\",SEARCH:\"搜索\",SEARCH_HISTORY:\"搜索历史\",SEARCH_RESULT:\"搜索结果\",NO_SEARCH_RESULT:\"搜索无结果\",FAVORITE:\"收藏\",COPY:\"复制\",COPIED:\"已复制\",SORT:\"排序\",ACTIONS:\"动作\",MORE_ACTIONS:\"更多动作\",PREVIEW:\"预览\",MAX_ITEM_LENGTH:\"行数限制\",TEXT_MAX_LENGTH:\"显示字符长度\",AUTO_SAVE:\"自动保存\",AUTO_SYNC:\"自动同步\",SYNC_NOW:\"立即同步\",UNZIP_FAILED:\"解压文件失败\",REBUILD:\"重建\",REBUILD_DATABASE:\"重建数据库\",REBUILD_DATABASE_ALERT:\"重建数据库将会丢失顺序信息，是否确认重建？\",DELETE_ALL_DATA:\"删除所有数据\",DELETE_ALL_DATA_ALERT:\"确定要删除所有数据吗？\",DELETE_DATA:\"删除数据\",DELETE_TABLE:\"删除 `${table}` 的所有数据？\",SELECT_ALL:\"全选\",DESELECT_ALL:\"取消全选\",EDITOR:\"编辑器\",CREATE_NEW:\"新建\",CREATE_NEW_ACTION:\"新建动作\",CREATE_NEW_TYPE:\"新建分类\",TYPE_ALREADY_EXISTS:\"该类别已经存在\",EDIT_DETAILS:\"编辑信息\",EDIT_SCRIPT:\"编辑脚本\",INFORMATION:\"信息\",NAME:\"名称\",ICON:\"图标\",CATEGORY:\"分类\",EDIT_CATEGORY:\"编辑分类\",\"delete.category\":\"删除分类 ${category}\",\"delete.category.keep.actions\":\"是否保留该分类中的动作？\",DESCRIPTION:\"描述\",CODE:\"代码\",TEXT_INSETS:\"文本下边距\",SHOW_LINE_NUMBER:\"显示行号\",LIGHT_MODE_THEME:\"浅色模式主题\",DARK_MODE_THEME:\"深色模式主题\",SAVE:\"保存\",SAVE_SUCCESS:\"保存成功\",SAVE_ERROR:\"保存失败\",DELETE:\"删除\",CONFIRM:\"确认\",DELETE_CONFIRM_MSG:\"确认要删除吗？\",DELETE_SUCCESS:\"删除成功\",DELETE_ERROR:\"删除失败\",IMPORT_EXAMPLE_ACTIONS:\"导入示例动作\",REBUILD_ACTION_DATABASE:\"重建动作库\",REBUILD_ACTION_DATABASE_ALERT_TITLE:\"您确认要重建？\",REBUILD_ACTION_DATABASE_ALERT_MESSAGE:\"重建会同时删除保存在 WebDAV 中的数据！(如果开启的话)\",EXPORT:\"导出\",IMPORT:\"导入\",FILE_TYPE_ERROR:\"文件类型不符\",OVERWRITE_ALERT:\"该操作将会覆盖当前数据，是否继续？\",UNABLE_CREATE_ACTION:\"无法创建动作\",ACTION_NAME_ALREADY_EXISTS:\"动作 `${name}` 已存在\",IMPORT_FROM_FILE:\"从文件导入\",DEIT_CATEGORY:\"编辑分类\",KEYBOARD:\"键盘\",KEYBOARD_HEIGHT:\"键盘高度\",USE_BLUR:\"使用模糊效果\",BACKGROUND_IMAGE:\"背景图片\",DELETE_DELAY:\"删除延时\",SWITCH_AFTER_INSERT:\"输入后切换\",JSBOX_TOOLBAR:\"JSBox 工具栏\",QUICK_START_SCRIPTS:\"快速启动脚本\",SEND:\"发送\",OPEN_IN_JSBOX:\"在 JSBox 中打开\",SWITCH_KEYBOARD:\"切换键盘\",TAPTIC_ENGINE:\"触感反馈\",TAPTIC_ENGINE_LEVEL:\"触感反馈强度\",TAPTIC_ENGINE_FOR_DELETE:\"删除按钮触感反馈\",SPACE:\"空格\",ALL_SCRIPTS:\"所有脚本\",SELECT_SCRIPTS:\"选择脚本\",FONT_SIZE:\"字体大小\",LIST:\"列表\",MATRIX:\"网格\",PIN_ACTION:\"置顶动作\",\"keyboard.excludePin\":\"列表中排除已置顶\",CHECK_UPDATE:\"检查更新\",UPDATE:\"更新\",WIDGET:\"小组件\",RECENT:\"最近内容\",CLICK_ACTION:\"点击事件\",TODAY_WIDGET:\"通知中心小组件\",PREV_PAGE:\"上一页\",NEXT_PAGE:\"下一页\",DISPLAY_MODE:\"显示模式\",CLASSIC:\"经典\",MODERN:\"现代\",FILE_MANAGEMENT:\"文件管理\",\"compatibility.rebuildUserAction.alert.title\":\"我们需要重建部分动作！\",\"compatibility.rebuildUserAction.alert.message\":\"如果您点击 好，以下动作将会被重建：\",\"compatibility.rebuildUserAction.alert.message2\":\"只有动作逻辑会被更改，名称和图标将维持现状。\",EXPERIMENTAL:\"实验功能\",SYNC_ACTIONS:\"动作同步\",SYNCING:\"正在同步...\",LAST_SYNC_AT:\"最后同步：\",MODIFIED:\"最近修改：\",WEBDAV_ERROR_CLOSED:\"WebDAV 同步出错，暂时关闭。\",HOST:\"Host\",USER:\"User\",PASSWORD:\"Password\",BASEPATH:\"Base Path\",DATA_CONFLICT:\"数据同步发生冲突\",DATA_CONFLICT_MESSAGE:\"请选择想要保留的数据\",WEBDAV_DATA:\"WebDAV 数据\",LOCAL_DATA:\"本地数据\",ADD_TO_TAIO:\"添加到 Taio\",SELECT_TAIO_APP:\"请在分享菜单中选择 Taio App\",ACTION_SAFETY_WARNING:\"动作安全警告\",ACTION_PERMISSION_REQUEST:\"动作权限申请\",ACTION_RESET_NAME_WARNING:\"动作 `${name}` 正在尝试将名称改为 `${to_name}`，这可能导致其获取 `${to_name}` 的所有权限\",ACTION_NETWORK_PERMISSION_MESSAGE:\"是否允许动作 `${name}` 获取网络权限？\",Return:\"返回\",Go:\"前往\",Google:\"谷歌\",Join:\"加入\",Next:\"下一步\",Route:\"路线\",Search:\"搜索\",Send:\"发送\",Yahoo:\"雅虎\",Done:\"完成\",\"Emergency Call\":\"紧急呼叫\",Continue:\"继续\",Joining:\"正在加入\",\"Route Continue\":\"继续路线\"}},$app.theme=\"auto\",$app.minSDKVer=\"2.19.0\",$app.minOSVer=\"14.0.0\",$app.idleTimerDisabled=!1,$app.keyboardToolbarEnabled=!0,$app.rotateDisabled=!1,__INFO__={name:\"CAIO\",version:\"2.4.4\",author:\"ipuppet\",module:!1},__README__={\"README.md\":'# CAIO\\r\\n\\r\\n> Clipboard all in one.  \\r\\n> An iOS clipboard tool based on JSBox.\\r\\n\\r\\n[See My Blog](https://blog.ultagic.com/#/detail/42/)\\r\\n\\r\\nSupport for home widgets and notification center widgets.\\r\\n\\r\\n## Build Taio Action\\r\\n\\r\\nThe build script depends on [Parcel](https://parceljs.org/).\\r\\n\\r\\n```shell\\r\\nnpm i -g parcel\\r\\nnpm run build\\r\\n```\\r\\n\\r\\nYou can also use the packaged files directly [dist/CAIO.json](./dist/CAIO.json).\\r\\n\\r\\n## Actions\\r\\n\\r\\n> For details on how to write, see `scripts/action/README.md` or the book button in the upper right corner of the `Action` edit page in the app.\\r\\n\\r\\n### `Action` data differences in different environments\\r\\n\\r\\n- The data processed by the `Action` button at the top of the home page is the currently copied content.\\r\\n- The data processed by the `Action` menu that pops up by long-pressing the list is the selected content.\\r\\n- The data processed by the `Action` button in the editor is whatever is being edited.\\r\\n\\r\\n## Today Widget\\r\\n\\r\\n> Click to copy, long press to trigger the action.\\r\\n\\r\\nPlease try to avoid using the Today Widget when JSBox is running CAIO.\\r\\n\\r\\n## WebDAV\\r\\n\\r\\n> Sync data with WebDAV.\\r\\n\\r\\nConfig Example:  \\r\\nHost: `https://example.com/dav`  \\r\\nUser: `guest`  \\r\\nPassword: `password123`  \\r\\nBase Path: `/path/to/save`\\r\\n\\r\\n## Shortcuts\\r\\n\\r\\nPlease add a new action called `Run JSBox script` and set the `Name` parameter to `CAIO`.\\r\\n\\r\\nNext, set the `Parameter Dictionary` to a `Dictionary`.\\r\\n\\r\\n### Clips\\r\\n\\r\\n| Parameter | Type   |\\r\\n| --------- | ------ |\\r\\n| set       | Text   |\\r\\n| get       | Number |\\r\\n| delete    | Number |\\r\\n| table     | Text   |\\r\\n\\r\\n- `set`: The content will be saved to CAIO unless there is already an existing item with the same content.\\r\\n- `get`: The item at the specified index (e.g., 0) will be returned.\\r\\n- `delete`: The item at the specified index (e.g., 0) will be deleted, returning its content.\\r\\n- `table`: It will specify the table to either set or get the item from, with options being `[\"favorite\", \"clips\"]`. This parameter is optional and has a default value of `clips`.\\r\\n\\r\\n### Run Action\\r\\n\\r\\nAll `ActionData` parameters are supported, e.g. `args`.\\r\\n\\r\\n| Parameter | Type |\\r\\n| --------- | ---- |\\r\\n| runAction | Text |\\r\\n| text      | Text |\\r\\n\\r\\n- `runAction`: Long press the action on the JSBox action page to copy the URL Schema and fill it in here.\\r\\n- `text`: Optional parameter to pass content to the action. When running JSBox in a shortcut, the script cannot access clipboard content, so you need to pass it through this parameter (use the shortcut\\'s `Get Clipboard` action).\\r\\n',\"README_CN.md\":'# CAIO\\r\\n\\r\\n> Clipboard all in one.  \\r\\n> An iOS clipboard tool based on JSBox.\\r\\n\\r\\n[查看我的博客](https://blog.ultagic.com/#/detail/42/)\\r\\n\\r\\n支持桌面小组件和通知中心小组件\\r\\n\\r\\n## 构建 Taio 动作\\r\\n\\r\\n构建脚本依赖 [Parcel](https://parceljs.org/)\\r\\n\\r\\n```shell\\r\\nnpm i -g parcel\\r\\nnpm run build\\r\\n```\\r\\n\\r\\n您也可以直接使用已打包好的文件 [dist/CAIO.json](./dist/CAIO.json)\\r\\n\\r\\n## Actions\\r\\n\\r\\n> 编写方式详见 `scripts/action/README.md` 或应用内 `Action` 编辑页面右上角图书按钮。\\r\\n\\r\\n### 不同环境中 `Action` 数据区别\\r\\n\\r\\n- 首页顶部 `Action` 按钮处理的数据为当前复制的内容\\r\\n- 长按列表弹出的 `Action` 菜单处理的数据为被选中的内容\\r\\n- 编辑器中顶部 `Action` 按钮（闪电图形按钮）处理的数据为正在编辑的所有内容\\r\\n\\r\\n## Today Widget\\r\\n\\r\\n> 点击复制，长按触发动作。\\r\\n\\r\\n请尽量避免在 JSBox 运行 CAIO 时使用 Today Widget\\r\\n\\r\\n## WebDAV\\r\\n\\r\\n> 通过 WebDAV 同步数据\\r\\n\\r\\n示例配置:  \\r\\nHost: `https://example.com/dav`  \\r\\nUser: `guest`  \\r\\nPassword: `password123`  \\r\\nBase Path: `/path/to/save`\\r\\n\\r\\n## 快捷指令\\r\\n\\r\\n添加一个名为 `运行 JSBox 脚本` 的动作，并将 `脚本名` 参数设置为 `CAIO`。\\r\\n\\r\\n然后将 `参数词典` 设置为一个 `字典`。\\r\\n\\r\\n### 剪切板相关\\r\\n\\r\\n| 参数   | 类型   |\\r\\n| ------ | ------ |\\r\\n| set    | Text   |\\r\\n| get    | Number |\\r\\n| delete | Number |\\r\\n| table  | Text   |\\r\\n\\r\\n- `set`：将把内容保存到CAIO中，除非已存在相同内容的项。\\r\\n- `get`：将返回指定索引（例如：0）处的项。\\r\\n- `delete`：将删除指定索引（例如：0）处的项，返回该项内容。\\r\\n- `table`：将指定要设置或获取项的表格，可选项为 `[\"favorite\", \"clips\"]`。此项可省略，默认值为 `clips`。\\r\\n\\r\\n### 运行动作\\r\\n\\r\\n支持所有 `ActionData` 参数，如 `args`。\\r\\n\\r\\n| 参数      | 类型 |\\r\\n| --------- | ---- |\\r\\n| runAction | Text |\\r\\n| text      | Text |\\r\\n\\r\\n- `runAction`：在 JSBox 动作页面长按动作，复制 URL Schema，填写到此栏。\\r\\n- `text`：可选参数，传递给动作的内容。快捷指令中运行 JSBox 时脚本无法获取剪切板内容，需要通过此参数传递（使用快捷指令的 `获取剪切板` 动作）。\\r\\n'},__ACTIONS__={clipboard:{B23Clean:{config:'{\\n    \"icon\": \"trash\",\\n    \"color\": \"#FF0000\",\\n    \"name\": \"b23 清除追踪\"\\n}',main:'/**\\n * @typedef {import(\"../../action\").Action} Action\\n */\\nclass MyAction extends Action {\\n    l10n() {\\n        return {\\n            \"zh-Hans\": {\\n                \"b23clean.converting\": \"正在转换...\",\\n                \"b23clean.noUrl\": \"未检测到链接\",\\n                \"b23clean.noBiliUrl\": \"未检测到 bilibili 链接\",\\n                \"b23clean.success\": \"已转换为 BV 视频链接\",\\n                \"b23clean.noChange\": \"无变化\",\\n                \"b23clean.multipleLinks\": \"多条链接仅在编辑模式下可用。\"\\n            },\\n            en: {\\n                \"b23clean.converting\": \"Converting...\",\\n                \"b23clean.noUrl\": \"No link detected\",\\n                \"b23clean.noBiliUrl\": \"bilibili link not detected\",\\n                \"b23clean.success\": \"Converted to BV video link\",\\n                \"b23clean.noChange\": \"No change\",\\n                \"b23clean.multipleLinks\": \"Multiple links are only available in edit mode.\"\\n            }\\n        }\\n    }\\n\\n    async cleanUrl(b23url) {\\n        if (b23url.indexOf(\"bilibili.com\") === -1 && b23url.indexOf(\"b23.tv\") === -1) {\\n            throw new Error($l10n(\"b23clean.noBiliUrl\"))\\n        }\\n\\n        let url = b23url\\n        if (b23url.indexOf(\"b23.tv\") >= 0) {\\n            const resp = await $http.get(b23url)\\n            url = resp.response.url\\n        }\\n\\n        const queryStart = url.indexOf(\"?\")\\n        if (queryStart > -1) {\\n            url = url.substring(0, queryStart - 1)\\n        }\\n\\n        return url\\n    }\\n\\n    /**\\n     * 系统会调用 do() 方法\\n     */\\n    async do() {\\n        $ui.toast($l10n(\"b23clean.converting\"), 1000)\\n\\n        try {\\n            const b23url = this.getUrls()\\n            if (b23url.length === 0) {\\n                throw new Error($l10n(\"b23clean.noUrl\"))\\n            }\\n\\n            if (b23url.length === 1) {\\n                let url = await this.cleanUrl(b23url[0])\\n                $ui.clearToast()\\n                $ui.alert({\\n                    title: $l10n(\"b23clean.success\"),\\n                    message: url,\\n                    actions: [\\n                        { title: $l10n(\"OK\") },\\n                        {\\n                            title: $l10n(\"COPY\"),\\n                            handler: () => {\\n                                $clipboard.text = url\\n                                $ui.success($l10n(\"COPIED\"))\\n                            }\\n                        }\\n                    ]\\n                })\\n            } else {\\n                if (this.env !== ActionEnv.editor) {\\n                    $ui.toast($l10n(\"b23clean.multipleLinks\"))\\n                    return\\n                }\\n                let flag = false\\n                for (let i = 0; i < b23url.length; i++) {\\n                    try {\\n                        const url = b23url[i].trim()\\n                        const replacedUrl = await this.cleanUrl(url)\\n                        flag = true\\n\\n                        if (url !== replacedUrl) {\\n                            const newText = this.text.replace(url, replacedUrl)\\n                            this.setContent(newText)\\n                        }\\n                    } catch {}\\n                }\\n                if (!flag) {\\n                    throw new Error($l10n(\"b23clean.noBiliUrl\"))\\n                } else {\\n                    $ui.toast($l10n(\"b23clean.noChange\"))\\n                }\\n            }\\n        } catch (error) {\\n            $ui.clearToast()\\n            $delay(0.5, () => $ui.error(error))\\n        }\\n    }\\n}\\n',readme:\"## B23Clean\\n\\n清除 b23.tv 分享链接中的追踪参数，转换为 BV 视频链接。\"},CleanClipboard:{config:'{\\n    \"icon\": \"trash\",\\n    \"color\": \"#FF0000\",\\n    \"name\": \"清除剪切板\"\\n}',main:'/**\\n * @typedef {import(\"../../action\").Action} Action\\n */\\nclass MyAction extends Action {\\n    l10n() {\\n        return {\\n            \"zh-Hans\": {\\n                \"clipboard.clean.success\": \"剪切板已清空\"\\n            },\\n            en: {\\n                \"clipboard.clean.success\": \"Clipboard is cleaned\"\\n            }\\n        }\\n    }\\n\\n    /**\\n     * 系统会调用 do() 方法\\n     */\\n    do() {\\n        $clipboard.clear()\\n        $ui.success($l10n(\"clipboard.clean.success\"))\\n    }\\n}\\n',readme:\"## CleanClipboard\\n\\n清空当前剪切板内容。\"},DownloadFromUrl:{config:'{\\n    \"icon\": \"square.and.arrow.down\",\\n    \"color\": \"#FF0099\",\\n    \"name\": \"从链接下载\"\\n}',main:'class MyAction extends Action {\\n    async downloadContent(url) {\\n        const response = await $http.get({\\n            url,\\n            showsProgress: true\\n        })\\n        if (response.error) {\\n            $ui.alert(response.error.localizedDescription)\\n        } else {\\n            return response\\n        }\\n    }\\n\\n    async do() {\\n        const url = this.getUrls()\\n        let response = undefined\\n        if (url.length > 1) {\\n            $ui.menu({\\n                items: url,\\n                handler: async (title, index) => {\\n                    response = await this.downloadContent(url[index])\\n                }\\n            })\\n        } else if (url.length === 1) {\\n            response = await this.downloadContent(url[0])\\n        } else {\\n            $ui.warning(\"未检测到链接\")\\n            return\\n        }\\n        $share.sheet([\\n            {\\n                name: response.response.suggestedFilename,\\n                data: response.data\\n            }\\n        ])\\n        return response\\n    }\\n}\\n',readme:\"## DownloadFromUrl\\n\\n从链接下载内容，如 js 文件内容等。\"},GetFromWin:{config:'{\\n    \"icon\": \"square.and.arrow.down\",\\n    \"color\": \"#33CC33\",\\n    \"name\": \"读取 clipsync\"\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    key = $cache.get(\"caio.action.clipsync.key\")\\r\\n    iv = $cache.get(\"caio.action.clipsync.iv\")\\r\\n    address = $cache.get(\"caio.action.clipsync.address\")\\r\\n\\r\\n    async getInfo(refresh = false) {\\r\\n        if (refresh || !this.address || !this.key || !this.iv) {\\r\\n            const result = await this.input([\\r\\n                {\\r\\n                    key: \"key\",\\r\\n                    value: this.key,\\r\\n                    placeholder: \"key\"\\r\\n                },\\r\\n                {\\r\\n                    key: \"iv\",\\r\\n                    value: this.iv,\\r\\n                    placeholder: \"iv\"\\r\\n                },\\r\\n                {\\r\\n                    key: \"address\",\\r\\n                    value: this.address,\\r\\n                    placeholder: \"Address\"\\r\\n                }\\r\\n            ])\\r\\n            this.key = result.key\\r\\n            this.iv = result.iv\\r\\n            this.address = result.address\\r\\n\\r\\n            $cache.set(\"caio.action.clipsync.key\", this.key)\\r\\n            $cache.set(\"caio.action.clipsync.iv\", this.iv)\\r\\n            $cache.set(\"caio.action.clipsync.address\", this.address)\\r\\n        }\\r\\n\\r\\n        if (!this.address.startsWith(\"http\")) {\\r\\n            this.address = \"http://\" + this.address\\r\\n        }\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        await this.getInfo()\\r\\n\\r\\n        $ui.toast(\"Loading...\", 5)\\r\\n        try {\\r\\n            const resp = await this.request(this.address + \"/api/clip\", \"GET\")\\r\\n            if (resp.data.status) {\\r\\n                const aes = this.aes(this.key, this.iv)\\r\\n                const data = aes.decrypt(resp.data.data)\\r\\n                $clipboard.text = data\\r\\n                if ($app.env === $env.keyboard) {\\r\\n                    $keyboard.insert(data)\\r\\n                }\\r\\n                $ui.success(\"success\")\\r\\n            }\\r\\n        } catch (error) {\\r\\n            $ui.clearToast()\\r\\n            $ui.alert({\\r\\n                title: \"Error\",\\r\\n                message: String(error),\\r\\n                actions: [\\r\\n                    { title: \"OK\" },\\r\\n                    {\\r\\n                        title: \"Reset\",\\r\\n                        handler: () => this.getIp(true)\\r\\n                    }\\r\\n                ]\\r\\n            })\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## GetFromWin\\n\\n通 clipsync 读取 PC 剪切板。\\n\\n服务端：[clipsync](https://github.com/ipuppet/clipsync)\\n\"},OpenUrl:{config:'{\\n    \"icon\": \"link\",\\n    \"color\": \"#FF0099\",\\n    \"name\": \"打开链接\"\\n}',main:'class MyAction extends Action {\\n    l10n() {\\n        return {\\n            \"zh-Hans\": {\\n                \"openLink.nourl\": \"未检测到链接\"\\n            },\\n            en: {\\n                \"openLink.nourl\": \"No link detected\"\\n            }\\n        }\\n    }\\n\\n    openUrl(url) {\\n        $app.openURL(url.trim())\\n    }\\n\\n    do() {\\n        const url = this.getUrls()\\n        if (this.env === ActionEnv.siri) {\\n            // 快捷指令 Number 无法输入符号，所以使用字符串代替\\n            const idx = Number(this.args)\\n            if (idx === -1) {\\n                // 返回对象方便快捷指令处理\\n                return Object.fromEntries(url.map((v, i) => [i.toString(), v]))\\n            }\\n            this.openUrl(url[idx])\\n            return url[idx]\\n        }\\n        if (url.length > 1) {\\n            $ui.menu({\\n                items: url,\\n                handler: (title, index) => {\\n                    this.openUrl(url[index])\\n                }\\n            })\\n        } else if (url.length === 1) {\\n            this.openUrl(url[0])\\n        } else {\\n            $ui.warning($l10n(\"openLink.nourl\"))\\n        }\\n    }\\n}\\n',readme:\"## OpenUrl\\n\\n提取文本中的URL并打开。\"},RawRepoConverter:{config:'{\\r\\n    \"icon\": \"link\",\\r\\n    \"color\": \"#FF0099\",\\r\\n    \"name\": \"RawRepoConverter\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    #component\\r\\n\\r\\n    get component() {\\r\\n        if (!this.#component) {\\r\\n            const url = String(this.text)\\r\\n            const path = url.substring(url.indexOf(\"/\", \"https://\".length) + 1)\\r\\n            this.#component = path.split(\"/\")\\r\\n        }\\r\\n        return this.#component\\r\\n    }\\r\\n\\r\\n    l10n() {\\r\\n        return {\\r\\n            \"zh-Hans\": {\\r\\n                \"openLink.nourl\": \"未检测到链接\"\\r\\n            },\\r\\n            en: {\\r\\n                \"openLink.nourl\": \"No link detected\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    githubusercontent() {\\r\\n        const user = this.component[0],\\r\\n            repository = this.component[1],\\r\\n            branch = this.component[2],\\r\\n            file = this.component.slice(3).join(\"/\")\\r\\n        return `https://github.com/${user}/${repository}/blob/${branch}/${file}`\\r\\n    }\\r\\n\\r\\n    github() {\\r\\n        const user = this.component[0],\\r\\n            repository = this.component[1],\\r\\n            blob = this.component[2],\\r\\n            branch = this.component[3],\\r\\n            file = this.component.slice(4).join(\"/\")\\r\\n        return `https://raw.githubusercontent.com/${user}/${repository}/${branch}/${file}`\\r\\n    }\\r\\n\\r\\n    do() {\\r\\n        let result\\r\\n        const url = String(this.text)\\r\\n        if (url.includes(\"raw.githubusercontent.com\")) {\\r\\n            result = this.githubusercontent(url)\\r\\n        } else if (url.includes(\"github.com\")) {\\r\\n            if (url.includes(\"?raw=true\")) {\\r\\n                result = url.replace(\"?raw=true\", \"\")\\r\\n            } else {\\r\\n                result = this.github()\\r\\n            }\\r\\n        } else {\\r\\n            $ui.warning($l10n(\"openLink.nourl\"))\\r\\n            return\\r\\n        }\\r\\n\\r\\n        $ui.success($l10n(\"COPIED\"))\\r\\n        $clipboard.text = result\\r\\n    }\\r\\n}\\r\\n',readme:\"## RawRepoConverter\\r\\n\\r\\nGithub Raw 链接和 Repository 链接转换器\\r\\n\"},SendToWin:{config:'{\\n    \"icon\": \"square.and.arrow.up\",\\n    \"color\": \"#33CC33\",\\n    \"name\": \"推送 clipsync\"\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    key = $cache.get(\"caio.action.clipsync.key\")\\r\\n    iv = $cache.get(\"caio.action.clipsync.iv\")\\r\\n    address = $cache.get(\"caio.action.clipsync.address\")\\r\\n\\r\\n    async getInfo(refresh = false) {\\r\\n        if (refresh || !this.address || !this.key || !this.iv) {\\r\\n            const result = await this.input([\\r\\n                {\\r\\n                    key: \"key\",\\r\\n                    value: this.key,\\r\\n                    placeholder: \"key\"\\r\\n                },\\r\\n                {\\r\\n                    key: \"iv\",\\r\\n                    value: this.iv,\\r\\n                    placeholder: \"iv\"\\r\\n                },\\r\\n                {\\r\\n                    key: \"address\",\\r\\n                    value: this.address,\\r\\n                    placeholder: \"Address\"\\r\\n                }\\r\\n            ])\\r\\n            this.key = result.key\\r\\n            this.iv = result.iv\\r\\n            this.address = result.address\\r\\n\\r\\n            $cache.set(\"caio.action.clipsync.key\", this.key)\\r\\n            $cache.set(\"caio.action.clipsync.iv\", this.iv)\\r\\n            $cache.set(\"caio.action.clipsync.address\", this.address)\\r\\n        }\\r\\n\\r\\n        if (!this.address.startsWith(\"http\")) {\\r\\n            this.address = \"http://\" + this.address\\r\\n        }\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        await this.getInfo()\\r\\n\\r\\n        $ui.toast(\"Loading...\", 5)\\r\\n        try {\\r\\n            const aes = this.aes(this.key, this.iv)\\r\\n            const data = this.selectedText ?? this.text ?? \"\"\\r\\n            const resp = await this.request(this.address + \"/api/clip\", \"POST\", {\\r\\n                data: aes.encrypt(data)\\r\\n            })\\r\\n            if (resp.data.status) {\\r\\n                $ui.success(\"success\")\\r\\n            }\\r\\n        } catch (error) {\\r\\n            $ui.clearToast()\\r\\n            $ui.alert({\\r\\n                title: \"Error\",\\r\\n                message: String(error),\\r\\n                actions: [\\r\\n                    { title: \"OK\" },\\r\\n                    {\\r\\n                        title: \"Reset Adress\",\\r\\n                        handler: () => this.getInfo(true)\\r\\n                    }\\r\\n                ]\\r\\n            })\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## SendToWin\\n\\n通 clipsync 推送剪切板至 PC。\\n\\n服务端：[clipsync](https://github.com/ipuppet/clipsync)\\n\"},Tokenize:{config:'{\\n    \"icon\": \"pencil.and.ellipsis.rectangle\",\\n    \"color\": \"#0099FF\",\\n    \"name\": \"分词复制\"\\n}',main:'class MyAction extends Action {\\n    getView() {\\n        const color = {\\n            background: {\\n                normal: $color(\"#E7F2FF\", \"#E7F2FF\"),\\n                highlight: $color(\"##074FF\", \"#BBDAFF\")\\n            },\\n            text: {\\n                normal: $color(\"##074FF\", \"##074FF\"),\\n                highlight: $color(\"#FFFFFF\", \"#ADADAD\")\\n            }\\n        }\\n        const fontSize = 16\\n        const edges = 10\\n        return {\\n            type: \"matrix\",\\n            layout: $layout.fill,\\n            props: {\\n                spacing: edges,\\n                data: this.results.map(item => ({ label: { text: item } })),\\n                template: {\\n                    views: [{\\n                        type: \"label\",\\n                        props: {\\n                            id: \"label\",\\n                            align: $align.center,\\n                            cornerRadius: edges,\\n                            bgcolor: color.background.normal,\\n                            font: $font(fontSize),\\n                            textColor: color.text.normal\\n                        },\\n                        layout: $layout.fill\\n                    }]\\n                }\\n            },\\n            events: {\\n                highlighted: () => { },\\n                itemSize: (sender, indexPath) => {\\n                    const width = fontSize * this.results[indexPath.item].length + 1\\n                    if (this.maxtrixItemHeight === undefined)\\n                        this.maxtrixItemHeight = fontSize + edges * 2\\n                    return $size(width + edges * 2, this.maxtrixItemHeight)\\n                },\\n                didSelect: (sender, indexPath) => {\\n                    const index = this.selected.indexOf(indexPath.item)\\n                    const label = sender.cell(indexPath).get(\"label\")\\n                    if (index === -1) {\\n                        this.selected.push(indexPath.item)\\n                        label.bgcolor = color.background.highlight\\n                        label.textColor = color.text.highlight\\n                    } else {\\n                        this.selected.splice(index, 1)\\n                        label.bgcolor = color.background.normal\\n                        label.textColor = color.text.normal\\n                    }\\n                }\\n            }\\n        }\\n    }\\n    /**\\n     * 系统会调用 do() 方法\\n     */\\n    do() {\\n        this.selected = []\\n        this.results = []\\n        $text.tokenize({\\n            text: this.selectedText ?? this.text,\\n            handler: results => {\\n                this.results = results\\n                this.pageSheet({\\n                    view: this.getView(),\\n                    done: () => {\\n                        const result = []\\n                        this.selected.sort().forEach(i => {\\n                            result.push(this.results[i])\\n                        })\\n                        if (result.length > 0) {\\n                            const text = result.join(\"\")\\n                            $clipboard.text = text\\n                            $ui.alert({\\n                                title: \"完成\",\\n                                message: `已复制内容：${text}`\\n                            })\\n                        }\\n                    }\\n                })\\n            }\\n        })\\n    }\\n}\\n',readme:\"## Tokenize\\n\\n将文本分词处理后复制。\"},Translate:{config:'{\\n    \"icon\": \"globe\",\\n    \"color\": \"#007AFF\",\\n    \"name\": \"Translate\"\\n}\\n',main:'class MyAction extends Action {\\n    isChinese(text) {\\n        const englishRegex = /[a-zA-Z]/g\\n        const chineseRegex = /[\\\\u4e00-\\\\u9fa5]/g\\n\\n        const englishMatches = text.match(englishRegex) ?? []\\n        const chineseMatches = text.match(chineseRegex) ?? []\\n\\n        const englishCount = englishMatches.length\\n        const chineseCount = chineseMatches.length\\n\\n        return chineseCount > englishCount\\n    }\\n\\n    async translate(text) {\\n        try {\\n            const query = {\\n                client: \"gtx\",\\n                dt: \"t\",\\n                sl: \"auto\",\\n                tl: this.isChinese(text) ? \"en\" : \"zh-CN\",\\n                q: text\\n            }\\n            const queryStr = Object.keys(query)\\n                .map(key => `${key}=${$text.URLEncode(query[key])}`)\\n                .join(\"&\")\\n            const resp = await $http.post({\\n                url: `https://translate.google.com/translate_a/single?${queryStr}`,\\n                header: {\\n                    \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\\n                }\\n            })\\n            if (resp.response.statusCode !== 200) {\\n                if (resp.error) throw new Error(resp.error.localizedDescription)\\n                else throw new Error(resp.response.statusCode)\\n            }\\n            const data = resp.data\\n            return data[0][0][0]\\n        } catch (error) {\\n            throw new Error(`Failed to translate: ${error.message}`)\\n        }\\n    }\\n\\n    async do() {\\n        const text = this.selectedText ?? this.text\\n        const translated = await this.translate(text)\\n        if (!translated) return\\n        if (this.env === ActionEnv.keyboard) {\\n            this.replaceKeyboardText(text, translated)\\n        } else if (this.env === ActionEnv.siri) {\\n            return translated\\n        } else {\\n            this.showTextContent(translated)\\n        }\\n    }\\n}\\n',readme:\"# Translate\\n\\n使用谷歌翻译API翻译文本。\\n\"}},editor:{Paste:{config:'{\\n    \"icon\": \"doc.on.clipboard\",\\n    \"color\": \"#FF0000\",\\n    \"name\": \"Paste\"\\n}',main:'/**\\n * @typedef {import(\"../../action\").Action} Action\\n */\\nclass MyAction extends Action {\\n    do() {\\n        const text = $clipboard.text\\n        if (!text || text === \"\") return\\n        $keyboard.insert(text)\\n    }\\n}\\n',readme:\"## Paste\\n\\n向输入框输入剪切板内的内容\"},PreviewMarkdown:{config:'{\\n    \"icon\": \"book\",\\n    \"color\": \"#9900CC\",\\n    \"name\": \"预览Markdown\"\\n}',main:'class MyAction extends Action {\\n    do() {\\n        this.pageSheet({\\n            view: {\\n                type: \"markdown\",\\n                props: { content: this.text },\\n                layout: $layout.fill\\n            }\\n        })\\n    }\\n}\\n',readme:\"## PreviewMarkdown\\n\\n预览Markdown。\"},Replace:{config:'{\\n    \"icon\": \"square.and.arrow.up\",\\n    \"color\": \"#FF3300\",\\n    \"name\": \"查找替换\"\\n}',main:'function HtmlTemplate(html) {\\r\\n    return `\\r\\n<html>\\r\\n<head>\\r\\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\\r\\n</head>\\r\\n<body>\\r\\n${html}\\r\\n</body>\\r\\n</html>\\r\\n`\\r\\n}\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    do() {\\r\\n        $ui.menu({\\r\\n            items: [\"忽略大小写\", \"大小写敏感\", \"正则表达式\"],\\r\\n            handler: async (title, idx) => {\\r\\n                const patternText = await $input.text({\\r\\n                    placeholder: \"查找内容\"\\r\\n                })\\r\\n                const replaceString = await $input.text({\\r\\n                    placeholder: \"替换内容\"\\r\\n                })\\r\\n                let pattern = undefined\\r\\n                if (idx === 0) {\\r\\n                    pattern = new RegExp(`(${patternText})+`, \"gi\")\\r\\n                } else if (idx === 1) {\\r\\n                    pattern = new RegExp(`(${patternText})+`, \"g\")\\r\\n                } else if (idx === 2) {\\r\\n                    pattern = new RegExp(patternText, \"g\")\\r\\n                }\\r\\n\\r\\n                const matchResultPreview = this.text.replaceAll(pattern, `<font color=red>${replaceString}</font>`)\\r\\n                const matchResult = this.text.replaceAll(pattern, replaceString)\\r\\n                this.pageSheet({\\r\\n                    title: \"替换预览\",\\r\\n                    doneText: \"替换\",\\r\\n                    view: {\\r\\n                        type: \"web\",\\r\\n                        props: {\\r\\n                            html: HtmlTemplate(matchResultPreview)\\r\\n                        },\\r\\n                        layout: $layout.fill\\r\\n                    },\\r\\n                    done: () => {\\r\\n                        this.setContent(matchResult)\\r\\n                    }\\r\\n                })\\r\\n            }\\r\\n        })\\r\\n        // this.setContent(\"Hello world!\")\\r\\n    }\\r\\n}\\r\\n',readme:\"## Replace\\n\\n查找替换\"}},uncategorized:{ActionEditPreview:{config:'{\\r\\n    \"icon\": \"play\",\\r\\n    \"color\": \"#FF0000\",\\r\\n    \"name\": \"编辑动作即时预览示例\"\\r\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n * @typedef {import(\"../../action\").ActionData} ActionData\\r\\n * @typedef {import(\"../../action\").ActionEnv} ActionEnv\\r\\n */\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    preview() {\\r\\n        return new ActionData({\\r\\n            text: \"hello word\"\\r\\n        })\\r\\n    }\\r\\n\\r\\n    async do() {\\r\\n        try {\\r\\n            if (this.env !== ActionEnv.build) {\\r\\n                $ui.toast(\"action editor only\")\\r\\n                return\\r\\n            }\\r\\n            return this.text\\r\\n        } catch (error) {\\r\\n            $ui.alert(error)\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## ActionEditPreview\\r\\n\\r\\n编辑动作即时预览示例。\"},DeleteClips:{config:'{\\n    \"icon\": \"trash\",\\n    \"color\": \"#FF0000\",\\n    \"name\": \"删除所有剪切板\"\\n}',main:'/**\\n * @typedef {import(\"../../action\").Action} Action\\n */\\n\\nclass MyAction extends Action {\\n    async do() {\\n        try {\\n            const action = await this.clearAllClips()\\n            if (action) {\\n                $ui.success($l10n(\"DONE\"))\\n            }\\n        } catch (error) {\\n            $ui.error(error)\\n        }\\n    }\\n}\\n',readme:\"## DeleteClips\\n\\n删除所有已保存的剪切板（不包括收藏）。\"},DisplayClipboard:{config:'{\\n    \"icon\": \"option\",\\n    \"color\": \"#FF6633\",\\n    \"name\": \"显示剪切板\"\\n}',main:'/**\\r\\n * @typedef {import(\"../../action\").Action} Action\\r\\n */\\r\\n\\r\\nclass MyAction extends Action {\\r\\n    do() {\\r\\n        const image = $clipboard.image\\r\\n        if (image) {\\r\\n            this.quickLookImage(image)\\r\\n        } else {\\r\\n            this.pageSheet({\\r\\n                view: {\\r\\n                    type: \"text\",\\r\\n                    props: {\\r\\n                        editable: false,\\r\\n                        text: $clipboard.text,\\r\\n                        insets: $insets(10, 10, 10, 10)\\r\\n                    },\\r\\n                    layout: $layout.fill\\r\\n                }\\r\\n            })\\r\\n        }\\r\\n    }\\r\\n}\\r\\n',readme:\"## DisplayClipboard\\n\\n显示当前剪切板内的内容。\"},ExportAllContent:{config:'{\\n    \"icon\": \"square.and.arrow.up\",\\n    \"color\": \"#FF3300\",\\n    \"name\": \"导出数据\"\\n}',main:'class MyAction extends Action {\\n    do() {\\n        const data = this.getAllClips()\\n        if (data.clips.length > 0 || data.favorite.length > 0) {\\n            $share.sheet(JSON.stringify(data, null, 2))\\n        } else {\\n            $ui.alert(\"无数据\")\\n        }\\n    }\\n}\\n',readme:\"## ExportAllContent\\n\\n导出所有保存的数据。\"}}},__ACTION_README__={content:'# Action\\r\\n\\r\\n所有 Action 保存在 `storage/user_action` 目录下，按照文件夹分类\\r\\n\\r\\n`Action` 结构如下：\\r\\n\\r\\n- `ActionName`\\r\\n  - `config.json` 配置文件\\r\\n  - `main.js` 入口文件\\r\\n  - `README.md` 说明文件\\r\\n\\r\\n## `config.json` 配置项\\r\\n\\r\\n- `icon` 图标 可以是 [JSBox 内置图标](https://github.com/cyanzhong/xTeko/tree/master/extension-icons)、SF Symbols图标、base64图片数据和来自 url 的图片\\r\\n- `color` 颜色\\r\\n- `name` 名称\\r\\n- `description` 描述信息\\r\\n\\r\\n## `main.js` 入口文件\\r\\n\\r\\n创建名为 `MyAction` 的类并继承 `Action` 类\\r\\n\\r\\n```js\\r\\n/**\\r\\n * @typedef {import(\"scripts/action/action.js\").Action} Action\\r\\n */\\r\\n/**\\r\\n * 必须为 MyAction\\r\\n */\\r\\nclass MyAction extends Action {\\r\\n    /**\\r\\n     * 系统会调用 do() 方法\\r\\n     * 在编辑模式如果提供了返回值，则可弹窗预览返回值\\r\\n     */\\r\\n    do() {\\r\\n        console.log(this.text)\\r\\n    }\\r\\n}\\r\\n```\\r\\n\\r\\n## 父类 `Action` 的属性\\r\\n\\r\\n- `this.env`  \\r\\n  当前运行环境，参见 [ActionEnv](#ActionEnv)\\r\\n- `this.config`  \\r\\n  当前 Action 配置文件内容\\r\\n- `this.editor`  \\r\\n  参见 [ActionData](#ActionData)\\r\\n- `this.section`  \\r\\n  首页剪切板分类\\r\\n- `this.uuid`  \\r\\n  首页剪切板项目 uuid\\r\\n- `this.text`  \\r\\n  当处于键盘中运行时为输入框内文本，处于编辑器时为编辑器内文本，其他情况为剪切板内文本。(仅可获取光标行)\\r\\n- `this.selectedText`  \\r\\n  当前选中的文本\\r\\n- `this.selectedRange`  \\r\\n  在编辑器中，当前选中的文本范围 `{location: Number, length: Number}`\\r\\n- `this.textBeforeInput`  \\r\\n  键盘中输入光标之前的文本\\r\\n- `this.textAfterInput`  \\r\\n  键盘中输入光标之后的文本\\r\\n\\r\\n更多参见 [ActionData](#ActionData)\\r\\n\\r\\n## 父类的方法\\r\\n\\r\\n```js\\r\\n/**\\r\\n * 编辑动作状态下提供预览数据\\r\\n * @returns {ActionData}\\r\\n */\\r\\npreview(): ActionData\\r\\n\\r\\n/**\\r\\n * 重写该方法返回 l10n 对象可注入 l10n\\r\\n * l10n() {\\r\\n        return {\\r\\n            \"zh-Hans\": {\\r\\n                \"clipboard.clean.success\": \"剪切板已清空\"\\r\\n            },\\r\\n            en: {\\r\\n                \"clipboard.clean.success\": \"Clipboard is cleaned\"\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n */\\r\\nl10n()\\r\\n\\r\\n/**\\r\\n * page sheet\\r\\n * @param {*} args \\r\\n *  {\\r\\n        view: args.view, // 视图对象\\r\\n        title: args.title ?? \"\", // 中间标题\\r\\n        done: args.done, // 点击左上角按钮后的回调函数\\r\\n        doneText: args.doneText ?? $l10n(\"DONE\") // 左上角文本\\r\\n        rightButtons: [{ title:string, symbol:string, tapped:function }] // 右上角按钮\\r\\n    }\\r\\n * @returns {Sheet}\\r\\n  */\\r\\npageSheet(args): Sheet\\r\\nshowTextContent(text, title = \"\"): Sheet\\r\\nshowMarkdownContent(markdown, title = \"\"): Sheet\\r\\n\\r\\n/**\\r\\n * 获取所有剪切板数据\\r\\n * @returns {object}\\r\\n */\\r\\ngetAllClips(): { favorite, clips }\\r\\n\\r\\n/**\\r\\n * 更新当前文本，当用户侧滑返回时才会触发保存操作\\r\\n */\\r\\nsetContent(text): void\\r\\n\\r\\n/**\\r\\n * 获取指定的 Action 类\\r\\n * @param {string} category\\r\\n * @param {string} name config.name\\r\\n * @param {ActionData} data new ActionData({ args: any })\\r\\n * @returns\\r\\n */\\r\\ngetAction(category, name, data): any\\r\\n\\r\\n/**\\r\\n * 运行指定的 Action 并返回该 Action do() 方法的返回值\\r\\n */\\r\\nasync runAction(category, name, data): any\\r\\n\\r\\n/**\\r\\n * 从 `this.text` 中匹配所有 url\\r\\n */\\r\\ngetUrls(): []\\r\\n\\r\\n/**\\r\\n * 运行其他 JSBox 脚本\\r\\n * @param {string} name\\r\\n */\\r\\naddinRun(name): void\\r\\n```\\r\\n\\r\\n## <span id=\"ActionEnv\">ActionEnv</span>\\r\\n\\r\\n```js\\r\\nclass ActionEnv {\\r\\n    static build = -1 // 动作编辑器\\r\\n    static today = 0\\r\\n    static editor = 1\\r\\n    static clipboard = 2\\r\\n    static action = 3 // 主动作页面\\r\\n    static keyboard = 4\\r\\n    static recursion = 5\\r\\n    static widget = 6\\r\\n    static siri = 7\\r\\n}\\r\\n```\\r\\n\\r\\n## <span id=\"ActionData\">ActionData</span>\\r\\n\\r\\n```js\\r\\nclass ActionData {\\r\\n    env\\r\\n    args // 其他动作传递的参数\\r\\n    text // 自动获取文本，优先获取选中的文本\\r\\n    originalContent // 原始文本\\r\\n    section // 首页剪切板分类\\r\\n    uuid // 首页剪切板项目 uuid\\r\\n    selectedRange // 文本选中的范围\\r\\n    selectedText // 选中的文本\\r\\n    textBeforeInput // 键盘中输入光标之前的文本\\r\\n    textAfterInput // 键盘中输入光标之后的文本\\r\\n    editor // 编辑器\\r\\n}\\r\\n```\\r\\n\\r\\n其中 `editor` 如下：\\r\\n\\r\\n```js\\r\\nconst editor = {\\r\\n    originalContent,\\r\\n    setContent: text => {}\\r\\n}\\r\\n```\\r\\n'},$app.env){case $env.app:case $env.action:t=n(\"6olY1\");break;case $env.today:case $env.notification:case $env.keyboard:case $env.siri:t=n(\"ljE8b\");break;case $env.widget:t=n(\"gD12U\");break;default:$intents.finish(\"不支持在此环境中运行\"),$ui.render({views:[{type:\"label\",props:{text:\"不支持在此环境中运行\",align:$align.center},layout:$layout.fill}]})}t&&t.run()})();"
                }
            }
        }
    ],
    "buildVersion": 1,
    "clientMinVersion": 1,
    "clientVersion": 592,
    "icon": {
        "glyph": "heart.text.square",
        "color": "#FF6633"
    },
    "summary": "A Clipboard tool based on JSBox.",
    "name": "CAIO"
}